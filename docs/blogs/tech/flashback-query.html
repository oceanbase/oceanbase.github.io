<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-blogs/tech/flashback-query" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Practice of Flashback Queries in OceanBase Database | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/blogs/tech/flashback-query"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Practice of Flashback Queries in OceanBase Database | OceanBase"><meta data-rh="true" name="description" content="Misoperations such as deleting data by mistake are common in the daily work of database administrators (DBAs). To help them address these issues, we need to know how to restore data."><meta data-rh="true" property="og:description" content="Misoperations such as deleting data by mistake are common in the daily work of database administrators (DBAs). To help them address these issues, we need to know how to restore data."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/blogs/tech/flashback-query"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/blogs/tech/flashback-query" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/blogs/tech/flashback-query" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H4XM2M50RX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-H4XM2M50RX",{})</script><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.d332df5a.js" defer="defer"></script>
<script src="/assets/js/main.f609a655.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><span><li><a class="dropdown__link" href="/docs/sig/overview/list">Special Interest Group(SIG)</a></li></span><span><li><a class="dropdown__link" href="/docs/honor/overview">Community Honors</a></li></span><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://discord.gg/74cF8vbNEs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Data + AI</a><ul class="dropdown__menu"><span><li><a href="https://oceanbase-devhub.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">AI Workshops<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/ai-workshop-2024" target="_blank" rel="noopener noreferrer" class="dropdown__link">RAG Bot<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/dify/dify@oceanbase-workshop" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dify (MySQL Compatible)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/DB-GPT/docker/compose_examples/ob_dbgpt_tutorial" target="_blank" rel="noopener noreferrer" class="dropdown__link">DB-GPT<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/arch/all-in-one">Architectural Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/feat/io-isolation">Features Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/blogs/tech/DDL-Execution-Efficient">Technical Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/DDL-Execution-Efficient">Insights into OceanBase Database 4.0: How to Make DDL Execution Efficient and Transparent in a Distributed Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Materialized-Views">Explore Data Warehouses with Columnar Storage and Materialized Views of OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Modern-HBase-Arch">Simplistic Yet Not Simple: The Upgrade to a Modern HBase Architecture with OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/OpenStack-ob">OpenStack: Partnering with OceanBase Database to Build a Highly Available and Scalable Infrastructure Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Real-time-AP">OceanBase Database 4.3 - Milestone Release for Real-time AP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Standalone-distributed">Thoughts on the Integrated Architecture of OceanBase Database for Standalone and Distributed Modes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Zabbix">Zabbix and OceanBase Database Completed Product Compatibility and Mutual Certification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/adaptive-sql-execution-engine">Adaptive Techniques in the OceanBase SQL Execution Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/alter-table">Principles of ALTER TABLE in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/analysis-column">OceanBase Database V4.3 Feature Breakdown: In-depth Analysis of Columnar Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/binlog-service">OceanBase Binlog Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/column-store">The Present and Future of Columnar Storage in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/core-tech-ob">Decoding the Core Technologies of OceanBase Community Edition 4.x</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/distributed-push-down">OceanBase Distributed Pushdown Technology</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/end-to-end-tracing">Insights into OceanBase Database 4.0: Issues Addressed by End-to-end Tracing, Starting with a Slow SQL Query</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/failure-by-collation">SQL Tuning Practices - Index Failure Caused by Collations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/blogs/tech/flashback-query">Practice of Flashback Queries in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/high-concurrency">OceanBase Technical Insights for High-Concurrency Scenarios</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/hive-to-ob">From Hive to OceanBase Database: Building an Efficient Real-Time Data Warehouse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/image-search-vector-search">[OceanBase Practices] Building an Image Search Application Based on the Vector Search Technology of OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/legacy-monitoring-system">Using OceanBase Database to Store Data of a traditional Monitoring System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/native-distributed">Treat the Symptoms and the Root Cause! OceanBase Native Distributed + Single-machine Distributed Integration Solves the Problem of Sharding from the Root</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ob-db-transform">OceanBase Helps Enterprises Cope with the Challenges of Database Transformation in the Deep Waters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ob-openai">Build Your Own Document Q&amp;A App with OceanBase and OpenAI in 30 mins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ob-schema">What Is a Schema in OceanBase Database?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/obd-error">Troubleshoot obd Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-I">Mastering Parallel Execution in OceanBase Database: Part 1 - Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-II">Mastering Parallel Execution in OceanBase Database: Part 2 - Set the DOP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-III">Mastering Parallel Execution in OceanBase Database: Part 3 - Concurrency Control and Queuing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-IV">Mastering Parallel Execution in OceanBase Database: Part 4 - Parallel Execution Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-V">Mastering Parallel Execution in OceanBase Database: Part 5 - Parallel Execution Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-VI">Mastering Parallel Execution in OceanBase Database: Part 6 - Troubleshooting and Tuning Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-VII">Mastering Parallel Execution in OceanBase Database: Part 7 - Get Started with a PoC Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/partition-create">A Brief Analysis of Frequently Asked Questions about Partition Creation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/practices-binlog">Practices of OceanBase Binlog Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/pushdown-tech">Distributed Pushdown Techniques in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/query-engines">Evolution of Database Query Engines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/query-perf">Insights into OceanBase Database 4.0: Distributed Query Performance Optimization in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/real-time-analytics">Release of OceanBase Database V4.3.3: The First GA Version for Real-time Analytics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/refine-performance">How We Approach Improving Distributed Query Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/row-to-vector">From Rows to Vectors: The Evolution of the Execution Engine of OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/small-specification-deployment">Insights into OceanBase Database 4.0: Support for Small-Specification Deployment to Make Distributed Databases More Accessible</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/storage-engine">Storage Engine of OceanBase Database V4.x Cuts Historical Database Costs by over 50%</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/tablet">What Is a Tablet in OceanBase Database V4.0? Why Is It Introduced?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ticket-olap">Columnar Storage Engine: Your Ticket to OLAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/tp-to-ap">From OLTP to OLAP: Exploration and practice of the OceanBase SQL engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/trans-recovery">Principles and Practices of Transaction Recovery in Distributed Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/troubleshoot">Five Steps to Troubleshoot Process Crashes Based on Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/truncated-table">Why Truncated Tables Cannot Be Recycled in OceanBase Database V4.x?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/vector-search">Vector capabilities of OceanBase Database: find similar images in a blink</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/users/1st-financial">Corporate Cases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/showcases/architectural-evolution">Highlights</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/others/flink-and-ob">Others</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Technical Introduction</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Practice of Flashback Queries in OceanBase Database</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Practice of Flashback Queries in OceanBase Database</h1></header><p>Misoperations such as deleting data by mistake are common in the daily work of database administrators (DBAs). To help them address these issues, we need to know how to restore data.</p>
<p>OceanBase Database supports record-specific flashback queries, which allow you to obtain data of a specific historical version. Let&#x27;s have a look at how to use this feature in advance when it might be needed unexpectedly.</p>
<p>In a flashback query, <code>undo_retention</code> is used to specify the time range of data versions to be retained in minor compactions. When <code>undo_retention</code> is set to <code>0</code>, multi-version minor compaction is disabled, which indicates that only the latest version of row data is retained in the minor compaction file. When <code>undo_retention</code> is set to a value greater than 0, multi-version minor compaction is enabled, and multiple versions of row data within the specified period in seconds are retained in the minor compaction file. To recover accidentally deleted data, you can first increase the value of <code>undo_retention</code> and set <code>undo_retention</code> to the default value after data is restored.</p>
<p>Default value:</p>
<p>1800, in seconds</p>
<p>Value range:</p>
<p>[0, 4294967295]</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-preparations">1. Preparations<a href="#1-preparations" class="hash-link" aria-label="Direct link to 1. Preparations" title="Direct link to 1. Preparations">​</a></h2>
<p>Change the value of <code>undo_retention</code> and enable the recycle bin.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #Change the value of undo_retention.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; ALTER SYSTEM SET undo_retention=1800;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.004 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SHOW PARAMETERS LIKE &#x27;undo_retention&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +-------+----------+-----------------+----------+----------------+-----------+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+--------+---------+-------------------+---------------+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | zone  | svr_type | svr_ip          | svr_port | name           | data_type | value | info                                                                                                                                                                           | section | scope  | source  | edit_level        | default_value | isdefault |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +-------+----------+-----------------+----------+----------------+-----------+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+--------+---------+-------------------+---------------+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | zone1 | observer | 192.168.150.116 |     2882 | undo_retention | INT       | 1800  | the low threshold value of undo retention. The system retains undo for at least the time specified in this config when active txn protection is banned. Range: [0, 4294967295] | TENANT  | TENANT | DEFAULT | DYNAMIC_EFFECTIVE | 1800          |         1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +-------+----------+-----------------+----------+----------------+-----------+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+--------+---------+-------------------+---------------+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.004 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Enable the recycle bin and log in again to reconnect to the database.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bclient [test]&gt; SET GLOBAL recyclebin = on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.002 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SHOW VARIABLES LIKE &#x27;recyclebin&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | Variable_name | Value |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | recyclebin    | ON    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.001 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-flash-back-to-the-state-before-a-dml-operation">2. Flash Back to the State Before a DML Operation<a href="#2-flash-back-to-the-state-before-a-dml-operation" class="hash-link" aria-label="Direct link to 2. Flash Back to the State Before a DML Operation" title="Direct link to 2. Flash Back to the State Before a DML Operation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-create-a-table-and-prepare-the-required-data">2.1 Create a table and prepare the required data<a href="#21-create-a-table-and-prepare-the-required-data" class="hash-link" aria-label="Direct link to 2.1 Create a table and prepare the required data" title="Direct link to 2.1 Create a table and prepare the required data">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; create table banjin_flash (id int ,name varchar(10),dizhi varchar(10),primary key (id));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into banjin_flash values (1,&#x27;zhangsan&#x27;,&#x27;Beijing&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into banjin_flash values (2,&#x27;lisi&#x27;,&#x27;Shanghai&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into banjin_flash values (3,&#x27;wangwu&#x27;,&#x27;Tianjin&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.050 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (1,&#x27;zhangsan&#x27;,&#x27;Beijing&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.008 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (2,&#x27;lisi&#x27;,&#x27;Shanghai&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.001 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (3,&#x27;wangwu&#x27;,&#x27;Tianjin&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.001 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (4,&#x27;zhaoliu&#x27;,&#x27;Hebei&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.001 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-modify-the-table">2.2 Modify the table<a href="#22-modify-the-table" class="hash-link" aria-label="Direct link to 2.2 Modify the table" title="Direct link to 2.2 Modify the table">​</a></h3>
<p>Modify the table and record the current date and time returned by the NOW() function to facilitate subsequent data restoration.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | now()               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | 2024-10-20 17:31:13 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.000 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; update banjin_flash set dizhi = &#x27;Hunan&#x27; where name=&#x27;lisi&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.003 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Rows matched: 1  Changed: 1  Warnings: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | now()               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | 2024-10-20 17:31:30 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.000 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; delete from banjin_flash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 4 rows affected (0.002 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | now()               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | 2024-10-20 17:31:52 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.000 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-flash-back-data">2.3 Flash back data<a href="#23-flash-back-data" class="hash-link" aria-label="Direct link to 2.3 Flash back data" title="Direct link to 2.3 Flash back data">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; select * from banjin_flash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Empty set (0.001 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:31:30&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | id | name     | dizhi  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  1 | zhangsan | Beijing   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  2 | lisi     | Hunan   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  3 | wangwu   | Tianjin   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  4 | zhaoliu  | Hebei   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4 rows in set (0.000 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:31:13&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | id | name     | dizhi  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  1 | zhangsan | Beijing   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  2 | lisi     | Shanghai   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  3 | wangwu   | Tianjin   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  4 | zhaoliu  | Hebei   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4 rows in set (0.000 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the results of the preceding two flashback queries, data at different points in time is returned: the data before the deletion is returned for the first query, and the data before the update is returned for the second query.</p>
<p>You can insert the restored data into the backup table for subsequent operations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-flash-back-to-the-state-before-a-ddl-operation">3. Flash Back to the State Before a DDL Operation<a href="#3-flash-back-to-the-state-before-a-ddl-operation" class="hash-link" aria-label="Direct link to 3. Flash Back to the State Before a DDL Operation" title="Direct link to 3. Flash Back to the State Before a DDL Operation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-flash-back-the-table-to-the-state-before-an-add-column-operation">3.1 Flash back the table to the state before an ADD COLUMN operation<a href="#31-flash-back-the-table-to-the-state-before-an-add-column-operation" class="hash-link" aria-label="Direct link to 3.1 Flash back the table to the state before an ADD COLUMN operation" title="Direct link to 3.1 Flash back the table to the state before an ADD COLUMN operation">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; alter table banjin_flash add column dianhua decimal(11) default 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.038 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:44:43&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+---------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | id | name     | dizhi  | dianhua |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+---------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  1 | zhangsan | Beijing   |       1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  2 | lisi     | Hunan   |       1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  3 | wangwu   | Tianjin   |       1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  4 | zhaoliu  | Hebei   |       1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+---------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4 rows in set (0.002 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; alter table banjin_flash add column dianhua1 decimal(11) ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.034 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:44:43&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+---------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | id | name     | dizhi  | dianhua | dianhua1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+---------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  1 | zhangsan | Beijing   |       1 |     NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  2 | lisi     | Hunan   |       1 |     NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  3 | wangwu   | Tianjin   |       1 |     NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  4 | zhaoliu  | Hebei   |       1 |     NULL |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+---------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4 rows in set (0.001 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the preceding flashback query result, the default value is used in the added columns. If no default value is available, NULL is used.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-restore-the-table-to-the-state-before-a-drop-column-operation">3.2 Restore the table to the state before a DROP COLUMN operation<a href="#32-restore-the-table-to-the-state-before-a-drop-column-operation" class="hash-link" aria-label="Direct link to 3.2 Restore the table to the state before a DROP COLUMN operation" title="Direct link to 3.2 Restore the table to the state before a DROP COLUMN operation">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt;  alter table banjin_flash drop column dianhua1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.251 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:44:43&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ERROR 1412 (HY000): Unable to read data -- Table definition has changed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The table cannot be restored after a column is dropped. The following error is returned in this case: ERROR 1412 (HY000): Unable to read data -- Table definition has changed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-flash-back-the-table-to-the-state-before-a-drop-table-operation">3.3 Flash back the table to the state before a DROP TABLE operation<a href="#33-flash-back-the-table-to-the-state-before-a-drop-table-operation" class="hash-link" aria-label="Direct link to 3.3 Flash back the table to the state before a DROP TABLE operation" title="Direct link to 3.3 Flash back the table to the state before a DROP TABLE operation">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; drop table banjin_flash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.022 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:51:30&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ERROR 1146 (42S02): Table &#x27;test.banjin_flash&#x27; doesn&#x27;t exist</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the table is dropped, it cannot be directly restored. An error is returned, indicating that the table does not exist.</p>
<p>In this case, restore the table from the recycle bin and perform a flashback query again.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; select * from banjin_flash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Empty set (0.001 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; show recyclebin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +--------------------------------+---------------+-------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | OBJECT_NAME                    | ORIGINAL_NAME | TYPE  | CREATETIME                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +--------------------------------+---------------+-------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | __recycle_$_1_1729417897979024 | banjin_flash  | TABLE | 2024-10-20 17:51:37.978166 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +--------------------------------+---------------+-------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.002 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; FLASHBACK TABLE __recycle_$_1_1729417897979024 TO BEFORE DROP;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.033 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:51:30&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | id | name     | dizhi  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  1 | zhangsan | Beijing   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  2 | lisi     | Shanghai   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  3 | wangwu   | Tianjin   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  4 | zhaoliu  | Hebei   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----+----------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4 rows in set (0.008 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-flash-back-to-the-state-before-a-truncate-operation">4. Flash Back to the State Before a TRUNCATE Operation<a href="#4-flash-back-to-the-state-before-a-truncate-operation" class="hash-link" aria-label="Direct link to 4. Flash Back to the State Before a TRUNCATE Operation" title="Direct link to 4. Flash Back to the State Before a TRUNCATE Operation">​</a></h2>
<p>TRUNCATE is a special DDL operation, for which the flashback feature needs to be described separately.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (1,&#x27;zhangsan&#x27;,&#x27;Beijing&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.007 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (2,&#x27;lisi&#x27;,&#x27;Shanghai&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.001 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (3,&#x27;wangwu&#x27;,&#x27;Tianjin&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.001 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; insert into banjin_flash values (4,&#x27;zhaoliu&#x27;,&#x27;Hebei&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.001 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | now()               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | 2024-10-20 18:42:47 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.000 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; update banjin_flash set dizhi = &#x27;Hunan&#x27; where name=&#x27;lisi&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 1 row affected (0.002 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Rows matched: 1  Changed: 1  Warnings: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | now()               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | 2024-10-20 18:42:48 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.000 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; truncate table banjin_flash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.040 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 18:42:47&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ERROR 1412 (HY000): Unable to read data -- Table definition has changed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>&quot;ERROR 1412 (HY000): Unable to read data -- Table definition has changed&quot; is reported when you flash back the table to the state before it was truncated.</p>
<p>The definition and procedure of a TRUNCATE operation are as follows according to the OceanBase Database official website:</p>
<p>To execute the <code>TRUNCATE TABLE</code> statement, you must have the <code>DROP</code> privilege on the table. It is a DDL statement.</p>
<p><code>TRUNCATE TABLE</code> and <code>DELETE FROM</code> have the following differences:</p>
<ul>
<li><strong>A TRUNCATE operation drops a table and creates it again.</strong> It is much faster than deleting data row by row, especially for large tables.</li>
<li>The output of <code>TRUNCATE TABLE</code> always indicates that 0 rows were affected.</li>
<li>When you use <code>TRUNCATE TABLE</code>, the table management program does not record the last <code>AUTO_INCREMENT</code> value, but resets it to zero.</li>
<li>The <code>TRUNCATE TABLE</code> statement cannot be executed during transactions or when the table is locked. Otherwise, an error is returned.</li>
<li>If the table definition file is valid, you can use the <code>TRUNCATE TABLE</code> statement to recreate the table as an empty table, even if the data or indexes are corrupted.</li>
</ul>
<p>Although the table is dropped before recreation, the dropped table is not moved to the recycle bin. Proceed with caution.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; TRUNCATE TABLE BANJIN_FLASH;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Query OK, 0 rows affected (0.042 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obclient [test]&gt; show recyclebin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Empty set (0.002 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-command-summary">5. Command Summary<a href="#5-command-summary" class="hash-link" aria-label="Direct link to 5. Command Summary" title="Direct link to 5. Command Summary">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    # Modify the value of undo_retention.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ALTER SYSTEM SET undo_retention=1800;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # View the undo_retention parameter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SHOW PARAMETERS LIKE &#x27;undo_retention&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Enable the recycle bin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bclient [test]&gt; SET GLOBAL recyclebin = on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # View the recycle bin status.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SHOW VARIABLES LIKE &#x27;recyclebin&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Perform a flashback query.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SELECT * FROM banjin_flash AS OF SNAPSHOT time_to_usec(&#x27;2024-10-20 17:31:13&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Alternatively, use the following two statements together.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SELECT time_to_usec(&#x27;2024-10-20 06:42:40&#x27;) * 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SELECT * FROM banjin_flash AS OF SNAPSHOT 1729377760000000000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # View the recycle bin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    show recyclebin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Restore a dropped table from the recycle bin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FLASHBACK TABLE __recycle_$_1_1729417897979024 TO BEFORE DROP;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Table and data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create table banjin_flash (id int ,name varchar(10),dizhi varchar(10),primary key (id));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into banjin_flash values (1,&#x27;zhangsan&#x27;,&#x27;Beijing&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into banjin_flash values (2,&#x27;lisi&#x27;,&#x27;Shanghai&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into banjin_flash values (3,&#x27;wangwu&#x27;,&#x27;Tianjin&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into banjin_flash values (4,&#x27;zhaoliu&#x27;,&#x27;Hebei&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #Data operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    update banjin_flash set dizhi = &#x27;Hunan&#x27; where name=&#x27;lisi&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delete from banjin_flash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alter table banjin_flash add column dianhua decimal(11) default 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alter table banjin_flash drop column dianhua;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/blogs/tech/flashback-query.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/blogs/tech/failure-by-collation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SQL Tuning Practices - Index Failure Caused by Collations</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/blogs/tech/high-concurrency"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OceanBase Technical Insights for High-Concurrency Scenarios</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-preparations" class="table-of-contents__link toc-highlight">1. Preparations</a></li><li><a href="#2-flash-back-to-the-state-before-a-dml-operation" class="table-of-contents__link toc-highlight">2. Flash Back to the State Before a DML Operation</a><ul><li><a href="#21-create-a-table-and-prepare-the-required-data" class="table-of-contents__link toc-highlight">2.1 Create a table and prepare the required data</a></li><li><a href="#22-modify-the-table" class="table-of-contents__link toc-highlight">2.2 Modify the table</a></li><li><a href="#23-flash-back-data" class="table-of-contents__link toc-highlight">2.3 Flash back data</a></li></ul></li><li><a href="#3-flash-back-to-the-state-before-a-ddl-operation" class="table-of-contents__link toc-highlight">3. Flash Back to the State Before a DDL Operation</a><ul><li><a href="#31-flash-back-the-table-to-the-state-before-an-add-column-operation" class="table-of-contents__link toc-highlight">3.1 Flash back the table to the state before an ADD COLUMN operation</a></li><li><a href="#32-restore-the-table-to-the-state-before-a-drop-column-operation" class="table-of-contents__link toc-highlight">3.2 Restore the table to the state before a DROP COLUMN operation</a></li><li><a href="#33-flash-back-the-table-to-the-state-before-a-drop-table-operation" class="table-of-contents__link toc-highlight">3.3 Flash back the table to the state before a DROP TABLE operation</a></li></ul></li><li><a href="#4-flash-back-to-the-state-before-a-truncate-operation" class="table-of-contents__link toc-highlight">4. Flash Back to the State Before a TRUNCATE Operation</a></li><li><a href="#5-command-summary" class="table-of-contents__link toc-highlight">5. Command Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/compilation/sig_intro">compilation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>