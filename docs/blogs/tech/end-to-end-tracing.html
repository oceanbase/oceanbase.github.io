<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-blogs/tech/end-to-end-tracing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Insights into OceanBase Database 4.0: Issues Addressed by End-to-end Tracing, Starting with a Slow SQL Query | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/blogs/tech/end-to-end-tracing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Insights into OceanBase Database 4.0: Issues Addressed by End-to-end Tracing, Starting with a Slow SQL Query | OceanBase"><meta data-rh="true" name="description" content="About the author: Xiao Yi, Senior Technical Expert at OceanBase, has supported Ant Group&#x27;s Double 11 Shopping Festival multiple times. He is a key member of the TPC-C and TPC-H performance team and specializes in designing and developing SQL engine components, including link protocols, execution plans, and execution engines."><meta data-rh="true" property="og:description" content="About the author: Xiao Yi, Senior Technical Expert at OceanBase, has supported Ant Group&#x27;s Double 11 Shopping Festival multiple times. He is a key member of the TPC-C and TPC-H performance team and specializes in designing and developing SQL engine components, including link protocols, execution plans, and execution engines."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/blogs/tech/end-to-end-tracing"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/blogs/tech/end-to-end-tracing" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/blogs/tech/end-to-end-tracing" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H4XM2M50RX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-H4XM2M50RX",{})</script><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.d332df5a.js" defer="defer"></script>
<script src="/assets/js/main.f5d6e2de.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><span><li><a class="dropdown__link" href="/docs/sig/overview/list">Special Interest Group(SIG)</a></li></span><span><li><a class="dropdown__link" href="/docs/honor/overview">Community Honors</a></li></span><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://discord.gg/74cF8vbNEs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Data + AI</a><ul class="dropdown__menu"><span><li><a href="https://oceanbase-devhub.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">AI Workshops<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/ai-workshop-2024" target="_blank" rel="noopener noreferrer" class="dropdown__link">RAG Bot<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/dify/dify@oceanbase-workshop" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dify (MySQL Compatible)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/DB-GPT/docker/compose_examples/ob_dbgpt_tutorial" target="_blank" rel="noopener noreferrer" class="dropdown__link">DB-GPT<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/arch/all-in-one">Architectural Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/feat/io-isolation">Features Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/blogs/tech/DDL-Execution-Efficient">Technical Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/DDL-Execution-Efficient">Insights into OceanBase Database 4.0: How to Make DDL Execution Efficient and Transparent in a Distributed Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Materialized-Views">Explore Data Warehouses with Columnar Storage and Materialized Views of OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Modern-HBase-Arch">Simplistic Yet Not Simple: The Upgrade to a Modern HBase Architecture with OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/OpenStack-ob">OpenStack: Partnering with OceanBase Database to Build a Highly Available and Scalable Infrastructure Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Real-time-AP">OceanBase Database 4.3 - Milestone Release for Real-time AP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Standalone-distributed">Thoughts on the Integrated Architecture of OceanBase Database for Standalone and Distributed Modes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/Zabbix">Zabbix and OceanBase Database Completed Product Compatibility and Mutual Certification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/adaptive-sql-execution-engine">Adaptive Techniques in the OceanBase SQL Execution Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/alter-table">Principles of ALTER TABLE in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/analysis-column">OceanBase Database V4.3 Feature Breakdown: In-depth Analysis of Columnar Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/binlog-service">OceanBase Binlog Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/column-store">The Present and Future of Columnar Storage in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/core-tech-ob">Decoding the Core Technologies of OceanBase Community Edition 4.x</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/distributed-push-down">OceanBase Distributed Pushdown Technology</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/blogs/tech/end-to-end-tracing">Insights into OceanBase Database 4.0: Issues Addressed by End-to-end Tracing, Starting with a Slow SQL Query</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/failure-by-collation">SQL Tuning Practices - Index Failure Caused by Collations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/flashback-query">Practice of Flashback Queries in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/high-concurrency">OceanBase Technical Insights for High-Concurrency Scenarios</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/hive-to-ob">From Hive to OceanBase Database: Building an Efficient Real-Time Data Warehouse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/image-search-vector-search">[OceanBase Practices] Building an Image Search Application Based on the Vector Search Technology of OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/legacy-monitoring-system">Using OceanBase Database to Store Data of a traditional Monitoring System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/native-distributed">Treat the Symptoms and the Root Cause! OceanBase Native Distributed + Single-machine Distributed Integration Solves the Problem of Sharding from the Root</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ob-db-transform">OceanBase Helps Enterprises Cope with the Challenges of Database Transformation in the Deep Waters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ob-openai">Build Your Own Document Q&amp;A App with OceanBase and OpenAI in 30 mins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ob-schema">What Is a Schema in OceanBase Database?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/obd-error">Troubleshoot obd Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-I">Mastering Parallel Execution in OceanBase Database: Part 1 - Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-II">Mastering Parallel Execution in OceanBase Database: Part 2 - Set the DOP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-III">Mastering Parallel Execution in OceanBase Database: Part 3 - Concurrency Control and Queuing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-IV">Mastering Parallel Execution in OceanBase Database: Part 4 - Parallel Execution Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-V">Mastering Parallel Execution in OceanBase Database: Part 5 - Parallel Execution Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-VI">Mastering Parallel Execution in OceanBase Database: Part 6 - Troubleshooting and Tuning Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/parallel-execution-VII">Mastering Parallel Execution in OceanBase Database: Part 7 - Get Started with a PoC Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/partition-create">A Brief Analysis of Frequently Asked Questions about Partition Creation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/practices-binlog">Practices of OceanBase Binlog Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/pushdown-tech">Distributed Pushdown Techniques in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/query-engines">Evolution of Database Query Engines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/query-perf">Insights into OceanBase Database 4.0: Distributed Query Performance Optimization in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/real-time-analytics">Release of OceanBase Database V4.3.3: The First GA Version for Real-time Analytics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/refine-performance">How We Approach Improving Distributed Query Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/row-to-vector">From Rows to Vectors: The Evolution of the Execution Engine of OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/small-specification-deployment">Insights into OceanBase Database 4.0: Support for Small-Specification Deployment to Make Distributed Databases More Accessible</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/storage-engine">Storage Engine of OceanBase Database V4.x Cuts Historical Database Costs by over 50%</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/tablet">What Is a Tablet in OceanBase Database V4.0? Why Is It Introduced?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/ticket-olap">Columnar Storage Engine: Your Ticket to OLAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/tp-to-ap">From OLTP to OLAP: Exploration and practice of the OceanBase SQL engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/trans-recovery">Principles and Practices of Transaction Recovery in Distributed Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/troubleshoot">Five Steps to Troubleshoot Process Crashes Based on Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/truncated-table">Why Truncated Tables Cannot Be Recycled in OceanBase Database V4.x?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/vector-search">Vector capabilities of OceanBase Database: find similar images in a blink</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/users/1st-financial">Corporate Cases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/showcases/architectural-evolution">Highlights</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/others/flink-and-ob">Others</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Technical Introduction</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Insights into OceanBase Database 4.0: Issues Addressed by End-to-end Tracing, Starting with a Slow SQL Query</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Insights into OceanBase Database 4.0: Issues Addressed by End-to-end Tracing, Starting with a Slow SQL Query</h1></header>
<blockquote>
<p>About the author: <strong>Xiao Yi, Senior Technical Expert at OceanBase</strong>, has supported Ant Group&#x27;s Double 11 Shopping Festival multiple times. He is a key member of the TPC-C and TPC-H performance team and specializes in designing and developing SQL engine components, including link protocols, execution plans, and execution engines.</p>
</blockquote>
<p>In the previous article, we discussed what DDL challenges a database faces when it transitions from a standalone architecture to a distributed one and what solutions and design ideas OceanBase Database V4.0 has taken to ensure more efficient and transparent DDL operations for better user experience in O&amp;M. In this article, we delve into fault tracing and diagnosis, another important capability in database O&amp;M.</p>
<p>First, let&#x27;s read this conversation:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A business manager complained: &quot;The database requests are going to take a million years to finish. Could you have a look?&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rolling down the real-time monitoring records of the database node, the database administrator (DBA) felt strange: &quot;I don&#x27;t see any slow SQL statements here.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The business manager asked: &quot;What&#x27;s going on then?&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DBA: &quot;Maybe there is something wrong with the connection between the client and the database node. Let me check the logs of the proxy server.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">One hour later... &quot;The time consumption shown in the logs of the proxy looks good.&quot; the DBA frowned. &quot;Maybe it&#x27;s the network problem between the client and the proxy?&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Well, this is a short story about troubleshooting a slow SQL statement in a distributed database. This issue, if not solved soon, will greatly affect the user experience, or even lead to service unavailability. That&#x27;s why we made it a priority to offer simple, efficient diagnostics. Compared with standalone databases, a distributed database typically has a cluster of dozens or hundreds of servers, with multiple interlinked components working together to process user requests. It is more challenging to achieve fast and efficient fault diagnosis and location.</p>
<p>OceanBase Database V4.0 has significantly improved its diagnostic capabilities by supporting visual end-to-end tracing of SQL requests. This feature helps users quickly locate the specific execution stage, machine, and module of a fault, with the detailed execution information provided. It makes O&amp;M simple and efficient. In this article, we will share our thoughts on efficient database diagnosis and introduce to you the benefits and design ideas of the end-to-end tracing feature in <a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer">OceanBase Database</a> from the following perspectives:</p>
<ul>
<li><strong>Purpose of end-to-end tracing</strong></li>
<li><strong>Benefits of end-to-end tracing</strong></li>
<li><strong>Design of end-to-end tracing</strong></li>
<li><strong>Performance of end-to-end tracing in OceanBase Database V4.0</strong></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="purpose-of-end-to-end-tracing">Purpose of End-to-end Tracing<a href="#purpose-of-end-to-end-tracing" class="hash-link" aria-label="Direct link to Purpose of End-to-end Tracing" title="Direct link to Purpose of End-to-end Tracing">​</a></h2>
<p>In OceanBase Database, a user request is first sent to OBProxy, a SQL request proxy service, which routes the request to one of the OBServer nodes of the OceanBase cluster. Then, the request is processed by many modules in different engines, such as the SQL engine, storage engine, and transaction engine, depending on the request type. The request may also access data on multiple OBServer nodes by remote procedure call (RPC) tasks. At last, the result is returned to the client.</p>
<p><img decoding="async" loading="lazy" alt="1678085682" src="/assets/images/1678085682712-5d0512910dc5a9137acda575ab9c95c5.png" width="843" height="844" class="img_ev3q"></p>
<p><em>Figure 1 SQL request execution processes in OceanBase Database</em></p>
<p>If a user request returns an error or is executed slowly, it may be caused by the execution fault of a component or the connection problems between components. OceanBase Database of earlier versions has provided users with a range of monitoring and diagnostic capabilities, such as SysStat, SQL Audit, Trans Stat, Tenant Dump, Slow Trans, and Slow Query, and OceanBase Cloud Platform (OCP), the database management platform of OceanBase, has supported visual diagnostic operations such as transaction, TopSQL, and SlowSQL diagnostics based on the output of those monitoring capabilities. However, these capabilities cannot provide enough information for the O&amp;M team to quickly check for issues and efficiently restore the faulty service from an end-to-end perspective. It often takes a long time, sometimes with the help of component experts, to merely locate the execution stage, machine, or module where the issue occurs.</p>
<p>To further improve the diagnostic efficiency of user request exceptions in a distributed system, OceanBase Database V4.0 supports end-to-end tracing. This feature traces the information of user SQL requests executed by different components at different stages of the entire data processing link, and presents the information to users in a visual way, allowing users to quickly hunt down the target.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="benefits-of-end-to-end-tracing">Benefits of End-to-end Tracing<a href="#benefits-of-end-to-end-tracing" class="hash-link" aria-label="Direct link to Benefits of End-to-end Tracing" title="Direct link to Benefits of End-to-end Tracing">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="end-to-end-tracing-of-transactions-and-sql-statements">End-to-end tracing of transactions and SQL statements<a href="#end-to-end-tracing-of-transactions-and-sql-statements" class="hash-link" aria-label="Direct link to End-to-end tracing of transactions and SQL statements" title="Direct link to End-to-end tracing of transactions and SQL statements">​</a></h3>
<p>OceanBase Database V4.0 supports user-facing fine-grained end-to-end tracing of transactions and SQL statements. For a business department, the total time consumed by a business service is often of greater concern. In an online transaction processing (OLTP) system, for example, a business service usually consists of one or more transactions. Therefore, it is more practical to take a transaction as the elementary tracing unit. The end-to-end tracing feature creates a trace for each transaction, and records the execution information of each SQL statement in the OBClient &gt; OBProxy &gt; OBServer link in the transaction. By combing through a trace, users are able to quickly find the SQL statements executed in the transaction and get the execution information at OBClient.</p>
<p>In a real business system that utilizes end-to-end tracing, once users find a slow SQL request or transaction, they can quickly locate the very execution stage that drags down the progress of the whole execution link. Or, if users notice that it takes a long time to initiate an SQL request since the end of the last one in a transaction, they can consult with the business department to figure out the possible problems in the business logic.</p>
<p><img decoding="async" loading="lazy" alt="1678085788" src="/assets/images/1678085789075-8009ecfd39df0181193fe31d50f0d6be.png" width="809" height="450" class="img_ev3q"></p>
<p><em>Figure 2 SQL requests in a transaction</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="end-to-end-tracing-in-a-distributed-system">End-to-end tracing in a distributed system<a href="#end-to-end-tracing-in-a-distributed-system" class="hash-link" aria-label="Direct link to End-to-end tracing in a distributed system" title="Direct link to End-to-end tracing in a distributed system">​</a></h3>
<p>OceanBase Database V4.0 supports end-to-end tracing in a distributed system. In the distributed architecture of OceanBase Database, OBProxy may route a received user request to any one of the OBServer nodes in the cluster, and the requested data may be distributed across multiple OBServer nodes. Moreover, the execution engine will assign SQL execution tasks to different OBServer nodes. If a cluster has many OBServer nodes, questions arise. Which OBServer nodes handle these SQL requests and tasks? How much time does each module on an OBServer node take? These are common concerns for O&amp;M personnel.</p>
<p>The end-to-end tracing feature allows users to trace the entire execution link of SQL requests in a distributed scenario that involves multiple OBServer nodes. Users can find details such as the OBServer nodes that received requests, the OBServer nodes that executed remote tasks, and the scheduling status and execution time of each task.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/pord/blog/2023-04/1678085839669.png" alt="1678085839" class="img_ev3q"></p>
<p><em>Figure 3 Execution process of a distributed request</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="convenient-association-between-diagnostics-and-the-business-system">Convenient association between diagnostics and the business system<a href="#convenient-association-between-diagnostics-and-the-business-system" class="hash-link" aria-label="Direct link to Convenient association between diagnostics and the business system" title="Direct link to Convenient association between diagnostics and the business system">​</a></h3>
<p>Many users have built their own monitoring and diagnostic systems. When a request gets slow or an error is reported in the database, users may need to quickly associate the event with the corresponding SQL diagnostics in the system to get troubleshooting done faster. End-to-end tracing allows users to easily associate diagnostics with the business system. They can set an app trace ID for a request from the business system to the database by using the Java Database Connectivity (JDBC) or SQL API. The app trace ID is recorded in the end-to-end tracing information.</p>
<p>When an error is reported for a request or database call, users can use the corresponding app trace ID to quickly search for the associated database trace in the end-to-end diagnostic system, and then view the time consumption of the request or database call at each execution stage of the database link and the point where the error is reported, so as to identify the component that triggers the error in a short period of time.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-end-to-end-information-display-modes">Multiple end-to-end information display modes<a href="#multiple-end-to-end-information-display-modes" class="hash-link" aria-label="Direct link to Multiple end-to-end information display modes" title="Direct link to Multiple end-to-end information display modes">​</a></h3>
<p>OCP allows users to quickly find faulty requests by using different metrics, such as the time consumption, trace ID, and SQL statement ID. Also, OCP clearly displays the execution information of the entire execution link from the client to each component of the database, which helps users locate the problematic stage in no time.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/pord/blog/2023-04/1678085878241.png" alt="1678085878" class="img_ev3q"></p>
<p><em>Figure 4 A link details page on OCP</em></p>
<p>OceanBase Database V4.0 also supports interactive end-to-end tracing operations. For example, if users manually execute an SQL statement in the command line, and want to inspect the execution link of the statement to get the time consumption of each stage for performance analysis or optimization, they can use the Show Trace feature to easily spot the performance bottlenecks. The following sample code shows the execution process of two distributed parallel tasks (px_task) by running the <code>Show Trace</code> command. Users can specify keywords and options in the command to see more details.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    OceanBase(admin@test)&gt;select/*+parallel(2)*/ count(*) from t1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | count(*) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |        5 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 row in set (0.005 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OceanBase(admin@test)&gt;show trace;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +-------------------------------------------+----------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | Operation                                 | StartTime                  | ElapseTime |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +-------------------------------------------+----------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | obclient                                  | 2023-03-01 17:51:30.143537 | 4.667 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | └─ ob_proxy                               | 2023-03-01 17:51:30.143716 | 4.301 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |    └─ com_query_process                   | 2023-03-01 17:51:30.145119 | 2.527 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |       └─ mpquery_single_stmt              | 2023-03-01 17:51:30.145123 | 2.513 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |          ├─ sql_compile                   | 2023-03-01 17:51:30.145133 | 0.107 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |          │  └─ pc_get_plan                | 2023-03-01 17:51:30.145135 | 0.061 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |          └─ sql_execute                   | 2023-03-01 17:51:30.145252 | 2.350 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             ├─ open                       | 2023-03-01 17:51:30.145252 | 0.073 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             ├─ response_result            | 2023-03-01 17:51:30.145339 | 2.186 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  ├─ px_schedule             | 2023-03-01 17:51:30.145342 | 1.245 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │  ├─ px_task              | 2023-03-01 17:51:30.146391 | 1.113 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │  │  ├─ get_das_id        | 2023-03-01 17:51:30.146979 | 0.001 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │  │  ├─ do_local_das_task | 2023-03-01 17:51:30.147012 | 0.050 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │  │  └─ close_das_task    | 2023-03-01 17:51:30.147237 | 0.014 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │  └─ px_task              | 2023-03-01 17:51:30.146399 | 0.868 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │     ├─ get_das_id        | 2023-03-01 17:51:30.147002 | 0.001 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │     ├─ do_local_das_task | 2023-03-01 17:51:30.147036 | 0.041 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  │     └─ close_das_task    | 2023-03-01 17:51:30.147183 | 0.011 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             │  └─ px_schedule             | 2023-03-01 17:51:30.147437 | 0.001 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |             └─ close                      | 2023-03-01 17:51:30.147536 | 0.049 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                └─ end_transaction         | 2023-03-01 17:51:30.147571 | 0.002 ms   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +-------------------------------------------+----------------------------+------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-other-diagnostic-features">Integration with other diagnostic features<a href="#integration-with-other-diagnostic-features" class="hash-link" aria-label="Direct link to Integration with other diagnostic features" title="Direct link to Integration with other diagnostic features">​</a></h3>
<p>Now we know that users can quickly locate the faulty component or module with the help of the end-to-end tracing feature. What if users want to dig deeper and get more execution details? No worries. The end-to-end tracing feature is integrated with other diagnostic features designed for different modules, which helps users get diagnostic insights.</p>
<p>For example, if users, with the help of the end-to-end tracing feature, confirm that the SQL execution engine is the culprit of a slow SQL request, they can launch the SQL Plan Monitor feature based on the sql_trace_id parameter of the SQL request to check out the execution information of operators and threads of the associated execution plan. As shown in Figure 5, we can see the details of each operator, such as the CPU time (the green bar in the DBTime column), the waiting time (the red bar in the DBTime column), and the number of rows returned.</p>
<p><img decoding="async" loading="lazy" alt="1678085987" src="/assets/images/1678085987788-fe590367bde3350323e31c02474f0b61.png" width="1217" height="241" class="img_ev3q"></p>
<p><em>Figure 5 Execution information displayed by SQL Plan Monitor</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-of-end-to-end-tracing">Design of End-to-end Tracing<a href="#design-of-end-to-end-tracing" class="hash-link" aria-label="Direct link to Design of End-to-end Tracing" title="Direct link to Design of End-to-end Tracing">​</a></h2>
<p>The figure below shows the key OceanBase components that make the end-to-end tracing feature possible. In this section, we will describe in detail the OpenTracing data model, which we use to record the trace information, generation of trace data, and integrated data analysis and display on OCP.</p>
<p><img decoding="async" loading="lazy" alt="1678086049" src="/assets/images/1678086049739-d2a1a9795c09586061aa18e87136a031.png" width="822" height="417" class="img_ev3q"></p>
<p><em>Figure 6 OceanBase components that enable the end-to-end tracing feature</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-model">Data model<a href="#data-model" class="hash-link" aria-label="Direct link to Data model" title="Direct link to Data model">​</a></h3>
<p>The end-to-end tracing feature of OceanBase Database uses the OpenTracing model to record data. This model is widely used in a large number of distributed tracing systems. In the figure below, the left part shows the OpenTracing model, and the right part shows the corresponding end-to-end tracing data model of OceanBase Database. Each trace corresponds to one database transaction and multiple spans. An SQL request corresponds to a span, which records the information about an execution process. In addition, each span records a log that is persisted to the trace file.</p>
<p><img decoding="async" loading="lazy" alt="1678086081" src="/assets/images/1678086081133-4680aa205e3808273512d87e5a1c21b6.png" width="818" height="481" class="img_ev3q"></p>
<p><em>Figure 7 End-to-end tracing data models</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generation-of-trace-data">Generation of trace data<a href="#generation-of-trace-data" class="hash-link" aria-label="Direct link to Generation of trace data" title="Direct link to Generation of trace data">​</a></h3>
<p>One of the key capabilities of the end-to-end tracing feature is to generate complete and valid trace data. On the one hand, we have studied each component in the entire request execution link, making careful decisions on the stages and information to be recorded in specific spans, to ensure that the end-to-end tracing data is accurate and useful. On the other hand, we have also taken account of the performance impact of trace data generation, which is caused mainly by the overhead for recording the trace data into the memory, and that for writing the trace data to the trace file. To minimize the impact on performance and provide users with more useful information for end-to-end diagnostics, OceanBase Database supports various control strategies. Users can set different sampling frequencies for traces to record complete trace information. OceanBase Database also writes the full trace information of slow and faulty SQL statements that users are more concerned about into the trace file.</p>
<p><img decoding="async" loading="lazy" alt="1678086110" src="/assets/images/1678086110289-39fd1477b50995ad39f56c75622759f7.png" width="825" height="271" class="img_ev3q"></p>
<p><em>Figure 8 Generation of trace logs for each component</em></p>
<p>The trace files are independently stored on the machines that host the obproxy and observer processes. Considering that a database client interacts with the business server, the end-to-end tracing information of OBClient is not recorded on the business server, but transferred to OBProxy.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integrated-data-analysis-and-display-on-ocp">Integrated data analysis and display on OCP<a href="#integrated-data-analysis-and-display-on-ocp" class="hash-link" aria-label="Direct link to Integrated data analysis and display on OCP" title="Direct link to Integrated data analysis and display on OCP">​</a></h3>
<p>OCP allows users to search for the trace information of a request by specified conditions and view the details of the execution link in a GUI. The trace information comes from the trace logs of the obproxy and observer processes on different servers. OCP provides special backend collectors to collect and parse the trace logs, and then store them in Elasticsearch.  The collected data is the raw span data, and the data of the same trace may be scattered in different spans on different servers. It is hard to search data by span tags. Therefore, the OCP server regularly merges key span data of a trace, such as the time consumption at each stage and important tags, into one data record to construct a profile of the trace. This way, users can efficiently query the trace information by different combined conditions and the results can be neatly presented on pages.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-of-end-to-end-tracing-in-oceanbase-database-v40">Performance of End-to-end Tracing in OceanBase Database V4.0<a href="#performance-of-end-to-end-tracing-in-oceanbase-database-v40" class="hash-link" aria-label="Direct link to Performance of End-to-end Tracing in OceanBase Database V4.0" title="Direct link to Performance of End-to-end Tracing in OceanBase Database V4.0">​</a></h2>
<p>You must remember the slow SQL story at the beginning of this article. So, what changes can the end-to-end tracing feature bring to the O&amp;M work?</p>
<p>By using the feature, if users notice that business requests are slow, they can simply navigate to the end-to-end trace search page on OCP, sort SQL requests by time consumption, find the most time-consuming requests in a certain time period, and check for requests with unexpectedly long execution time. If a time-consuming SQL request is confirmed with the help of TopSQL diagnostics, or the app trace ID of the related user is obtained, the trace ID can be used as a filter to narrow down the scope of search.</p>
<p><img decoding="async" loading="lazy" alt="1678086185" src="/assets/images/1678086185409-7ce49922fac2a7f09201a42573a0dac1.png" width="1080" height="266" class="img_ev3q"></p>
<p><em>Figure 9 Request searching on the end-to-end trace search page on OCP</em></p>
<p>Once the time-consuming SQL request is identified, we can diagnose what went wrong exactly. At this point, users can click the trace ID on the OCP page to expand the trace information of the request, as shown in Figure 10. The measured execution time is 4.47 ms at OBClient, 4.366 ms at OBProxy, and 3.246 ms at the OBServer node. Based on the normal time consumption of each end, we can come to the conclusion that the OBServer node took the most time in the execution. Going deeper, we can see that a large part of the time was consumed at the SQL compile stage, at which the SQL execution plan was generated. We can now come to a preliminary conclusion that the execution of this SQL request was slow because it failed to hit the execution plan.</p>
<p><img decoding="async" loading="lazy" alt="1678086219" src="/assets/images/1678086219476-4010a17cf438f4d2d9676d601d55c03a.png" width="1080" height="666" class="img_ev3q"></p>
<p><em>Figure 10 End-to-end tracing details presented on OCP</em></p>
<p>On the end-to-end tracing details page on OCP, we can see the path by which the SQL request calls each module, and the time consumption of each stage. For example, users can tell simply by checking the timeline that the transport of the request from OBClient to OBProxy did not take too much time. However, if users want to know the time consumed from OBClient initiating the request to OBProxy receiving the request, they can click the span of OBClient and that of OBProxy respectively. As shown in Figure 11, we can quickly figure out that the difference between the start times of the two stages is 187 μs. In other words, users are able to analyze an issue in a more detailed way.</p>
<p><img decoding="async" loading="lazy" alt="1678086322" src="/assets/images/1678086322794-796d7962e1d5d9723ef0535ea938900a.png" width="1080" height="222" class="img_ev3q"></p>
<p><em>Figure 11 Details of end-to-end tracing stages</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="afterword">Afterword<a href="#afterword" class="hash-link" aria-label="Direct link to Afterword" title="Direct link to Afterword">​</a></h2>
<p>The end-to-end tracing feature of OceanBase Database V4.0 achieves the observability of each transaction and SQL request, allowing users to efficiently diagnose and locate a fault. We believe this new feature will further speed up the troubleshooting process and make database O&amp;M easier and more efficient. As an important part of enhancing the usability of OceanBase Database, we will also focus on providing a better O&amp;M experience by integrating more features into OceanBase Database V4.x, such as Active Session History (ASH), Realtime SQL Plan Monitor, and Logical Plan Manager. Feel free to leave your comments below and share your ideas on database diagnostics.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/blogs/tech/end-to-end-tracing.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/blogs/tech/distributed-push-down"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OceanBase Distributed Pushdown Technology</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/blogs/tech/failure-by-collation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SQL Tuning Practices - Index Failure Caused by Collations</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#purpose-of-end-to-end-tracing" class="table-of-contents__link toc-highlight">Purpose of End-to-end Tracing</a></li><li><a href="#benefits-of-end-to-end-tracing" class="table-of-contents__link toc-highlight">Benefits of End-to-end Tracing</a><ul><li><a href="#end-to-end-tracing-of-transactions-and-sql-statements" class="table-of-contents__link toc-highlight">End-to-end tracing of transactions and SQL statements</a></li><li><a href="#end-to-end-tracing-in-a-distributed-system" class="table-of-contents__link toc-highlight">End-to-end tracing in a distributed system</a></li><li><a href="#convenient-association-between-diagnostics-and-the-business-system" class="table-of-contents__link toc-highlight">Convenient association between diagnostics and the business system</a></li><li><a href="#multiple-end-to-end-information-display-modes" class="table-of-contents__link toc-highlight">Multiple end-to-end information display modes</a></li><li><a href="#integration-with-other-diagnostic-features" class="table-of-contents__link toc-highlight">Integration with other diagnostic features</a></li></ul></li><li><a href="#design-of-end-to-end-tracing" class="table-of-contents__link toc-highlight">Design of End-to-end Tracing</a><ul><li><a href="#data-model" class="table-of-contents__link toc-highlight">Data model</a></li><li><a href="#generation-of-trace-data" class="table-of-contents__link toc-highlight">Generation of trace data</a></li><li><a href="#integrated-data-analysis-and-display-on-ocp" class="table-of-contents__link toc-highlight">Integrated data analysis and display on OCP</a></li></ul></li><li><a href="#performance-of-end-to-end-tracing-in-oceanbase-database-v40" class="table-of-contents__link toc-highlight">Performance of End-to-end Tracing in OceanBase Database V4.0</a></li><li><a href="#afterword" class="table-of-contents__link toc-highlight">Afterword</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/compilation/sig_intro">compilation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>