<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-blogs/tech/ob-schema" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">What Is a Schema in OceanBase Database? | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/blogs/tech/ob-schema"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="What Is a Schema in OceanBase Database? | OceanBase"><meta data-rh="true" name="description" content="In the OceanBase open source community, questions like &quot;What is a schema?&quot; are often seen."><meta data-rh="true" property="og:description" content="In the OceanBase open source community, questions like &quot;What is a schema?&quot; are often seen."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/blogs/tech/ob-schema"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/blogs/tech/ob-schema" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/blogs/tech/ob-schema" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.e3b8f256.js" defer="defer"></script>
<script src="/assets/js/main.5b1f0ef9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Special Interest Group(SIG)</a><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="dropdown__link">Slack<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/arch/all-in-one">Architectural Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/feat/io-isolation">Features Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/blogs/tech/adaptive-sql-execution-engine">Technical Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/adaptive-sql-execution-engine">Adaptive Techniques in the OceanBase SQL Execution Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/alter-table">Principles of ALTER TABLE in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/distributed-push-down">OceanBase Distributed Pushdown Technology</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/high-concurrency">OceanBase Technical Insights for High-Concurrency Scenarios</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/blogs/tech/ob-schema">What Is a Schema in OceanBase Database?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/query-engines">Evolution of Database Query Engines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/refine-performance">How We Approach Improving Distributed Query Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/tp-to-ap">From OLTP to OLAP: Exploration and practice of the OceanBase SQL engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/trans-recovery">Principles and Practices of Transaction Recovery in Distributed Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/blogs/tech/vector-search">Vector capabilities of OceanBase Database: find similar images in a blink</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/users/AXA">Corporate Cases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/showcases/architectural-evolution">Highlights</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/blogs/others/flink-and-ob">Others</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Technical Introduction</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">What Is a Schema in OceanBase Database?</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>What Is a Schema in OceanBase Database?</h1></header>
<p>In the OceanBase open source community, questions like &quot;What is a schema?&quot; are often seen.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459740667.png" alt="1691459740" class="img_ev3q"></p>
<p><strong>Many mistakenly believe schemas and databases are synonymous in OceanBase Database. In this article, we talk about what a schema truly is.</strong></p>
<p>In short, the meaning of a schema differs across MySQL and Oracle modes of OceanBase Database and its metadata management module.</p>
<h1>Schema in OceanBase Database in MySQL Mode</h1>
<p>       Schema is a synonym for database. You can replace DATABASE with SCHEMA in SQL statements. For example, you can replace CREATE DATABASE with CREATE SCHEMA.</p>
<h1>Schema in OceanBase Database in Oracle Mode</h1>
<p>       In OceanBase Database in Oracle mode, a schema is a collection of database objects owned by a user. It provides privilege management and namespace isolation, similar to a user space. Schema objects are database objects in a specific schema, such as tables, views, and indexes. Non-schema objects are database objects that do not belong to a specific schema, such as users, roles, and tablespaces.</p>
<p>When a user is created, it has a default schema with the same name as the username. With appropriate privileges, a user can access and use objects in other schemas. When you access an object without specifying a schema, the system automatically adds the default schema name of the object.</p>
<p>If the user you currently use has the necessary privileges to access or modify objects in other schemas, you can switch to another schema by executing <code>alter session set current_schema = other_schema_name;</code>. This allows you to work within the context of the specified schema.</p>
<h1>Schema in the Metadata Management Module of OceanBase Database</h1>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459773537.png" alt="1691459773" class="img_ev3q"></p>
<p>       In the metadata management module of OceanBase Database, a schema refers to the complete set of metadata describing database objects that must be synchronized across a cluster. This includes, but is not limited to, metadata for tables, databases, and users. Additionally, OceanBase Database employs a multi-version schema approach, ensuring eventual consistency of in-memory schema information across the cluster.</p>
<h1>What does a schema encompass?</h1>
<p>       After understanding that a schema represents metadata, you may naturally wonder, &quot;What does the metadata encompass?&quot;</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459787349.png" alt="1691459787" class="img_ev3q"></p>
<p>       The preceding answer requires clarification. Metadata for database objects is exclusively modified by DDL statements. In contrast, estimated row counts are influenced solely by DML statements and are therefore statistical information, not metadata. Consequently, estimated row counts are not part of the table schema.</p>
<p>For a comprehensive understanding of what constitutes metadata, refer to the code under <code>src/share/schema</code>. For example, to view the table metadata stored in the table schema, check the members of the <code>ObTableSchema</code> class and its parent classes in <a href="https://github.com/oceanbase/oceanbase/blob/9940650223427978ac634ff0d7423ab53c74a95e/src/share/schema/ob_table_schema.h#L821" target="_blank" rel="noopener noreferrer">ob_table_schema.h</a>.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459798799.png" alt="1691459798" class="img_ev3q"></p>
<h1>Execution Process of DDL Statements</h1>
<p>       You now understand what a schema is and its components. As a schema can be modified only through DDL statements, we briefly explain their execution process to help troubleshoot DDL issues.</p>
<p>       DDL statements are not processed by the optimizer; instead, they are sent as commands to a RootServer (RS) for processing. The following figure shows the execution process in OceanBase Database.</p>
<p><img decoding="async" loading="lazy" alt="1691459810" src="/assets/images/1691459810134-e74d7f7e284c458bc48a70c693ef7202.png" width="920" height="298" class="img_ev3q"></p>
<p>       Let&#x27;s use a common CREATE TABLE statement as an example:</p>
<p>       The OBServer resolves the CREATE TABLE statement, stores the table information in create_table_arg, and sends create_table_arg to the RS through a remote procedure call (RPC). The RS then performs the following operations:</p>
<ul>
<li>Check whether the schema used by the OBServer during resolution is of the latest version through optimistic locking. If not, retry the entire DDL statement.</li>
<li>Obtain a new, monotonically increasing table ID within the tenant from the __all_sys_stat table.</li>
<li>Persist the information provided in create_table_arg to internal tables such as __all_table_history for durability.</li>
<li>Record the DDL change log in the __all_ddl_operation table for use in scenarios such as incremental refreshes.</li>
<li>Publish the updated schema by notifying all nodes to refresh their in-memory schema cache.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="1691461106" src="/assets/images/1691461106276-6ad48ae42a241db4cbdc8a36f61117a0.png" width="863" height="548" class="img_ev3q"></p>
<p>       Upon receiving the PUBLISH SCHEMA command from the RS, other OBServers load the incremental schema changes from the internal tables into their in-memory schema cache. This process is often referred to as a &quot;schema refresh.&quot;</p>
<p>       What happens when the DDL service on the RS calls publish_schema() to broadcast the new schema version to all OBServers?</p>
<ol>
<li>The OBServer where the RS resides calls refresh_schema directly.</li>
<li>Every other alive OBServer receives a switch_schema command, with the value of the schema_version parameter being the latest schema version.</li>
<li>Upon receiving the command, each OBServer generates an ObSchemaRefreshTask to asynchronously refresh its schema to the latest version.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="1691459823" src="/assets/images/1691459823348-f88e9281a6071d14aed0dc2eb3a8e918.png" width="918" height="278" class="img_ev3q"></p>
<p>Here is another figure.</p>
<ul>
<li>The upper part of the figure shows DDL statement execution, during which the DDL service on the RS writes data to the internal tables and notifies each OBServer to load metadata changes into their in-memory schema cache.</li>
<li>The lower part of the figure shows query execution, during which metadata is read from the in-memory schema cache.</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459832525.png" alt="1691459832" class="img_ev3q"></p>
<p>The GV$OB_SERVER_SCHEMA_INFO view in the question mentioned at the beginning of this article provides the information about the latest refreshed schema version for each tenant on every OBServer. Key schema information in this view includes REFRESHED_SCHEMA_VERSION, SCHEMA_COUNT, and SCHEMA_SIZE, defined as follows:</p>
<ul>
<li>
<p>REFRESHED_SCHEMA_VERSION: the schema version refreshed for the tenant on the OBServer.</p>
</li>
<li>
<p>RECEIVED_SCHEMA_VERSION: the schema version in the latest refresh task received from the RS for the tenant on the OBServer.</p>
</li>
<li>
<p>SCHEMA_COUNT: the total number of schema objects, such as tables and databases, for the schema version.</p>
</li>
<li>
<p>SCHEMA_SIZE: the total memory used by the schema objects for the schema version, in bytes.</p>
<p>obclient&gt; select * from oceanbase.GV$OB_SERVER_SCHEMA_INFO\G
*************************** 1. row ***************************
SVR_IP: 11.158.31.20
SVR_PORT: 22602
TENANT_ID: 1002
REFRESHED_SCHEMA_VERSION: 1690109029768968
RECEIVED_SCHEMA_VERSION: 1690113309637344
SCHEMA_COUNT: 1583
SCHEMA_SIZE: 1537240
MIN_SSTABLE_SCHEMA_VERSION: -1
1 row in set (0.01 sec)</p>
</li>
</ul>
<h1>Troubleshooting of DDL and Schema Issues</h1>
<p>       Now that we&#x27;ve discussed so much, let&#x27;s move on to some typical DDL and schema issues. Feel free to share any good troubleshooting methods you&#x27;ve found.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-modify-the-syntax-of-a-ddl-statement-when-it-fails-with-a-syntax-error">How do I modify the syntax of a DDL statement when it fails with a syntax error?<a href="#how-do-i-modify-the-syntax-of-a-ddl-statement-when-it-fails-with-a-syntax-error" class="hash-link" aria-label="Direct link to How do I modify the syntax of a DDL statement when it fails with a syntax error?" title="Direct link to How do I modify the syntax of a DDL statement when it fails with a syntax error?">​</a></h2>
<p>       Customers often attempt to migrate metadata from their existing databases to OceanBase Database Community Edition. For example, we recently encountered a customer who tried to apply a PostgreSQL partitioned table definition to a tenant in OceanBase Database in MySQL mode. The execution failed and the customer mistakenly concluded that OceanBase Database does not support partitioned tables.</p>
<p>CREATE TABLE value_stream_dashboard_counts (
id bigint NOT NULL,
namespace_id bigint NOT NULL,
count bigint NOT NULL,
metric smallint NOT NULL
)
PARTITION BY RANGE (id);</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459848425.png" alt="1691459848" class="img_ev3q"></p>
<p>       How do I troubleshoot syntax errors in OceanBase Database in MySQL mode? A common approach is to consult the various OceanBase syntax documentation resources. However, OceanBase syntax is evolving rapidly as its MySQL compatibility improves. The documentation may not accurately reflect the currently supported syntax, and even eventual consistency cannot be guaranteed. A senior colleague once wisely said, &quot;Documentation can be misleading, but code never lies.&quot; All syntax supported by OceanBase Database Community Edition is defined in a Yet Another Compiler Compiler (Yacc) file named <a href="https://github.com/oceanbase/oceanbase/blob/9940650223427978ac634ff0d7423ab53c74a95e/src/sql/parser/sql_parser_mysql_mode.y#L4391" target="_blank" rel="noopener noreferrer">sql_parser_mysql_mode.y</a>.</p>
<p>       With the syntax rules in this file, we can easily correct the preceding SQL statement for execution in OceanBase Database in MySQL mode.</p>
<p>CREATE TABLE value_stream_dashboard_counts (
id bigint NOT NULL,
namespace_id bigint NOT NULL,
count bigint NOT NULL,
metric smallint NOT NULL
)
PARTITION BY RANGE (id)(
PARTITION p0 VALUES LESS THAN (100),
PARTITION p1 VALUES LESS THAN (200),
PARTITION p2 VALUES LESS THAN (300),
PARTITION p3 VALUES LESS THAN MAXVALUE
);</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-troubleshoot-a-ddl-statement-that-failed-with-a-vague-error">How do I troubleshoot a DDL statement that failed with a vague error?<a href="#how-do-i-troubleshoot-a-ddl-statement-that-failed-with-a-vague-error" class="hash-link" aria-label="Direct link to How do I troubleshoot a DDL statement that failed with a vague error?" title="Direct link to How do I troubleshoot a DDL statement that failed with a vague error?">​</a></h2>
<p>       For example, I encountered an error while executing a DDL statement. The error message indicated that a check constraint contains an invalid expression, but it did not pinpoint the offending part of the expression. Was the issue with the column <code>c1</code>, the equality operator <code>=</code>, the function <code>sysdate()</code>, or the entire expression <code>c1 = sysdate()</code>?</p>
<p>obclient&gt; create table t1(c1 int, check (c1 = sysdate()));
ERROR 3814 (HY000): An expression of a check constraint contains disallowed function.</p>
<p>       First, query the trace_id of the failed statement.</p>
<p>select last_trace_id();
+------------------------------------+
| last_trace_id()                    |
+------------------------------------+
| Y584A0B9E1F14-00060127094761A8-0-0 |
+------------------------------------+
1 row in set (0.00 sec)</p>
<p>       Then, run <code>grep Y584A0B9E1F14-00060127094761B0-0-0 observer.log\*</code> to obtain the OBServer logs.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459866653.png" alt="1691459866" class="img_ev3q"></p>
<p>       The first warning log for this trace indicates that a deterministic expression is wrongly specified in the check constraint. However, it actually means a non-deterministic expression is used, which is not allowed.</p>
<p>       To understand what constitutes a non-deterministic expression, refer to the code based on the file name and line number indicated in the log, such as <a href="https://github.com/oceanbase/oceanbase/blob/9940650223427978ac634ff0d7423ab53c74a95e/src/sql/resolver/expr/ob_raw_expr_util.cpp#L1856" target="_blank" rel="noopener noreferrer">ob_raw_expr_util.cpp:1856</a>. You can navigate to the definition of a specific function on the web page, such as <a href="https://github.com/oceanbase/oceanbase/blob/master/src/sql/resolver/expr/ob_raw_expr.cpp#L832" target="_blank" rel="noopener noreferrer">ObRawExpr::is_non_pure_sys_func_expr</a>.</p>
<p>       All non-deterministic expressions are listed there, including sysdate, which was used in the failed statement.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459880888.png" alt="1691459880" class="img_ev3q"></p>
<p>       We can infer that the expression within a check constraint must be deterministic, producing the same result each time the expression is executed. The sysdate expression, which returns the current time, produces a different result upon each execution and is thus not allowed in check constraints. This is a good opportunity to explore other examples of non-deterministic expressions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-do-i-do-if-i-am-unable-to-obtain-useful-logs-after-executing-a-ddl-statement">What do I do if I am unable to obtain useful logs after executing a DDL statement?<a href="#what-do-i-do-if-i-am-unable-to-obtain-useful-logs-after-executing-a-ddl-statement" class="hash-link" aria-label="Direct link to What do I do if I am unable to obtain useful logs after executing a DDL statement?" title="Direct link to What do I do if I am unable to obtain useful logs after executing a DDL statement?">​</a></h2>
<p>       For example, I executed a DDL statement to create a database, but it failed with an error.</p>
<p>obclient&gt; create database xiaofeng_db;
ERROR 4016 (HY000): Internal error</p>
<p>obclient&gt; select last_trace_id();
+------------------------------------+
| last_trace_id()                    |
+------------------------------------+
| Y584A0B9E1F14-00060127094761B4-0-0 |
+------------------------------------+
1 row in set (0.00 sec)</p>
<p>I tried running <code>grep Y584A0B9E1F14-00060127094761B4-0-0 observer.log*</code> to obtain logs based on the trace ID, but only found an RPC error.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459892911.png" alt="1691459893" class="img_ev3q"></p>
<p>Since DDL::Arg is sent to the RS for execution, the issue likely originated there. Therefore, run <code>grep Y584A0B9E1F14-00060127094761B4-0-0 rootservice.log* | vi -</code> to obtain the RS logs, and search for the first occurrence of <code>ret=-4016</code> in the log file based on the error code 4016.</p>
<p>       The error log indicates that the issue occurred on line 2887 of the <code>ob\_root\_service.cpp</code> file. The error message is &quot;create_database failed, because db_name is forbidden.&quot; We encourage you to first analyze the issue based on the file name and line number in the error log. If the cause remains unclear, contact OceanBase Database Technical Support for assistance.</p>
<p>       The file contains an intentionally added error code to simulate errors on the RS. Any attempt to create a database named xiaofeng_db will trigger a 4016 OB_ERR_UNEXPECTED error.</p>
<p>The <code>rootservice.log</code> file is often overlooked during the troubleshooting of DDL and schema issues. Even many highly experienced OceanBase kernel developers have wasted considerable time debugging a minor bug due to this oversight. If you find no clue in the <code>observer.log</code> file when troubleshooting this type of issues, remember to check the <code>rootservice.log</code> file.</p>
<p><img decoding="async" loading="lazy" src="https://obcommunityprod.oss-cn-shanghai.aliyuncs.com/prod/blog/2023-08/1691459923618.png" alt="1691459923" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-do-i-do-if-observers-hang-during-schema-refreshes">What do I do if OBServers hang during schema refreshes?<a href="#what-do-i-do-if-observers-hang-during-schema-refreshes" class="hash-link" aria-label="Direct link to What do I do if OBServers hang during schema refreshes?" title="Direct link to What do I do if OBServers hang during schema refreshes?">​</a></h2>
<p>       A schema refresh involves loading data from internal tables into memory and verifying schema validity. If the verification fails, it indicates an issue with the metadata persisted in the internal tables, causing OBServers to hang. This happens because executing DDL statements, DML statements, or queries based on corrupted metadata may incur many data correctness issues. This situation is rare but can cause severe consequences.</p>
<p>       If a DDL statement hangs and messages such as &quot;Trying so hard to die&quot; and &quot;schema meta is still not consistent after rebuild, need fixing&quot; appear in the RS logs, manual intervention is needed to restore the environment by modifying incorrect data in the OceanBase Database internal tables. This process is risky. We recommend that you contact OceanBase Database Technical Support for assistance in diagnosing the root cause and restoring your environment. If you are using OceanBase Database Community Edition, join DingTalk group 33254054 and contact the group administrator.</p>
<h1>References</h1>
<p>Overview of database objects in MySQL mode: <a href="https://www.oceanbase.com/docs/common-oceanbase-database-10000000001702409" target="_blank" rel="noopener noreferrer">https://www.oceanbase.com/docs/common-oceanbase-database-10000000001702409</a></p>
<p>Overview of database objects in Oracle mode: <a href="https://www.oceanbase.com/docs/common-oceanbase-database-10000000001702405" target="_blank" rel="noopener noreferrer">https://www.oceanbase.com/docs/common-oceanbase-database-10000000001702405</a></p>
<p>Answer from Yanmu in the Q&amp;A section of the OceanBase community: <a href="https://ask.oceanbase.com/t/topic/35601662/3" target="_blank" rel="noopener noreferrer">https://ask.oceanbase.com/t/topic/35601662/3</a></p>
<p>Source code of OceanBase Database: <a href="https://github.com/oceanbase/oceanbase/blob/9940650223427978ac634ff0d7423ab53c74a95e/src/share/schema/ob_table_schema.h#L821" target="_blank" rel="noopener noreferrer">https://github.com/oceanbase/oceanbase/blob/9940650223427978ac634ff0d7423ab53c74a95e/src/share/schema/ob_table_schema.h#L821</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/blogs/tech/ob-schema.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/blogs/tech/high-concurrency"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OceanBase Technical Insights for High-Concurrency Scenarios</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/blogs/tech/query-engines"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Evolution of Database Query Engines</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-do-i-modify-the-syntax-of-a-ddl-statement-when-it-fails-with-a-syntax-error" class="table-of-contents__link toc-highlight">How do I modify the syntax of a DDL statement when it fails with a syntax error?</a></li><li><a href="#how-do-i-troubleshoot-a-ddl-statement-that-failed-with-a-vague-error" class="table-of-contents__link toc-highlight">How do I troubleshoot a DDL statement that failed with a vague error?</a></li><li><a href="#what-do-i-do-if-i-am-unable-to-obtain-useful-logs-after-executing-a-ddl-statement" class="table-of-contents__link toc-highlight">What do I do if I am unable to obtain useful logs after executing a DDL statement?</a></li><li><a href="#what-do-i-do-if-observers-hang-during-schema-refreshes" class="table-of-contents__link toc-highlight">What do I do if OBServers hang during schema refreshes?</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>