<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/analyze_sql_monitoring_view" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Perform analysis based on SQL monitoring views | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/analyze_sql_monitoring_view"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Perform analysis based on SQL monitoring views | OceanBase"><meta data-rh="true" name="description" content="Overview of system views"><meta data-rh="true" property="og:description" content="Overview of system views"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/analyze_sql_monitoring_view"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/analyze_sql_monitoring_view" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/analyze_sql_monitoring_view" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.1096f0ac.js" defer="defer"></script>
<script src="/assets/js/main.364d8de6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Special Interest Group(SIG)</a><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="dropdown__link">Slack<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_01_overview_of_the_oceanbase_database/introduction">Overview of the Oceanbase database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_02_deploy_oceanbase_database/introduction">Deploy Oceanbase database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/introduction">Test Oceanbase database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_04_migration_and_synchronization_oceanbase/introduction">Migrate and synchronize data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/introduction">Operation and maintenance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_06_using_ob_for_business_development/introduction">Using Oceanbase for business development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/introduction">Diagnosis_and_tuning</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/overview_of_diagnosis_and_tuning">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/odp_sql_route">Principles of ODP SQL routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/manage_connections">Manage OceanBase Database connections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/analyze_sql_monitoring_view">Perform analysis based on SQL monitoring views</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/management_execution_plan">Read and manage SQL execution plans in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/sql_tuning">Common SQL tuning methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/troubleshooting_sql_performance_issues">Typical scenarios and troubleshooting logic for SQL performance issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/performance_diagnosis_by_sql_diagnoser">Use SQL Diagnoser to diagnose and analyze SQL performance issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/diagnose_and_analyze_through_obdiag">Use obdiag for diagnostics and analytics</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Diagnosis_and_tuning</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Perform analysis based on SQL monitoring views</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>7.4 Perform analysis based on SQL monitoring views</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-system-views">Overview of system views<a href="#overview-of-system-views" class="hash-link" aria-label="Direct link to Overview of system views" title="Direct link to Overview of system views">​</a></h2>
<p>OceanBase Database V4.x provides a variety of views. You can obtain the basic information and real-time status of various database objects in an OceanBase cluster by using these views. These views can be classified into two categories: data dictionary views and dynamic performance views.</p>
<ul>
<li>
<p>A data dictionary view displays the basic information about database objects that are managed by the <code>sys</code> tenant. Typically, the names of data dictionary views begin with <code>DBA_</code> or <code>CDB_</code>. Views whose names begin with <code>DBA_</code> display information about each tenant. For example, the <code>DBA_OB_LS</code> view of a tenant displays the log stream information of the tenant, and the <code>DBA_OB_LS</code> view of the <code>sys</code> tenant displays only the log stream information of the <code>sys</code> tenant. Views whose names begin with <code>CDB_</code> are used for the <code>sys</code> tenant. You can query these views for the status of all tenants in the cluster from the <code>sys</code> tenant. For example, the <code>CDB_OB_LS</code> view displays information about all log streams of all tenants in the cluster. In general, each view whose name begins with <code>DBA_</code> has a corresponding view whose name begins with <code>CDB_</code> in the <code>sys</code> tenant.</p>
</li>
<li>
<p>A dynamic performance view displays information about the dynamic status changes of the system. Typically, the names of dynamic performance views begin with <code>GV$</code> or <code>V$</code>. Views whose names begin with <code>V$</code> display only information about the node to which you have logged on. Views whose names begin with <code>GV$</code> display information about all nodes. Dynamic performance views of a user tenant display information about the tenant. For example, you can query the <code>GV$OB_UNITS</code> view of a user tenant for the resource unit allocation information of the tenant. Dynamic performance views of the <code>sys</code> tenant display information about all tenants in the cluster.</p>
</li>
</ul>
<p>These views show you the internal architecture of OceanBase Database and details about the system operation status. Views allow you to learn about the system components of OceanBase Database, check their status in real time, and understand the relationships between them. Internal views are one of the best tools that help you get familiar with OceanBase Database. Corresponding data dictionary views are shown in the following figure.</p>
<p><img decoding="async" loading="lazy" alt="Views" src="/assets/images/001-886ca35af3f1225d5cc8fa3c2bd93f53.jpeg" width="2000" height="1010" class="img_ev3q"></p>
<p>The data sources of metrics are internal dynamic performance views of OceanBase Database. All metrics can be queried by using SQL statements. Dynamic performance views are classified into <code>GV$</code> views and <code>V$</code> views. An external monitoring system, such as OceanBase Cloud Platform (OCP), deploys its agent process on each database server and regularly pulls local monitoring information (<code>V$</code> views) by using SQL APIs. Some global information, such as RootService-related information, is collected from the central node. All monitoring data is reported to the monitoring system database and aggregated by cluster, tenant, node, and resource unit, to display the metrics on the monitoring dashboard.</p>
<blockquote>
<p><strong>Note</strong></p>
<ul>
<li>
<p>Although the data sources of metrics are views of OceanBase Database, we recommend that you use a visual external monitoring system during daily O&amp;M, which makes it easier to analyze the trends of metrics and improves efficiency.</p>
</li>
<li>
<p><code>GV$</code> views and <code>V$</code> views are homogenous. Therefore, they are not separately described in this topic. You can query an appropriate view based on the scenario.</p>
</li>
</ul>
</blockquote>
<p>The following table describes the frequently used dynamic performance views of OceanBase Database.</p>
<table><thead><tr><th>View</th><th>Description</th></tr></thead><tbody><tr><td>GV$SYSSTAT</td><td>Displays the system statistics.</td></tr><tr><td>GV$SYSTEM_EVENT</td><td>Displays the statistics of tenant-level wait events.</td></tr><tr><td>GV$SESSION_EVENT</td><td>Displays the statistics of session-level wait events.</td></tr><tr><td>GV$LATCH</td><td>Displays the latch statistics.</td></tr><tr><td>GV$OB_MEMORY</td><td>Displays the memory information.</td></tr><tr><td>GV$OB_PROCESSLIST</td><td>Displays the session information.</td></tr><tr><td>GV$OB_TRANSACTION_PARTICIPANTS</td><td>Displays the information about participants of active transactions.</td></tr><tr><td>GV$OB_SQL_AUDIT</td><td>Displays the SQL statistics.</td></tr><tr><td>GV$SQL_PLAN_MONITOR</td><td>Displays the statistics of SQL operators.</td></tr><tr><td>GV$OB_PLAN_CACHE_STAT</td><td>Displays the plan cache statistics.</td></tr><tr><td>GV$OB_PLAN_CACHE_PLAN_STAT</td><td>Displays the statistics of execution plans.</td></tr><tr><td>GV$OB_PLAN_CACHE_PLAN_EXPLAIN</td><td>Displays the details of execution plans.</td></tr><tr><td>GV$OB_SERVERS</td><td>Displays the information about OBServer nodes.</td></tr><tr><td>GV$OB_UNITS</td><td>Displays the information about resource units.</td></tr><tr><td>GV$OB_PARAMETERS</td><td>Displays the information about parameters.</td></tr><tr><td>GV$OB_KVCACHE</td><td>Displays the information about KVCache.</td></tr><tr><td>GV$OB_SSTABLES</td><td>Displays the information about SSTables.</td></tr><tr><td>GV$OB_MEMSTORE</td><td>Displays the information about MemStores.</td></tr><tr><td>GV$OB_LOG_STAT</td><td>Displays the information about log streams.</td></tr></tbody></table>
<p>Metrics can be classified by different attributes.</p>
<ul>
<li>
<p>Metrics are classified into system and SQL metrics based on the metric type. System metrics describe the system operating status for you to determine the health condition of clusters, tenants, and sessions. System metrics can be further classified into metrics, wait events, and latch events. SQL metrics describe SQL-related monitoring information and record resource consumption and wait events during the SQL execution so that you can diagnose the issue of a specific SQL statement.</p>
</li>
<li>
<p>Metrics are classified into tenant-level and session-level metrics based on the monitoring granularity. Tenant-level metrics are indexed by tenant ID and node IP address. The external monitoring system regularly collects monitoring data gathered by tenant on each server, and aggregate and display the data by different dimensions, such as cluster, tenant, node, and resource unit, as needed in various scenarios. Tenant-level monitoring provides the data sources of the monitoring dashboard. Session-level metrics are indexed by session ID and trace ID. This allows you to perform end-to-end diagnostics on specific sessions. Session-level monitoring plays an important role in end-to-end tracing.</p>
</li>
<li>
<p>Metrics can also be classified based on the monitored objects. For example, the metrics can be classified into categories such as transaction, KVCache, clog, storage, resource, SSTable, and MemStore metrics. Based on all the metrics of OceanBase Database, you can progressively find the root causes during fault diagnosis, track the health status of each component in real time to identify potential risks at the earliest opportunity, and prevent the database performance specified in the service level agreement (SLA) from being affected.</p>
</li>
</ul>
<p>This topic describes SQL monitoring. It allows you to diagnose system performance issues based on the monitoring information collected during multiple or specific executions of specific SQL statements. For information about system monitoring, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001169156" target="_blank" rel="noopener noreferrer">System monitoring</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-sql-monitoring">Overview of SQL monitoring<a href="#overview-of-sql-monitoring" class="hash-link" aria-label="Direct link to Overview of SQL monitoring" title="Direct link to Overview of SQL monitoring">​</a></h2>
<p>SQL monitoring information includes the resource consumption during SQL execution, which is obtained by collecting the statistics of metrics and wait events before and after an SQL statement is executed and calculating the difference. In addition, SQL monitoring provides information such as the SQL text, SQL plan, and execution feedback, which is quite helpful in diagnosing an SQL statement.</p>
<p>OceanBase Database provides many views for SQL diagnostics. The following table describes important ones.</p>
<table><thead><tr><th>View</th><th>Description</th></tr></thead><tbody><tr><td>GV$OB_SQL_AUDIT</td><td>Displays the SQL statistics.</td></tr><tr><td>GV$OB_PLAN_CACHE_PLAN_STAT</td><td>Displays the statistics of execution plans.</td></tr><tr><td>GV$OB_PLAN_CACHE_PLAN_EXPLAIN</td><td>Displays the details of execution plans.</td></tr><tr><td>DBA_OB_OUTLINES</td><td>Displays the general outlines.</td></tr><tr><td>DBA_OB_CONCURRENT_LIMIT_SQL</td><td>Displays the throttling outlines.</td></tr><tr><td>GV$OB_PLAN_CACHE_STAT</td><td>Displays the plan cache statistics.</td></tr><tr><td>GV$SQL_PLAN_MONITOR</td><td>Displays the statistics of SQL operators.</td></tr><tr><td>GV$SESSION_EVENT</td><td>Displays the statistics of session-level wait events.</td></tr><tr><td>GV$OB_TRANSACTION_PARTICIPANTS</td><td>Displays the information about participants of active transactions.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="view-related-to-sql-audit">View related to SQL audit<a href="#view-related-to-sql-audit" class="hash-link" aria-label="Direct link to View related to SQL audit" title="Direct link to View related to SQL audit">​</a></h2>
<p>The<code> GV$OB_SQL_AUDIT</code> view is the most frequently used SQL monitoring view. It records the source, execution status, resource consumption, and wait events of each SQL request regardless of whether the SQL request is successful or fails. It also records key information such as the SQL text and execution plans. Therefore, it is a great tool for SQL diagnostics.</p>
<p>The data of the <code>GV$OB_SQL_AUDIT</code> view is stored in a configurable memory space. On each node, a separate cache is allocated for each tenant. When the memory usage or the number of records reaches the specified threshold, automatic eviction is triggered. The oldest data is evicted first. This is similar to a first-in-first-out (FIFO) queue in the memory. An experienced database administrator (DBA) often starts troubleshooting SQL response time (RT) jitters by disabling the SQL audit feature to retain the monitoring records. This prevents the monitoring data from being evicted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-audit-settings">SQL audit settings<a href="#sql-audit-settings" class="hash-link" aria-label="Direct link to SQL audit settings" title="Direct link to SQL audit settings">​</a></h3>
<p>You can use the following parameters to control the behavior of the SQL audit feature:</p>
<ul>
<li>
<p><code>enable_sql_audit</code>: specifies whether to enable the SQL audit feature for all tenants. This cluster parameter takes effect immediately after it is modified. The default value is <code>True</code>. For more information, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001105603" target="_blank" rel="noopener noreferrer">enable_sql_audit</a>.</p>
<ul>
<li>
<p>Query the value of <code>enable_sql_audit</code>.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> parameters </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;enable_sql_audit&#x27;</span><span class="token plain">\G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         zone: zone1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     svr_type: observer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       svr_ip: 1.2.3.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     svr_port: 12345</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         name: enable_sql_audit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_type: NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         info: specifies whether SQL audit is turned on. The default value is TRUE. Value: TRUE: turned on FALSE: turned off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      section: OBSERVER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scope: CLUSTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       source: DEFAULT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   edit_level: DYNAMIC_EFFECTIVE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_value: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isdefault: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Change the value of <code>enable_sql_audit</code>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>You can modify the <code>enable_sql_audit</code> parameter only in the <code>sys</code> tenant. The modification takes effect on the entire cluster.</p>
</blockquote>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Enable the SQL audit feature for the entire cluster.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> SYSTEM </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> enable_sql_audit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Disable the SQL audit feature for the entire cluster.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> SYSTEM </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> enable_sql_audit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><code>ob_enable_sql_audit</code>: specifies whether to enable the SQL audit feature for the current tenant. This tenant-level system variable takes effect immediately after it is modified. The default value is <code>ON</code>. For more information, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001105303" target="_blank" rel="noopener noreferrer">ob_enable_sql_audit</a>.</p>
<ul>
<li>
<p>Query the value of <code>ob_enable_sql_audit</code>.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ob_enable_sql_audit&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name       | Value |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ob_enable_sql_audit | ON    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Change the value of <code>ob_enable_sql_audit</code>.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Disable the SQL audit feature for the current tenant. The modification takes effect only on connections created after the statement execution succeeds.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> ob_enable_sql_audit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OFF</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Enable the SQL audit feature for the current tenant. The modification takes effect only on connections created after the statement execution succeeds.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> ob_enable_sql_audit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><code>ob_sql_audit_percentage</code>: specifies the percentage of tenant memory that can be used by the SQL audit feature for the current tenant. This tenant-level system variable takes effect immediately after it is modified. The default value is <code>3</code>, which indicates 3%. To prevent excessive memory usage, the maximum memory space for the SQL Audit feature is set to 1 GB. For more information, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001105342" target="_blank" rel="noopener noreferrer">ob_sql_audit_percentage</a>.</p>
<ul>
<li>
<p>Query the value of <code>ob_sql_audit_percentage</code>.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ob_sql_audit_percentage&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name           | Value |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ob_sql_audit_percentage | 3     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Modify the <code>ob_sql_audit_percentage</code> parameter for the current tenant. The modification takes effect only on connections created after the statement execution succeeds.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> ob_sql_audit_percentage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eviction-mechanism-of-sql-audit">Eviction mechanism of SQL audit<a href="#eviction-mechanism-of-sql-audit" class="hash-link" aria-label="Direct link to Eviction mechanism of SQL audit" title="Direct link to Eviction mechanism of SQL audit">​</a></h3>
<p>OceanBase Database runs a background task for each tenant to check the memory usage of the OBServer node and SQL audit every second and determines whether to trigger SQL eviction. The maximum memory size available for SQL audit is specified by <code>ob_sql_audit_percentage</code>. When the memory usage of SQL audit reaches the specified threshold, eviction is triggered. When the memory usage of SQL audit falls below the specified threshold, eviction stops.</p>
<p>The following table describes the eviction mechanism of SQL audit.</p>
<table><thead><tr><th>Trigger condition</th><th>Maximum memory size for SQL audit</th><th>Eviction triggering threshold</th><th>Eviction stopping threshold</th></tr></thead><tbody><tr><td>Memory usage</td><td>[0 MB, 64 MB)</td><td>Maximum memory size × 50%</td><td>0 MB</td></tr><tr><td>Memory usage</td><td>[64 MB, 100 MB)</td><td>Maximum memory size - 20 MB</td><td>Maximum memory size - 40 MB</td></tr><tr><td>Memory usage</td><td>[100 MB, 5 GB)</td><td>Maximum memory size × 80%</td><td>Maximum memory size × 60%</td></tr><tr><td>Memory usage</td><td>[5 GB, +∞)</td><td>Maximum memory size - 1 GB</td><td>Maximum memory size - 2 GB</td></tr><tr><td>Records</td><td>N/A</td><td>9 million</td><td>8 million</td></tr></tbody></table>
<p>The SQL audit feature also supports tenant-level manual eviction. You can execute the following statement to enable manual eviction for a tenant.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> system flush </span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> audit tenant </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tenant_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fields-in-gvob_sql_audit">Fields in GV$OB_SQL_AUDIT<a href="#fields-in-gvob_sql_audit" class="hash-link" aria-label="Direct link to Fields in GV$OB_SQL_AUDIT" title="Direct link to Fields in GV$OB_SQL_AUDIT">​</a></h3>
<p>The <code>GV$OB_SQL_AUDIT</code> view provides information in many fields. This section describes only a part of them. For more information, see the <strong>Fields in GV$OB_SQL_AUDIT</strong> section in <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001169795" target="_blank" rel="noopener noreferrer">GV$OB_SQL_AUDIT</a>.</p>
<ul>
<li>
<p><code>TENANT_ID</code>: the ID of the tenant that sent the request.</p>
</li>
<li>
<p><code>SVR_IP</code>: the IP address of the server that received the request.</p>
</li>
<li>
<p><code>CLIENT_IP</code>: the IP address of the client that sent the request.</p>
</li>
<li>
<p><code>REQUEST_TIME</code>: the time when the database received the request.</p>
</li>
<li>
<p><code>REQUEST_ID</code>: the ID of the request, which identifies one execution of the request and increases over time. External monitoring systems use this field as a cursor to pull the audit information.</p>
</li>
<li>
<p><code>IS_INNER_SQL</code>: indicates whether the request is an internal SQL request.</p>
</li>
<li>
<p><code>IS_EXECUTOR_RPC</code>: indicates whether the current request is an RPC request.</p>
</li>
<li>
<p><code>SQL_ID</code>: the identifier of a specific SQL statement. Unlike the <code>REQUEST_ID</code> field, the value of the <code>SQL_ID</code> field of an SQL statement remains unchanged regardless of multiple executions.</p>
</li>
<li>
<p><code>QUERY_SQL</code>: the full-text content of the SQL statement. OceanBase Database allows you to bind an execution plan by using the <code>SQL_ID</code> or <code>SQL_TEXT</code> field.</p>
</li>
<li>
<p><code>SID</code>: the identifier of a session. It is associated with all SQL statements and wait events of the session. This field corresponds to the <code>ID</code> field in the <code>GV$OB_PROCESSLIST</code> view.</p>
</li>
<li>
<p><code>TX_ID</code>: the identifier of a transaction. It is associated with all SQL statements of the transaction. A large gap between the end time of a statement and the start time of the next statement in a transaction indicates that the execution link consumes a large amount of time.</p>
</li>
<li>
<p><code>TRACE_ID</code>: the trace ID of the SQL request. You can associate the trace ID with other metrics or logs in a query.</p>
</li>
<li>
<p><code>IS_HIT_PLAN</code>: indicates whether the plan cache is hit. SQL tuning is time-consuming. To avoid repeated SQL tuning, generated plans are stored in the plan cache and retrieved from the plan cache when the related SQL statement is executed again. If the plan cache is not hit, a hard parsing of the SQL statement is performed. Otherwise, soft parsing is performed. Hard parsing affects the SQL performance and increases time consumption. If the hit rate of the plan cache of a tenant is too low, check whether the plan cache space is too small. A small plan cache causes frequent eviction of plans.</p>
</li>
<li>
<p><code>PLAN_ID</code>: the ID of the execution plan. You can query the details and statistics of the execution plan by using this field.</p>
</li>
<li>
<p><code>PLAN_HASH</code>: the hash value of the execution plan.</p>
</li>
<li>
<p><code>PLAN_TYPE</code>: the type of the execution plan. Valid values: <code>0</code>, <code>1</code>, <code>2</code>, and <code>3</code>. Values <code>1</code>, <code>2</code>, and <code>3</code> respectively correspond to local plans, remote plans, and distributed plans. The value <code>0</code> indicates that no execution plan is available. For example, a <code>COMMIT</code> statement does not have an execution plan.</p>
</li>
<li>
<p><code>AFFECTED_ROWS</code>: the number of rows affected.</p>
</li>
<li>
<p><code>RETURN_ROWS</code>: the number of rows returned.</p>
</li>
<li>
<p><code>RET_CODE</code>: the return code of the execution.</p>
</li>
<li>
<p><code>EVENT</code>: the name of the wait event with the longest wait time.</p>
</li>
<li>
<p><code>P1TEXT</code> to <code>P3TEXT</code>: the names of the three parameters of the wait event.</p>
</li>
<li>
<p><code>P1</code> to <code>P3</code>: the values of the three parameters of the wait event.</p>
</li>
<li>
<p><code>LEVEL</code>: the level of the wait event.</p>
</li>
<li>
<p><code>WAIT_CLASS_ID</code>: the ID of the class to which the wait event belongs.</p>
</li>
<li>
<p><code>WAIT_CLASS</code>: the name of the class to which the wait event belongs.</p>
</li>
<li>
<p><code>STATE</code>: the status of the wait event.</p>
</li>
<li>
<p><code>WAIT_TIME_MICRO</code>: the wait time of the wait event, in microseconds.</p>
</li>
<li>
<p><code>TOTAL_WAIT_TIME_MICRO</code>: the total wait time in the execution process, in microseconds.</p>
</li>
<li>
<p><code>TOTAL_WAITS</code>: the total number of waits during the execution.</p>
</li>
<li>
<p><code>ELAPSED_TIME</code>: the total time of this execution, from the time when the request was received to the end of the execution, which consists of multiple sub-stages.</p>
</li>
<li>
<p><code>NET_TIME</code>: the amount of time elapsed from when the RPC was sent to when the request was received.</p>
</li>
<li>
<p><code>NET_WAIT_TIME</code>: the amount of time elapsed from when the request was received to when it entered the queue.</p>
</li>
<li>
<p><code>QUEUE_TIME</code>: the time that the request waited in the queue, which reflects the request accumulation in the current tenant.</p>
</li>
<li>
<p><code>DECODE_TIME</code>: the time spent decoding the request after it left the queue.</p>
</li>
<li>
<p><code>GET_PLAN_TIME</code>: the time when the execution plan was generated, which reflects the health of the plan cache of the current tenant.</p>
</li>
<li>
<p><code>EXECUTE_TIME</code>: the execution time of the plan, which is the sum of the CPU time and the value of the <code>TOTAL_WAIT_TIME_MICRO</code> field. The value of the <code>TOTAL_WAIT_TIME_MICRO</code> field is the sum of the values of the following fields: <code>APPLICATION_WAIT_TIME</code>, <code>CONCURRENCY_WAIT_TIME</code>, <code>USER_IO_WAIT_TIME</code>, and <code>SCHEDULE_TIME</code>. The difference between the values of the <code>EXECUTE_TIME</code> and <code>TOTAL_WAIT_TIME_MICRO</code> fields is the value of the <code>CPU_TIME</code> field.</p>
</li>
<li>
<p><code>APPLICATION_WAIT_TIME</code>: the total amount of time spent waiting for events of the <code>application</code> class.</p>
</li>
<li>
<p><code>CONCURRENCY_WAIT_TIME</code>: the total amount of time spent waiting for events of the <code>concurrency</code> class.</p>
</li>
<li>
<p><code>USER_IO_WAIT_TIME</code>: the total amount of time spent waiting for events of the <code>user_io</code> class.</p>
</li>
<li>
<p><code>SCHEDULE_TIME</code>: the total amount of time spent on events of the <code>schedule</code> class, in microseconds.</p>
</li>
<li>
<p>Logical reads: During the execution of a request, the database first reads data from caches at all levels. The corresponding fields include <code>ROW_CACHE_HIT</code>, <code>BLOOM_FILTER_CACHE_HIT</code>, and <code>BLOCK_CACHE_HIT</code>. If no cache is hit, a disk read is performed. The field corresponding to a disk read is <code>DISK_READS</code>. You can determine whether to optimize an SQL request based on the number of rows scanned during the execution of the request. The number of rows scanned is calculated based on the number of cache and disk reads. Note that the number of rows scanned does not equal the number of physical reads, because the database first scans caches at all levels.</p>
</li>
<li>
<p><code>ROW_CACHE_HIT</code>: the number of row cache hits.</p>
</li>
<li>
<p><code>BLOOM_FILTER_CACHE_HIT</code>: the number of Bloom filter cache hits.</p>
</li>
<li>
<p><code>BLOCK_CACHE_HIT</code>: the number of block cache hits.</p>
</li>
<li>
<p><code>BLOCK_INDEX_CACHE_HIT</code>: the number of block index cache hits.</p>
</li>
<li>
<p><code>DISK_READS</code>: the number of physical reads.</p>
</li>
<li>
<p><code>RETRY_CNT</code>: the number of retries.</p>
</li>
<li>
<p><code>TABLE_SCAN</code>: indicates whether the request contains a full table scan.</p>
</li>
<li>
<p><code>CONSISTENCY_LEVEL</code>: the consistency level. Valid values:</p>
<ul>
<li>
<p><code>-1</code>: indicates that the consistency level is invalid.</p>
</li>
<li>
<p><code>1</code>: indicates to read data stored in SSTables.</p>
</li>
<li>
<p><code>2</code>: indicates weak-consistency read.</p>
</li>
<li>
<p><code>3</code>: indicates strong-consistency read.</p>
</li>
</ul>
</li>
<li>
<p><code>MEMSTORE_READ_ROW_COUNT</code>: the number of rows read from the MemStore.</p>
</li>
<li>
<p><code>SSSTORE_READ_ROW_COUNT</code>: the number of rows read from the SSStore.</p>
</li>
<li>
<p><code>REQUEST_MEMORY_USED</code>: the memory consumed by the request.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h3>
<p>You can query the <code>GV$OB_SQL_AUDIT</code> view for execution information of SQL statements in various dimensions. Here are some examples:</p>
<ul>
<li>
<p>Query slow SQL statistics.</p>
<p>You can query the SQL statements whose execution time exceeds the specified threshold during a period of time, and subsequently optimize specific SQL statements based on the query result. The following example queries the first five SQL statements that were executed later than <code>2024-02-20 12:00:00</code> with the execution time exceeding 100 ms under the tenant whose ID is <code>1002</code>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usec_to_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  elapsed_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  queue_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  execute_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  query_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GV$OB_SQL_AUDIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1002</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> elapsed_time </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> request_time </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> time_to_usec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2024-02-20 12:00:00&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  elapsed_time </span><span class="token keyword" style="color:#00009f">desc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+----------------------------+--------------+------------+--------------+-------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| tenant_id | request_id | usec_to_time(request_time) | elapsed_time | queue_time | execute_time | query_sql                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+----------------------------+--------------+------------+--------------+-------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 |   21371247 | 2024-02-20 16:14:10.008111 |       153118 |         34 |       139873 | select * from xxxx where xxxx |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+----------------------------+--------------+------------+--------------+-------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query SQL statements within a transaction.</p>
<p>Each SQL statement entry in <code>GV$OB_SQL_AUDIT</code> records the unique identifier of the current transaction in the <code>tx_id</code> field. You can find all SQL statements in the current transaction based on this field. Then, you can determine whether the transaction model in business stress testing meets your expectation. The following example queries the SQL statements executed in the transaction whose <code>tx_id</code> is <code>27592485</code> under the <code>sys</code> tenant whose ID is <code>1</code>.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tx_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  query_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GV$OB_SQL_AUDIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> tx_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;27592485&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request_time </span><span class="token keyword" style="color:#00009f">asc</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| tenant_id | tx_id    | query_sql                                                                                                                                                                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         1 | 27592485 | START TRANSACTION                                                                                                                                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         1 | 27592485 | SELECT column_value FROM __all_core_table WHERE TABLE_NAME = &#x27;__all_global_stat&#x27; AND COLUMN_NAME = &#x27;snapshot_gc_scn&#x27; FOR UPDATE                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         1 | 27592485 | UPDATE __all_core_table SET column_value = 1708416843896658521 WHERE table_name = &#x27;__all_global_stat&#x27; AND column_name = &#x27;snapshot_gc_scn&#x27; AND column_value &lt; 1708416843896658521 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         1 | 27592485 | COMMIT                                                                                                                                                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query SQL statements executed in the same session.</p>
<p>You can query all business requests in a specific session by SID to analyze the business model. The following example queries the SQL statements executed later than <code>2024-02-20 12:00:00</code> in the session whose <code>sid</code> is <code>3221652146</code> under the tenant whose ID is <code>1002</code>.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  query_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GV$OB_SQL_AUDIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1002</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> sid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3221652146</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> request_time </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> time_to_usec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2024-02-20 12:00:00&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request_time </span><span class="token keyword" style="color:#00009f">asc</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| tenant_id | sid        | query_sql                                                                                                                                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 3221652146 | set _show_ddl_in_compat_mode = 1;                                                                                                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 3221652146 | set autocommit=1                                                                                                                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 3221652146 | set names utf8                                                                                                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 3221652146 | SELECT @@max_allowed_packet,@@system_time_zone,@@time_zone,@@auto_increment_increment,@@tx_isolation AS tx_isolation,@@session.tx_read_only AS tx_read_only |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 3221652146 | select @@version_comment, @@version, ob_version() limit 1                                                                                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 3221652146 | show variables like &#x27;version_comment&#x27;                                                                                                                       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 3221652146 | SHOW DATABASES                                                                                                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the average queuing time of the last 1,000 SQL statements.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">--+ query_timeout(30000000)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queue_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GV$OB_SQL_AUDIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request_id </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      v$OB_SQL_AUDIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| avg(queue_time) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|          0.2960 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query SQL statements that occupy the most resources of a tenant.</p>
<p>If CPU resources of the tenant are fully used, you can use the following statement to check whether the issue is caused by SQL statements and if yes, query the suspicious SQL statements. The SQL statements in the return result are sorted in descending order by the amount of resources occupied, which is calculated by using the following formula: Execution time × Number of executions.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SQL_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ELAPSED_TIME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QUEUE_TIME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ROW_CACHE_HIT </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> BLOOM_FILTER_CACHE_HIT </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> BLOCK_CACHE_HIT </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> DISK_READS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> avg_logical_read</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">execute_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> avg_exec_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> cnt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">execute_time </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> TOTAL_WAIT_TIME_MICRO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> avg_cpu_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TOTAL_WAIT_TIME_MICRO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> avg_wait_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WAIT_CLASS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">retry_cnt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  QUERY_SQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GV$OB_SQL_AUDIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SQL_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  avg_exec_time </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> cnt </span><span class="token keyword" style="color:#00009f">desc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------+-------------------+-----------------+------------------+---------------+------+--------------+---------------+------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| SQL_ID                           | avg(ELAPSED_TIME) | avg(QUEUE_TIME) | avg_logical_read | avg_exec_time | cnt  | avg_cpu_time | avg_wait_time | WAIT_CLASS | avg(retry_cnt) | QUERY_SQL                                                                                                                                                                                                                                                                                                                                                                                                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------+-------------------+-----------------+------------------+---------------+------+--------------+---------------+------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1532BA78C664771E7113567D8E951B51 |         4330.2720 |          0.0000 |           0.0000 |     4138.0498 |  261 |    4138.0498 |        0.0000 | OTHER      |         0.0000 | SELECT FIELD FROM `oceanbase`. `__tenant_virtual_table_column` WHERE TABLE_ID = 20001                                                                                                                                                                                                                                                                                                                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1D0BA376E273B9D622641124D8C59264 |          323.2321 |          0.0000 |           0.0000 |      224.9437 |  711 |     224.9437 |        0.0000 | OTHER      |         0.0000 | COMMIT                                                                                                                                                                                                                                                                                                                                                                                                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 9050622DE000F09344C9A882DAF34A75 |          472.4209 |          0.0000 |           0.0000 |      265.2209 |  575 |     265.2209 |        0.0000 | OTHER      |         0.0000 | select * from __all_ls where 1=1 and status != &#x27;DROPPED&#x27; and status != &#x27;CREATE_ABORT&#x27; order by ls_id                                                                                                                                                                                                                                                                                                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 19A6B821DB3DE80D69EE8880D3A45C5F |       160857.0000 |         38.0000 |           0.0000 |   137214.0000 |    1 |  137214.0000 |        0.0000 | OTHER      |         0.0000 | select * from GV$OB_SQL_AUDIT where SQL_ID = &#x27;1D0BA376E273B9D622641124D8C59264&#x27;                                                                                                                                                                                                                                                                                                                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 37B3D4D55DC217FA1BCA9031DC3AF1DC |        34309.2500 |         37.2500 |           0.0000 |    28792.0000 |    4 |   28792.0000 |        0.0000 | OTHER      |         0.0000 | select   SQL_ID,   avg(ELAPSED_TIME),   avg(QUEUE_TIME),   avg(ROW_CACHE_HIT + BLOOM_FILTER_CACHE_HIT + BLOCK_CACHE_HIT + DISK_READS) avg_logical_read,   avg(execute_time) avg_exec_time,   count(*) cnt,   avg(execute_time - TOTAL_WAIT_TIME_MICRO) avg_cpu_time,   avg(TOTAL_WAIT_TIME_MICRO) avg_wait_time,   WAIT_CLASS,   avg(retry_cnt) from   GV$OB_SQL_AUDIT group by   SQL_ID order by   avg_exec_time * cnt desc limit   10 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 735537F7B5DB7C4E0E946C9B26108560 |          615.7653 |          0.0000 |           0.0000 |      395.2419 |  277 |     395.2419 |        0.0000 | OTHER      |         0.0000 | SELECT * FROM __all_spatial_reference_systems WHERE (SRS_ID &lt; 70000000 AND SRS_ID != 0) OR SRS_ID &gt; 2000000000                                                                                                                                                                                                                                                                                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 2EAAA3C495632AB97F13659E429FC9CD |          464.6715 |          0.0000 |           0.0000 |      240.4224 |  277 |     240.4224 |        0.0000 | OTHER      |         0.0000 | select * from __all_balance_task where parent_list is null or parent_list = &#x27;&#x27;                                                                                                                                                                                                                                                                                                                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| B7A6FA97FEC98C06F9586D23935AC4C6 |          276.7934 |          0.0000 |           0.0000 |      104.0799 |  576 |     104.0799 |        0.0000 | OTHER      |         0.0000 | START TRANSACTION                                                                                                                                                                                                                                                                                                                                                                                                                       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 556CEFD22F28DDDCB6E283DF89BD9348 |         2263.9643 |          0.0000 |           0.0000 |     2103.5714 |   28 |    2103.5714 |        0.0000 | OTHER      |         0.0000 | UPDATE __all_core_table SET column_value = 1708415231707450537 WHERE table_name = &#x27;__all_global_stat&#x27; AND column_name = &#x27;snapshot_gc_scn&#x27; AND column_value &lt; 1708415231707450537                                                                                                                                                                                                                                                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 17605A1DA6B6A2150E9FBCA5D4C7653A |          797.5532 |          0.0000 |           0.0000 |      594.5532 |   94 |     594.5532 |        0.0000 | OTHER      |         0.0000 | SELECT row_id, column_name, column_value FROM __all_core_table WHERE table_name = &#x27;__all_global_stat&#x27; ORDER BY row_id, column_name                                                                                                                                                                                                                                                                                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------+-------------------+-----------------+------------------+---------------+------+--------------+---------------+------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When an SQL response time (RT) jitter occurs in a tenant, the CPU resource of the tenant is fully used and the RT of all SQL statements soars. In this case, you must first determine whether the issue is caused by the SQL statements or other problems.</p>
<p>The SQL statement described in the preceding example is quite useful in diagnostics. It aggregates executed SQL statements based on <code>SQL_ID</code> values and sorts the statements in descending order by the amount of resources occupied, which is the product of <code>avg_exec_time</code> multiplied by <code>cnt</code>. This way, you can check the top SQL statements for exceptions.</p>
<p>For more information, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001166527" target="_blank" rel="noopener noreferrer">Cases</a>.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="views-related-to-execution-plans">Views related to execution plans<a href="#views-related-to-execution-plans" class="hash-link" aria-label="Direct link to Views related to execution plans" title="Direct link to Views related to execution plans">​</a></h2>
<p>To avoid repeatedly generating plans for the same SQL statement, generated plans are stored in the plan cache and retrieved from the plan cache when the system attempts to generate a plan for the same SQL statement again. On each node, a separate plan cache is allocated for each tenant to cache the SQL plans processed on this node.</p>
<p>Plan cache views display plan cache statistics, execution statistics, and plan information. The data displayed in these views is collected from plan caches. OceanBase Database provides the following plan cache views:</p>
<ul>
<li>
<p><code>GV$OB_PLAN_CACHE_STAT</code>: displays the statistics about each plan cache. On each node, a separate plan cache is allocated for each tenant to cache the SQL plans processed on this node. In this view, each plan cache has a record.</p>
</li>
<li>
<p><code>GV$OB_PLAN_CACHE_PLAN_STAT</code>: displays the details of each cached plan and its execution statistics.</p>
</li>
<li>
<p><code>GV$OB_PLAN_CACHE_PLAN_EXPLAIN</code>: displays the information about operators in the cached plans. <strong>Take note of the following considerations:</strong></p>
<ul>
<li>
<p>To query the <code>GV$OB_PLAN_CACHE_PLAN_EXPLAIN</code> view, you must specify the <code>TENANT_ID</code>, <code>SVR_IP</code>, <code>SVR_PORT</code>, and <code>PLAN_ID</code> fields. Otherwise, no result is returned.</p>
</li>
<li>
<p>To query the <code>V$OB_PLAN_CACHE_PLAN_EXPLAIN</code> view, you must specify the <code>TENANT_ID</code> and <code>PLAN_ID</code> fields. Otherwise, no result is returned.</p>
</li>
</ul>
</li>
</ul>
<p>Fields in the <code>GV$OB_PLAN_CACHE_PLAN_STAT</code> view are described as follows:</p>
<ul>
<li>
<p><code>TENANT_ID</code>: the ID of the tenant.</p>
</li>
<li>
<p><code>SVR_IP</code>: the IP address of the node.</p>
</li>
<li>
<p><code>PLAN_ID</code>: the ID of the execution plan, which corresponds to the <code>PLAN_ID</code> field in the <code>GV$OB_SQL_AUDIT</code> view.</p>
</li>
<li>
<p><code>SQL_ID</code>: the ID of the SQL statement, which corresponds to the <code>SQL_ID</code> field in the <code>GV$OB_SQL_AUDIT</code> view.</p>
</li>
<li>
<p><code>TYPE</code>: the type of the execution plan. <code>1</code> indicates a local plan. <code>2</code> indicates a remote plan. <code>3</code> indicates a distributed plan.</p>
</li>
<li>
<p><code>STATEMENT</code>: the parameterized SQL statement.</p>
</li>
<li>
<p><code>QUERY_SQL</code>: the original SQL statement executed when the plan was loaded for the first time.</p>
</li>
<li>
<p><code>FIRST_LOAD_TIME</code>: the time when the plan was loaded for the first time.</p>
</li>
<li>
<p><code>SCHEMA_VERSION</code>: the version of the schema.</p>
</li>
<li>
<p><code>LAST_ACTIVE_TIME</code>: the time of the last execution.</p>
</li>
<li>
<p><code>AVG_EXE_USEC</code>: the average execution duration.</p>
</li>
<li>
<p><code>SLOWEST_EXE_TIME</code>: the timestamp when the slowest execution ended.</p>
</li>
<li>
<p><code>SLOWEST_EXE_USEC</code>: the amount of time consumed by the slowest execution.</p>
</li>
<li>
<p><code>SLOW_COUNT</code>: the number of times that the current plan was identified as a slow query. The query execution time threshold is specified by the cluster parameter <code>trace_log_slow_query_watermark</code>.</p>
</li>
<li>
<p><code>HIT_COUNT</code>: the number of plan cache hits.</p>
</li>
<li>
<p><code>LARGE_QUERYS</code>: the number of times that the current plan was identified as a large query. The query execution time threshold is specified by the cluster parameter <code>large_query_threshold</code>.</p>
</li>
<li>
<p><code>DELAYED_LARGE_QUERYS</code>: the number of times that the current plan was identified as a large query and dropped to the large query queue.</p>
</li>
<li>
<p><code>TIMEOUT_COUNT</code>: the number of timeouts.</p>
</li>
<li>
<p><code>EXECUTIONS</code>: the number of times that the plan has been executed.</p>
</li>
<li>
<p><code>DISK_READS</code>: the number of physical reads.</p>
</li>
<li>
<p><code>DIRECT_WRITES</code>: the number of disk writes.</p>
</li>
<li>
<p><code>BUFFER_GETS</code>: the number of logical reads.</p>
</li>
<li>
<p><code>APPLICATION_WAIT_TIME</code>: the total amount of time spent waiting for events of the <code>application</code> class.</p>
</li>
<li>
<p><code>CONCURRENCY_WAIT_TIME</code>: the total amount of time spent waiting for events of the <code>concurrency</code> class.</p>
</li>
<li>
<p><code>USER_IO_WAIT_TIME</code>: the total amount of time spent waiting for the events of the <code>user_io</code> class.</p>
</li>
<li>
<p><code>ROWS_PROCESSED</code>: the total number of rows in the results selected for all executions or the number of rows modified by executing the <code>ALTER TABLE</code> statement.</p>
</li>
<li>
<p><code>ELAPSED_TIME</code>: the total time consumed by all executions, where the time consumed by each execution is defined as the time elapsed from when the execution request was received to when the execution was completed.</p>
</li>
<li>
<p><code>CPU_TIME</code>: the total amount of CPU time consumed by all executions.</p>
</li>
<li>
<p><code>OUTLINE_ID</code>: the ID of the outline. The value <code>-1</code> indicates that the plan is not generated based on a bound outline.</p>
</li>
<li>
<p><code>OUTLINE_DATA</code>: the information about the outline corresponding to the plan.</p>
</li>
<li>
<p><code>TABLE_SCAN</code>: indicates whether the query is a primary key scan.</p>
</li>
</ul>
<p>The <code>GV$OB_PLAN_CACHE_PLAN_EXPLAIN</code> view displays the details of each execution plan in the following main fields:</p>
<ul>
<li>
<p><code>TENANT_ID</code>: the ID of the tenant.</p>
</li>
<li>
<p><code>SVR_IP</code>: the IP address of the node.</p>
</li>
<li>
<p><code>PLAN_ID</code>: the ID of the execution plan.</p>
</li>
<li>
<p><code>PLAN_DEPTH</code>: the depth of the operator.</p>
</li>
<li>
<p><code>OPERATOR</code>: the name of the operator.</p>
</li>
<li>
<p><code>NAME</code>: the name of the table corresponding to the operator.</p>
</li>
<li>
<p><code>ROWS</code>: the estimated number of rows in the result.</p>
</li>
<li>
<p><code>COST</code>: the estimated cost.</p>
</li>
<li>
<p><code>PROPERTY</code>: the details of the operator.</p>
</li>
</ul>
<p>When you repeatedly execute an SQL statement, the execution plan may change with database objects, statistics, and OceanBase Database versions. You can query the actual execution plan for an SQL statement from the <code>gv$ob_sql_audit</code> or <code>GV$OB_PLAN_CACHE_PLAN_EXPLAIN</code> view instead of directly executing the <code>EXPLAIN</code> statement.</p>
<p>Here is an example:</p>
<ol>
<li>
<p>Execute an SQL statement.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DBA_OB_DATABASES</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------+--------------------+-----------+--------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| DATABASE_NAME      | IN_RECYCLEBIN | COLLATION          | READ_ONLY | COMMENT            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------+--------------------+-----------+--------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| obproxy            | NO            | utf8mb4_general_ci | NO        |                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test               | NO            | utf8mb4_general_ci | NO        | test schema        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| __public           | NO            | utf8mb4_general_ci | YES       | public schema      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| __recyclebin       | NO            | utf8mb4_general_ci | YES       | recyclebin schema  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mysql              | NO            | utf8mb4_general_ci | NO        | MySql schema       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| information_schema | NO            | utf8mb4_general_ci | NO        | information_schema |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| oceanbase          | NO            | utf8mb4_general_ci | NO        | system database    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------+--------------------+-----------+--------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the trace ID of the SQL statement.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> last_trace_id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| last_trace_id()                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Y584A0B9E1F14-0006104BFEB3B549-0-0 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the <code>TENANT_ID</code>, <code>SVR_IP</code>, <code>SVR_PORT</code>, and <code>PLAN_ID</code> fields corresponding to the SQL statement based on the trace ID.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> TENANT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SVR_IP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SVR_PORT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PLAN_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  QUERY_SQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gv$ob_sql_audit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> trace_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Y584A0B9E1F14-0006104BFEB3B549-0-0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TENANT_ID | SVR_IP       | SVR_PORT | PLAN_ID | QUERY_SQL                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 1.2.3.4      |    12345 |   67890 | select * from oceanbase.DBA_OB_DATABASES |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the actual execution plan for the SQL statement based on the return result.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GV$OB_PLAN_CACHE_PLAN_EXPLAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1002</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> SVR_IP </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1.2.3.4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> SVR_PORT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12345</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> PLAN_ID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">67890</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------+--------------+-----------------+------+------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TENANT_ID | SVR_IP       | SVR_PORT | PLAN_ID | PLAN_DEPTH | PLAN_LINE_ID | OPERATOR        | NAME | ROWS | COST | PROPERTY                                                                                                                                                                                                                                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------+--------------+-----------------+------+------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 1.2.3.4      |    12345 |   67890 |          0 |            0 | PHY_HASH_JOIN   | NULL |    8 |   56 | NULL                                                                                                                                                                                                                                                                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 1.2.3.4      |    12345 |   67890 |          1 |            1 |  PHY_TABLE_SCAN | D    |    8 |    5 | table_rows:8, physical_range_rows:8, logical_range_rows:8, index_back_rows:0, output_rows:8, avaiable_index_name[idx_db_name,__all_database], pruned_index_name[idx_db_name], estimation info[table_id:104, (table_type:10, version: -1--1--1, logical_rc:8, physical_rc:8)] |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 1.2.3.4      |    12345 |   67890 |          1 |            2 |  PHY_TABLE_SCAN | C    |   18 |   45 | table_rows:18, physical_range_rows:18, logical_range_rows:18, index_back_rows:0, output_rows:18, avaiable_index_name[__tenant_virtual_collation]                                                                                                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------+--------------+-----------------+------+------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>OceanBase Database also supports the <code>GV$OB_SQL_PLAN</code> view. It displays the information returned during the first execution of a plan, for example, the number of output rows of the current operator estimated by the optimizer, and the actual number of rows returned for the current operator during the first execution of the plan. You can determine whether the cost estimated by the optimizer is accurate based on these values. For more information about the <code>GV$OB_SQL_PLAN</code> view, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001104608" target="_blank" rel="noopener noreferrer">GV$OB_SQL_PLAN</a>.</p>
<p>Here is an example:</p>
<ol>
<li>
<p>Execute an SQL statement.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DBA_OB_DATABASES</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------+--------------------+-----------+--------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| DATABASE_NAME      | IN_RECYCLEBIN | COLLATION          | READ_ONLY | COMMENT            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------+--------------------+-----------+--------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| obproxy            | NO            | utf8mb4_general_ci | NO        |                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test               | NO            | utf8mb4_general_ci | NO        | test schema        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| __public           | NO            | utf8mb4_general_ci | YES       | public schema      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| __recyclebin       | NO            | utf8mb4_general_ci | YES       | recyclebin schema  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mysql              | NO            | utf8mb4_general_ci | NO        | MySql schema       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| information_schema | NO            | utf8mb4_general_ci | NO        | information_schema |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| oceanbase          | NO            | utf8mb4_general_ci | NO        | system database    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+---------------+--------------------+-----------+--------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the trace ID of the SQL statement.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> last_trace_id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| last_trace_id()                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Y584A0B9E1F14-0006104BFEB3B549-0-0 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the <code>TENANT_ID</code>, <code>SVR_IP</code>, <code>SVR_PORT</code>, and <code>PLAN_ID</code> fields corresponding to the SQL statement based on the trace ID.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> TENANT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SVR_IP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SVR_PORT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PLAN_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  QUERY_SQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gv$ob_sql_audit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> trace_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Y584A0B9E1F14-0006104BFEB3B549-0-0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TENANT_ID | SVR_IP       | SVR_PORT | PLAN_ID | QUERY_SQL                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | 1.2.3.4      |    12345 |   67890 | select * from oceanbase.DBA_OB_DATABASES |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+--------------+----------+---------+------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query the actual execution plan for the SQL statement based on the return result.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OPERATOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PARENT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DEPTH</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  POSITION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OBJECT_NAME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  REAL_COST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CARDINALITY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  REAL_CARDINALITY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IO_COST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CPU_COST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GV$OB_SQL_PLAN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> plan_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">67890</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----+-----------+-------+----------+----------------------------+------+-----------+-------------+------------------+---------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| OPERATOR         | ID | PARENT_ID | DEPTH | POSITION | OBJECT_NAME                | COST | REAL_COST | CARDINALITY | REAL_CARDINALITY | IO_COST | CPU_COST |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----+-----------+-------+----------+----------------------------+------+-----------+-------------+------------------+---------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| HASH OUTER JOIN  |  0 |        -1 |     0 |        1 |                            |   57 |      2110 |           8 |                8 |       0 |        0 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TABLE FULL SCAN  |  1 |         0 |     1 |        1 | __all_database             |    6 |         0 |           8 |                8 |       0 |        0 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TABLE FULL SCAN  |  2 |         0 |     1 |        2 | __tenant_virtual_collation |   46 |      2110 |          18 |               18 |       0 |        0 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----+-----------+-------+----------+----------------------------+------+-----------+-------------+------------------+---------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/04_analyze_sql_monitoring_view.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/manage_connections"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Manage OceanBase Database connections</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_07_diagnosis_and_tuning/management_execution_plan"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Read and manage SQL execution plans in OceanBase Database</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview-of-system-views" class="table-of-contents__link toc-highlight">Overview of system views</a></li><li><a href="#overview-of-sql-monitoring" class="table-of-contents__link toc-highlight">Overview of SQL monitoring</a></li><li><a href="#view-related-to-sql-audit" class="table-of-contents__link toc-highlight">View related to SQL audit</a><ul><li><a href="#sql-audit-settings" class="table-of-contents__link toc-highlight">SQL audit settings</a></li><li><a href="#eviction-mechanism-of-sql-audit" class="table-of-contents__link toc-highlight">Eviction mechanism of SQL audit</a></li><li><a href="#fields-in-gvob_sql_audit" class="table-of-contents__link toc-highlight">Fields in GV$OB_SQL_AUDIT</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#views-related-to-execution-plans" class="table-of-contents__link toc-highlight">Views related to execution plans</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/compilation/sig_intro">compilation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>