<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-user_manual/user_best_practices/solutions/storage_compression" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">历史数据归档场景 | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/user_manual/user_best_practices/solutions/storage_compression"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="历史数据归档场景 | OceanBase"><meta data-rh="true" name="description" content="关键字：生命周期自动管理 | 低成本 | 超大容量"><meta data-rh="true" property="og:description" content="关键字：生命周期自动管理 | 低成本 | 超大容量"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/user_manual/user_best_practices/solutions/storage_compression"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/user_best_practices/solutions/storage_compression" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/user_best_practices/solutions/storage_compression" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.2b92dcb8.js" defer="defer"></script>
<script src="/assets/js/main.a90cc615.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Special Interest Group(SIG)</a><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="dropdown__link">Slack<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/about_oceanbase/overall_architecture">About OceanBase</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/deploy_oceanbase/deploy_method">Deploy Oceanbase</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/deploy_tools/deploy_obd">Deploy Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/data_migration/canal">Data Migration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/operation_maintenance/cluster_resource_upgrade">Operation Maintenance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/performance_tuning/comprehensive_sql_optimize">Performance Tuning</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/trouble_shooting/collection_stack">Trouble Shooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/development_practice/development_specification">Development Practice</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/user_manual/user_best_practices/solutions/high_availability_scenario">Solutions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/user_best_practices/solutions/high_availability_scenario">异地多活场景</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/user_best_practices/solutions/htap">HTAP 一体化混合负载场景</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/user_best_practices/solutions/migration_service">一站式传统数据库替换场景</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/user_best_practices/solutions/multi_tenant">SaaS 资源整合场景</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/user_manual/user_best_practices/solutions/storage_compression">历史数据归档场景</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/FAQ/all_faq">FAQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/user_best_practices/appendix/obtest_config">Appendix</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Solutions</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">历史数据归档场景</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><blockquote>
<p>关键字：生命周期自动管理 | 低成本 | 超大容量</p>
<p>通过 OceanBase 智能化的历史库迁移平台，帮助用户快速、安全的完成冷数据归档，一次配置即可实现自动化的周期管控。OceanBase 高压缩比的分布式存储引擎， 摒弃了传统数据库的定长数据块存储，采用基于 LSM-Tree 的存储架构和自适应压缩技术，创造性地解决了传统数据库无法平衡“性能”和“压缩比”的难题，</p>
</blockquote>
<a name="qccMi"></a>
<header><h1>历史数据归档场景</h1></header>
<p>  在订单、交易、日志等业务场景中，数据总量会不断增加。而对于这些数据的访问往往和时间有很强的相关性，通常与当前时间越接近的数据越“热”，也就是说，这些数据可能会被频繁地修改与点查。热数据的访问更多是事务型负载和实时分析负载，其数据量在整个系统中的占比相对较低。而在系统中已经存在了一段时间的数据，被称为冷数据，这些数据的被查询次数相对没有那么频繁，也很少被修改。冷数据的访问通常是少量的事务型负载和一些 ad-hoc 或报表统计等分析型负载，而且冷数据通常是稳定运行的 IT 系统中数据量的主要部分。<br>  由于冷热数据有着明显的区别，将它们放在一套相同规格的环境中同等处理显然会浪费系统的资源，单个数据库的容量上限还可能会限制数据的存储。但是，将冷数据定期归档到更经济的存储介质中，访问数据时采用从归档数据中还原的方  法，又会对历史数据的查询性能和系统的复杂度带来负面影响。因此，将数据分为线上库和历史库，将在线数据定期同步到历史库中的做法成为了越来越多系统的解决方案，通过在存储和计算成本更低的环境上部署历史库来降低成本和满足业务需求。</p>
<a name="EWRNS"></a>
<h1>解决方案</h1>
<a name="i7tfP"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="行业现状与挑战">行业现状与挑战<a href="#行业现状与挑战" class="hash-link" aria-label="Direct link to 行业现状与挑战" title="Direct link to 行业现状与挑战">​</a></h2>
<ul>
<li>数据增长加速：面对快速增长的在线数据，尤其例如新零售、支付等订单和交易场景，数据往往多呈现为流水型特征，即写入一段时间后不会再次访问或更新。</li>
<li>成本高效率低：低频或零访问数据占用在线业务库的固态存储空间，造成大量硬件资源浪费，堆高企业 IT 成本，导致在线数据库体积臃肿、查询效率降低，给后续数据变更、扩展造成阻碍。</li>
<li>传统方案风险高：传统数据归档方案往往是业务研发或 DBA 采用脚本或简单的同步工具进行，难以在并发和效率上有效控制，很容易对在线数据库产生影响，严重的甚至导致生产数据误删事故。</li>
<li>运维管理复杂：多个业务对应的不同数据库、甚至不同表都可能有各异的归档周期和限定条件，会导致大量定时任务的逻辑维护复杂，耗时耗力。<!-- -->
<a name="ITTZn"></a>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="方案描述">方案描述<a href="#方案描述" class="hash-link" aria-label="Direct link to 方案描述" title="Direct link to 方案描述">​</a></h2>
<ul>
<li>基于 OceanBase 对低端硬件的友好兼容， OceanBase 历史库平台实现了归档任务配置图形化，周期管控自动化，数据迁移 + 校验 + 删除一键自动灰度执行等能力。稳定性方面提供了防导爆、智能限速、多粒度流控等机制，真正实现了数据归档的智能化运维。</li>
<li>此方案历经蚂蚁集团核心业务场景验证，交易支付历史库单实例数据超过 6PB，采用上百台大容量机械盘的低成本硬件支撑，磁盘水位自动均衡，平稳运行多年，节省了大量机器资源。</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/1-744bd3ce3ea13bc400b051a6041c72b4.png" width="1350" height="728" class="img_ev3q"></p>
<a name="QgMwb"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="方案优势">方案优势<a href="#方案优势" class="hash-link" aria-label="Direct link to 方案优势" title="Direct link to 方案优势">​</a></h2>
<ul>
<li>可视化管理：任务创建与运行、进度大盘、一键暂停/恢复等基础操作图形化。</li>
<li>智能化运维：令牌桶算法限速控制、断点续传、任务调度自动化管控等机制，以及宕机自动替换、自动扩缩容、防导爆等自愈手段，实现运维零干预。</li>
<li>低成本：大容量 SATA 盘机型友好，结合 OceanBase 高压缩存储能力，单节点最大即可存储相当于传统数据库 400TB 数据。</li>
<li>海量存储：适用在线业务瘦身，真正做到为数据归档减负。历史库集群可作为大容量关系型数据库使用，能稳定支撑写入量巨大但低频访问的业务查询需求，如监控、日志、审计核对等场景。<!-- -->
<a name="zWNHH"></a>
</li>
</ul>
<h1>OceanBase 存储引擎和数据压缩技术介绍</h1>
<p>  作为一款 HTAP 数据库产品， OceanBase 使用基于 LSM-Tree 架构的存储引擎，同时支持 OLTP 与 OLAP 负载，这种存储架构提供了优秀的数据压缩能力。在 OceanBase 中，增量数据会写入 clog 和 memtable 中， OceanBase 的 memtable 是内存中的 B+ 树索引，提供高效的事务处理能力。<br>  memtable 会定期通过 compaction 生 成硬盘持久化数据 sstable ，多层 sstable 会采用 leveled compaction 策略进行增量数据重整。sstable 中数据块的存储分为两层，其中 2M 定长的数据块（宏块）作为 sstable 写入 I / O 的最小单元，存储在宏块中的变长数据块（微块）作为数据块压缩和读 I / O 的最小单元。<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/2-9710aee5849da4f955f33107e87cf945.png" width="1057" height="448" class="img_ev3q"><br>  在这样的存储架构下， OceanBase 的数据压缩集中发生在 compaction 过程中 sstable 的写入时，数据的在线更新与压缩得到了解耦。批量落盘的特性使其采用更激进的压缩策略。OceanBase 从 2.0 版本开始引入了行列混存的微块存储格式（ PAX ），充分利用了同一列数据的局部性和类型特征，在微块内部对一组行以列存的方式存储，并针对数据特征按列进行编码。变长的数据块和连续批量压缩的数据也可以让 OceanBase 通过同一个 sstable 中已经完成压缩的数据块的先验知识，对下一个数据块的压缩进行指导，在数据块中压缩尽量多的数据行，并选择更优的编码算法。<br>  与部分在 schema 上指定数据编码的数据库实现不同， OceanBase 选择了用户不感知的数据自适应编码，在给用户带来更小负担的同时降低了存储成本，从历史库角度而言，用户也不需要针对历史库数据做出过多压缩与编码相关的配置调整。 OceanBase 之所以能够在事务性能和压缩率之间取得更好的平衡，都得益于 LSM-Tree 的存储架构。<br>  当然， LSM-Tree 架构不是解决数据库压缩所有问题的万金油，如何通过数据压缩降低成本、提升性能是业界一直在讨论的话题。对 B+ 树类的存储引擎进行更高效的压缩也有很多探索，比如基于可计算存储硬件的工作，利用存储硬件内部的透明压缩能力对 B+ 树类存储引擎的数据压缩进行优化，使其写放大达到了接近 LSM-Tree 架构存储引擎的效果。但 LSM-tree 中内存数据页更新与数据块落盘解耦，和 sstable 数据紧凑排布的特点，使得 LSM-tree 相对 B+ 树类存储引擎，仍然更适合在对查询/更新带来更少负面影响的前提下实现更高效的数据压缩。</p>
<a name="usRhP"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oceanbase-的数据库压缩技术">OceanBase 的数据库压缩技术<a href="#oceanbase-的数据库压缩技术" class="hash-link" aria-label="Direct link to OceanBase 的数据库压缩技术" title="Direct link to OceanBase 的数据库压缩技术">​</a></h2>
<p>  OceanBase 支持不感知数据特征的通用压缩 ( compression ) 和感知数据特征并按列进行压缩的数据编码 ( encoding )。这两种压缩方式是正交的，也就是说，可以对一个数据块先进行编码，然后再进行通用压缩，来实现更高的压缩率。<br>  OceanBase 中的通用压缩是在不感知微块内部数据格式的前提下，将整个微块通过通用压缩算法进行压缩，依赖通用压缩算法来检测并消除微块中的数据冗余。目前 OceanBase 支持用户选择 zlib 、 snappy 、 zstd 、 lz4 算法进行通用压缩。用户可以根据表的应用场景，通过 DDL 对指定表的通用压缩算法进行配置和变更。<br>  由于通用压缩后的数据块在读取进行扫描前需要对整个微块进行解压，会消耗一定 CPU 并带来 overhead。为了降低解压数据块对于查询性能的影响， OceanBase 将解压数据的动作交给异步 I / O 线程来进行，并按需将解压后的数据块放在 block cache 中。这样结合查询时对预读 （ prefetching ） 技术的应用，可以为查询处理线程提供数据块的流水线，消除解压带来的额外开销。<br>  通用压缩的优点是对被压缩的数据没有任何假设，任何数据都可能找到模式  并压缩，但往往出于平衡压缩性能和压缩率的考虑，通用压缩算法会放弃对一些复杂数据冗余模式的探测和压缩。对于关系型数据库来说，系统对数据库内存储的结构化数据有着更多的先验知识，利用这些先验知识可以对数据进行更高效的压缩。</p>
<a name="o9Tuq"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oceanbase-的数据编码算法">OceanBase 的数据编码算法<a href="#oceanbase-的数据编码算法" class="hash-link" aria-label="Direct link to OceanBase 的数据编码算法" title="Direct link to OceanBase 的数据编码算法">​</a></h3>
<ul>
<li>当通过一列数据存储城市、性别、产品分类等具有类型属性的值时，这些列数据块内部数据的基数（ cardinality ）也会比较小，这时数据库可以直接在用户数据字段上建立字典，来实现更高的压缩率；</li>
<li>当数据按时序插入数据库，这些插入的数据行中的时间相关字段、自增序列等数据的值域会相对较小，也会有单调递增等特性，利用这些特性，数据库可以更方便地为这些数据做 bit-packing 、差值等编码。</li>
</ul>
<p>  为了实现更高的压缩比，帮助用户大幅降低存储成本， OceanBase 设计了多种编码算法，最终在 OceanBase 的负载上实现了很好的压缩效果。 OceanBase 根据实际业务场景需求实现了单列数据的 bit-packing 编码、字符串 HEX 编码、字典编码、 RLE 编码、常量编码、数值差值编码、定长字符串差值编码，同时，创新地引入了列间等值编码和列间子串编码，能够分别对数据库中一列数据或几列数据间可能产生的不同类型数据冗余进行压缩。</p>
<a name="RPwfa"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="降低存储的位宽bit-packing-和-hex-编码">降低存储的位宽：Bit-packing 和 HEX 编码<a href="#降低存储的位宽bit-packing-和-hex-编码" class="hash-link" aria-label="Direct link to 降低存储的位宽：Bit-packing 和 HEX 编码" title="Direct link to 降低存储的位宽：Bit-packing 和 HEX 编码">​</a></h4>
<p>  Bit-packing 和 HEX 编码类似，都是在压缩数据的基数较小时，通过更小位宽的编码来表示原数据。而且这两种编码可以与其他编码叠加，对于其他编码产生的数值或字符串数据，都可以再通过 bit-packing 或 HEX 编码进一步去除冗余。<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/3.0-af0e361361244a3089d03ea48d81993c.png" width="539" height="151" class="img_ev3q"><br>  （bit-packing）<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/3.5-c29bd96dd9edd8e08033cd8ba3c89075.png" width="520" height="201" class="img_ev3q"><br>  （ HEX 编码）</p>
<a name="XGJyl"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="单列数据去重字典编码和-rle-编码等">单列数据去重：字典编码和 RLE 编码等<a href="#单列数据去重字典编码和-rle-编码等" class="hash-link" aria-label="Direct link to 单列数据去重：字典编码和 RLE 编码等" title="Direct link to 单列数据去重：字典编码和 RLE 编码等">​</a></h4>
<p>  字典编码则可以通过在数据块内建立字典，来对低基数的数据进行压缩。当低基数的数据在微块内的分布符合对应的特征时，也可以使用游程编码/常量编码等方法进行进一步的压缩。<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/4-c0799cbe7c09c3068091eb558a8a1bc4.png" width="651" height="311" class="img_ev3q"><br>  （字典编码/RLE 编码）</p>
<a name="hgpZm"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="利用数据的值域压缩差值编码等">利用数据的值域压缩：差值编码等<a href="#利用数据的值域压缩差值编码等" class="hash-link" aria-label="Direct link to 利用数据的值域压缩：差值编码等" title="Direct link to 利用数据的值域压缩：差值编码等">​</a></h4>
<p>  差值编码也是常用的编码方法， OceanBase 中的差值编码分为数值差值编码和定长字符串差值编码。数值差值编码主要用来对值域较小的数值类数据类型进行压缩。对于日期、时间戳等数据，或其他临近数据差值较小的数值类数据，可以只存储最小值，每行存储原数据与最小值的差值。定长字符串编码则可以比较好地对人工生成的 ID，如订单号/身份证号、url 等有一定模式的字符串进行压缩，对一个微块的数据存储一个模式串，每行额外存储与模式串不同的子串差值，来达到更好的压缩效果。<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/5-21f35ae511ee5a14440bc1016b22afc8.png" width="376" height="281" class="img_ev3q"><br>  （整形差值）<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/6-3bfadacc8bc2e316189f3125b5f43135.png" width="421" height="201" class="img_ev3q"><br>  （字符串差值）</p>
<a name="Ugb2n"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="减小多列数据冗余列间编码">减小多列数据冗余：列间编码<a href="#减小多列数据冗余列间编码" class="hash-link" aria-label="Direct link to 减小多列数据冗余：列间编码" title="Direct link to 减小多列数据冗余：列间编码">​</a></h4>
<p>  为了利用不同列间数据的相似性增强压缩效果，OceanBase 引入了列间编码。通常情况下，列存数据库只会对数据在列内部进行编码，但在实际应用中有很多表除了同一列数据之间存在相似性，不同列的数据之间也可能有一定的关系，利用这种关系可以通过一列数据表示另外一列数据的部分信息。<br>  列间编码可以对复合列、系统生成的数据做出更好的压缩，也能够降低在数据表设计范式上的问题导致的数据冗余。</p>
<a name="AhhEi"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="自适应压缩技术让数据库选择编码算法">自适应压缩技术：让数据库选择编码算法<a href="#自适应压缩技术让数据库选择编码算法" class="hash-link" aria-label="Direct link to 自适应压缩技术：让数据库选择编码算法" title="Direct link to 自适应压缩技术：让数据库选择编码算法">​</a></h4>
<p>  数据编码的压缩效果不仅与表的 schema 相关，同时还与数据的分布，微块内数据值域等数据本身的特征相关，这也就意味着比较难以在用户设计表数据模型时指定列编码来实现最好的压缩效果。为了减轻用户的使用负担，也为了实现更好的压缩效果，OceanBase 支持在合并过程中分析数据类型、值域、NDV 等特征，结合 compaction 任务中上一个微块对应列选择的编码算法和压缩率自适应地探测合适的编码，对同一列在不同数据块中支持使用不同的算法来进行编码，也保证了选择编码算法的开销在可接受的区间内。</p>
<a name="QGem9"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="降低数据编码对查询性能影响的能力">降低数据编码对查询性能影响的能力<a href="#降低数据编码对查询性能影响的能力" class="hash-link" aria-label="Direct link to 降低数据编码对查询性能影响的能力" title="Direct link to 降低数据编码对查询性能影响的能力">​</a></h3>
<p>  为了能够更好地平衡压缩效果和查询的性能，我们在设计数据编码格式时也考虑到了对查询性能带来的影响。</p>
<a name="x7mNw"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="行级粒度数据随机访问">行级粒度数据随机访问<a href="#行级粒度数据随机访问" class="hash-link" aria-label="Direct link to 行级粒度数据随机访问" title="Direct link to 行级粒度数据随机访问">​</a></h4>
<p>  通用压 缩中如果要访问一个压缩块中的一部分数据通常需要将整个数据块解压后访问，某些分析型系统的数据编码大多面向扫描的场景，点查的场景比较少，因此采用了在访问某一行数据时需要对相邻数据行或数据块内读取行之前所有行进行解码计算的数据编码的格式（如 PFor 等差值编码）。<br>  OceanBase 需要更好地支持事务型负载，就意味着要支持相对更高效的点查，因此 OceanBase 在设计数据编码格式时保证了编码后的数据是可以以行为粒度随机访问的。也就是在对某一行进行点查时只需要对这一行相关的元数据进行访问并解码，减小了随机点查时的计算放大。同时对于编码格式的微块，解码数据所需要的所有元数据都存储在微块内，让数据微块有自解释的能力，也在解码时提供了更好的内存局部性。</p>
<a name="ZnVKR"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="缓存解码器">缓存解码器<a href="#缓存解码器" class="hash-link" aria-label="Direct link to 缓存解码器" title="Direct link to 缓存解码器">​</a></h4>
<p>  在 OceanBase 目前的数据解码实现中，每一列数据都需要初始化一个解码器对象来解析数据，构造解码器时会需要进行一些计算和内存分配，为了进一步减小访问编码数据时的 RT ，OceanBase 会将数据的解码器和数据块一起缓存在 block cache 中，访问 cache 中数据块时可以直接通过缓存的解码器解析数据。当不能命中 block cache 中缓存的解码器时，OceanBase 还会为解码器用到的元数据内存和对象构建缓存池，在不同查询间复用这些内存和对象。<br>  通过上述细节上的优化，行列混存格式的 sstable 编码数据也可以很好地支持事务型负载。而且由于编码数据行列混存的格式，使得在分析型查询的处理上，编码数据有着和列存数据相似的特性，数据分布 更紧凑，对 CPU cache 更加友好。这些特性使列存常用的优化手段也能应用于分析型查询优化中，充分利用 SIMD 等方法来提供更高效的分析型负载处理。</p>
<a name="gd9G8"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="计算下推">计算下推<a href="#计算下推" class="hash-link" aria-label="Direct link to 计算下推" title="Direct link to 计算下推">​</a></h4>
<p>  由于编码数据中会存储有序字典、 null bitmap 、常量等可以描述数据分布的元数据，在扫描数据时可以利用这些数据对于部分过滤，聚合算子的执行过程进行优化，实现在未解码的数据上直接进行计算。 OceanBase 对分析处理能力进行了大幅的优化，其中包括聚合与过滤计算下推到存储层执行，和在向量化引擎中利用编码数据的列存特征进行向量化的批量解码等特性。在查询时充分利用了编码元数据和编码数据列存储的局部性，在编码数据上直接进行计算，大幅提高了下推算子的执行效率和向量化引擎中的数据解码效率。基于数据编码的计算下推和向量化解码也成为了支持 OceanBase 高效处理分析型负载，在 TPC-H benchmark 中达到优秀性能指标的重要功能。<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/7-6a21bdf4355baffde6088c0c87b96a86.png" width="856" height="520" class="img_ev3q"></p>
<a name="wdJfG"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="据编码压缩的基础测试">据编码压缩的基础测试<a href="#据编码压缩的基础测试" class="hash-link" aria-label="Direct link to 据编码压缩的基础测试" title="Direct link to 据编码压缩的基础测试">​</a></h2>
<p>  不同的压缩方式如何影响 OceanBase 的压缩效果，以下通过一个简单的测试进行观察。使用 OceanBase 4.0 版本分别在交易场景的 TPC-H 10g 的数据模型和用户行为日志场景的 IJCAI-16 Brick-and-Mortar Store Recommendation Dataset 数据集上对 OceanBase 的压缩率进行测试。</p>
<ul>
<li>TPC-H 是对订单，交易场景的建模，对 TPC-H 模型中数据量比较大的两张表，即存储订单的 ORDERS 表和存储商品信息的 LINEITEM 表的压缩率进行统计。在 OceanBase 默认配置（ zstd + encoding ）下，这两张表的压缩率可以达到 4.6 左右，相较只开启 encoding 或 zstd 压缩时提升明显。</li>
<li>IJCAI-16 taobao user log 则是淘宝脱敏后的真实业务数据，存储了用户浏览商品时的行为日志。在 OceanBase 默认配置（ zstd + encoding ）下压缩率可以达到 9.9 ，只开启 encoding 压缩率可以达到 8.3 ，只开启 zstd 压缩率为 6.0 。</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/8-b9db517f6c6aee0699525dd2d93189ac.png" width="1000" height="578" class="img_ev3q"></p>
<a name="IMcgi"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oceanbase-存储引擎技术为何能更好地支持历史库场景">OceanBase 存储引擎技术为何能更好地支持历史库场景？<a href="#oceanbase-存储引擎技术为何能更好地支持历史库场景" class="hash-link" aria-label="Direct link to OceanBase 存储引擎技术为何能更好地支持历史库场景？" title="Direct link to OceanBase 存储引擎技术为何能更好地支持历史库场景？">​</a></h2>
<p>  OceanBase 存储引擎的数据库压缩功能在设计上希望能够在用户少感知、不感知存储格式的前提下，在不降低事务型负载性能的同时降低存储空间和存储成本，同时提升分析型负载的性能。这样的设计与历史库的设计不谋而合。高度压缩的数据既能够帮助历史库数据降低至少 50% 的存储成本，高效的写入查询和统一的配置接口又能够帮助业务增效。<br>  对于历史库数据同步的需求， OceanBase 的 LSM-Tree 存储引擎天生具有高效的写入性能，既能够通过旁路导  入高效处理定期的批量数据同步，又能够承载一些实时数据同步和历史库数据修改的场景。<br>  对于历史库数据的定期跑批报表，和一些 ad-hoc 的分析型查询带来的大量数据扫描的需求，因为历史库中增量数据较少，所以绝大多数数据都存储在基线的 SSTable 中，这时计算下推可以只扫描基线数据，绕过了 LSM-Tree 架构常见的读放大问题。而且支持在压缩数据上执行下推算子和向量化解码的压缩格式可以轻松地处理大量数据查询和计算。<br>  对于大量历史数据存储的需求， OceanBase 的 SSTable 存储格式和数据编码压缩功能可以使 OceanBase 更轻松地支持超大容量的数据存储。而且高度压缩的数据和在同等硬件下更高效的查询性能也能够大幅度降低存储和计算的成本。<br>  此外，企业可以选择将历史库所在的集群部署在更经济的硬件上，但是对数据库进行运维基本不需要感知数据编码与压缩的相关配置，应用开发也可以做到在线库和历史库使用完全相同的访问接口，简化应用代码和架构。<br>  这些特点让越来越多的企业开始在历史库场景使用 OceanBase 进行降本增效的实践。OceanBase 也不断在存储架构，降本增效方面做出更多的探索。</p>
<a name="xEBc5"></a>
<h1>用户案例</h1>
<a name="ORgGI"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="支付宝">支付宝<a href="#支付宝" class="hash-link" aria-label="Direct link to 支付宝" title="Direct link to 支付宝">​</a></h2>
<a name="vLIRy"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="业务挑战">业务挑战<a href="#业务挑战" class="hash-link" aria-label="Direct link to 业务挑战" title="Direct link to 业务挑战">​</a></h3>
<ul>
<li>从 2013 年开始，支付宝交易核心已经面临架构上的水平拆分上限了，如果保持当前架构下仅针对业务进行水平拆分扩容， 需要购买更多的 Oracle 数据库，这将带来数据库成本近乎直线的攀升。该如何平衡成本和稳定性？这个问题是彼时支付宝工程师面对的难题。要么购买更多的机器并投入更大的精力进行业务拆分，能够保证短期内的数据库性能与稳定性，要么重新选择一款不丢数据且稳定性高的数据库。</li>
<li>在 2014 年，支付宝原有的数据库系统已经扩容到最大集群量，但仍然无法满足历史库的需求。当时作为备选的蚂蚁集团完全自研的原生分布式数据库 OceanBase 经受住了试验，支撑住了系统的稳定性。此举使支付宝的交易系统数据库切换为 OceanBase，保障了历史库系统的稳定性与高性能。<!-- -->
<a name="IVJzr"></a>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-1">解决方案<a href="#解决方案-1" class="hash-link" aria-label="Direct link to 解决方案" title="Direct link to 解决方案">​</a></h3>
<p>  历史库目的是为了解决因为业务增长引发的数据库存储空间问题。通过性能换成本的方式，将过去不再使用的业务数据或查询很少的数据，搬迁到性能低但存储量大的机型构成的集群中，降低线上数据库存储带来的开销。针对历史库的需求，需要一个迁移程序将冷数据从在线库迁移至历史库，并且保证在线库和历史库都持续可用，不需要停机切流。因此，有几点特殊的需求：</p>
<ul>
<li>考虑数据量比较大，需要支持断点续传。</li>
<li>由于交易历史库有一些表之间有关联，需要具备主子表维度迁移的功能。</li>
<li>需要具备删除已经迁移的数据的功能。</li>
</ul>
<p>  迁移工具 OMS 包括迁移、校验、删除三种任务模式。通过多线程启动对应的任务，并将相关迁移任务、进度和结果写入 metadb ，以便监控任务进度和支持断点续传。</p>
<a name="vBG2c"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="历史库平台架构">历史库平台架构<a href="#历史库平台架构" class="hash-link" aria-label="Direct link to 历史库平台架构" title="Direct link to 历史库平台架构">​</a></h4>
<p>  历史库平台为数据提供了更长生命周期管理能力。历史库平台通常由在线数据库、历史库客户端、历史库管控平台、历史数据库集群组成，为用户提供一站式的数据存储、归档解决方案。通过历史库管控平台，用户可以方便地配置迁移任务，指定规则将符合条件的非活跃数据从在线数据库迁移到成本更低的历史 OceanBase 数据库集群中。同时，历史库平台提供多维度的限速能力，以及多项目间优先级调度功能。用户通过配置限速减少迁移时对业务的影响，通过配置优先级可管理多套集群，满足多项目同时运行。待数据迁移完成后，提供数据校验、校验成功后删除在线数据配套功能，方便实用。<br>  经过支付宝业务的打磨，历史库平台（见下图）已经支撑支付宝内部交易、支付、账务等多个重要系统，节省了支付宝内部数据存储成本。同时，在网商银行也有广泛的使用场景。<br>  <img decoding="async" loading="lazy" alt="image.png" src="/assets/images/9-f758330d6e212db1065d3865c6f5893f.png" width="445" height="323" class="img_ev3q"><br>  从图中可见，历史库平台包含三大板块：在线数据库、历史数据库集群、历史库管控平台。</p>
<ul>
<li>在线数据库，用于存放应用常常需要访问的数据。通常会采用更高规格配置的服务器，提供高性能的处理能力。目前已支持 OceanBase ， MySQL ， Oracle 作为数据源。</li>
<li>历史数据库集群用于存放应用产生的终态数据，根据应用需求不同，即可以作为数据归档存储的集群不对应用提供访问，也可以满足应用的访问需求。采用成本更低的 SATA 盘来搭建 OceanBase 数据库集群。其中的历史库客户端用于处理用户发起的迁移、校验、删除任务。支付宝内部实现了多维度的限速，根据需求不同可以灵活地提供集群限速和表限速功能，最大程度的避免了任务对在线库应用流量的影响。</li>
<li>历史库管控平台是用户对历史库进行各项操作的运维管理平台，提供权限管理、任务配置、任务监控等功能。<!-- -->
<a name="NsfbW"></a>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="用户收益">用户收益<a href="#用户收益" class="hash-link" aria-label="Direct link to 用户收益" title="Direct link to 用户收益">​</a></h3>
<p>  支付宝当前已建设 20 多个历史库集群，在支付宝内部已覆盖交易、支付、充值、会员、账务等几乎所有核心业务，总数据量 95 PB ，每月增量 3 PB 。其中，最大的交易支付集群组，数据量 15 PB ，每日数据增量可达到 50 TB 。支付宝历史库的实践，带来的收益显著，主要包括以下三点：</p>
<ul>
<li>成本下降 80% 左右。</li>
</ul>
<p>  由于历史库采用成本更低的 SATA 盘来搭建 OceanBase 数据库集群，单位空间磁盘成本降低到线上机器的 30% 。同时使用更高压缩比的 zstd 压缩算法，使得总体成本下降 80% 左右。如果线上是 MySQL 、 Oracle 等传统数据库，那么成本会降低更多。因为 OceanBase 本身的数据编码、压缩以及 LSM-Tree 的存储架构等，使得存储成本只有传统数据库的 1/3 。</p>
<ul>
<li>弹性伸缩能力降低运维成本。</li>
</ul>
<p>  历史库使用 OceanBase 三副本架构，每个 zone 中有多个 OBServer ，通过分区将数据分散到多个 unit 中。OceanBase 具备业务无感知的弹性伸缩能力，并且可以通过扩容节点增加容量、提升性能。这意味着历史库可以不再受限于磁盘大小，通过少数集群就可以涵盖所有业务的历史库，降低运维成本。<br>  目前历史数据是永久保存的，随着时间的推移，历史库的容量占用也会越来越高。依赖 OceanBase 本身的高扩展性，通过横向扩展 OBServer ，增加 unit_number 即可实现容量的扩容。</p>
<ul>
<li>数据强一致，故障快速修复。</li>
</ul>
<p>  数据迁移相当于一份数据归档及逻辑备份，如果这些数据发生了丢失，那么后续需要做审计、历史数据查询的时候，数据就对不上了。这对于很多业务尤其是金融业务而言是无法忍受的。<br>  OceanBase 底层使用 Paxos 一致性算法，当单台 OBServer 宕机时，可以在 30s 内快速恢复，并保证数据的强一致，降低对线上查询及归档任务的影响。</p>
<a name="tIJuI"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="携程">携程<a href="#携程" class="hash-link" aria-label="Direct link to 携程" title="Direct link to 携程">​</a></h2>
<a name="yKysy"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="业务挑战-1">业务挑战<a href="#业务挑战-1" class="hash-link" aria-label="Direct link to 业务挑战" title="Direct link to 业务挑战">​</a></h3>
<ul>
<li>随着订单业务量的增加，业务数据迅猛增长，传统数据库的存储瓶颈以及性能不佳问题越来越明显。</li>
<li>不仅运维成本和复杂度有所增加，同时需要不断对应用进行改造和适配以解决不断分库分表带来的问题。<!-- -->
<a name="VmvV5"></a>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-2">解决方案<a href="#解决方案-2" class="hash-link" aria-label="Direct link to 解决方案" title="Direct link to 解决方案">​</a></h3>
<ul>
<li>相比传统的集中式数据库 MySQL，OceanBase 在存储层面极致的压缩能力，有效降低企业使用数据库的硬件成本。</li>
<li>OceanBase 具备灵活的资源扩展能力，根据业务实际发展情况可以动态的进行计算和存储能力的线性扩展，支撑海量  数据的存储和计算，同时很好地应对未来的业务增长要求。</li>
<li>在数据迁移方面，因 OceanBase 兼容 MySQL 协议与语法，因此 OMS 可以做到平滑迁移，可大幅降低业务迁移和改造成本。OMS 通过全量迁移、增量迁移、反向迁移，保障数据迁过程中的强一致，并提供数据同步到 kafka 等消息队列中的能力。</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/10-aea09c895a52dbd64108f2f8e192c22e.png" width="1083" height="551" class="img_ev3q"></p>
<a name="zVHuv"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="用户收益-1">用户收益<a href="#用户收益-1" class="hash-link" aria-label="Direct link to 用户收益" title="Direct link to 用户收益">​</a></h3>
<ul>
<li>运维更加高效与便捷：单集群替换数十套 MySQL 环境，运维管理成本大大降低，同时管理更加方便。使用普通的 PC 服务器即可构建超高吞吐的 OceanBase 集群，无需分库分表，快速按需扩展，为携程历史库在水平扩展过程中提供了平滑的成本增长曲线。</li>
<li>低成本：支撑上百 TB 数据存储场景且性能和稳定性有保证，同时相比较之前的方案，OceanBase 方案的存储成本降低 85%，降本效果明显。</li>
<li>数据同步性能提升：数据迁移对业务透明，OMS 支持全量数据迁移、增量数据同步，支持主流数据库的一站式数据迁移。数据从上游写入到下游 OceanBase 响应延迟更小，数据同步速度更快，同步延迟时间减少 3/4。</li>
<li>数据写入性能优秀：OceanBase 的无共享架构、分区级主副本打散，以及并行执行框架提供的 ParallelDML 能力，真正实现了高效的多节点写入。利用该特性，数据写入性能提升数倍，能够从容应对携程历史库的超高并发数据写入需求。</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/user_best_practices/solutions/storage_compression.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/user_manual/user_best_practices/solutions/multi_tenant"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SaaS 资源整合场景</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/user_manual/user_best_practices/FAQ/all_faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">生态组件FAQ大全</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#行业现状与挑战" class="table-of-contents__link toc-highlight">行业现状与挑战</a></li><li><a href="#方案描述" class="table-of-contents__link toc-highlight">方案描述</a></li><li><a href="#方案优势" class="table-of-contents__link toc-highlight">方案优势</a></li><li><a href="#oceanbase-的数据库压缩技术" class="table-of-contents__link toc-highlight">OceanBase 的数据库压缩技术</a><ul><li><a href="#oceanbase-的数据编码算法" class="table-of-contents__link toc-highlight">OceanBase 的数据编码算法</a></li><li><a href="#降低数据编码对查询性能影响的能力" class="table-of-contents__link toc-highlight">降低数据编码对查询性能影响的能力</a></li></ul></li><li><a href="#据编码压缩的基础测试" class="table-of-contents__link toc-highlight">据编码压缩的基础测试</a></li><li><a href="#oceanbase-存储引擎技术为何能更好地支持历史库场景" class="table-of-contents__link toc-highlight">OceanBase 存储引擎技术为何能更好地支持历史库场景？</a></li><li><a href="#支付宝" class="table-of-contents__link toc-highlight">支付宝</a><ul><li><a href="#业务挑战" class="table-of-contents__link toc-highlight">业务挑战</a></li><li><a href="#解决方案-1" class="table-of-contents__link toc-highlight">解决方案</a></li><li><a href="#用户收益" class="table-of-contents__link toc-highlight">用户收益</a></li></ul></li><li><a href="#携程" class="table-of-contents__link toc-highlight">携程</a><ul><li><a href="#业务挑战-1" class="table-of-contents__link toc-highlight">业务挑战</a></li><li><a href="#解决方案-2" class="table-of-contents__link toc-highlight">解决方案</a></li><li><a href="#用户收益-1" class="table-of-contents__link toc-highlight">用户收益</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>