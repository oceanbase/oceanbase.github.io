<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/diagnose_and_analyze_through_obdiag" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Use obdiag for diagnostics and analytics | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/diagnose_and_analyze_through_obdiag"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Use obdiag for diagnostics and analytics | OceanBase"><meta data-rh="true" name="description" content="You can use OceanBase Diagnostic Tool (obdiag) for diagnostics and analytics."><meta data-rh="true" property="og:description" content="You can use OceanBase Diagnostic Tool (obdiag) for diagnostics and analytics."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/diagnose_and_analyze_through_obdiag"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/diagnose_and_analyze_through_obdiag" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/diagnose_and_analyze_through_obdiag" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H4XM2M50RX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-H4XM2M50RX",{})</script><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.aa453ec0.js" defer="defer"></script>
<script src="/assets/js/main.f609a655.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><span><li><a class="dropdown__link" href="/docs/sig/overview/list">Special Interest Group(SIG)</a></li></span><span><li><a class="dropdown__link" href="/docs/honor/overview">Community Honors</a></li></span><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://discord.gg/74cF8vbNEs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Data + AI</a><ul class="dropdown__menu"><span><li><a href="https://oceanbase-devhub.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">AI Workshops<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/ai-workshop-2024" target="_blank" rel="noopener noreferrer" class="dropdown__link">RAG Bot<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/dify/dify@oceanbase-workshop" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dify (MySQL Compatible)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/DB-GPT/docker/compose_examples/ob_dbgpt_tutorial" target="_blank" rel="noopener noreferrer" class="dropdown__link">DB-GPT<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts/en-US/chapter_01_overview_of_the_oceanbase_database/introduction">Overview of the Oceanbase database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts/en-US/chapter_02_deploy_oceanbase_database/introduction">Deploy Oceanbase database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts/en-US/chapter_03_test_oceanbase_database/introduction">Test Oceanbase database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts/en-US/chapter_04_migration_and_synchronization_oceanbase/introduction">Migrate and synchronize data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts/en-US/chapter_05_operation_and_maintenance/introduction">Operation and maintenance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/quick_starts/en-US/chapter_06_using_ob_for_business_development/introduction">Using Oceanbase for business development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/introduction">Diagnosis_and_tuning</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/overview_of_diagnosis_and_tuning">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/odp_sql_route">Principles of ODP SQL routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/manage_connections">Manage OceanBase Database connections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/analyze_sql_monitoring_view">Perform analysis based on SQL monitoring views</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/management_execution_plan">Read and manage SQL execution plans in OceanBase Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/sql_tuning">Common SQL tuning methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/troubleshooting_sql_performance_issues">Typical scenarios and troubleshooting logic for SQL performance issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/performance_diagnosis_by_sql_diagnoser">Use SQL Diagnoser to diagnose and analyze SQL performance issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/diagnose_and_analyze_through_obdiag">Use obdiag for diagnostics and analytics</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Diagnosis_and_tuning</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Use obdiag for diagnostics and analytics</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>7.9 Use obdiag for diagnostics and analytics</h1></header>
<p>You can use OceanBase Diagnostic Tool (obdiag) for diagnostics and analytics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-obdiag">About obdiag<a href="#about-obdiag" class="hash-link" aria-label="Direct link to About obdiag" title="Direct link to About obdiag">​</a></h2>
<p>In the native distributed database system OceanBase Database, root cause analysis for faults is complex because many factors may be involved, such as the server environment, parameters, and running load. Experts must collect and analyze extensive information during troubleshooting. Therefore, obdiag is introduced to help efficiently collect information scattered on various nodes and find their association.</p>
<p><img decoding="async" loading="lazy" alt="obdiag" src="/assets/images/001-7f3869a3aa5303a4898770edb61f7689.png" width="1280" height="1276" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benefits">Benefits<a href="#benefits" class="hash-link" aria-label="Direct link to Benefits" title="Direct link to Benefits">​</a></h3>
<p>obdiag is an agile diagnostic tool designed for OceanBase Database. It provides the following benefits:</p>
<ul>
<li>
<p><strong>Lightweight</strong>: You can deploy obdiag by using the RPM package or OceanBase Deployer (OBD) with a few clicks. The RPM package is less than 30 MB in size. You can deploy it on an OBServer node or any server that can connect to nodes in the OceanBase cluster, for example, a jump server or control server.</p>
</li>
<li>
<p><strong>Easy to use</strong>: You can perform installation, cluster inspection, information collection, diagnostics, and root cause analysis all by using commands.</p>
</li>
<li>
<p><strong>Open source</strong>: obdiag is developed based on Python. The source code is 100% open-source. For more information, visit the <a href="https://github.com/oceanbase/obdiag" target="_blank" rel="noopener noreferrer">GitHub code repository</a>.</p>
</li>
<li>
<p><strong>High scalability</strong>: The inspection, scenario-based information collection, and root cause analysis features of obdiag are all available as add-ons. You can add custom diagnostic scenarios at low costs.</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Benefits" src="/assets/images/002-8c216f74555bf3ba0e6e0b71c5359f15.png" width="2012" height="374" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="features">Features<a href="#features" class="hash-link" aria-label="Direct link to Features" title="Direct link to Features">​</a></h3>
<p>obdiag can scan, collect, analyze, and diagnose information such as the logs, SQL audit records, and the process stack information of OceanBase Database. You can use obdiag with ease, no matter whether your OceanBase cluster is deployed manually or by using OceanBase Cloud Platform (OCP) or OBD. obdiag has the following features:</p>
<p><img decoding="async" loading="lazy" alt="Features" src="/assets/images/003-5fa4a3408b1f8060f57d75f9d4c8430a.png" width="1972" height="368" class="img_ev3q"></p>
<ul>
<li>
<p><strong>Cluster inspection</strong>: You can use <code>obdiag check</code> commands to inspect the status of an OceanBase cluster. The inspection process analyzes the cluster from perspectives of the system kernel parameters and internal tables, identifies the causes of existing or possible exceptions, and provides O&amp;M suggestions.</p>
</li>
<li>
<p><strong>Diagnostic analysis</strong>: You can use <code>obdiag analyze</code> commands to analyze diagnostic information of OceanBase Database. These commands allow you to analyze OceanBase Database logs to identify errors that have occurred, as well as enable end-to-end diagnostics to locate slow execution.</p>
</li>
<li>
<p><strong>Information collection</strong>: You can use <code>obdiag gather</code> commands to collect diagnostic information of OceanBase Database, including basic information and information for specific scenarios.</p>
</li>
<li>
<p><strong>Root cause analysis</strong>: You can use <code>obdiag rca</code> commands to analyze diagnostic information of OceanBase Database. These commands allow you to analyze exceptions of OceanBase Database to identify causes of these exceptions.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-and-deploy-obdiag">Install and deploy obdiag<a href="#install-and-deploy-obdiag" class="hash-link" aria-label="Direct link to Install and deploy obdiag" title="Direct link to Install and deploy obdiag">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-obdiag">Install obdiag<a href="#install-obdiag" class="hash-link" aria-label="Direct link to Install obdiag" title="Direct link to Install obdiag">​</a></h3>
<p>You can use obdiag independently or in combination with OBD.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="method-1-use-obdiag-independently">Method 1: Use obdiag independently<a href="#method-1-use-obdiag-independently" class="hash-link" aria-label="Direct link to Method 1: Use obdiag independently" title="Direct link to Method 1: Use obdiag independently">​</a></h4>
<p>If the cluster to be diagnosed is not deployed by using OBD, you can run the following commands to install and deploy obdiag:</p>
<ul>
<li>
<p>Online deployment (when Internet access is available)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo yum install -y yum-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo yum install -y oceanbase-diagnostic-tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /usr/local/oceanbase-diagnostic-tool/init.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Offline deployment (when Internet access is unavailable)</p>
<p>Download the obdiag package of the latest version from <a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer">OceanBase Download Center</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum install -y oceanbase-diagnostic-tool*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /usr/local/oceanbase-diagnostic-tool/init.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Deployment on a Debian-based system, such as Ubuntu</p>
<p>Download the obdiag package of the latest version from <a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer">OceanBase Download Center</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt-get install alien -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alien --scripts --to-deb  oceanbase-diagnostic-tool*.rpm # Convert the RPM package to a DEB package.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dpkg -i oceanbase-diagnostic-tool*.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /usr/local/oceanbase-diagnostic-tool/init.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="method-2-use-obdiag-in-combination-with-obd">Method 2: Use obdiag in combination with OBD<a href="#method-2-use-obdiag-in-combination-with-obd" class="hash-link" aria-label="Direct link to Method 2: Use obdiag in combination with OBD" title="Direct link to Method 2: Use obdiag in combination with OBD">​</a></h4>
<p>If the cluster to be diagnosed is deployed by using OBD, we recommend that you upgrade OBD to V2.5.0 or later. Then, you can directly run obdiag commands in OBD. For more information about the commands, see <a href="https://en.oceanbase.com/docs/community-obd-en-10000000001181576" target="_blank" rel="noopener noreferrer">obdiag commands</a>.</p>
<ul>
<li>
<p>Online deployment (when Internet access is available)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Enable OBD to pull remote images.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obd mirror enable remote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deploy obdiag by using OBD.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obd obdiag deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Offline deployment (when Internet access is unavailable)</p>
<p>Download the obdiag package of the latest version from <a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer">OceanBase Download Center</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Copy the offline obdiag package to the image repository of OBD.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obd mirror clone oceanbase-diagnostic-tool-xxxxxxxx.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deploy obdiag by using OBD.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obd obdiag deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-obdiag">Configure obdiag<a href="#configure-obdiag" class="hash-link" aria-label="Direct link to Configure obdiag" title="Direct link to Configure obdiag">​</a></h3>
<p>To configure obdiag, you can create a user-defined configuration file in a custom path, or use the system configuration file, which you do not need to modify in most cases. The following sections describe the two configuration files.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="user-defined-configuration-file">User-defined configuration file<a href="#user-defined-configuration-file" class="hash-link" aria-label="Direct link to User-defined configuration file" title="Direct link to User-defined configuration file">​</a></h4>
<p>You can create or edit a user-defined configuration file by running the <code>obdiag config &lt;option&gt;</code> command. By default, the configuration file is named <code>config.yml</code> and is stored in the <code>~/.obdiag/</code> directory. Template configuration files are stored in the <code>~/.obdiag/example</code> directory.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag config -h &lt;db_host&gt; -u &lt;sys_user&gt; [-p password] [-P port]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The following table describes the parameters.</p>
<table><thead><tr><th>Parameter</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>db_host</td><td>Yes</td><td>The IP address used to connect to the <code>sys</code> tenant of the OceanBase cluster.</td></tr><tr><td>sys_user</td><td>Yes</td><td>The username used to connect to the <code>sys</code> tenant of the OceanBase cluster. To avoid permission issues, we recommend that you use <code>root@sys</code>. If you connect to the cluster by using OceanBase Database Proxy (ODP), the value of this parameter must include the cluster name, for example, <code>root@sys#obtest</code>.</td></tr><tr><td>-p password</td><td>No</td><td>The password used to connect to the <code>sys</code> tenant of the OceanBase cluster. This parameter is left empty by default.</td></tr><tr><td>-P port</td><td>No</td><td>The port used to connect to the <code>sys</code> tenant of the OceanBase cluster. Port <code>2881</code> is used by default.</td></tr></tbody></table>
<p>Here are some examples:</p>
<ul>
<li>
<p>A password is specified.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag config -hxx.xx.xx.xx -uroot@sys -p***** -P2881</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>No password is specified.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag config -hxx.xx.xx.xx -uroot@sys -P2881</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>ODP is used for connection.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag config -hxx.xx.xx.xx -uroot@sys#obtest  -p***** -P2883</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>After the execution is completed, the new configuration is generated in the <code>config.yml</code> configuration file, and the original configuration file, if it contains configuration information, is backed up to the <code>~/.obdiag/</code> directory as a <code>backup_conf</code> file.</p>
<p><strong>Tips:</strong></p>
<ul>
<li>
<p>Manage the configuration files of multiple clusters:</p>
<p>You can directly specify the configuration files of target clusters in obdiag commands. Here is an example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather log –c cluster_1.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather log –c cluster_2.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>If a cluster is deployed by using OBD, you can directly use obdiag commands in the cluster without generating a configuration file. When you run obdiag commands in OBD, you must add <code>obd</code> to the commands and specify the cluster name. For example, <code>obdiag gather log</code> is replaced with <code>obd obdiag gather log &lt;cluster_name&gt;</code>. OBD will generate a configuration file for obdiag.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="system-configuration-file">System configuration file<a href="#system-configuration-file" class="hash-link" aria-label="Direct link to System configuration file" title="Direct link to System configuration file">​</a></h4>
<p>The system configuration file is named <code>inner_config.yml</code> and located in the <code>/usr/local/oceanbase-diagnostic-tool/conf/</code> directory.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">obdiag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">basic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/.obdiag/config.yml </span><span class="token comment" style="color:#999988;font-style:italic"># The path of the user-defined configuration file.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config_backup_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/.obdiag/backup_conf </span><span class="token comment" style="color:#999988;font-style:italic"># The path where the backup of the original configuration file is stored when you run the `obdiag config` command.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">file_number_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The maximum number of files returned for a collection command on a single remote host.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">file_size_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2G </span><span class="token comment" style="color:#999988;font-style:italic"># The maximum size of the compressed file returned for a collection command on a single remote host.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">logger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">log_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/.obdiag/log </span><span class="token comment" style="color:#999988;font-style:italic"># The path where the execution log file of obdiag is stored.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">log_filename</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> obdiag.log </span><span class="token comment" style="color:#999988;font-style:italic"># The name of the execution log file of obdiag.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">file_handler_log_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DEBUG </span><span class="token comment" style="color:#999988;font-style:italic"># The lowest level of execution logs of obdiag to be recorded.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">log_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> INFO </span><span class="token comment" style="color:#999988;font-style:italic"># The execution log level of obdiag.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> obdiag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">stdout_handler_log_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> INFO </span><span class="token comment" style="color:#999988;font-style:italic"># The lowest level of obdiag logs to be displayed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Parameters required for inspection. Usually, you do not need to modify parameters in this section.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ignore_version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Specifies whether to ignore the version of OceanBase Database.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">report</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">report_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./check_report/&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The output path of the inspection report.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">export_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> table </span><span class="token comment" style="color:#999988;font-style:italic"># The type of the inspection report.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">package_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;~/.obdiag/check_package.yaml&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The path of the inspection package file.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks_base_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;~/.obdiag/tasks/&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The basic directory of inspection tasks.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">gather</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scenes_base_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;~/.obdiag/gather/tasks&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The directory of `gather` tasks.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">rca</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">result_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./rca/&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The storage path of root cause analysis results.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>Note</strong></p>
<p>You can modify the <code>obdiag.basic.file_number_limit</code> and <code>obdiag.basic.file_size_limit</code> parameters if the number of log files on the remote host or the size of the compressed file exceeds the specified upper limit during log collection.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-obdiag">Use obdiag<a href="#use-obdiag" class="hash-link" aria-label="Direct link to Use obdiag" title="Direct link to Use obdiag">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-inspection">Cluster inspection<a href="#cluster-inspection" class="hash-link" aria-label="Direct link to Cluster inspection" title="Direct link to Cluster inspection">​</a></h3>
<p>You can use <code>obdiag check</code> commands to inspect the status of an OceanBase cluster. The inspection process analyzes the cluster from perspectives of the system kernel parameters and internal tables, identifies the causes of existing or possible exceptions, and provides O&amp;M suggestions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="supported-scenarios">Supported scenarios<a href="#supported-scenarios" class="hash-link" aria-label="Direct link to Supported scenarios" title="Direct link to Supported scenarios">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[check cases about observer]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command                              info_en                                                    info_cn            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check                         default check all task without filter                      默认执行除filter组里的所有巡检项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --cases=ad              Test and inspection tasks                                  测试巡检任务             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --cases=build_before    Deployment environment check                               部署环境检查             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --cases=sysbench_run    Collection of inspection tasks when executing sysbench     执行sysbench时的巡检任务集合 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --cases=sysbench_free   Collection of inspection tasks before executing sysbench   执行sysbench前的巡检任务集合 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[check cases about obproxy]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command                              info_en                                 info_cn            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check                         default check all task without filter   默认执行除filter组里的所有巡检项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --obproxy-cases=proxy   obproxy version check                   obproxy 版本检查       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="commands">Commands<a href="#commands" class="hash-link" aria-label="Direct link to Commands" title="Direct link to Commands">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run all inspection items by default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check the deployment environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --cases=build_before</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List the inspection tasks when a Sysbench benchmark is run </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --cases=sysbench_run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List the inspection tasks before a Sysbench benchmark is run </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --cases=sysbench_free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check the version of ODP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag check --obproxy-cases=proxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="diagnostic-analysis">Diagnostic analysis<a href="#diagnostic-analysis" class="hash-link" aria-label="Direct link to Diagnostic analysis" title="Direct link to Diagnostic analysis">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="syntax">Syntax<a href="#syntax" class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag analyze &lt;analyze type&gt; [options]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Valid values of the <code>analyze type</code> parameter are as follows:</p>
<ul>
<li>
<p><code>log</code>: analyzes logs of OceanBase Database.</p>
</li>
<li>
<p><code>flt_trace</code>: performs end-to-end diagnostics.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="commands-1">Commands<a href="#commands-1" class="hash-link" aria-label="Direct link to Commands" title="Direct link to Commands">​</a></h4>
<p>You can run <code>obdiag analyze</code> commands to analyze logs of an OceanBase cluster online, or specify the <code>--files</code> option to enable offline analysis.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Analyze the logs of the last hour online. When you run this command, obdiag pulls and analyzes the logs of the last hour from the remote host to diagnose the errors that have occurred.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag analyze log --since 1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Analyze the logs of the last 30 minutes online. When you run this command, obdiag pulls and analyzes the logs of the last 30 minutes from the remote host to diagnose the errors that have occurred.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag analyze log --since 30m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Analyze a specified log file offline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag analyze log --files observer.log.20230831142211247 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Analyze the log files in a specified directory offline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag analyze log --files ./test/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="end-to-end-diagnostics">End-to-end diagnostics<a href="#end-to-end-diagnostics" class="hash-link" aria-label="Direct link to End-to-end diagnostics" title="Direct link to End-to-end diagnostics">​</a></h4>
<p><strong>What is end-to-end diagnostics?</strong> OceanBase Database is a distributed database in which the call links are complex. When a timeout issue occurs, O&amp;M engineers cannot quickly locate whether the issue is caused by OceanBase Database components or the network. They can only analyze the issue based on experience and OceanBase Database logs. OceanBase Database V4.0 provides the trace log feature for end-to-end diagnostics. Two paths are involved in end-to-end tracing. In one path, the application sends a request to ODP by using a client, such as Java Database Connectivity (JDBC) or Oracle Call Interface (OCI), to access an OBServer node. The access result is returned to the application. In the other path, the application directly accesses an OBServer node by using a client, and the access result is returned to the application. In end-to-end diagnostics, all components are diagnosed.</p>
<p><em><strong>Working mechanism</strong></em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌────────┐       ┌─────────────────────────────┐       ┌────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Server 1 │------&gt;│ Search and filter the logs related to the specified flt_trace_id. │------&gt;│ Return filtered logs to the node where obdiag is deployed. │---┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────┘       └─────────────────────────────┘       └────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────┐       ┌─────────────────────────────┐       ┌────────────────────────────┐   │    ┌────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Server 2 │------&gt;│ Search and filter the logs related to the specified flt_trace_id. │------&gt;│ Return filtered logs to the node where obdiag is deployed. │---┼---&gt;│ Aggregate logs obtained from parent and child nodes and generate a trace tree based on the hierarchical relationship between nodes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────┘       └─────────────────────────────┘       └────────────────────────────┘   │    └────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────┐       ┌─────────────────────────────┐       ┌────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Server N │------&gt;│ Search and filter the logs related to the specified flt_trace_id. │------&gt;│ Return filtered logs to the node where obdiag is deployed. │---┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────┘       └─────────────────────────────┘       └────────────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Syntax</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag analyze flt_trace [options]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-find-the-id-of-a-suspected-slow-sql-statement">Step 1: Find the ID of a suspected slow SQL statement<a href="#step-1-find-the-id-of-a-suspected-slow-sql-statement" class="hash-link" aria-label="Direct link to Step 1: Find the ID of a suspected slow SQL statement" title="Direct link to Step 1: Find the ID of a suspected slow SQL statement">​</a></h5>
<p>If you suspect that an SQL statement is slow, you can query the <code>gv$ob_sql_audit</code> view to obtain its <code>flt_trace_id</code> value. Here is an example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OceanBase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token variable" style="color:#36acaa">@test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> query_sql</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flt_trace_id </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gv$ob_sql_audit </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> query_sql </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;select @@version_comment limit 1&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| query_sql                        | flt_trace_id                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| select @@version_comment limit 1 | 00060aa3-d607-f5f2-328b-388e17f687cb |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------------+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result indicates that the <code>flt_trace_id</code> value of the suspected SQL statement is <code>00060aa3-d607-f5f2-328b-388e17f687cb</code>.</p>
<p>You can also obtain the <code>flt_trace_id</code> value by searching the <code>trace.log</code> file of ODP or OceanBase Database. Here is an example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">head trace.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2023-12-07 22:20:07.242229] [489640][T1_L0_G0][T1][YF2A0BA2DA7E-00060BEC28627BEF-0-0] {&quot;trace_id&quot;:&quot; 00060bec-275e-9832-e730-7c129f2182ac&quot;,&quot;name&quot;:&quot; close_das_task&quot;,&quot;id&quot;:&quot; 00060bec-2a20-bf9e-56c9-724cb467f859&quot;,&quot;start_ts&quot;:1701958807240606,&quot;end_ts&quot;:1701958807240607,&quot;parent_id&quot;:&quot; 00060bec-2a20-bb5f-e03a-5da01aa3308b&quot;,&quot;is_follow&quot;:false}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result indicates that the <code>flt_trace_id</code> value of the suspected SQL statement is <code>00060bec-275e-9832-e730-7c129f2182ac</code>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-run-the-end-to-end-diagnostics-command">Step 2: Run the end-to-end diagnostics command<a href="#step-2-run-the-end-to-end-diagnostics-command" class="hash-link" aria-label="Direct link to Step 2: Run the end-to-end diagnostics command" title="Direct link to Step 2: Run the end-to-end diagnostics command">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag analyze flt_trace --flt_trace_id 000605b1-28bb-c15f-8ba0-1206bcc08aa3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root node id: 000605b1-28bb-c15f-8ba0-1206bcc08aa3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TOP time-consuming leaf span:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+----------------------------------+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ID| Span Name                        | Elapsed Time|      NODE           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+----------------------------------+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 18| px_task                          | 2.758 ms    | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 5 | pc_get_plan                      | 52 μs       | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 16| do_local_das_task                | 45 μs       | OBSERVER(xx.xx.xx.1)|     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 10| do_local_das_task                | 17 μs       | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 17| close_das_task                   | 14 μs       | OBSERVER(xx.xx.xx.1)|     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+----------------------------------+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tags &amp; Logs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18 - px_task  Elapsed: 2.758 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     NODE:OBSERVER(xx.xx.xx.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     tags: [{&#x27;group_id&#x27;: 0}, {&#x27;qc_id&#x27;: 1}, {&#x27;sqc_id&#x27;: 0}, {&#x27;dfo_id&#x27;: 1}, {&#x27;task_id&#x27;: 1}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 - pc_get_plan  Elapsed: 52 μs </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NODE:OBSERVER(xx.xx.xx.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16 - do_local_das_task  Elapsed: 45 μs </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     NODE:OBSERVER(xx.xx.xx.3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 - do_local_das_task  Elapsed: 17 μs </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     NODE:OBSERVER(xx.xx.xx.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">17 - close_das_task  Elapsed: 14 μs </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     NODE:OBSERVER(xx.xx.xx.3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Details:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+----------------------------------+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ID| Span Name                        | Elapsed Time|  NODE               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+----------------------------------+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1 | TRACE                            | -           | -                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 2 | └─com_query_process              | 5.351 ms    | OBPROXY(xx.xx.xx.1) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 3 |   └─mpquery_single_stmt          | 5.333 ms    | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 4 |     ├─sql_compile                | 107 μs      | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 5 |     │ └─pc_get_plan              | 52 μs       | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 6 |     └─sql_execute                | 5.147 ms    | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 7 |       ├─open                     | 87 μs       | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 8 |       ├─response_result          | 4.945 ms    | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 9 |       │ ├─px_schedule            | 2.465 ms    | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 10|       │ │ ├─do_local_das_task    | 17 μs       | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 11|       │ │ ├─px_task              | 2.339 ms    | OBSERVER(xx.xx.xx.2)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 12|       │ │ │ ├─do_local_das_task  | 54 μs       | OBSERVER(xx.xx.xx.2)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 13|       │ │ │ └─close_das_task     | 22 μs       | OBSERVER(xx.xx.xx.2)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 14|       │ │ ├─do_local_das_task    | 11 μs       | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 15|       │ │ ├─px_task              | 2.834 ms    | OBSERVER(xx.xx.xx.3)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 16|       │ │ │ ├─do_local_das_task  | 45 μs       | OBSERVER(xx.xx.xx.3)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 17|       │ │ │ └─close_das_task     | 14 μs       | OBSERVER(xx.xx.xx.3)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 18|       │ │ └─px_task              | 2.758 ms    | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 19|       │ ├─px_schedule            | 1 μs        | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 20|       │ └─px_schedule            | 1 μs        | OBSERVER(xx.xx.xx.1)|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| ..|       ......                     | ...         |  ......             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+----------------------------------+-------------+---------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For more details, please run cmd &#x27; cat analyze_flt_result/000605b1-28bb-c15f-8ba0-1206bcc08aa3.txt &#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="information-collection">Information collection<a href="#information-collection" class="hash-link" aria-label="Direct link to Information collection" title="Direct link to Information collection">​</a></h3>
<p>obdiag allows you to collect basic information and information for specific scenarios.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="collect-basic-information">Collect basic information<a href="#collect-basic-information" class="hash-link" aria-label="Direct link to Collect basic information" title="Direct link to Collect basic information">​</a></h4>
<p>Syntax:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather &lt;gather type&gt; [options]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Valid values of the <code>gather type</code> parameter are as follows:</p>
<ul>
<li>
<p><code>log</code>: collects logs of the specified OceanBase cluster.</p>
</li>
<li>
<p><code>sysstat</code>: collects information about nodes in the specified OceanBase cluster.</p>
</li>
<li>
<p><code>clog</code>: collects the clogs of the specified OceanBase cluster.</p>
</li>
<li>
<p><code>slog</code>: collects the slogs of the specified OceanBase cluster.</p>
</li>
<li>
<p><code>plan_monitor</code>: collects the execution details of parallel SQL statements with the specified trace ID in the specified OceanBase cluster.</p>
</li>
<li>
<p><code>stack</code>: collects the stack information of the specified OceanBase cluster.</p>
</li>
<li>
<p><code>perf</code>: collects the performance information of the specified OceanBase cluster.</p>
</li>
<li>
<p><code>obproxy_log</code>: collects the logs of the ODP node on which the specified OceanBase cluster depends.</p>
</li>
<li>
<p><code>all</code>: collects the diagnostic information of the specified OceanBase cluster, including the logs, node information, stack information, and performance information of the cluster.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="collect-information-for-specific-scenarios">Collect information for specific scenarios<a href="#collect-information-for-specific-scenarios" class="hash-link" aria-label="Direct link to Collect information for specific scenarios" title="Direct link to Collect information for specific scenarios">​</a></h4>
<p>You can use <code>obdiag gather scenes</code> commands to collect the information required for troubleshooting specific issues. These commands help address the pain point in collecting information on distributed nodes.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="supported-scenarios-1">Supported scenarios<a href="#supported-scenarios-1" class="hash-link" aria-label="Direct link to Supported scenarios" title="Direct link to Supported scenarios">​</a></h5>
<p>You can run the <code>obdiag gather scene list</code> command to query the scenarios supported for information collection.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Other Problem Gather Scenes]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command                                                   info_en               info_cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=other.application_error   [application error]   [应用报错问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Obproxy Problem Gather Scenes]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command                                           info_en             info_cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=obproxy.restart   [obproxy restart]   [obproxy无故重启]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Observer Problem Gather Scenes]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command                                                                                                                                   info_en                                       info_cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.backup                                                                                           [backup problem]                              [数据备份问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.backup_clean                                                                                     [backup clean]                                [备份清理问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.clog_disk_full                                                                                   [clog disk full]                              [clog盘满]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.cluster_down                                                                                     [cluster down]                                [集群无法连接]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.compaction                                                                                       [compaction]                                  [合并问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.cpu_high                                                                                         [High CPU]                                    [CPU高]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.delay_of_primary_and_backup                                                                      [delay of primary and backup]                 [主备库延迟]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.io                                                                                               [io problem]                                  [io问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.log_archive                                                                                      [log archive]                                 [日志归档问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.long_transaction                                                                                 [long transaction]                            [长事务]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.memory                                                                                           [memory problem]                              [内存问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.perf_sql --env &quot;{db_connect=&#x27;-h127.0.0.1 -P2881 -utest@test -p****** -Dtest&#x27;, trace_id=&#x27;Yxx&#x27;}&quot;   [SQL performance problem]                     [SQL性能问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.px_collect_log --env &quot;{trace_id=&#x27;Yxx&#x27;, estimated_time=&#x27;2024-04-19 14:46:17&#x27;}&quot;                    [Collect error source node logs for SQL PX]   [SQL PX 收集报错源节点日志]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.recovery                                                                                         [recovery]                                    [数据恢复问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.restart                                                                                          [restart]                                     [observer无故重启]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.rootservice_switch                                                                               [rootservice switch]                          [有主改选或者无主选举的切主]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.sql_err --env &quot;{db_connect=&#x27;-h127.0.0.1 -P2881 -utest@test -p****** -Dtest&#x27;, trace_id=&#x27;Yxx&#x27;}&quot;    [SQL execution error]                         [SQL 执行出错]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.suspend_transaction                                                                              [suspend transaction]                         [悬挂事务]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.unit_data_imbalance                                                                              [unit data imbalance]                         [unit迁移/缩小 副本不均衡问题]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.unknown                                                                                          [unknown problem]                             [未能明确问题的场景]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="commands-2">Commands<a href="#commands-2" class="hash-link" aria-label="Direct link to Commands" title="Direct link to Commands">​</a></h5>
<p>Syntax:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene={SceneName}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Application error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=other.application_error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Unexpected restart of the obproxy process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=obproxy.restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data backup exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Backup cleanup exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.backup_clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clog disk space exhausted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.clog_disk_full </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Major compaction exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.compaction </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># High CPU utilization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.cpu_high</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data latency between the primary and standby databases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.delay_of_primary_and_backup </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Log archiving exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.log_archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Long-running transaction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.long_transaction </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Memory exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SQL performance exception. In the following example, the value of `trace_id` in the `env` parameter corresponds to the value of `trace_id` in the `gv$ob_sql_audit` view.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.perf_sql --env &quot;{db_connect=&#x27;-hxx -Pxx -uxx -pxx -Dxx&#x27;, trace_id=&#x27;xx&#x27;}&quot;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Restore exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.memory# </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Unexpected restart of the observer process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.restart  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Leader switching in re-election with a leader or election without a leader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.rootservice_switch  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SQL execution error. In the following example, the value of `trace_id` in the `env` parameter corresponds to the value of `trace_id` in the `gv$ob_sql_audit` view.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.sql_err --env &quot;{db_connect=&#x27;-hxx -Pxx -uxx -pxx -Dxx&#x27;, trace_id=&#x27;xx&#x27;}&quot;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Suspended transaction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.suspend_transaction </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data imbalance between units after unit migration or unit reduction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.unit_data_imbalance </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Unknown error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># When you collect PX logs of the source node that reports an error, the `trace_id` parameter is required and the `estimated_time` parameter is optional. The default value of `estimated_time` is the current time. PX logs generated one week earlier than the specified time will be collected based on the specified trace ID.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obdiag gather scene run --scene=observer.px_collect_log --env &quot;{trace_id=&#x27;Yxx&#x27;, estimated_time=&#x27;2024-04-19 14:46:17&#x27;}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="root-cause-analysis">Root cause analysis<a href="#root-cause-analysis" class="hash-link" aria-label="Direct link to Root cause analysis" title="Direct link to Root cause analysis">​</a></h3>
<p>You can use <code>obdiag rca</code> commands to analyze the diagnostic information of OceanBase Database. These commands allow you to analyze exceptions of OceanBase Database to identify the causes of these exceptions.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="supported-scenarios-2">Supported scenarios<a href="#supported-scenarios-2" class="hash-link" aria-label="Direct link to Supported scenarios" title="Direct link to Supported scenarios">​</a></h4>
<p>You can run the <code>obdiag rca list</code> command to query the scenarios supported for root cause analysis.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag rca list </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="commands-3">Commands<a href="#commands-3" class="hash-link" aria-label="Direct link to Commands" title="Direct link to Commands">​</a></h4>
<p>You can run the following command to analyze the root cause of a specified issue.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag rca run --scene=&lt;scene_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here is an example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obdiag rca run --scene=disconnection </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                   record                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+----------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| step | info                                                                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+----------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1   | node:xxx.xxx.xxx obproxy_diagnosis_log: [2024-01-18 17:48:37.667014] [23173][Y0-00007FAA5183E710] |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      | [CONNECTION](trace_type=&quot;CLIENT_VC_TRACE&quot;, connection_diagnosis={cs_id:1065, ss_id:4559,           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      | proxy_session_id:837192278409543969, server_session_id:3221810838,                                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      | client_addr:&quot; xxx.xxx.xxx.xxx:xxxx&quot;, server_addr:&quot; xxx.xxx.xxx.xxx:2883&quot;, cluster_name:&quot; obcluster&quot;,     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      | tenant_name:&quot; sys&quot;, user_name:&quot; root&quot;, error_code: -10010, error_msg:&quot; An unexpected connection event  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      | received from client while obproxy reading request&quot;, request_cmd:&quot; COM_SLEEP&quot;, sql_cmd:&quot; COM_END&quot;,   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      | req_total_time(us):5315316}{vc_event:&quot; VC_EVENT_EOS&quot;, user_sql:&quot; &quot;})                                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  2   | cs_id:1065, server_session_id:3221810838                                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  3   | trace_type:CLIENT_VC_TRACE                                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  4   | error_code: -10010                                                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+----------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The suggest: Need client cooperation for diagnosis</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-diagnostics-scenarios">Add diagnostics scenarios<a href="#add-diagnostics-scenarios" class="hash-link" aria-label="Direct link to Add diagnostics scenarios" title="Direct link to Add diagnostics scenarios">​</a></h2>
<p>This section describes how to add diagnostics scenarios to meet the diagnostics requirements of clusters.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-inspection-scenarios">Add inspection scenarios<a href="#add-inspection-scenarios" class="hash-link" aria-label="Direct link to Add inspection scenarios" title="Direct link to Add inspection scenarios">​</a></h3>
<p>Inspection scenarios are stored in the <code>~/.obdiag/check</code> directory. The <code>obproxy_check_package.yaml</code> and <code>observer_check_package.yaml</code> files record the inspection items for ODP and OBServer nodes, respectively.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── obproxy_check_package.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── observer_check_package.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── obproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       └── bad_version.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── observer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── core_file_find.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── data_path_settings.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── deadlocks.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── oversold.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── clog_abnormal_file.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── disk_full.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── disk_hole.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── err_code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── find_err_4000.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── sysbench</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── sysbench_free_test_cpu_count.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── sysbench_free_test_memory_limit.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── sysbench_free_test_network_speed.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── aio.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── dependent_software_swapon.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── dependent_software.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ├── bad_version.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── old_version.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>tasks</code> directory stores existing inspection items, and each large inspection item corresponds to a YAML file. You can write a task script in the YAML format according to specific rules.</p>
<p>Here is a sample task script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">info: testinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">task:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - version: &quot;[3.1.0,3.2.4]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {steps_object}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - version: &quot;[4.2.0.0,4.3.0.0]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {steps_object}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The following table describes the parameters.</p>
<table><thead><tr><th>Parameter</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>info</td><td>Yes</td><td>The scenario to use the task script file. This information facilitates maintenance.</td></tr><tr><td>version</td><td>No</td><td>The OceanBase Database versions that the script is compatible with. The value is a range with complete version numbers in the form of a string. <br>A version number contains three digits for OceanBase Database V3.x, such as [3.1.1,3.2.0]. <br>A version number contains four digits for OceanBase Database V4.x, such as [4.1.0.0,4.2.0.0].</td></tr><tr><td>steps</td><td>Yes</td><td>The list of steps to be executed.</td></tr></tbody></table>
<p>For more information about the tutorial, see <a href="https://en.oceanbase.com/docs/common-obdiag-en-10000000001574823" target="_blank" rel="noopener noreferrer">Use obdiag to inspect an OceanBase cluster</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-information-collection-scenarios">Add information collection scenarios<a href="#add-information-collection-scenarios" class="hash-link" aria-label="Direct link to Add information collection scenarios" title="Direct link to Add information collection scenarios">​</a></h3>
<p>Information collection scenarios are stored in the <code>~/.obdiag/gather/tasks</code> directory. The YAML files in the <code>obproxy</code>, <code>observer</code>, and <code>other</code> directories record the information collection scenarios for ODP, OBServer nodes, and other components, respectively.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── obproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── restart.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── observer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── backup_clean.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── backup.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── clog_disk_full.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── cluster_down.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── compaction.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── delay_of_primary_and_backup.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── io.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── log_archive.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── long_transaction.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── memory.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── recovery.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── restart.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── rootservice_switch.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── suspend_transaction.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── unit_data_imbalance.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── unknown.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── other</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── application_error.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The method for adding an information collection scenario is similar to that of <a href="#Add_inspection_scenarios">adding an inspection scenario</a>. Here is an example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#cat backup.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">info_en</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[backup problem]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">info_cn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[Data backup problem]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> obdiag gather scene run </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scene=observer.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">task</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[2.0.0.0, 4.0.0.0]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show variables like &#x27;version_comment&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.v$ob_cluster&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase. __all_zone WHERE name=&#x27;idc&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select svr_ip,zone,with_rootserver,status,block_migrate_in_time,start_service_time,stop_time,build_version from oceanbase. __all_server order by zone;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT zone, concat(svr_ip, &#x27;:&#x27; , svr_port) observer, cpu_capacity, cpu_total, cpu_assigned, cpu_assigned_percent, mem_capacity, mem_total, mem_assigned, mem_assigned_percent, unit_Num, round(`load`, 2) `load`, round(cpu_weight, 2) cpu_weight, round(memory_weight, 2) mem_weight, leader_count FROM oceanbase. __all_virtual_server_stat ORDER BY zone,svr_ip;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select tenant_id,tenant_name,primary_zone,compatibility_mode from oceanbase. __all_tenant;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show parameters like &#x27;%syslog_level%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show parameters like &#x27;%syslog_io_bandwidth_limit%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select count(*),tenant_id,zone_list,unit_count from oceanbase. __all_resource_pool group by tenant_id,zone_list,unit_count;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show parameters like &#x27;%auto_delete_expired_backup%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select * from oceanbase. __all_virtual_backup_task;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select * from oceanbase. __all_virtual_backup_info;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select * from oceanbase. __all_virtual_sys_task_status where comment like &#x27;%backup%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select count(*),status from oceanbase. __all_virtual_pg_backup_task group by status;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select svr_ip, log_archive_status, count(*) from oceanbase. __all_virtual_pg_backup_log_archive_status group by svr_ip, log_archive_status;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select * from oceanbase. __all_rootservice_event_history where gmt_create &gt; ${from_time} and gmt_create &lt; ${to_time} order by gmt_create desc;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;select b.* from oceanbase. __all_virtual_pg_backup_log_archive_status a,oceanbase. __all_virtual_pg_log_archive_stat b where a.table_id=b.table_id and a.partition_id=b.partition_id  order by log_archive_cur_ts limit 5;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">grep</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sysstat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sysstat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[4.0.0.0, *]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show variables like &#x27;version_comment&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.DBA_OB_ZONES;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.DBA_OB_SERVERS;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.GV$OB_SERVERS;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.DBA_OB_UNIT_CONFIGS;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.DBA_OB_RESOURCE_POOLS;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.DBA_OB_TENANTS;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT c.TENANT_ID, e.TENANT_NAME, concat(c.NAME, &#x27;: &#x27;, d.NAME) `pool:conf`,concat(c.UNIT_COUNT, &#x27; unit: &#x27;, d.min_cpu, &#x27;C/&#x27;, ROUND(d.MEMORY_SIZE/1024/1024/1024,0), &#x27;G&#x27;) unit_info FROM oceanbase.DBA_OB_RESOURCE_POOLS c, oceanbase.DBA_OB_UNIT_CONFIGS d, oceanbase.DBA_OB_TENANTS e WHERE c.UNIT_CONFIG_ID=d.UNIT_CONFIG_ID AND c.TENANT_ID=e.TENANT_ID AND c.TENANT_ID&gt;1000 ORDER BY c.TENANT_ID;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT a.TENANT_NAME,a.TENANT_ID,b.SVR_IP FROM oceanbase.DBA_OB_TENANTS a, oceanbase.GV$OB_UNITS b WHERE a.TENANT_ID=b.TENANT_ID;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show parameters like &#x27;%syslog_level%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show parameters like &#x27;%syslog_io_bandwidth_limit%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show parameters like &#x27;%backup%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;show parameters like &#x27;%ha_low_thread_score%&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.CDB_OB_BACKUP_PARAMETER&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.CDB_OB_BACKUP_JOBS limit 20;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.DBA_OB_ROOTSERVICE_EVENT_HISTORY WHERE module=&#x27;backup_data&#x27; AND event =&#x27;start_backup_data&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase.CDB_OB_BACKUP_TASKS limit 20;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM oceanbase. __all_virtual_backup_schedule_task limit 20&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * from oceanbase.CDB_OB_BACKUP_JOB_HISTORY where STATUS = &#x27;FAILED&#x27; limit 20;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">grep</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sysstat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sysstat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The parameters are described as follows:</p>
<ul>
<li>
<p><code>info_en</code>: the scenario description in English to be returned by the <code>obdiag gather scene list</code> command.</p>
</li>
<li>
<p><code>info_cn</code>: the scenario description in Chinese to be returned by the <code>obdiag gather scene list</code> command.</p>
</li>
<li>
<p><code>command</code>: the command to be run.</p>
</li>
<li>
<p><code>task.version</code>: the OceanBase Database version supported by obdiag.</p>
</li>
<li>
<p><code>task.steps.type</code>: the type of the execution step. Valid values are <code>ssh</code>, <code>sql</code>, <code>log</code>, <code>obproxy_log</code>, and <code>sysstat</code>.</p>
</li>
<li>
<p><code>task.steps.type.global</code>: specifies whether to execute the step only on one node or on all nodes. The value <code>true</code> specifies to execute the step only on the first node. The value <code>false</code> specifies to execute the step on each node.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-root-cause-analysis-scenarios">Add root cause analysis scenarios<a href="#add-root-cause-analysis-scenarios" class="hash-link" aria-label="Direct link to Add root cause analysis scenarios" title="Direct link to Add root cause analysis scenarios">​</a></h3>
<p>Root cause analysis scenarios are recorded in Python files under the <code>~/.obdiag/rca</code> directory. To add a root cause analysis scenario, you must configure specific link logic for root cause analysis in the Python code. For more information, see <a href="https://oceanbase.yuque.com/org-wiki-obtech-vh7w9r/imzr6c/or82ioetg06ta27e" target="_blank" rel="noopener noreferrer">obdiag Project Developer Guide</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── ddl_disk_full_scene.py </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── disconnection_scene.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lock_conflict_scene.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── major_hold_scene.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>obdiag supports cluster inspection, diagnostic analysis, and information collection. You can easily inspect an OceanBase cluster and recover the cluster based on the diagnostics report. If a cluster encounters an unknown exception, obdiag allows you to analyze the logs to narrow the troubleshooting scope. If a cluster encounters a known exception, obdiag allows you to directly analyze the root cause based on the root cause analysis report. If the problem persists, you can collect diagnostic information and post it to the QA module in the OceanBase community or send it to OceanBase Technical Support.</p>
<p><img decoding="async" loading="lazy" alt="Overall process" src="/assets/images/004-c6b271046516bb42b9f4e518c48a36dd.png" width="1834" height="498" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/09_diagnose_and_analyze_through_obdiag.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/user_manual/quick_starts/en-US/chapter_07_diagnosis_and_tuning/performance_diagnosis_by_sql_diagnoser"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Use SQL Diagnoser to diagnose and analyze SQL performance issues</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-obdiag" class="table-of-contents__link toc-highlight">About obdiag</a><ul><li><a href="#benefits" class="table-of-contents__link toc-highlight">Benefits</a></li><li><a href="#features" class="table-of-contents__link toc-highlight">Features</a></li></ul></li><li><a href="#install-and-deploy-obdiag" class="table-of-contents__link toc-highlight">Install and deploy obdiag</a><ul><li><a href="#install-obdiag" class="table-of-contents__link toc-highlight">Install obdiag</a></li><li><a href="#configure-obdiag" class="table-of-contents__link toc-highlight">Configure obdiag</a></li></ul></li><li><a href="#use-obdiag" class="table-of-contents__link toc-highlight">Use obdiag</a><ul><li><a href="#cluster-inspection" class="table-of-contents__link toc-highlight">Cluster inspection</a></li><li><a href="#diagnostic-analysis" class="table-of-contents__link toc-highlight">Diagnostic analysis</a></li><li><a href="#information-collection" class="table-of-contents__link toc-highlight">Information collection</a></li><li><a href="#root-cause-analysis" class="table-of-contents__link toc-highlight">Root cause analysis</a></li></ul></li><li><a href="#add-diagnostics-scenarios" class="table-of-contents__link toc-highlight">Add diagnostics scenarios</a><ul><li><a href="#add-inspection-scenarios" class="table-of-contents__link toc-highlight">Add inspection scenarios</a></li><li><a href="#add-information-collection-scenarios" class="table-of-contents__link toc-highlight">Add information collection scenarios</a></li><li><a href="#add-root-cause-analysis-scenarios" class="table-of-contents__link toc-highlight">Add root cause analysis scenarios</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/compilation/sig_intro">compilation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>