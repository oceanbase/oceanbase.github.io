<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/oms_troubleshooting_guide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">社区版 OMS 问题排查手册 | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/oms_troubleshooting_guide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="社区版 OMS 问题排查手册 | OceanBase"><meta data-rh="true" name="description" content="为什么要搞一个社区版工具问题排查手册？"><meta data-rh="true" property="og:description" content="为什么要搞一个社区版工具问题排查手册？"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/oms_troubleshooting_guide"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/oms_troubleshooting_guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/oms_troubleshooting_guide" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H4XM2M50RX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-H4XM2M50RX",{})</script><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.c2d6d3f4.js" defer="defer"></script>
<script src="/assets/js/main.f609a655.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><span><li><a class="dropdown__link" href="/docs/sig/overview/list">Special Interest Group(SIG)</a></li></span><span><li><a class="dropdown__link" href="/docs/honor/overview">Community Honors</a></li></span><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://discord.gg/74cF8vbNEs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Data + AI</a><ul class="dropdown__menu"><span><li><a href="https://oceanbase-devhub.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">AI Workshops<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/ai-workshop-2024" target="_blank" rel="noopener noreferrer" class="dropdown__link">RAG Bot<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/dify/dify@oceanbase-workshop" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dify (MySQL Compatible)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/DB-GPT/docker/compose_examples/ob_dbgpt_tutorial" target="_blank" rel="noopener noreferrer" class="dropdown__link">DB-GPT<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/zh-CN/about_this_manual/overview">关于 《DBA 进阶教程》</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/zh-CN/disaster_recovery_architecture_design/high_availability_architecture_overview">容灾架构设计</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/zh-CN/operations_and_maintenance/version_upgrade_path">运维管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/zh-CN/scenario_best_practices/parameter_templates">场景最佳实践</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/zh-CN/development_specification/object_specification">数据库开发规范</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/zh-CN/emergency_handbook/emergency_overview">OBServer 故障应急手册</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/oms_troubleshooting_guide">社区版工具问题排查手册</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/oms_troubleshooting_guide">社区版 OMS 问题排查手册</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/obd_troubleshooting_guide">社区版 OBD 问题排查手册</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/odp_troubleshooting_guide/introduction">社区版 ODP 问题排查手册</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/introduction">用户经验分享</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">社区版工具问题排查手册</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">社区版 OMS 问题排查手册</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>社区版 OMS 问题排查手册</h1></header><blockquote>
<p>为什么要搞一个社区版工具问题排查手册？</p>
<p>一是因为 OceanBase 官网的工具文档，大多是商业版本的内容。类似于 OMS，商业版和社区版是两个完全独立的工具，所以需要一个社区版用户专用的 OMS 问题排查手册。</p>
<p>二是类似于 OBD 这种轻量的运维工具，目前是社区版数据库内核的专用工具（马上就会支持商业版的数据库内核），而且官网缺少比较详细的 OBD 问题排查手册，所以也有这种需求。</p>
<p>OCP 这种商业版和社区版几乎没有区别，共用同一套代码的工具，问题排查就详见官网文档吧，哈哈~</p>
</blockquote>
<blockquote>
<p>这个排查手册是 OMS 社区版的研发负责人刘彻老哥亲手为大家写的，堪称 OMS 问题排查 “宝典”。欢迎阅读和收藏。</p>
<p>今天和 OBD 研发负责人谐云老哥聊天，他说有大量社区版用户都在使用 OBD 对集群进行运维管理。所以预计在 2024.12 内，也会出一份类似的 OBD 社区版问题排查手册，大家后续可以关注下。</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oms-问题排查思路">OMS 问题排查思路<a href="#oms-问题排查思路" class="hash-link" aria-label="Direct link to OMS 问题排查思路" title="Direct link to OMS 问题排查思路">​</a></h2>
<p>OMS 社区版发生报错时，请先确认是否存在因官网文档中已提到的使用限制导致的异常。</p>
<p>下图为 OMS 社区版数据迁移或数据同步任务发生报错时的整体排查思路。</p>
<p><img decoding="async" loading="lazy" alt="FAQ-1" src="/assets/images/001-12bf7ee197931418aa41bd83fcfd5873.png" width="1418" height="1227" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="产品功能组件和日志位置说明">产品功能、组件和日志位置说明<a href="#产品功能组件和日志位置说明" class="hash-link" aria-label="Direct link to 产品功能、组件和日志位置说明" title="Direct link to 产品功能、组件和日志位置说明">​</a></h2>
<blockquote>
<p>说明：</p>
<p>所有日志文件均会自动归档压缩。您在查看日志时，请根据时间来确定具体的日志文件。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="结构迁移">结构迁移<a href="#结构迁移" class="hash-link" aria-label="Direct link to 结构迁移" title="Direct link to 结构迁移">​</a></h3>
<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>组件</td><td>Ghana</td></tr><tr><td>日志目录</td><td>/home/admin/logs/ghana/Ghana</td></tr><tr><td>结构转换相关日志（调用 DBCat 组件）</td><td>dbcat.log</td></tr><tr><td>通常异常日志</td><td>common-error.log</td></tr><tr><td>通常输出日志</td><td>common-default.log</td></tr><tr><td>一些查询日志</td><td>check_query.log</td></tr><tr><td>任务步骤日志</td><td>oms-step.log</td></tr><tr><td>后台调度日志</td><td>oms-scheduler.log</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="全量迁移">全量迁移<a href="#全量迁移" class="hash-link" aria-label="Direct link to 全量迁移" title="Direct link to 全量迁移">​</a></h3>
<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>组件</td><td>Connector</td></tr><tr><td>日志目录</td><td>/home/ds/run/ <code>{组件 ID}</code> /logs</td></tr><tr><td>错误日志</td><td>error.log</td></tr><tr><td>程序运行日志</td><td>connector.log</td></tr></tbody></table>
<p>查看组件 ID 的操作如下：</p>
<ol>
<li>
<p>登录 OMS 社区版控制台。</p>
</li>
<li>
<p>在左侧导航栏，单击 <strong>数据迁移</strong>。</p>
</li>
<li>
<p>在 <strong>数据迁移</strong> 页面，单击目标数据迁移任务的名称，进入详情页面。</p>
</li>
<li>
<p>单击页面右上角的 <strong>查看组件监控</strong>。</p>
<p><img decoding="async" loading="lazy" alt="FAQ-2" src="/assets/images/002-883091799cd629a3ace05006405c2876.png" width="2837" height="544" class="img_ev3q"></p>
</li>
<li>
<p>在 <strong>查看组件监控</strong> 对话框，查看 Full-Import 全量迁移组件的 <strong>组件 ID</strong>。</p>
<p><img decoding="async" loading="lazy" alt="FAQ-3" src="/assets/images/003-03524d4df4e93b4b198accbbd059d34b.png" width="1715" height="809" class="img_ev3q"></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="增量同步">增量同步<a href="#增量同步" class="hash-link" aria-label="Direct link to 增量  同步" title="Direct link to 增量同步">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="增量拉取组件-store">增量拉取组件 Store<a href="#增量拉取组件-store" class="hash-link" aria-label="Direct link to 增量拉取组件 Store" title="Direct link to 增量拉取组件 Store">​</a></h4>
<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>组件</td><td>Store</td></tr><tr><td>日志目录</td><td>/home/ds/store/<code>store{port}</code>/log</td></tr><tr><td>obstore（源库为 V3.x）</td><td>liboblog.log</td></tr><tr><td>obstore（源库为 V4.x）</td><td>libobcdc.log</td></tr><tr><td>mysqlstore（Java 实现的 xlog）</td><td>connector/connector.log</td></tr></tbody></table>
<p>查看 <code>store{port}</code> 的操作如下：</p>
<ol>
<li>
<p>登录 OMS 社区版控制台。</p>
</li>
<li>
<p>在左侧导航栏，单击 <strong>数据迁移</strong>。</p>
</li>
<li>
<p>在 <strong>数据迁移</strong> 页面，单击目标数据迁移任务的名称，进入详情页面。</p>
</li>
<li>
<p>单击页面右上角的 <strong>查看组件监控</strong>。</p>
<p><img decoding="async" loading="lazy" alt="FAQ-2" src="/assets/images/002-883091799cd629a3ace05006405c2876.png" width="2837" height="544" class="img_ev3q"></p>
</li>
<li>
<p>在 <strong>查看组件监控</strong> 对话框，查看 Store 增量拉取组件的 <strong>组件 ID</strong>。</p>
<p>组件 ID 的格式为 <code>{ip}-{port}:{subtopic}:{seq}</code>，您可以从组件 ID 中获取 Store 组件的 <code>{port}</code>。</p>
<p><img decoding="async" loading="lazy" alt="FAQ-4" src="/assets/images/004-098ca64336012f154d646e09cf176aad.png" width="1667" height="506" class="img_ev3q"></p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="增量同步组件-incr-sync">增量同步组件 Incr-Sync<a href="#增量同步组件-incr-sync" class="hash-link" aria-label="Direct link to 增量同步组件 Incr-Sync" title="Direct link to 增量同步组件 Incr-Sync">​</a></h4>
<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>组件</td><td>Incr-Sync</td></tr><tr><td>日志目录</td><td>/home/ds/run/<code>{组件 ID}</code>/`logs</td></tr><tr><td>错误日志</td><td>error.log</td></tr><tr><td>程序运行日志</td><td>connector.log</td></tr><tr><td>增量 Source 读取到的数据（仅有 PK）</td><td>msg/connector_source_msg.log</td></tr><tr><td>增量 Sink 写入的数据（仅有 PK）</td><td>msg/connector_sink_msg.log</td></tr><tr><td>增量过滤的数据</td><td>msg/connector_filter_msg.log</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="全量校验">全量校验<a href="#全量校验" class="hash-link" aria-label="Direct link to 全量校验" title="Direct link to 全量校验">​</a></h3>
<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>组件</td><td>Full-Verification</td></tr><tr><td>日志目录</td><td>/home/ds/run/<code>{组件 ID}</code>/logs</td></tr><tr><td>错误日志</td><td>error.log</td></tr><tr><td>程序运行日志</td><td>task.log</td></tr><tr><td>校验结果文件目录</td><td>/home/ds/run/<code>{组件 ID}</code>/verify/<code>{subid}</code>/</td></tr><tr><td>不一致数据以及原因文件</td><td>/home/ds/run/<code>{组件 ID}</code>/verify/<code>{subid}</code>/<code>{schema}</code>/diff/<code>{table_name}.diff</code></td></tr><tr><td>可以在目标端执行的订正 SQL 文件</td><td>/home/ds/run/<code>{组件 ID}</code>/verify/<code>{subid}</code>/<code>{schema}</code>/sql/<code>{table_name}.sql</code></td></tr></tbody></table>
<p><code>{subid}</code>：从 1 开始，每次重新校验会自动加 1。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="正向切换">正向切换<a href="#正向切换" class="hash-link" aria-label="Direct link to 正向切换" title="Direct link to 正向切换">​</a></h3>
<p>正向切换在管控组件中完成。如果您选择了反向增量，则会创建反向 Store 和反向的增量。</p>
<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>组件</td><td>Ghana</td></tr><tr><td>日志目录</td><td>/home/admin/logs/ghana/Ghana</td></tr><tr><td>通常异常日志</td><td>common-error.log</td></tr><tr><td>通常输出日志</td><td>common-default.log</td></tr><tr><td>链路步骤日志</td><td>oms-step.log</td></tr><tr><td>后台调度日志</td><td>oms-scheduler.log</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="反向增量">反向增量<a href="#反向增量" class="hash-link" aria-label="Direct link to 反向增量" title="Direct link to 反向增量">​</a></h3>
<p>除组件 ID 命名有区别外，其它内容和增量同步一致。反向增量组件 ID 的名称中包含 <strong>reverse</strong> 关键字。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="管控相关组件">管控相关组件<a href="#管控相关组件" class="hash-link" aria-label="Direct link to 管控相关组件" title="Direct link to 管控相关组件">​</a></h3>
<table><thead><tr><th>组件</th><th>描述</th></tr></thead><tbody><tr><td>oms_console</td><td>Ghana 组件，日志目录为 <code>/home/admin/logs/ghana/Ghana</code>。</td></tr><tr><td>oms_drc_cm</td><td>CM 组件，日志目录为 <code>/home/admin/logs/cm</code>。</td></tr><tr><td>oms_drc_supervisor</td><td>Supervisor 组件，日志目录为 <code>/home/admin/logs/supervisor</code>。</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装阶段问题">安装阶段问题<a href="#安装阶段问题" class="hash-link" aria-label="Direct link to 安装阶段问题" title="Direct link to 安装阶段问题">​</a></h2>
<p>进入 OMS 社区版容器，先查看 OMS 社区版组件是否正常。对于不正常的组件，请查看相关日志。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">supervisorctl status </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在安装阶段，通常会出现如下问题：</p>
<ul>
<li>
<p>端口被占用</p>
</li>
<li>
<p>给 OMS 社区版提供的元数据库权限存在问题</p>
</li>
<li>
<p>部分操作系统 Docker 环境有问题，出现文件权限 ？？? 的情况，导致服务无法启动。请更换系统安装 OMS 社区版。</p>
</li>
<li>
<p>用户系统为 cgroup2，导致 OMS 社区版机器转态不正常。OMS V4.2.4 之后版本解决该问题。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="全量增量迁移性能调优">全量/增量迁移性能调优<a href="#全量增量迁移性能调优" class="hash-link" aria-label="Direct link to 全量/增量迁移性能调优" title="Direct link to 全量/增量迁移性能调优">​</a></h2>
<p>关于全量迁移和增量同步性能调优的详情，请参见 <a href="https://www.oceanbase.com/docs/community-oms-cn-1000000001456856" target="_blank" rel="noopener noreferrer">全量/增量数据迁移性能调优</a>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="并发jvm-内存每个分片记录数等问题">并发、JVM 内存、每个分片记录数等问题<a href="#并发jvm-内存每个分片记录数等问题" class="hash-link" aria-label="Direct link to 并发、JVM 内存、每个分片记录数等问题" title="Direct link to 并发、JVM 内存、每个分片记录数等问题">​</a></h3>
<p>该部分内容可以解决大部分性能问题。</p>
<table><thead><tr><th>问题类型</th><th>解决方式</th></tr></thead><tbody><tr><td>并发</td><td>源端并发 <code>source.workerNum</code>，目标端并发 <code>sink.workerNum</code>。通常全量迁移时，源端并发和目标端并发的设置相同，增量同步 Source 中无需设置。<br>并发度和机器 CPU 核数量相关，最大可以设置为 CPU*4，同时需要查看机器中是否存在其他迁移任务在执行。</td></tr><tr><td>JVM 内存</td><td><code>coordinator.connectorJvmParam</code>。主要调整 <code>-Xms8g</code>（初始内存）、<code>-Xmx8g</code>（最大内存）和 <code>-Xmn4g</code>（新增的内存），调整规则如下：<ul><li>初始内存=最大内存 </li><li>新增的内存=最大内存-4GB</li><li>通常一个并发对应 1GB 内存。例如，32 并发，最大内存设置 32GB。</li></ul></td></tr><tr><td>每个分片记录数</td><td><code>source.sliceBatchSize</code>，默认值为 600。<br>对于大表通常 10000 即可，如果设置太大会消耗内存较多。您可以根据  <code>logs/msg/metrics.log</code> 中的 <code>slice_queue</code> 决定是否需要修改。如果是 0，则需要增加每个分片的记录数，原因是 Source Worker 线程会从 <code>slice_queue</code> 拉取分片，0 表示没有分片，Source Worker 便会等待空转。</td></tr></tbody></table>
<p>全量迁移通常需要后建索引，提高全量迁移效率。对于目标库为 OceanBase 数据库的情况，您可以通过系统参数 <code>struct.transfer.config</code> 配置中的 <code>ob.parallel</code> 来配置创建索引的并发度。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="增量同步-1">增量同步<a href="#增量同步-1" class="hash-link" aria-label="Direct link to 增量同步" title="Direct link to  增量同步">​</a></h3>
<p>事务分片：<code>source.splitThreshold</code>。当源端存在批量操作导致增量延迟时，您可以进行调整，默认值为 128。批量操作类型为 <code>INSERT</code> 时，调整越大越好，上限为 512。批量操作 <code>UPDATE</code> 和 <code>DELETE</code> 时，调整值越小越好，下限为 1。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metricslog-分析">metrics.log 分析<a href="#metricslog-分析" class="hash-link" aria-label="Direct link to metrics.log 分析" title="Direct link to metrics.log 分析">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="判断瓶颈在哪里">判断瓶颈在哪里<a href="#判断瓶颈在哪里" class="hash-link" aria-label="Direct link to 判断瓶颈在哪里" title="Direct link to 判断瓶颈在哪里">​</a></h4>
<p>slice 分片-&gt; source 读取源端-&gt; dispatcher 数据分发-&gt; sink 写入目标</p>
<ul>
<li>
<p><code>slice_queue</code> 大于 0，表示瓶颈不在这里。<code>slice_queue</code> 等于 0，表示分片慢，增加 <code>source.sliceBatchSize</code> 每个分片的记录数，多表场景也可以增加 <code>source.sliceWorkerNum</code> 分片工作线程。</p>
</li>
<li>
<p><code>source_worker_num</code> 小于 source_worker_num_all`，表示瓶颈不在 Source 读取。</p>
</li>
<li>
<p><code>sink_worker_num</code> 小于 <code>sink_worker_num_all</code>，表示瓶颈不在 Sink 写入。</p>
</li>
<li>
<p><code>dispatcher.ready_execute_batch_size</code> 等于 0，表示写入没有瓶颈，<code>ready_execute_batch_size</code> 大于 0，表示写入慢。</p>
</li>
<li>
<p><code>dispatcher.wait_dispatch_record_size</code> 等于 0，表示分发没有瓶颈。<code>wait_dispatch_record_size</code> 大于 0，表示 OMS 内部计算数据归属分区存在瓶颈（分区表情况下一般都会有积压，分区计算比较耗时）。旁路场景下可以关闭分区计算 <code>sink.enablePartitionBucket=false</code>，也可能存在热点数据，详情请参见 <a href="https://www.oceanbase.com/knowledge-base/oms-ee-1000000000253328" target="_blank" rel="noopener noreferrer">疑似热点问题</a> 的内容。</p>
</li>
<li>
<p>在 JVM 内存不够的情况下，可能发生 fullgc 情况，从而导致整个效率降低很多，也会出现数据库断链等容易误判的异常。您可以登录 OMS 社区版容器，查看进程 gc 情况。</p>
</li>
<li>
<p>如果源端在进行批量操作，建议您控制批量操作流量。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">su - ds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ps -ef|grep &quot;组件 ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/alibaba/java/bin/jstat -gcutil {pid} 1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0.00  18.27  64.08   0.90  97.11  93.45      7    0.374     0    0.000    0.374</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0.00  18.27  64.08   0.90  97.11  93.45      7    0.374     0    0.000    0.374</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>FGC 不断增加，则表示需要增加 JVM 内存。</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;jvm&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;JVM&quot;: &quot;{\&quot;heapMemoryMax\&quot;:7782,\&quot;heapMemoryInit\&quot;:8192,\&quot;heapMemoryUsed\&quot;:1072,\&quot;heapMemoryCommitted\&quot;:7782,\&quot;noHeapMemoryMax\&quot;:0,\&quot;noHeapMemoryInit\&quot;:2,\&quot;noHeapMemoryUsed\&quot;:78,\&quot;noHeapMemoryCommitted\&quot;:83,\&quot;gcInfoList\&quot;:[{\&quot;name\&quot;:\&quot;ParNew\&quot;,\&quot;count\&quot;:6,\&quot;costMs\&quot;:770},{\&quot;name\&quot;:\&quot;ConcurrentMarkSweep\&quot;,\&quot;count\&quot;:1,\&quot;costMs\&quot;:362}],\&quot;threadCount\&quot;:34}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dataflow&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;slice_queue&quot;: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;os&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;OS&quot;: &quot;{\&quot;cpu\&quot;:0.5210029306414848,\&quot;sysCpu\&quot;:62.941847206385404}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;sink&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_worker_num&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ob_watermark_detect_times&quot;: 231,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_request_time&quot;: 198.43,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source_iops&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_total_transaction&quot;: 2384.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ob_exceed_mem_high_watermark_times&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_total_record&quot;: 23383.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;paused_time_ms&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_commit_time&quot;: 3363.16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_worker_num_all&quot;: 8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;shardTime&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_total_bytes&quot;: 8739678.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_delay&quot;: 1717642529661,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;paused_total_time_ms&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ob_free_memory&quot;: 92,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;rps&quot;: 41.42,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;tps&quot;: 3.1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ob_exceed_cpu_high_watermark_times&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;iops&quot;: 3921.59,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sinkSlowRoutes&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sink_execute_time&quot;: 17.25,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ob_free_cpu&quot;: -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;source&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source_read_time&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source_rps&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source_slice_time&quot;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source_worker_num_all&quot;: 8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source_worker_num&quot;: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dispatcher&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;wait_dispatch_record_size&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ready_execute_batch_size&quot;: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;frame&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;SourceTaskManager.createdSourceSize&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;queue_slot1.batchAccumulate&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;frame.throttle.throttle_memory_remain&quot;: &quot;2.14748365E9&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;queue_slot1.batchCount&quot;: 3715.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;queue_slot1.tps&quot;: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="增量延迟-疑似热点问题">增量延迟-疑似热点问题<a href="#增量延迟-疑似热点问题" class="hash-link" aria-label="Direct link to 增量延迟-疑似热点问题" title="Direct link to 增量延迟-疑似热点问题">​</a></h3>
<p>详情请参见 <a href="https://www.oceanbase.com/knowledge-base/oms-ee-1000000000253328" target="_blank" rel="noopener noreferrer">疑似热点问题</a> 的内容。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="全量校验-1">全量校验<a href="#全量校验-1" class="hash-link" aria-label="Direct link to 全量校验" title="Direct link to 全量校验">​</a></h3>
<ul>
<li>
<p>请参考全量迁移。</p>
</li>
<li>
<p>通过 <code>task.sourceMasterSection.excludeColumn</code> 排除 LOB 类型的大字段和无需校验的字段，具体设置请参见 <a href="https://www.oceanbase.com/docs/community-oms-cn-1000000001456854" target="_blank" rel="noopener noreferrer">Full-Verification 组件参数说明</a>。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="全量校验数据问题">全量校验数据问题<a href="#全量校验数据问题" class="hash-link" aria-label="Direct link to 全量校验数据问题" title="Direct link to 全量校验数据问题">​</a></h2>
<p><img decoding="async" loading="lazy" alt="FAQ-5" src="/assets/images/005-0e7984dd00f6804f7775929687d44b21.png" width="2806" height="1036" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何从-store-中-dump-数据">如何从 Store 中 dump 数据<a href="#如何从-store-中-dump-数据" class="hash-link" aria-label="Direct link to 如何从 Store 中 dump 数据" title="Direct link to 如何从 Store 中 dump 数据">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># checkpoint 是 unix 时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 17006 和 p_47qaxxxu8_source-000-0 看下图</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 可以根据表名、时间和字段内容定位到具体数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget &#x27;localhost:17006/p_47qaxxxsu8_source-000-0&#x27; --post-data &#x27;filter.conditions=*.*.*&amp;checkpoint=1667996779&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="FAQ-6" src="/assets/images/006-3040d92373ab905ad1b29f4b27e42d6c.png" width="1795" height="1836" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="典型使用场景和功能">典型使用场景和功能<a href="#典型使用场景和功能" class="hash-link" aria-label="Direct link to 典型使用场景和功能" title="Direct link to 典型使用场景和功能">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="多表汇聚">多表汇聚<a href="#多表汇聚" class="hash-link" aria-label="Direct link to 多表汇聚" title="Direct link to 多表汇聚">​</a></h3>
<p>源端分库分表迁移到目标端单表或者分区表，示例如下：</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 源表、主键 ID、UK 字段 uk_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> test_01</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uk_id </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> test_02</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uk_id </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 目标表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id_new </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uk_id </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id_new</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">uk_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token keyword" style="color:#00009f">unique</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uk_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uk_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITIONS </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>常见问题如下：</p>
<ul>
<li>
<p>创建数据迁移任务时，源端分表批量重命名</p>
<ul>
<li>
<p>使用 <strong>匹配规则</strong> 配置</p>
</li>
<li>
<p>使用配置 <code>src_schema.test_*=dst_schema.test</code></p>
</li>
</ul>
</li>
<li>
<p>源端 ID 自增字段，在源端多表中重复，目标表使用新的字段名称作为自增主键</p>
<ul>
<li>
<p>源表 ID 字段无需迁移到目标表，目标表中 id_new 字段为新的自增列</p>
</li>
<li>
<p>全量迁移时需要设置参数 <code>sink.ignoreRedunantColumnsReplicate=true</code>，全量迁移时 ID 字段将忽略</p>
</li>
<li>
<p>增量同步时需要设置 <code>sink.ignoreRedunantColumnsReplicate=true</code>，忽略 ID 字段</p>
</li>
</ul>
</li>
<li>
<p>目标端为分区表，OceanBase 数据库中 PK 字段必须包含分区字段，如何进行数据校验</p>
<ul>
<li>
<p>全量校验设置 <code>task.sourceMasterSection.matchAllColumn=false</code>，源表 ID 字段将不参与校验。此处要求源表具备不允许为 NULL 的 UK，否则无法校验。</p>
</li>
<li>
<p>全量校验设置 <code>inmod</code> 模式：<code>filter.verify.inmod.tables=.*;.*;.*</code>，详情请参见 <a href="https://www.oceanbase.com/docs/community-oms-cn-1000000001456854" target="_blank" rel="noopener noreferrer">Full-Verification 组件参数说明</a>。</p>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oceanbase-无主键迁移-隐藏列">OceanBase 无主键迁移-隐藏列<a href="#oceanbase-无主键迁移-隐藏列" class="hash-link" aria-label="Direct link to OceanBase 无主键迁移-隐藏列" title="Direct link to OceanBase 无主键迁移-隐藏列">​</a></h3>
<p>OceanBase 社区版作为源端时，对于无中间件表，OMS 社区版迁移会使用隐藏列作为主键迁移 <code>__pk_increment</code>，结构迁移时在目标表中会多出一列 <code>OMS_PK_INCRMT</code>。</p>
<ul>
<li>
<p>如果用户经过正向切换后，OMS_PK_INCRMT 最终会被删除</p>
</li>
<li>
<p>如果用户没有经过正向切换，并且该目标库作为下个任务的源库，此时会存在异常问题，需要您手动删除 <code>OMS_PK_INCRMT</code> 才能避免异常。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oceanbase-旁路导入">OceanBase 旁路导入<a href="#oceanbase-旁路导入" class="hash-link" aria-label="Direct link to OceanBase 旁路导入" title="Direct link to OceanBase 旁路导入">​</a></h3>
<p>旁路性能相关的参数，除了常用的并发外，还有一个额外的服务端并发参数可以设置：<code>sink.serverParallel</code>，默认值为 8。该参数会影响 OceanBase 服务端用于旁路任务的工作线程和并发。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="反向增量-1">反向增量<a href="#反向增量-1" class="hash-link" aria-label="Direct link to 反向增量" title="Direct link to 反向增量">​</a></h3>
<p>用户希望有回滚能力或者将原来的库作为备库使用。对于该类需求，建议您在创建数据迁移任务时勾选 <strong>反向增量</strong>。另外对于 MySQL 数据库作为源端时（例如 MySQL-&gt;OceanBase 社区版），请您在 MySQL 数据库中手动创建 OMS 社区版需要使用的事务库 <code>omstxndb</code>。如果不创建该事务库，会出现异常提示 <code>omstxndb</code> 库不存在。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="容灾双活">容灾双活<a href="#容灾双活" class="hash-link" aria-label="Direct link to 容灾  双活" title="Direct link to 容灾双活">​</a></h3>
<p>用户应用在需要双写或者灰度切换的情况下，可以使用 OMS 社区版的容灾双活功能。目前支持 MySQL-&gt;OceanBase 社区版、OceanBase 社区版-&gt; OceanBase 社区版的双活，OMS 社区版会自动设置防循环复制参数。请注意双活场景下，所有表必须都要有 PK 或者 UK。</p>
<ol>
<li>
<p>有两个库 A、B</p>
</li>
<li>
<p>应用按照一定规则将数据分别写入 A、B 库</p>
<p>非双写：应用写入 A 的数据，不会再写入 B，同样应用写入 B 的数据，不会再写入 A。</p>
</li>
<li>
<p>A、B 需要保留应用所有数据</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="FAQ-7" src="/assets/images/007-70ebe63098ce7303a63511fbb74bee39.png" width="1387" height="750" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="全量校验-2">全量校验<a href="#全量校验-2" class="hash-link" aria-label="Direct link to 全量校验" title="Direct link to 全量校验">​</a></h3>
<p>全量校验有两种模式：</p>
<ul>
<li>
<p>默认模式：源端和目标端都使用分片范围查询</p>
</li>
<li>
<p>inmod 模式：源端使用分片范围查询，目标端使用源端查询出来数据中的 PK/UK 再去目标端查询目标数据，配置项 <code>filter.verify.inmod.tables</code></p>
<p>示例如下：</p>
<ul>
<li>
<p>配置当前任务的所有表均使用 inmode 校验：<code>filter.verify.inmod.tables=.*;.*;.*</code></p>
</li>
<li>
<p>配置 D1 库下的 T1 表使用 inmode 校验：<code>filter.verify.inmod.tables=D1;T1;.*</code></p>
</li>
<li>
<p>配置 D1 库下的 T1 和 T2 表使用 inmode 校验：<code>filter.verify.inmod.tables=D1;T1;.*|D1;T2;.*</code></p>
</li>
<li>
<p>配置 D1 库下的 T1、T2 表和 D2 库下的 T3、T4 表使用 inmode 校验：<code>filter.verify.inmod.tables=D1;T1;.*|D1;T2;.*|D2;T3;.*|D2;T4;.*</code></p>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oms-社区版使用到的系统视图-创建任务时选表视图">OMS 社区版使用到的系统视图-创建任务时选表、视图<a href="#oms-社区版使用到的系统视图-创建任务时选表视图" class="hash-link" aria-label="Direct link to OMS 社区版使用到的系统视图-创建任务时选表、视图" title="Direct link to OMS 社区版使用到的系统视图-创建任务时选表、视图">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql">MySQL<a href="#mysql" class="hash-link" aria-label="Direct link to MySQL" title="Direct link to MySQL">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="系统表列表">系统表列表<a href="#系统表列表" class="hash-link" aria-label="Direct link to 系统表列表" title="Direct link to 系统表列表">​</a></h4>
<table><thead><tr><th>表/视图</th><th>描述</th></tr></thead><tbody><tr><td>information_schema.SCHEMATA</td><td>Schema 信息</td></tr><tr><td>information_schema.tables</td><td>表信息</td></tr><tr><td>information_schema.columns</td><td>字段信息</td></tr><tr><td>information_schema.STATISTICS</td><td>索引信息</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="查询-sql">查询 SQL<a href="#查询-sql" class="hash-link" aria-label="Direct link to 查询 SQL" title="Direct link to 查询 SQL">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SET TIME_ZONE=&#x27;%s&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET sql_mode=&#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET names &#x27;utf8mb4&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET foreign_key_checks = off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT version();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询所有 Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT CATALOG_NAME, SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME, SQL_PATH </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM `information_schema`.`SCHEMATA`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询所有表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT NULL,TABLE_SCHEMA,TABLE_NAME,TABLE_ROWS, TABLE_COLLATION, ENGINE </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM information_schema.tables WHERE TABLE_TYPE=&#x27;BASE TABLE&#x27; AND TABLE_SCHEMA NOT IN(&#x27;mysql&#x27;,&#x27;information_schema&#x27;,&#x27;performance_schema&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询表的数据库引擎信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT `ENGINE` FROM `information_schema`.`tables` WHERE TABLE_SCHEMA = &#x27;%s&#x27; AND TABLE_NAME = &#x27;%s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询表的字符集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TABLE_COLLATION FROM information_schema.tables WHERE TABLE_SCHEMA = &#x27;%s&#x27; AND TABLE_NAME = &#x27;%s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询字段信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT `COLUMN_NAME` ,upper(`COLUMN_TYPE`) ,`CHARACTER_MAXIMUM_LENGTH` ,`NUMERIC_PRECISION`,`NUMERIC_SCALE` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM information_schema.columns WHERE table_schema=? AND table_name=? ORDER BY ORDINAL_POSITION ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询所有视图</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TABLE_NAME, TABLE_SCHEMA, VIEW_DEFINITION FROM information_schema.views </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE TABLE_SCHEMA IN (&#x27;xx&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 存在记录 5.7 之后的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 只查询正常列，不含生成列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT `COLUMN_NAME` ,upper(`COLUMN_TYPE`) ,`CHARACTER_MAXIMUM_LENGTH` ,`NUMERIC_PRECISION`,`NUMERIC_SCALE` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM information_schema.columns WHERE table_schema=? AND table_name=? AND (GENERATION_EXPRESSION=&#x27;&#x27; or GENERATION_EXPRESSION is null) ORDER BY ORDINAL_POSITION ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 索引     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT INDEX_NAME,NON_UNIQUE,SEQ_IN_INDEX,COLUMN_NAME,SUB_PART FROM information_schema.STATISTICS WHERE table_schema=? AND table_name=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AND concat(index_schema,&#x27;.&#x27;,index_name) NOT IN (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT concat(index_schema,&#x27;.&#x27;,index_name) FROM information_schema.STATISTICS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE table_schema=? AND table_name=? AND upper(nullable)=&#x27;YES&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY INDEX_NAME ASC, SEQ_IN_INDEX ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询分区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TABLE_SCHEMA, TABLE_NAME,PARTITION_NAME,SUBPARTITION_NAME,PARTITION_METHOD,PARTITION_EXPRESSION,SUBPARTITION_METHOD,SUBPARTITION_EXPRESSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM information_schema.PARTITIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看约束情况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT  REFERENCED_TABLE_SCHEMA, REFERENCED_TABLE_NAME, TABLE_SCHEMA, TABLE_NAME, CONSTRAINT_NAME,REFERENCED_COLUMN_NAME, COLUMN_NAME FROM information_schema.KEY_COLUMN_USAGE </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oceanbase-数据库-mysql-租户">OceanBase 数据库 MySQL 租户<a href="#oceanbase-数据库-mysql-租户" class="hash-link" aria-label="Direct link to OceanBase 数据库 MySQL 租户" title="Direct link to OceanBase 数据库 MySQL 租户">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="系统表  列表-1">系统表列表<a href="#系统表列表-1" class="hash-link" aria-label="Direct link to 系统表列表" title="Direct link to 系统表列表">​</a></h4>
<table><thead><tr><th>表/试图</th><th>描述</th></tr></thead><tbody><tr><td>information_schema.SCHEMATA</td><td>Schema 信息</td></tr><tr><td>information_schema.tables</td><td>表信息</td></tr><tr><td>information_schema.columns</td><td>字段信息</td></tr><tr><td>information_schema.STATISTICS</td><td>索引信息</td></tr><tr><td>information_schema.PARTITIONS</td><td>分区信息</td></tr><tr><td>oceanbase.gv$memstore</td><td>内存使用信息</td></tr><tr><td>oceanbase.gv$sysstat</td><td>CPU 使用信息</td></tr><tr><td>oceanbase.gv$table</td><td>tableid</td></tr><tr><td>oceanbase.__tenant_virtual_table_index</td><td>索引</td></tr><tr><td>以下是宏块切片需要使用到的系统表</td><td></td></tr><tr><td>oceanbase.__all_tenant</td><td>租户信息</td></tr><tr><td>oceanbase.__all_database</td><td>20200 之前版本，数据库信息</td></tr><tr><td>oceanbase.__all_table</td><td>20200 之前版本，表信息</td></tr><tr><td>oceanbase.__all_part</td><td>20200 之前版本，分区信息</td></tr><tr><td>oceanbase.__all_meta_table</td><td>20200 之前版本，表的元数据信息</td></tr><tr><td>oceanbase.__all_virtual_database</td><td>20200 之后版本，数据库信息</td></tr><tr><td>oceanbase.__all_virtual_table</td><td>20200 之后版本，表信息</td></tr><tr><td>oceanbase.__all_virtual_proxy_partition</td><td>20200 之后版本，分区信息</td></tr><tr><td>oceanbase.__all_meta_table</td><td>20200 之后版本，表的元数据信息</td></tr><tr><td>oceanbase.__all_virtual_partition_item</td><td>二级分区信息</td></tr><tr><td>oceanbase.__all_virtual_partition_sstable_macro_info</td><td>宏块信息表</td></tr></tbody></table>
<blockquote>
<p>说明：</p>
<p>宏块信息需要使用系统租户查询</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="查询sql">查询SQL<a href="#查询sql" class="hash-link" aria-label="Direct link to 查询SQL" title="Direct link to 查询SQL">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询所有 Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT CATALOG_NAME, SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME, SQL_PATH </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM `information_schema`.`SCHEMATA`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询所有表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT NULL,TABLE_SCHEMA,TABLE_NAME,TABLE_ROWS, TABLE_COLLATION, ENGINE </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM information_schema.tables WHERE TABLE_TYPE=&#x27;BASE TABLE&#x27; AND TABLE_SCHEMA NOT IN(&#x27;mysql&#x27;,&#x27;information_schema&#x27;,&#x27;performance_schema&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询表的数据库引擎信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT `ENGINE` FROM `information_schema`.`tables` WHERE TABLE_SCHEMA = &#x27;%s&#x27; AND TABLE_NAME = &#x27;%s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 表的字符集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TABLE_COLLATION FROM information_schema.tables WHERE TABLE_SCHEMA = &#x27;%s&#x27; AND TABLE_NAME = &#x27;%s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 字段信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT `COLUMN_NAME` ,upper(`COLUMN_TYPE`) ,`CHARACTER_MAXIMUM_LENGTH` ,`NUMERIC_PRECISION`,`NUMERIC_SCALE` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM information_schema.columns WHERE table_schema=? AND table_name=? ORDER BY ORDINAL_POSITION ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 存在记录 5.7 之后的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 只查询正常列，不含生成列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT `COLUMN_NAME` ,upper(`COLUMN_TYPE`) ,`CHARACTER_MAXIMUM_LENGTH` ,`NUMERIC_PRECISION`,`NUMERIC_SCALE` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM information_schema.columns WHERE table_schema=? AND table_name=? AND (GENERATION_EXPRESSION=&#x27;&#x27; or GENERATION_EXPRESSION is null) ORDER BY ORDINAL_POSITION ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 索引     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT INDEX_NAME,NON_UNIQUE,SEQ_IN_INDEX,COLUMN_NAME,SUB_PART FROM information_schema.STATISTICS WHERE table_schema=? AND table_name=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AND concat(index_schema,&#x27;.&#x27;,index_name) NOT IN (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT concat(index_schema,&#x27;.&#x27;,index_name) FROM information_schema.STATISTICS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE table_schema=? AND table_name=? AND upper(nullable)=&#x27;YES&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY INDEX_NAME ASC, SEQ_IN_INDEX ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询分区信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT PARTITION_NAME,SUBPARTITION_NAME FROM information_schema.PARTITIONS WHERE TABLE_SCHEMA=&#x27;{}&#x27; AND TABLE_NAME=&#x27;{}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 分区字段表达式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT DISTINCT PARTITION_EXPRESSION,SUBPARTITION_EXPRESSION FROM information_schema.PARTITIONS WHERE TABLE_SCHEMA=? AND TABLE_NAME=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 以下 SQL 通过宏块信息切片 __all_virtual_partition_sstable_macro_info 相关的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询租户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT tenant_id FROM oceanbase.__all_tenant WHERE tenant_name = &#x27;%s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询表的索引</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT  key_name, NON_UNIQUE,SEQ_IN_INDEX,COLUMN_NAME,`null` nullable FROM oceanbase.__tenant_virtual_table_index WHERE table_id = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 获取表id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 20200 之前版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT %s b.table_id FROM oceanbase.__all_database a, oceanbase.__all_table b WHERE a.database_id = b.database_id AND a.tenant_id = %d AND a.database_name = &#x27;%s&#x27; AND b.table_name = &#x27;%s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 20200 之后版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT %s b.table_id FROM oceanbase.__all_virtual_database a, oceanbase.__all_virtual_table b WHERE a.database_id = b.database_id AND a.tenant_id = %d AND a.database_name = &#x27;%s&#x27; AND b.table_name = &#x27;%s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 获取分区信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 20200 之前版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT %s part_id,part_name FROM oceanbase.__all_part WHERE table_id = %d AND part_name IS NOT NULL AND part_name&lt;&gt;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 20200 之后版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT %s part_id,part_name FROM oceanbase.__all_virtual_proxy_partition WHERE table_id = %d AND part_name IS NOT NULL AND part_name&lt;&gt;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 获取子分区信息 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT %s partition_id,case when subpart_name is null then concat(part_name,&#x27;sp&#x27;,subpart_id) ELSE subpart_name END subpart_name FROM oceanbase.__all_virtual_partition_item WHERE table_id = %d AND partition_level&gt;1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询 tableid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT table_id FROM oceanbase.gv$table WHERE database_name=? AND table_name=?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 宏块信息查询，store_type=1正常的信息，store_type=4表示转储</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 20200 之前版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT %s partition_id OMS_PARTITION_ID,data_seq OMS_DATA_SEQ,macro_range OMS_MACRO_RANGE,row_count OMS_ROW_COUNT FROM oceanbase.__all_virtual_partition_sstable_macro_info  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE tenant_id=%d AND table_id = %d AND store_type=1 AND macro_range NOT LIKE &#x27;%%]always true&#x27; AND macro_range&lt;&gt;&#x27;(MIN ; MAX]&#x27; AND macro_range LIKE &#x27;%%]&#x27; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AND (svr_ip,svr_port,partition_id) IN (SELECT svr_ip, svr_port,partition_id FROM oceanbase.__all_meta_table </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE tenant_id=%d AND table_id = %d AND ROLE = 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY partition_id,data_seq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 20200 之后版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT %s partition_id OMS_PARTITION_ID,data_seq OMS_DATA_SEQ,macro_range OMS_MACRO_RANGE,row_count OMS_ROW_COUNT FROM oceanbase.__all_virtual_partition_sstable_macro_info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE tenant_id=%d AND table_id = %d AND store_type=1 AND macro_range NOT LIKE &#x27;%%]always true&#x27; AND macro_range&lt;&gt;&#x27;(MIN ; MAX]&#x27; AND macro_range LIKE &#x27;%%]&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AND (svr_ip,svr_port,partition_id) IN (SELECT svr_ip, svr_port,partition_id FROM oceanbase.__all_virtual_meta_table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE tenant_id=%d AND table_id = %d AND ROLE = 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY partition_id,data_seq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 内存防爆</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT /*+query_timeout(5000000)*/ total, freeze_trigger,mem_limit FROM oceanbase.gv$memstore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- CPU 防爆</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT min(100-round(cpu_usage.value * 100 / cpu_limit.value)) cpu_free_percent </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM oceanbase.gv$sysstat cpu_usage, oceanbase.gv$sysstat cpu_limit </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE cpu_usage.name = &#x27;cpu usage&#x27; AND cpu_limit.name = &#x27;max cpus&#x27; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AND cpu_usage.svr_ip = cpu_limit.svr_ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="Direct link to 其他" title="Direct link to 其他">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="热更-oceanbase-增量-cdc-库">热更 OceanBase 增量 CDC 库<a href="#热更-oceanbase-增量-cdc-库" class="hash-link" aria-label="Direct link to 热更 OceanBase 增量 CDC 库" title="Direct link to 热更 OceanBase 增量 CDC 库">​</a></h3>
<p>OceanBase 数据库的不同版本可能需要对应的 CDC 库才能拉取到增量日志数据，OMS 社区版的 Store 组件通过加载 CDC 动态库的方式来拉取 OceanBase 数据库的增量数据。</p>
<p>下表为 OMS 社区版 Store 组件和 OceanBase CDC 库相关的目录 <code>/home/ds/lib64/reader</code>。</p>
<table><thead><tr><th>OMS 社区版 Store 组件</th><th>OceanBase CDC 库</th></tr></thead><tbody><tr><td>ob-ce-reader</td><td>不可热更</td></tr><tr><td>ob-ce-4.x-reader</td><td>OceanBase 数据库 V4.0.0 及之后，V4.2.1 及之前版本</td></tr><tr><td>ob-ce-4.2.2-reader</td><td>OceanBase 数据库 V4.2.2 及之后，V4.3.0 及之前版本</td></tr><tr><td>ob-ce-4.3-reader</td><td>OceanBase 数据库 V4.3.0 及之后版本</td></tr></tbody></table>
<p>热更步骤如下：</p>
<ol>
<li>
<p><a href="https://www.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer">下载 CDC rpm 包</a>：增量数据获取工具（OB CDC）。</p>
</li>
<li>
<p>解压 rpm 包：<code>rpm2cpio oceanbase-ce-cdc-x.x.x.x-xxxx.el7.x86_64.rpm|cpio -idmu --quiet</code>。</p>
</li>
<li>
<p>解压后，当前目录 <code>./home/admin/oceanbase/lib64</code> 会出现下述文件。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">libobcdc.so.x.x.x.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libobcdc.so.x -&gt; libobcdc.so.x.x.x.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libobcdc.so -&gt; libobcdc.so.x</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>进入 OMS 社区版容器，并通过 <code>cd</code> 命令进入目录 <code>/home/ds/lib64/reader</code>，根据 OceanBase 数据库的版本号进入上述表格中的 <code>ob-ce-xxx-reader</code> 目录。</p>
</li>
<li>
<p>备份 <code>ob-ce-xxx-reader</code> 目录中的原文件。</p>
</li>
<li>
<p>将 rpm 包解压的 <code>./home/admin/oceanbase/lib64</code> 下面的文件复制到 <code>ob-ce-xxx-reader</code> 目录中。</p>
</li>
</ol>
<p>上述步骤完成后，新建的 Store 组件均会使用热更后的 CDC 库。如果已经存在的 Store 组件需要热更，请执行下述操作。</p>
<ol>
<li>
<p>进入 Store 组件的运行目录 <code>/home/ds/store/store{port}/lib64/reader</code>，下面的目录结构和 <code>/home/ds/lib64/reader</code> 下的目录一致。</p>
</li>
<li>
<p>将 rpm 解压的 <code>./home/admin/oceanbase/lib64</code> 下面的文件复制到 <code>/home/ds/store/store{port}/lib64/reader/ob-ce-xxx-reader</code>。</p>
</li>
<li>
<p>在 OMS 社区版控制台，暂停 Store 组件。详情请参见 <a href="https://www.oceanbase.com/docs/community-oms-cn-1000000001456958" target="_blank" rel="noopener noreferrer">暂停 Store 组件</a>。</p>
</li>
<li>
<p>执行下述命令，确认 Store 进程已经停止。如果 Store 进程未停止，则可以执行 <code>kill -9</code>。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ps -ef | grep store{port}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>在 OMS 社区版控制台，启动 Store 组件。</p>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/01_oms_troubleshooting_guide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/user_manual/operation_and_maintenance/zh-CN/emergency_handbook/how_to_ask"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OBServer 中其他非预期的报错</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/user_manual/operation_and_maintenance/zh-CN/tool_emergency_handbook/obd_troubleshooting_guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">社区版 OBD 问题排查手册</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#oms-问题排查思路" class="table-of-contents__link toc-highlight">OMS 问题排查思路</a></li><li><a href="#产品功能组件和日志位置说明" class="table-of-contents__link toc-highlight">产品功能、组件和日志位置说明</a><ul><li><a href="#结构迁移" class="table-of-contents__link toc-highlight">结构迁移</a></li><li><a href="#全量迁移" class="table-of-contents__link toc-highlight">全量迁移</a></li><li><a href="#增量同步" class="table-of-contents__link toc-highlight">增量同步</a></li><li><a href="#全量校验" class="table-of-contents__link toc-highlight">全量校验</a></li><li><a href="#正向切换" class="table-of-contents__link toc-highlight">正向切换</a></li><li><a href="#反向增量" class="table-of-contents__link toc-highlight">反向增量</a></li><li><a href="#管控相关组件" class="table-of-contents__link toc-highlight">管控相关组件</a></li></ul></li><li><a href="#安装阶段问题" class="table-of-contents__link toc-highlight">安装阶段问题</a></li><li><a href="#全量增量迁移性能调优" class="table-of-contents__link toc-highlight">全量/增量迁移性能调优</a><ul><li><a href="#并发jvm-内存每个分片记录数等问题" class="table-of-contents__link toc-highlight">并发、JVM 内存、每个分片记录数等问题</a></li><li><a href="#增量同步-1" class="table-of-contents__link toc-highlight">增量同步</a></li><li><a href="#metricslog-分析" class="table-of-contents__link toc-highlight">metrics.log 分析</a></li><li><a href="#增量延迟-疑似热点问题" class="table-of-contents__link toc-highlight">增量延迟-疑似热点问题</a></li><li><a href="#全量校验-1" class="table-of-contents__link toc-highlight">全量校验</a></li></ul></li><li><a href="#全量校验数据问题" class="table-of-contents__link toc-highlight">全量校验数据问题</a><ul><li><a href="#如何从-store-中-dump-数据" class="table-of-contents__link toc-highlight">如何从 Store 中 dump 数据</a></li></ul></li><li><a href="#典型使用场景和功能" class="table-of-contents__link toc-highlight">典型使用场景和功能</a><ul><li><a href="#多表汇聚" class="table-of-contents__link toc-highlight">多表汇聚</a></li><li><a href="#oceanbase-无主键迁移-隐藏列" class="table-of-contents__link toc-highlight">OceanBase 无主键迁移-隐藏列</a></li><li><a href="#oceanbase-旁路导入" class="table-of-contents__link toc-highlight">OceanBase 旁路导入</a></li><li><a href="#反向增量-1" class="table-of-contents__link toc-highlight">反向增量</a></li><li><a href="#容灾双活" class="table-of-contents__link toc-highlight">容灾双活</a></li><li><a href="#全量校验-2" class="table-of-contents__link toc-highlight">全量校验</a></li></ul></li><li><a href="#oms-社区版使用到的系统视图-创建任务时选表视图" class="table-of-contents__link toc-highlight">OMS 社区版使用到的系统视图-创建任务时选表、视图</a><ul><li><a href="#mysql" class="table-of-contents__link toc-highlight">MySQL</a></li><li><a href="#oceanbase-数据库-mysql-租户" class="table-of-contents__link toc-highlight">OceanBase 数据库 MySQL 租户</a></li></ul></li><li><a href="#其他" class="table-of-contents__link toc-highlight">其他</a><ul><li><a href="#热更-oceanbase-增量-cdc-库" class="table-of-contents__link toc-highlight">热更 OceanBase 增量 CDC 库</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/compilation/sig_intro">compilation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>