<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/routing_diagnosis" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Troubleshoot ODP Routing Issues | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/routing_diagnosis"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Troubleshoot ODP Routing Issues | OceanBase"><meta data-rh="true" name="description" content="This topic describes the background of the routing diagnostics feature, how to obtain diagnostic information, and how to locate and solve issues based on diagnostic information."><meta data-rh="true" property="og:description" content="This topic describes the background of the routing diagnostics feature, how to obtain diagnostic information, and how to locate and solve issues based on diagnostic information."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/routing_diagnosis"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/routing_diagnosis" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/routing_diagnosis" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H4XM2M50RX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-H4XM2M50RX",{})</script><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.65614b57.js" defer="defer"></script>
<script src="/assets/js/main.8fc986a8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><span><li><a class="dropdown__link" href="/docs/sig/overview/list">Special Interest Group(SIG)</a></li></span><span><li><a class="dropdown__link" href="/docs/honor/overview">Community Honors</a></li></span><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://discord.gg/74cF8vbNEs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Data + AI</a><ul class="dropdown__menu"><span><li><a href="https://oceanbase-devhub.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">AI Workshops<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/ai-workshop-2024" target="_blank" rel="noopener noreferrer" class="dropdown__link">RAG Bot<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/dify/dify@oceanbase-workshop" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dify (MySQL Compatible)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/DB-GPT/docker/compose_examples/ob_dbgpt_tutorial" target="_blank" rel="noopener noreferrer" class="dropdown__link">DB-GPT<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/about_this_manual/overview">About &quot;DBA Advanced Tutorial&quot;</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/high_availability_architecture_overview">Disaster Recovery Architecture Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/version_upgrade_path">Operation and Maintenance Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/scenario_best_practices/parameter_templates">Best Practice Scenarios</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/development_specification/object_specification">Development Specification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/emergency_handbook/emergency_overview">OBServer Emergency Handbook</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/oms_troubleshooting_guide">Community Tools Troubleshooting Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/oms_troubleshooting_guide">OMS Community Edition Troubleshooting Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction">ODP Community Edition Troubleshooting Manual</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction">Background Knowledge of ODP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/show_trace">Check Whether ODP Causes a Performance Bottleneck</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/connection_diagnosis">Troubleshoot ODP Connection Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/routing_diagnosis">Troubleshoot ODP Routing Issues</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Community Tools Troubleshooting Guide</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ODP Community Edition Troubleshooting Manual</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Troubleshoot ODP Routing Issues</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshoot ODP Routing Issues</h1></header><blockquote>
<p>This topic describes the background of the routing diagnostics feature, how to obtain diagnostic information, and how to locate and solve issues based on diagnostic information.</p>
</blockquote>
<p>OceanBase Database Proxy (ODP) serves as the access and routing layers of OceanBase Database and routing is its core feature. In earlier versions, routing issues are difficult to troubleshoot. Therefore, ODP V4.2.1 provides the routing diagnostics feature. This feature allows you to set diagnostic points during the routing process of an SQL statement in ODP to record key status information. The diagnostic points are then returned in logs or the result set.</p>
<p>You can analyze the diagnostic points to learn about the routing process of an SQL statement in ODP.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="routing-diagnostics-procedure">Routing Diagnostics Procedure<a href="#routing-diagnostics-procedure" class="hash-link" aria-label="Direct link to Routing Diagnostics Procedure" title="Direct link to Routing Diagnostics Procedure">​</a></h2>
<p>To use the routing diagnostics feature for troubleshooting, perform the following steps:</p>
<ol>
<li>
<p>Obtain diagnostic information. For more information, see the &quot;Obtain Diagnostic Information&quot; section of this topic.</p>
</li>
<li>
<p>Perform troubleshooting based on the diagnostic information. For more information, see the &quot;Overview&quot; section of this topic.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="obtain-diagnostic-information">Obtain Diagnostic Information<a href="#obtain-diagnostic-information" class="hash-link" aria-label="Direct link to Obtain Diagnostic Information" title="Direct link to Obtain Diagnostic Information">​</a></h2>
<p>This topic describes two methods for obtaining diagnostic information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="obtain-diagnostic-information-by-running-a-command">Obtain diagnostic information by running a command<a href="#obtain-diagnostic-information-by-running-a-command" class="hash-link" aria-label="Direct link to Obtain diagnostic information by running a command" title="Direct link to Obtain diagnostic information by running a command">​</a></h3>
<p>You can run the <code>explain route &lt;your_sql&gt;;</code> command to obtain the routing status information of an SQL statement. If the value of <code>route_diagnosis_level</code> is not <code>0</code>, this command will return detailed diagnostic information. The statement specified by <code>&lt;your_sql&gt;</code> will undergo the forwarding process in ODP without being actually forwarded to an OBServer node.</p>
<p><code>route_diagnosis_level</code> is a global parameter that controls how detailed the routing status information is. The value is an integer. The default value is <code>2</code>, which indicates that the output information can cover level-2 diagnostic points.</p>
<p>The value range of the <code>route_diagnosis_level</code> parameter is [0, 4]. A larger value indicates more detailed status information. The value <code>0</code> specifies to disable this module. When this module is disabled, it does not occupy the memory of ODP or affect the performance of ODP.</p>
<p>This command does not apply to the following statements:</p>
<ul>
<li>
<p>COM_STMT_PREPARE</p>
</li>
<li>
<p>COM_STMT_PREPARE_EXECUTE</p>
</li>
<li>
<p>COM_STMT_CLOSE</p>
</li>
<li>
<p>COM_STMT_RESET</p>
</li>
<li>
<p><code>PREPARE statement_name FROM preparable_SQL_statement;</code></p>
</li>
<li>
<p><code>{DEALLOCATE | DROP} PREPARE stmt_name;</code></p>
</li>
<li>
<p>Internal statements of ODP</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h4>
<p>Execute the <code>SELECT * FROM test.list_sub_parts_my_01 WHERE c3=&#x27;1999-09-09&#x27; AND c1=mod(1999,1000) AND c2=&#x27;tiger0&#x27;</code> statement to query a table that does not exist.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obclient</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> ROUTE </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">list_sub_parts_my_01 </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> c3</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;1999-09-09&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> c1</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">mod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1999</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> c2</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;tiger0&#x27;</span><span class="token plain">\G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">row</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route </span><span class="token keyword" style="color:#00009f">Plan</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trans </span><span class="token keyword" style="color:#00009f">First</span><span class="token plain"> Query:</span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM test.list_sub_parts_my_01&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trans </span><span class="token keyword" style="color:#00009f">Current</span><span class="token plain"> Query:</span><span class="token string" style="color:#e3116c">&quot;EXPLAIN ROUTE SELECT * FROM test.list_sub_parts_my_01 WHERE c3=&#x27;1999-09-09&#x27; AND c1=mod(1999,1000) AND c2=&#x27;tiger0&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Prompts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-----------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ROUTE_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Will </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">partition</span><span class="token plain"> location lookup </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> decide which OBServer </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> route </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> TABLE_ENTRY_LOOKUP_DONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">No</span><span class="token plain"> available entry because </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> entry lookup failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ROUTE_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Will route </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> cached connected server</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10.10</span><span class="token number" style="color:#36acaa">.10</span><span class="token number" style="color:#36acaa">.1</span><span class="token plain">:</span><span class="token number" style="color:#36acaa">4001</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route </span><span class="token keyword" style="color:#00009f">Plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-----------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SQL_PARSE:{cmd:</span><span class="token string" style="color:#e3116c">&quot;COM_QUERY&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">:</span><span class="token string" style="color:#e3116c">&quot;list_sub_parts_my_01&quot;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ROUTE_INFO:{route_info_type:</span><span class="token string" style="color:#e3116c">&quot;USE_PARTITION_LOCATION_LOOKUP&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> in_transaction:</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> LOCATION_CACHE_LOOKUP:{</span><span class="token keyword" style="color:#00009f">mode</span><span class="token plain">:</span><span class="token string" style="color:#e3116c">&quot;oceanbase&quot;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> TABLE_ENTRY_LOOKUP_START:{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FETCH_TABLE_RELATED_DATA:{table_entry:</span><span class="token string" style="color:#e3116c">&quot;partition information does not exist&quot;</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> TABLE_ENTRY_LOOKUP_DONE:{is_lookup_succ:</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entry_from_remote:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ROUTE_INFO:{route_info_type:</span><span class="token string" style="color:#e3116c">&quot;USE_CACHED_SESSION&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> svr_addr:</span><span class="token string" style="color:#e3116c">&quot;10.10.10.1:4001&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> in_transaction:</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> CONGESTION_CONTROL:{svr_addr:</span><span class="token string" style="color:#e3116c">&quot;10.10.10.1:4001&quot;</span><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result set is described as follows:</p>
<ul>
<li>
<p><code>Trans First Query</code>: the first statement in the transaction.</p>
</li>
<li>
<p><code>Trans Current Query</code>: the current statement in the transaction.</p>
</li>
<li>
<p><code>Route Prompts</code>: the description of steps in the routing process. Two types of prompts exist: <code>[INFO]</code> and <code>[WARN]</code>.</p>
<ul>
<li>
<p><code>[INFO]</code>: some information returned during normal routing to help you understand the routing process. In this example, <code>[INFO]</code> information is returned in the <code>ROUTE_INFO</code> section. The information indicates that ODP routes the request to an OBServer node based on the partition location.</p>
</li>
<li>
<p><code>[WARN]</code>: information returned when an exception occurs in a step of the routing process.</p>
</li>
</ul>
</li>
<li>
<p><code>Route Plan</code>: the forwarding process in ODP. <code>SQL_PARSE</code>, <code>ROUTE_INFO</code>, and <code>LOCATION_CACHE_LOOKUP</code> are diagnostic points. Diagnostic points can be at the same level or in hierarchical relationships and are displayed in a tree structure.</p>
</li>
</ul>
<p>The <code>FETCH_TABLE_RELATED_DATA:{table_entry:&quot;partition information does not exist&quot;}</code> information in the <code>Route Plan</code> section indicates that ODP queries the partition information about this table but no partition information exists.</p>
<p>In most cases, you can locate an issue based on the information returned in the <code>Route Prompts</code> and <code>Route Plan</code> sections.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="diagnostic-logs">Diagnostic logs<a href="#diagnostic-logs" class="hash-link" aria-label="Direct link to Diagnostic logs" title="Direct link to Diagnostic logs">​</a></h3>
<p>If an SQL statement meets any of the following conditions, ODP will record the actual routing process in the <code>obproxy_diagnosis.log</code> file.</p>
<ul>
<li>
<p>The statement is not an <code>EXPLAIN ROUTE executable_sql;</code> statement.</p>
</li>
<li>
<p>No partition is hit (<code>is_partition_hit = false</code>) or the value of <code>route_diagnosis_level</code> is <code>4</code>.</p>
</li>
</ul>
<p>The log level is WARN or TRACE, depending on the scenario of the current statement.</p>
<ul>
<li>
<p>WARN logs are recorded in the following cases:</p>
<ul>
<li>
<p>The current statement belongs to a distributed transaction.</p>
</li>
<li>
<p>The statement is the first statement of a transaction.</p>
</li>
</ul>
</li>
<li>
<p>TRACE logs are recorded in the following cases:</p>
<ul>
<li>
<p>The current statement belongs to a regular transaction.</p>
</li>
<li>
<p>The table name is left empty in the statement.</p>
</li>
<li>
<p>The length of the statement exceeds the value of <code>request_buffer_length</code>.</p>
</li>
<li>
<p>Partition key calculation fails.</p>
</li>
</ul>
</li>
</ul>
<p>The following command words are supported in diagnostic logs:</p>
<ul>
<li>
<p>COM_QUERY</p>
</li>
<li>
<p>COM_STMT_PREPARE_EXECUTE</p>
</li>
<li>
<p>COM_STMT_PREPARE</p>
</li>
<li>
<p>COM_STMT_SEND_PIECE_DATA</p>
</li>
<li>
<p>COM_STMT_GET_PIECE_DATA</p>
</li>
<li>
<p>COM_STMT_FETCH</p>
</li>
<li>
<p>COM_STMT_SEND_LONG_DATA</p>
</li>
<li>
<p>Non-internal statements of ODP</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples-1">Examples<a href="#examples-1" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h4>
<p>In the <code>obproxy_diagnosis.log</code> file, find the target row by keyword and replace &#x27;/n&#x27; with &#x27;\n&#x27; to obtain the diagnostic process in a tree structure.</p>
<p>The command is <code>grep &quot;some_key_word&quot; obproxy_diagnosis.log | sed &quot;s/\/n/\n/g&quot;</code>. Here is an example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ grep &quot;2023-08-17 16:56:46.521180&quot; obproxy_diagnosis.log | sed &quot;s/\/n/\n/g&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[2023-08-17 16:56:46.521180] [31792][Y0-00007F38DAAF34E0] [ROUTE]((*route_diagnosis=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trans Current Query:&quot;select * from test.range_sub_parts_my_01 where c1=22222 and c2=111111 and c3=abcd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; PARTITION_ID_CALC_DONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [WARN] Fail to calculate first part idx may use route policy or cached server session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; SQL_PARSE:{cmd:&quot;COM_QUERY&quot;, table:&quot;range_sub_parts_my_01&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO:{route_info_type:&quot;USE_PARTITION_LOCATION_LOOKUP&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; LOCATION_CACHE_LOOKUP:{mode:&quot;oceanbase&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; TABLE_ENTRY_LOOKUP_DONE:{table:&quot;range_sub_parts_my_01&quot;, table_id:1099511677778, partition_num:16, table_type:&quot;USER TABLE&quot;, entry_from_remote:false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; PARTITION_ID_CALC_START:{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; EXPR_PARSE:{col_val:[[0][&quot;c1&quot;, &quot;22222&quot;], [1][&quot;c2&quot;, &quot;111111&quot;], [2][&quot;c3&quot;, &quot;&quot;]]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; RESOLVE_EXPR:{error:-4002, sub_part_range:&quot;(111111,MIN ; 111111,MAX)&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt; RESOLVE_TOKEN:{resolve:{&quot;BIGINT&quot;:22222}, token_type:&quot;TOKEN_INT_VAL&quot;, token:&quot;22222&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt; RESOLVE_TOKEN:{resolve:{&quot;BIGINT&quot;:111111}, token_type:&quot;TOKEN_INT_VAL&quot;, token:&quot;111111&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt; RESOLVE_TOKEN:{error:-4002, , token_type:&quot;TOKEN_COLUMN&quot;, token:&quot;abcd&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; PARTITION_ID_CALC_DONE:{error:-4002, partition_id:-1, level:2, partitions:&quot;(p-1sp-1)&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_POLICY:{replica:&quot;10.10.10.1:50110&quot;, idc_type:&quot;SAME_IDC&quot;, zone_type:&quot;ReadWrite&quot;, role:&quot;FOLLOWER&quot;, type:&quot;FULL&quot;, chosen_route_type:&quot;ROUTE_TYPE_NONPARTITION_UNMERGE_LOCAL&quot;, route_policy:&quot;MERGE_IDC_ORDER_OPTIMIZED&quot;, trans_consistency:&quot;STRONG&quot;, session_consistency:&quot;STRONG&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; CONGESTION_CONTROL:{svr_addr:&quot;10.10.10.1:50110&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; HANDLE_RESPONSE:{is_parititon_hit:&quot;false&quot;, state:&quot;CONNECTION_ALIVE&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The diagnostic procedure is as follows:</p>
<ol>
<li>
<p>Based on the <code>[WARN] Fail to calculate first part idx may use route policy or cached server session</code> information in <code>PARTITION_ID_CALC_DONE</code>, partition ID calculation fails, and the request is routed based on the routing strategy or by reusing a session.</p>
</li>
<li>
<p>Check the data near the <code>PARTITION_ID_CALC_DONE</code> diagnostic point. The <code>RESOLVE_TOKEN:{error:-4002, , token_type:&quot;TOKEN_COLUMN&quot;, token:&quot;abcd&quot;}</code> information indicates that ODP encounters an error in parsing <code>c3=abcd</code>.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<blockquote>
<p>A diagnostic point describes a key procedure in the routing and forwarding process on ODP. You can view diagnostic points to learn about the routing and forwarding process. This topic describes how to troubleshoot issues based on diagnostic points.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-procedure">Troubleshooting procedure<a href="#troubleshooting-procedure" class="hash-link" aria-label="Direct link to Troubleshooting procedure" title="Direct link to Troubleshooting procedure">​</a></h3>
<p>After you obtain diagnostic information, you can perform different troubleshooting operations based on whether the routed request is in the transaction.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="request-in-the-transaction">Request in the transaction<a href="#request-in-the-transaction" class="hash-link" aria-label="Direct link to Request in the transaction" title="Direct link to Request in the transaction">​</a></h4>
<p>If a request in a transaction is inaccurately routed, two cases are involved.</p>
<ul>
<li>
<p>Distributed transaction routing</p>
<ul>
<li>
<p>If the current request is inaccurately routed, check the diagnostic points based on the diagnostic procedure.</p>
</li>
<li>
<p>If the current request is routed to the coordinator node, extract the SQL statement in <code>Trans First Query</code>, pass the statement to the <code>explain route</code> command to execute the statement again, and check the diagnostic points based on the diagnostic procedure.</p>
</li>
</ul>
</li>
<li>
<p>Non-distributed transaction routing</p>
<p>The current request is routed together with the first statement in the transaction. In this case, extract the SQL statement in <code>Trans First Query</code>, pass the statement to the <code>explain route</code> command to execute the statement again, and check the diagnostic points based on the diagnostic procedure.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="request-not-in-the-transaction">Request not in the transaction<a href="#request-not-in-the-transaction" class="hash-link" aria-label="Direct link to Request not in the transaction" title="Direct link to Request not in the transaction">​</a></h4>
<p>If an inaccurately routed request is not in a transaction, you can directly check the diagnostic points based on the diagnostic procedure.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="diagnostic-procedure">Diagnostic procedure<a href="#diagnostic-procedure" class="hash-link" aria-label="Direct link to Diagnostic procedure" title="Direct link to Diagnostic procedure">​</a></h3>
<p>After you obtain diagnostic information by running the <code>explain route</code> command or from diagnostic logs, you can check each diagnostic point based on the following procedure. For more information about the variables to diagnose at each diagnostic point, see the following topics of diagnostic points.</p>
<p>The following table summarizes the diagnostic points based on the execution sequence. A higher diagnostic level indicates more detailed diagnostic information.</p>
<main id="notice" type="explain"><h4>Note</h4><ul><li><p>Not all data of diagnostic points is recorded in logs or returned in the result set. Only data useful to the current situation is recorded or returned. </p></li><li><p>The <code>TABLE_ENTRY_LOOKUP_START</code> and <code>PARTITION_ID_CALC_START</code> diagnostic points have no data and are used only to maintain the tree structure of diagnostic points.</p></li></ul></main>
<table><thead><tr><th>Diagnostic phase</th><th>Diagnostic point</th><th>Diagnostic point level</th></tr></thead><tr><td>Syntax parsing</td><td>SQL_PARSE</td><td>1</td></tr><tr><td>Routing information acquisition</td><td>ROUTE_INFO</td><td>1</td></tr><tr><td rowspan="13">Replica location acquisition</td><td>LOCATION_CACHE_LOOKUP</td><td>1</td></tr><tr><td>ROUTINE_ENTRY_LOOKUP_DONE</td><td>2</td></tr><tr><td>TABLE_ENTRY_LOOKUP_START</td><td>2</td></tr><tr><td>FETCH_TABLE_RELATED_DATA</td><td>3</td></tr><tr><td>TABLE_ENTRY_LOOKUP_DONE</td><td>2</td></tr><tr><td>PARTITION_ID_CALC_START</td><td>2</td></tr><tr><td>EXPR_PARSE</td><td>3</td></tr><tr><td>CALC_ROWID</td><td>3</td></tr><tr><td>RESOLVE_EXPR</td><td>3</td></tr><tr><td>RESOLVE_TOKEN</td><td>4</td></tr><tr><td>CALC_PARTITION_ID</td><td>3</td></tr><tr><td>PARTITION_ID_CALC_DONE</td><td>2</td></tr><tr><td>PARTITION_ENTRY_LOOKUP_DONE</td><td>2</td></tr><tr><td>Node selection based on the routing strategy</td><td>ROUTE_POLICY</td><td>1</td></tr><tr><td>Replica access control</td><td>CONGESTION_CONTROL</td><td>1</td></tr><tr><td>Response handling</td><td>HANDLE_RESPONSE</td><td>1</td></tr><tr><td>Replica selection and retry</td><td>RETRY</td><td>1</td></tr></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="diagnostic-tips">Diagnostic tips<a href="#diagnostic-tips" class="hash-link" aria-label="Direct link to Diagnostic tips" title="Direct link to Diagnostic tips">​</a></h4>
<ul>
<li>
<p>Pay attention to the WARN information in <code>Route Prompts</code> and the diagnostic data near the corresponding diagnostic point.</p>
</li>
<li>
<p>Pay attention to the error information in <code>Route Plan</code>.</p>
</li>
<li>
<p>Set <code>route_diagnosis_level</code> to <code>4</code> and <code>monitor_log_level</code> to &#x27;TRACE&#x27; and view the diagnostic results of all user requests in the diagnostic logs.</p>
<p>For more information about <code>route_diagnosis_level</code>, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001736104" target="_blank" rel="noopener noreferrer">route_diagnosis_level</a>. For more information about <code>monitor_log_level</code>, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001736057" target="_blank" rel="noopener noreferrer">monitor_log_level</a>.</p>
</li>
</ul>
<p><strong><font color="red">Diagnostic points are not described here. These diagnostic points involve too much content related to the ODP workflow and specific implementations. If you can directly understand and analyze the diagnostic information obtained by using <code>EXPLAIN ROUTE</code> based on your background knowledge (mainly based on intuition), that would be great. If you cannot understand the information, record the diagnostic information obtained and contact the on-duty staff in the OceanBase community forum for assistance in troubleshooting. </font></strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples-2">Examples<a href="#examples-2" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2>
<p>This topic provides several examples to describe how to use the routing diagnostics feature in MySQL mode.</p>
<blockquote>
<p>The following examples assume that <code>route_diagnosis_level</code> is set to <code>4</code>.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-1-pspl-statement-call">Example 1: PS/PL statement call<a href="#example-1-pspl-statement-call" class="hash-link" aria-label="Direct link to Example 1: PS/PL statement call" title="Direct link to Example 1: PS/PL statement call">​</a></h3>
<p>If it is difficult to find the actually executed statement when a prepared statement (PS)/PL statement call is inaccurately routed, you can view the corresponding diagnostic logs.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[2023-09-19 18:48:49.079458] [106700][Y0-00007FD892AB64E0] [ROUTE]((*route_diagnosis=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trans Current Query:&quot;execute stmt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Prompts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] Will do table partition location lookup to decide which OBServer to route to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_POLICY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] Will route to table&#x27;s partition leader replica(10.10.10.1:4001) using non route policy because query for STRONG read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; SQL_PARSE:{cmd:&quot;COM_QUERY&quot;, table:&quot;t0&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO:{route_info_type:&quot;USE_PARTITION_LOCATION_LOOKUP&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; LOCATION_CACHE_LOOKUP:{mode:&quot;oceanbase&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; TABLE_ENTRY_LOOKUP_DONE:{table:&quot;t0&quot;, table_id:&quot;500078&quot;, table_type:&quot;USER TABLE&quot;, partition_num:64, entry_from_remote:false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; PARTITION_ID_CALC_START:{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; EXPR_PARSE:{col_val:&quot;=88888888,=1111111&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; RESOLVE_EXPR:{part_range:&quot;[88888888 ; 88888888]&quot;, sub_part_range:&quot;[1111111 ; 1111111]&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt; RESOLVE_TOKEN:{token_type:&quot;TOKEN_INT_VAL&quot;, resolve:&quot;BIGINT:88888888&quot;, token:&quot;88888888&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt; RESOLVE_TOKEN:{token_type:&quot;TOKEN_INT_VAL&quot;, resolve:&quot;BIGINT:1111111&quot;, token:&quot;1111111&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; CALC_PARTITION_ID:{part_description:&quot;partition by hash(INT&lt;binary&gt;) partitions 8 subpartition by hash(INT&lt;binary&gt;) partitions 8&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; PARTITION_ID_CALC_DONE:{partition_id:200073, level:2, partitions:&quot;(p0sp7)&quot;, parse_sql:&quot;prepare stmt from &#x27;insert into t0 values(88888888,1111111,9999999)&#x27;&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; PARTITION_ENTRY_LOOKUP_DONE:{leader:&quot;10.10.10.1:4001&quot;, entry_from_remote:false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_POLICY:{chosen_route_type:&quot;ROUTE_TYPE_LEADER&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; CONGESTION_CONTROL:{svr_addr:&quot;10.10.10.1:4001&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can find the output of the executed statement in the <code>parse_sql</code> field of the diagnostic information of the <code>PARTITION_ID_CALC_DONE</code> diagnostic point.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-2-partitioned-table-query">Example 2: Partitioned table query<a href="#example-2-partitioned-table-query" class="hash-link" aria-label="Direct link to Example 2: Partitioned table query" title="Direct link to Example 2: Partitioned table query">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="inaccurate-partitioned-table-based-routing-because-partitioning-key-values-are-not-provided">Inaccurate partitioned table-based routing because partitioning key values are not provided<a href="#inaccurate-partitioned-table-based-routing-because-partitioning-key-values-are-not-provided" class="hash-link" aria-label="Direct link to Inaccurate partitioned table-based routing because partitioning key values are not provided" title="Direct link to Inaccurate partitioned table-based routing because partitioning key values are not provided">​</a></h4>
<p>Assume that <code>t0</code> is a subpartitioned table and the executed statement <code>select * from t0 where c1=1</code> is inaccurately routed. Run the following command for routing diagnostics:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obclient</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> ROUTE </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> t0 </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> c1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">\G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Trans Current Query:&quot;select * from t0 where c1=1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Prompts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] Will do table partition location lookup to decide which OBServer to route to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; PARTITION_ID_CALC_DONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [WARN] Fail to use partition key value to calculate sub part idx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; SQL_PARSE:{cmd:&quot;COM_QUERY&quot;, table:&quot;t0&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO:{route_info_type:&quot;USE_PARTITION_LOCATION_LOOKUP&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; LOCATION_CACHE_LOOKUP:{mode:&quot;oceanbase&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; TABLE_ENTRY_LOOKUP_DONE:{table:&quot;t0&quot;, table_id:&quot;500078&quot;, table_type:&quot;USER TABLE&quot;, partition_num:64, entry_from_remote:false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; PARTITION_ID_CALC_START:{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; EXPR_PARSE:{col_val:&quot;c1=1&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; RESOLVE_EXPR:{part_range:&quot;[1 ; 1]&quot;, sub_part_range:&quot;(MIN ; MAX)always true&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; RESOLVE_TOKEN:{token_type:&quot;TOKEN_INT_VAL&quot;, resolve:&quot;BIGINT:1&quot;, token:&quot;1&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; CALC_PARTITION_ID:{error:-4002, part_description:&quot;partition by hash(INT&lt;binary&gt;) partitions 8 subpartition by hash(INT&lt;binary&gt;) partitions 8&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; PARTITION_ID_CALC_DONE:{error:-4002, partition_id:-1, level:2, partitions:&quot;(p1sp-1)&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check the diagnostic result.</p>
<ol>
<li>
<p>The <code>PARTITION_ID_CALC_DONE [WARN] Fail to use partition key value to calculate sub part idx</code> information in <code>Route Prompts</code> indicates that subpartition location calculation fails.</p>
</li>
<li>
<p>Check whether relevant information exists near <code>PARTITION_ID_CALC_DONE</code> in <code>Route Plan</code>.</p>
</li>
<li>
<p>The diagnostic information at the diagnostic point <code>RESOLVE_EXPR:{part_range:&quot;[1 ; 1]&quot;, sub_part_range:&quot;(MIN ; MAX)always true&quot;}</code> indicates that the subpartition range is <code>MIN:MAX</code>. Therefore, the subpartition location cannot be determined.</p>
</li>
<li>
<p>It can be deemed that subpartitioning key values are not provided in <code>Trans Current Query:&quot;select * from t0 where c1=1&quot;</code>.</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="inaccurate-partitioned-table-based-routing-when-partitioning-key-values-are-calculated-by-using-an-unsupported-expression">Inaccurate partitioned table-based routing when partitioning key values are calculated by using an unsupported expression<a href="#inaccurate-partitioned-table-based-routing-when-partitioning-key-values-are-calculated-by-using-an-unsupported-expression" class="hash-link" aria-label="Direct link to Inaccurate partitioned table-based routing when partitioning key values are calculated by using an unsupported expression" title="Direct link to Inaccurate partitioned table-based routing when partitioning key values are calculated by using an unsupported expression">​</a></h4>
<p>Assume that <code>t0</code> is a partitioned table and the executed statement <code>select * from t0 where c1=abs(-100.123);</code> is inaccurately routed. View the corresponding diagnostic log.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[2023-09-19 19:43:11.029616] [106683][Y0-00007FD890E544E0] [ROUTE]((*route_diagnosis=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trans Current Query:&quot;select * from t0 where c1=abs(-100.123)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Prompts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] Will do table partition location lookup to decide which OBServer to route to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; RESOLVE_TOKEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [WARN] Not support to resolve expr func(abs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; SQL_PARSE:{cmd:&quot;COM_QUERY&quot;, table:&quot;t0&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO:{route_info_type:&quot;USE_PARTITION_LOCATION_LOOKUP&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; LOCATION_CACHE_LOOKUP:{mode:&quot;oceanbase&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; TABLE_ENTRY_LOOKUP_DONE:{table:&quot;t0&quot;, table_id:&quot;500078&quot;, table_type:&quot;USER TABLE&quot;, partition_num:64, entry_from_remote:false}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; PARTITION_ID_CALC_START:{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; EXPR_PARSE:{col_val:&quot;c1=abs&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; RESOLVE_EXPR:{error:-5055, part_range:&quot;(MIN ; MAX)always true&quot;, sub_part_range:&quot;(MIN ; MAX)always true&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &gt; RESOLVE_TOKEN:{error:-5055, token_type:&quot;TOKEN_FUNC&quot;, token:&quot;abs&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; PARTITION_ID_CALC_DONE:{error:-5055, partition_id:-1, level:2, partitions:&quot;(p-1sp-1)&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO:{route_info_type:&quot;USE_CACHED_SESSION&quot;, svr_addr:&quot;10.10.10.1:4001&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; CONGESTION_CONTROL:{svr_addr:&quot;10.10.10.1:4001&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; HANDLE_RESPONSE:{is_parititon_hit:&quot;true&quot;, send_action:&quot;SERVER_SEND_REQUEST&quot;, state:&quot;CMD_COMPLETE&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the diagnostic result, the information <code>RESOLVE_TOKEN [WARN] Not support to resolve expr func(abs)</code> indicates that the abs expression fails to be parsed. As a result, the partitioning key values cannot be correctly calculated, leading to inaccurate routing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="strategy-based-routing">Strategy-based routing<a href="#strategy-based-routing" class="hash-link" aria-label="Direct link to Strategy-based routing" title="Direct link to Strategy-based routing">​</a></h3>
<p>Assume that the <code>SELECT 100 - max(round(total / mem_limit * 100)) FROM oceanbase.gv$ob_memstore</code> statement is not routed as expected. Run the following command for routing diagnostics:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">obclient</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> ROUTE </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> mem_limit </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gv$ob_memstore\G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Plan:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trans Current Query:&quot;EXPLAIN ROUTE SELECT 100 - max(round(total / mem_limit * 100)) FROM oceanbase.gv$ob_memstore&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Route Prompts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] Will do table partition location lookup to decide which OBServer to route to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; TABLE_ENTRY_LOOKUP_DONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] Non-partition table will be routed by ROUTE_POLICY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ROUTE_POLICY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] All OBServers treated as the SAME_IDC with OBProxy because &#x27;proxy_idc_name&#x27; is not configured</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INFO] Will route to routing type(NONPARTITION_UNMERGE_LOCAL) matched replica(10.10.10.1:4001) using default route policy MERGE_IDC_ORDER because query for STRONG read</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The information <code>[INFO] All OBServers treated as the SAME_IDC with OBProxy because &#x27;proxy_idc_name&#x27; is not configured</code> indicates that the <code>proxy_idc_name</code> parameter is not configured. Therefore, ODP considers that all OBServer nodes are in the same IDC. As a result, LDC-based routing becomes invalid.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li>
<p><a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001736148" target="_blank" rel="noopener noreferrer">Overview</a></p>
<blockquote>
<p>A complete ODP routing diagnostics document is available on the official website of OceanBase Database.</p>
<p>The content of this topic is based on the documentation on the official website, with some deletions and additions. Specifically, the introduction of each diagnostic point is deleted. Diagnostic points are used by OceanBase Technical Support and R&amp;D engineers for fault analysis. You do not need to dive deep into this, but feel free to gain a basic understanding if it interests you.</p>
</blockquote>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/04_routing_diagnosis.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/connection_diagnosis"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshoot ODP Connection Issues</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#routing-diagnostics-procedure" class="table-of-contents__link toc-highlight">Routing Diagnostics Procedure</a></li><li><a href="#obtain-diagnostic-information" class="table-of-contents__link toc-highlight">Obtain Diagnostic Information</a><ul><li><a href="#obtain-diagnostic-information-by-running-a-command" class="table-of-contents__link toc-highlight">Obtain diagnostic information by running a command</a></li><li><a href="#diagnostic-logs" class="table-of-contents__link toc-highlight">Diagnostic logs</a></li></ul></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#troubleshooting-procedure" class="table-of-contents__link toc-highlight">Troubleshooting procedure</a></li><li><a href="#diagnostic-procedure" class="table-of-contents__link toc-highlight">Diagnostic procedure</a></li></ul></li><li><a href="#examples-2" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#example-1-pspl-statement-call" class="table-of-contents__link toc-highlight">Example 1: PS/PL statement call</a></li><li><a href="#example-2-partitioned-table-query" class="table-of-contents__link toc-highlight">Example 2: Partitioned table query</a></li><li><a href="#strategy-based-routing" class="table-of-contents__link toc-highlight">Strategy-based routing</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/compilation/sig_intro">compilation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>