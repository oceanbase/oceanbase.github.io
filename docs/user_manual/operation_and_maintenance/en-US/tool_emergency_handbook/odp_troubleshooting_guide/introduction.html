<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Background Knowledge of ODP | OceanBase</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Background Knowledge of ODP | OceanBase"><meta data-rh="true" name="description" content="If you are not familiar with OceanBase Database Proxy (ODP) of OceanBase Database, we recommend that you quickly browse this document to understand the background knowledge related to ODP, before you read the troubleshooting manual of ODP Community Edition."><meta data-rh="true" property="og:description" content="If you are not familiar with OceanBase Database Proxy (ODP) of OceanBase Database, we recommend that you quickly browse this document to understand the background knowledge related to ODP, before you read the troubleshooting manual of ODP Community Edition."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction" hreflang="en"><link data-rh="true" rel="alternate" href="https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6JQM9QDU5V-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H4XM2M50RX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-H4XM2M50RX",{})</script><link rel="stylesheet" href="/assets/css/styles.7e3a93fe.css">
<script src="/assets/js/runtime~main.bf54e5d6.js" defer="defer"></script>
<script src="/assets/js/main.8fc986a8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="OceanBase Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OceanBase</b></a><a class="navbar__item navbar__link" href="/docs/blogs/arch/all-in-one">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Product Docs</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">User Manual</a><a class="sub-dropdown dropdown__link dropdown--hoverable" style="cursor:pointer">Developer Manual</a></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><span><li><a class="dropdown__link" href="/docs/sig/overview/list">Special Interest Group(SIG)</a></li></span><span><li><a class="dropdown__link" href="/docs/honor/overview">Community Honors</a></li></span><span><li><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussion<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://discord.gg/74cF8vbNEs" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Forum (in Chinese)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Data + AI</a><ul class="dropdown__menu"><span><li><a href="https://oceanbase-devhub.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">AI Workshops<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/ai-workshop-2024" target="_blank" rel="noopener noreferrer" class="dropdown__link">RAG Bot<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/dify/dify@oceanbase-workshop" target="_blank" rel="noopener noreferrer" class="dropdown__link">Dify (MySQL Compatible)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span><span><li><a href="https://oceanbase-devhub.github.io/DB-GPT/docker/compose_examples/ob_dbgpt_tutorial" target="_blank" rel="noopener noreferrer" class="dropdown__link">DB-GPT<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></span></ul><ul class="dropdown__menu" style="left:160px;display:none"></ul></div><a href="https://en.oceanbase.com/softwarecenter" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oceanbase" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/about_this_manual/overview">About &quot;DBA Advanced Tutorial&quot;</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/high_availability_architecture_overview">Disaster Recovery Architecture Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/version_upgrade_path">Operation and Maintenance Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/scenario_best_practices/parameter_templates">Best Practice Scenarios</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/development_specification/object_specification">Development Specification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_manual/operation_and_maintenance/en-US/emergency_handbook/emergency_overview">OBServer Emergency Handbook</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/oms_troubleshooting_guide">Community Tools Troubleshooting Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/oms_troubleshooting_guide">OMS Community Edition Troubleshooting Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction">ODP Community Edition Troubleshooting Manual</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/introduction">Background Knowledge of ODP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/show_trace">Check Whether ODP Causes a Performance Bottleneck</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/connection_diagnosis">Troubleshoot ODP Connection Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/routing_diagnosis">Troubleshoot ODP Routing Issues</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Community Tools Troubleshooting Guide</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ODP Community Edition Troubleshooting Manual</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Background Knowledge of ODP</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Background Knowledge of ODP</h1></header><blockquote>
<p>If you are not familiar with OceanBase Database Proxy (ODP) of OceanBase Database, we recommend that you quickly browse this document to understand the background knowledge related to ODP, before you read the troubleshooting manual of ODP Community Edition.</p>
<p><strong><font color="red">If you are pressed for time, you can just read the &quot;Benefits of ODP&quot; and &quot;Implementation logic of ODP routing&quot; sections of this topic. </font></strong></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-mind-map-for-odp">Troubleshooting Mind Map for ODP<a href="#troubleshooting-mind-map-for-odp" class="hash-link" aria-label="Direct link to Troubleshooting Mind Map for ODP" title="Direct link to Troubleshooting Mind Map for ODP">​</a></h2>
<p>If you already know about ODP and just want to troubleshoot the issues encountered during the use of ODP, you can go to the following sections based on the following figure.</p>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/000-b90fdbb8cbdee61472fc40df81521809.png" width="1812" height="504" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-odp">What is ODP<a href="#what-is-odp" class="hash-link" aria-label="Direct link to What is ODP" title="Direct link to What is ODP">​</a></h2>
<p>Although ODP adds a hop to the database access link, ODP serves as a proxy server that provides various features and benefits. See the following figure.</p>
<p><img decoding="async" loading="lazy" alt="Proxy" src="/assets/images/001-2ea771b767c0f89fa2e88430cd3454b7.png" width="1512" height="1000" class="img_ev3q"></p>
<p>As shown in the preceding figure, the application is a business application and is allocated with three ODP nodes that each run an obproxy process. In actual deployment, a load balancer such as F5, LVS, or Nginx is deployed between the ODP nodes and the application to distribute requests to the ODP nodes, to which OBServer nodes are connected. Six OBServer nodes are deployed in the sample deployment architecture.</p>
<p>The reasons why ODP is required are as follows:</p>
<ul>
<li>
<p>Data routing</p>
<p>ODP can obtain information about data distribution on OBServer nodes and forward an SQL statement of a user to the OBServer node where the required data is located. This improves execution efficiency. For example, ODP can forward the SQL statement <code>insert into t1 where c1 in P1</code> to the OBServer node that contains the leader named <code>P1</code> in Zone 2 and the SQL statement <code>update t1 where c1 in P2</code> to the OBServer node that contains the leader named <code>P2</code> in Zone 1.</p>
</li>
<li>
<p>Connection management</p>
<p>An OceanBase cluster containing a large number of OBServer nodes is highly susceptible to connection status changes caused by maintenance and OBServer node problems. If one of the preceding exceptions occurs when a client is directly connected to an OBServer node, the connection will be closed. ODP masks the complexity of distributed OBServer nodes. If a client is connected to ODP, ODP can ensure the stability of the connection and manage the status of OBServer nodes in complex business scenarios.</p>
</li>
</ul>
<p>Based on ODP, a distributed database can be used in a similar manner as a standalone database.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="benefits-of-odp">Benefits of ODP<a href="#benefits-of-odp" class="hash-link" aria-label="Direct link to Benefits of ODP" title="Direct link to Benefits of ODP">​</a></h2>
<p>ODP is a key component of OceanBase Database and provides the following benefits:</p>
<ul>
<li>
<p>High-performance forwarding</p>
<p>ODP is fully compatible with the MySQL protocol and supports the proprietary protocol of OceanBase. It adopts the multi-threaded asynchronous framework and transparent streaming forwarding to ensure high-performance data forwarding. In addition, it consumes minimal cluster resources.</p>
</li>
<li>
<p>Optimal routing</p>
<p>ODP fully considers the location of replicas that are included in each user request, read/write split routing strategy configured by each user, the optimal procedure for multi-region deployment of OceanBase Database, and the status and load of each OBServer node. ODP routes a user request to the optimal OBServer node and ensures the performance of OceanBase Database operations.</p>
</li>
<li>
<p>Connection management</p>
<p>For the physical connections of a client, ODP maintains its connections to multiple OBServer nodes at the backend. It also adopts the incremental synchronization solution based on version numbers to maintain the session status of connections to each OBServer node. This ensures efficient client access to each OBServer node.</p>
</li>
<li>
<p>Security and reliability</p>
<p>ODP supports data access by using SSL and is compatible with the MySQL protocol to meet the security requirements of users.</p>
</li>
<li>
<p>Easy O&amp;M</p>
<p>ODP is stateless and supports unlimited horizontal scale-out. It allows you to access multiple OceanBase clusters at the same time. You can monitor the status of OceanBase Database in real time by using various internal commands. This allows you to perform routine O&amp;M in an efficient manner.</p>
</li>
</ul>
<p>ODP Community Edition is fully open source under Mulan Public License, Version 2 (Mulan PubL v2). You can copy and use the source code free of charge. You must follow the requirements outlined in the license when you modify or distribute the source code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-performance-based-on-odp-routing">High Performance Based on ODP Routing<a href="#high-performance-based-on-odp-routing" class="hash-link" aria-label="Direct link to High Performance Based on ODP Routing" title="Direct link to High Performance Based on ODP Routing">​</a></h2>
<p>High performance is an important characteristic of OceanBase Database. Routing affects performance mainly in terms of network communication overheads. ODP reduces network communication overheads and improves overall performance by perceiving data distribution and geographic locations of servers. This section describes routing strategies in terms of performance.</p>
<p>This section answers the following three questions:</p>
<ul>
<li>
<p>What is the implementation logic of ODP routing?</p>
</li>
<li>
<p>What types of SQL execution plans are supported by ODP?</p>
</li>
<li>
<p>How can I view resource distribution information?</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-logic-of-odp-routing">Implementation logic of ODP routing<a href="#implementation-logic-of-odp-routing" class="hash-link" aria-label="Direct link to Implementation logic of ODP routing" title="Direct link to Implementation logic of ODP routing">​</a></h3>
<p>As an important feature of OceanBase Database, routing enables quick data access in a distributed architecture.</p>
<p>A partition is a basic unit of data storage in OceanBase Database. After a table is created, mappings between the table and its partitions are generated. A non-partitioned table is mapped to one partition. A partitioned table is mapped to multiple partitions.</p>
<p>Based on the routing feature, a query can be accurately routed to the OBServer node where the desired data is located. In addition, a read request without high consistency requirements can be routed to an OBServer node where a replica is located. This maximizes the usage of server resources. During the routing process, SQL statements, configuration rules, and OBServer node status are used as the input, and an available OBServer node IP address is generated as the output.</p>
<p>The following figure shows the routing logic.</p>
<p><img decoding="async" loading="lazy" alt="Routing logic" src="/assets/images/002-d78d4b8c673133837ed6d8938843797d.png" width="2468" height="1354" class="img_ev3q"></p>
<ol>
<li>
<p>Parse the SQL request and extract information.</p>
<p>The custom parser module of ODP is used to parse SQL statements. ODP needs only to parse the database names, table names, and hints in DML statements. No complex expression analysis is required.</p>
</li>
<li>
<p>Obtain location information from the location cache.</p>
<p>ODP obtains the location of the replica involved in the SQL request. ODP attempts to obtain the routing table first from the local cache and then from the global cache. If the preceding operations fail, ODP initiates an asynchronous query task to query the routing table from the OBServer node. ODP uses the trigger mechanism to update the routing table. ODP forwards SQL requests to corresponding OBServer nodes based on the routing table. If an OBServer node finds that it cannot process an SQL request, it places the feedback in the response packet and sends the packet to ODP. ODP determines whether to forcibly update the routing table in the local cache based on the feedback. Generally, the routing table changes only when an OBServer node undergoes a major compaction or when leader switchover is caused by load balancing.</p>
</li>
<li>
<p>Determine routing rules.</p>
<p>ODP must determine the optimal routing rule based on the actual situation. For example, DML requests for strong-consistency reads are routed to the OBServer node where the partition leader is located, whereas DML requests for weak-consistency reads and other requests are evenly distributed to the OBServer nodes where the leader and followers are located. If an OceanBase cluster is deployed across regions, ODP provides logical data center (LDC)-based routing to preferentially route requests to an OBServer node in the same IDC, then an OBServer node in the same region, and finally an OBServer node in a different region. If the OceanBase cluster adopts the read-write splitting mode, ODP provides rules such as RZ-first, RZ-only, and non-major-compaction-first. You can set these rules based on your business needs. Here, RZ refers to read-only zone. In practice, the previous rules can be combined to generate a specific routing rule.</p>
</li>
<li>
<p>Select a target OBServer node.</p>
<p>ODP selects an OBServer node from the obtained routing table based on the determined routing rule and forwards the request to the OBServer node after the OBServer node passes the blocklist and graylist checks.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="types-of-sql-execution-plans">Types of SQL execution plans<a href="#types-of-sql-execution-plans" class="hash-link" aria-label="Direct link to Types of SQL execution plans" title="Direct link to Types of SQL execution plans">​</a></h3>
<p>A partition is a basic unit for data storage. When you create a table, mappings between the table and its partitions are automatically created. A non-partitioned table is mapped to one partition, and a partitioned table can be mapped to multiple partitions. Each partition contains one leader and multiple followers. By default, data is read from and written to the leader.</p>
<p>In OceanBase Database, an execution plan is generated before an SQL statement is executed, and the executor schedules different operators for evaluation based on the execution plan. OceanBase Database supports local, remote, and distributed plans.</p>
<p>This section describes how to read data from a partition leader in strong-consistency mode based on the three types of execution plans.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-plan">Local plan<a href="#local-plan" class="hash-link" aria-label="Direct link to Local plan" title="Direct link to Local plan">​</a></h4>
<p>All partition leaders involved in an SQL statement with a local plan are stored on the OBServer node where the current session resides. The OBServer node does not need to interact with other nodes during execution of the SQL statement.</p>
<p><img decoding="async" loading="lazy" alt="Local plan" src="/assets/images/003-72e81403c48972b26b7578cb7bb0cb45.png" width="625" height="263" class="img_ev3q"></p>
<p>You can execute the <code>EXPLAIN</code> statement to query a local plan. The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">========================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|ID|OPERATOR   |NAME|EST. ROWS|COST    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|0 |HASH JOIN  |    |98010000 |66774608|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|1 | TABLE SCAN|T1  |100000   |68478   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|2 | TABLE SCAN|T2  |100000   |68478   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">========================================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="remote-plan">Remote plan<a href="#remote-plan" class="hash-link" aria-label="Direct link to Remote plan" title="Direct link to Remote plan">​</a></h4>
<p>All partition leaders involved in an SQL statement with a remote plan are stored on an OBServer node other than the one where the current session resides. The current OBServer node must forward the SQL statement or subplan.</p>
<p><img decoding="async" loading="lazy" alt="Remote plan" src="/assets/images/004-b8b0468c70cc5dfc1beb22be2bd4bdd0.png" width="1336" height="277" class="img_ev3q"></p>
<p>You can execute the <code>EXPLAIN</code> statement to query a remote plan, which contains <code>EXCHANGE REMOTE</code> operators. The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">==================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|ID|OPERATOR            |NAME|EST. ROWS|COST     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|0 |EXCHANGE IN REMOTE  |    |98010000 |154912123|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|1 | EXCHANGE OUT REMOTE|    |98010000 |66774608 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|2 |  HASH JOIN         |    |98010000 |66774608 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|3 |   TABLE SCAN       |T1  |100000   |68478    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|4 |   TABLE SCAN       |T2  |100000   |68478    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the preceding plan, Operator 0 <code>EXCHANGE IN REMOTE</code> and Operator 1 <code>EXCHANGE OUT REMOTE</code> execute operations on different OBServer nodes.</p>
<p>The OBServer node where Operator 0 resides generates a remote plan for an SQL statement forwarded by ODP, and forwards the SQL statement or the subplans generated by Operators 1 to 4 to the OBServer node where the partition leader resides.</p>
<p>The OBServer node where Operators 1 to 4 reside executes the <code>HASH JOIN</code> operation, and returns the result to the OBServer node where Operator 0 resides through Operator 1.</p>
<p>Finally, the OBServer node where Operator 0 resides receives the result through Operator 0, and further returns the result to the upper layer.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="distributed-plan">Distributed plan<a href="#distributed-plan" class="hash-link" aria-label="Direct link to Distributed plan" title="Direct link to Distributed plan">​</a></h4>
<p>A distributed plan does not define the relationship between partition leaders involved in the SQL statement and the current session. You can create a distributed plan for an SQL statement that needs to access multiple partitions with their leaders distributed on different OBServer nodes.</p>
<p>A distributed plan is scheduled in parallel execution mode and divided into multiple steps during scheduling. Each step is called a data flow operation (DFO).</p>
<p><img decoding="async" loading="lazy" alt="Distributed plan" src="/assets/images/005-f2280c30cffc012d79e0b8dc89aa2519.png" width="918" height="414" class="img_ev3q"></p>
<p>You can execute the <code>EXPLAIN</code> statement to query a distributed plan, which contains <code>EXCHANGE DISTR</code> operators. The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|ID|OPERATOR                     |NAME    |EST. ROWS|COST      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|0 |PX COORDINATOR               |        |980100000|1546175452|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|1 | EXCHANGE OUT DISTR          |:EX10002|980100000|664800304 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|2 |  HASH JOIN                  |        |980100000|664800304 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|3 |   EXCHANGE IN DISTR         |        |200000   |213647    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|4 |    EXCHANGE OUT DISTR (HASH)|:EX10000|200000   |123720    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|5 |     PX BLOCK ITERATOR       |        |200000   |123720    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|6 |      TABLE SCAN             |T1      |200000   |123720    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|7 |   EXCHANGE IN DISTR         |        |500000   |534080    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|8 |    EXCHANGE OUT DISTR (HASH)|:EX10001|500000   |309262    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|9 |     PX BLOCK ITERATOR       |        |500000   |309262    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|10|      TABLE SCAN             |T2      |500000   |309262    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All partition leaders involved in a local or remote plan reside on a single OBServer node. ODP is designed to use better-performing local plans instead of remote plans as much as possible.</p>
<p>Without ODP, an OBServer node must generate a remote plan for an SQL statement and then forward the remote plan. In this case, the SQL statement must be processed by the parser and the resolver, and the optimizer must rewrite the SQL statement and select an optimal execution plan. Even so, the forwarded plan may still be a subplan with high network transmission costs.</p>
<p>However, ODP can forward an SQL statement by simply parsing the SQL statement and obtaining partition information. For more information, see “Implementation logic of ODP routing”. The overall process is much simpler than that of the preceding method.</p>
<p>If you have a large number of SQL statements whose table-based routing types are remote plans, the routing of the SQL statements may be abnormal. You can check the <code>plan_type</code> column in the <code>oceanbase.GV$OB_SQL_AUDIT</code> view for verification. You can query the number of execution plans by type. Here is a sample SQL statement:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">oceanbase</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> plan_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> gv$ob_sql_audit </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request_time </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> time_to_usec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-08-24 18:00:00&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> plan_type</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| plan_type | count(1) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         1 |    17119 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         0 |     9614 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         3 |     4400 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         2 |    23429 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The value of <code>plan_type</code> can be <code>1</code>, <code>2</code>, or <code>3</code>, indicating a local plan, remote plan, or distributed plan, respectively. Generally, <code>0</code> indicates an SQL statement without a plan, for example, <code>set autocommit=0/1</code> and <code>commit</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resource-distribution-information">Resource distribution information<a href="#resource-distribution-information" class="hash-link" aria-label="Direct link to Resource distribution information" title="Direct link to Resource distribution information">​</a></h3>
<p>OceanBase Database uses ODP to provide SQL routing. This section first describes how to view the data locations for you to better understand the SQL routing strategies.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-locations-of-tenant-resource-units">View the locations of tenant resource units<a href="#view-the-locations-of-tenant-resource-units" class="hash-link" aria-label="Direct link to View the locations of tenant resource units" title="Direct link to View the locations of tenant resource units">​</a></h4>
<p>ODP must know the locations of tenant resources before it can accurately route SQL statements to optimal OBServer nodes. The locations are stored in the location cache. You can find the locations of tenant resources by using either of the following methods:</p>
<ul>
<li>
<p>Query resource locations from the <code>sys</code> tenant</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name resource_pool_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> unit_config_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">max_cpu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">min_cpu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">memory_size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> max_mem_gb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">memory_size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> min_mem_gb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unit_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svr_ip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">svr_port</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t4</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tenant_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t4</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tenant_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  __all_resource_pool t1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> __all_unit_config t2 </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unit_config_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unit_config_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> __all_unit t3 </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">resource_pool_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">resource_pool_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">left</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> __all_tenant t4 </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tenant_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t4</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tenant_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">resource_pool_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">unit_config_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unit_id</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------+-----------------------------------+---------+---------+------------+------------+---------+-------+--------------------+-----------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| resource_pool_name           | unit_config_name                  | max_cpu | min_cpu | max_mem_gb | min_mem_gb | unit_id | zone  | observer           | tenant_id | tenant_name   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------+-----------------------------------+---------+---------+------------+------------+---------+-------+--------------------+-----------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| sys_pool                     | config_sys_zone1_xiaofeng_sys_lpj |       3 |       3 |          6 |          6 |       1 | zone1 | xx.xxx.xx.20:22602 |         1 | sys           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| pool_for_tenant_mysql        | 2c2g                              |       2 |       2 |          2 |          2 |    1001 | zone1 | xx.xxx.xx.20:22602 |      1002 | mysql         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| pool_mysql_standby_zone1_xcl | config_mysql_standby_zone1_S1_xic |     1.5 |     1.5 |          6 |          6 |    1002 | zone1 | xx.xxx.xx.20:22602 |      1004 | mysql_standby |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------------------+-----------------------------------+---------+---------+------------+------------+---------+-------+--------------------+-----------+---------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Query resource locations from a user tenant</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> GV$OB_UNITS </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> tenant_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1002</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When you query resource locations from a business tenant, the <code>WHERE tenant_id=1002</code> clause can be omitted. This is because you can view only the information about the current tenant from a business tenant. The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+----------+---------+-----------+-------+-----------+------------+---------+---------+-------------+---------------------+---------------------+-------------+---------------+-----------------+------------------+--------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| SVR_IP       | SVR_PORT | UNIT_ID | TENANT_ID | ZONE  | ZONE_TYPE | REGION     | MAX_CPU | MIN_CPU | MEMORY_SIZE | MAX_IOPS            | MIN_IOPS            | IOPS_WEIGHT | LOG_DISK_SIZE | LOG_DISK_IN_USE | DATA_DISK_IN_USE | STATUS | CREATE_TIME                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+----------+---------+-----------+-------+-----------+------------+---------+---------+-------------+---------------------+---------------------+-------------+---------------+-----------------+------------------+--------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 1.2.3.4      |    22602 |    1001 |      1002 | zone1 | ReadWrite | sys_region |       2 |       2 |  1073741824 | 9223372036854775807 | 9223372036854775807 |           2 |    5798205850 |      4607930545 |         20971520 | NORMAL | 2023-11-20 11:09:55.668007 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+----------+---------+-----------+-------+-----------+------------+---------+---------+-------------+---------------------+---------------------+-------------+---------------+-----------------+------------------+--------+----------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-locations-of-partition-replicas">View the locations of partition replicas<a href="#view-the-locations-of-partition-replicas" class="hash-link" aria-label="Direct link to View the locations of partition replicas" title="Direct link to View the locations of partition replicas">​</a></h4>
<p>According to the implementation logic of ODP routing, ODP parses SQL statements to obtain table and partition information, and then obtains the locations of corresponding partition leaders based on the information.</p>
<p>OceanBase Database 4.x supports tenant-level replica management strategies. All tables of a tenant conform to the same primary zone rule. In the <code>sys</code> tenant, you can query tenant information from the <code>oceanbase.DBA_OB_TENANTS</code> view. Here is a sample statement:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DBA_OB_TENANTS</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE | LOCALITY      | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED | TENANT_ROLE | SWITCHOVER_STATUS | SWITCHOVER_EPOCH | SYNC_SCN            | REPLAYABLE_SCN      | READABLE_SCN        | RECOVERY_UNTIL_SCN  | LOG_MODE     | ARBITRATION_SERVICE_STATUS | UNIT_NUM | COMPATIBLE | MAX_LS_ID |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         1 | sys         | SYS         | 2024-04-10 10:48:59.526612 | 2024-04-10 10:48:59.526612 | RANDOM       | FULL{1}@zone1 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 |                NULL |                NULL |                NULL |                NULL | NOARCHIVELOG | DISABLED                   |        1 | 4.2.3.0    |         1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1001 | META$1002   | META        | 2024-04-10 10:49:30.029481 | 2024-04-10 10:50:27.254959 | zone1        | FULL{1}@zone1 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 |                NULL |                NULL |                NULL |                NULL | NOARCHIVELOG | DISABLED                   |        1 | 4.2.3.0    |         1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | mysql       | USER        | 2024-04-10 10:49:30.048284 | 2024-04-10 10:50:27.458529 | zone1        | FULL{1}@zone1 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1717384184174664001 | 1717384184174664001 | 1717384184174664001 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |        1 | 4.2.3.0    |      1001 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the <code>sys</code> tenant, you can query the partition locations of all tables under each tenant from the <code>oceanbase.cdb_ob_table_locations</code> view. Here is a sample statement:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cdb_ob_table_locations </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;t1&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+---------------+------------+----------+------------+----------------+-------------------+------------+---------------+-----------+-------+-------+--------------+----------+--------+--------------+-----------------+-----------+-----------------+---------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TENANT_ID | DATABASE_NAME | TABLE_NAME | TABLE_ID | TABLE_TYPE | PARTITION_NAME | SUBPARTITION_NAME | INDEX_NAME | DATA_TABLE_ID | TABLET_ID | LS_ID | ZONE  | SVR_IP       | SVR_PORT | ROLE   | REPLICA_TYPE | DUPLICATE_SCOPE | OBJECT_ID | TABLEGROUP_NAME | TABLEGROUP_ID | SHARDING |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+---------------+------------+----------+------------+----------------+-------------------+------------+---------------+-----------+-------+-------+--------------+----------+--------+--------------+-----------------+-----------+-----------------+---------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         1 | oceanbase     | t1         |   500010 | USER TABLE | NULL           | NULL              | NULL       |          NULL |    200003 |     1 | zone1 | xx.xxx.xx.20 |    22602 | LEADER | FULL         | NONE            |    500010 | NULL            |          NULL | NULL     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1002 | test          | t1         |   500087 | USER TABLE | NULL           | NULL              | NULL       |          NULL |    200049 |  1001 | zone1 | xx.xxx.xx.20 |    22602 | LEADER | FULL         | NONE            |    500087 | NULL            |          NULL | NULL     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      1004 | test          | t1         |   500003 | USER TABLE | NULL           | NULL              | NULL       |          NULL |    200001 |  1001 | zone1 | xx.xxx.xx.20 |    22602 | LEADER | FULL         | NONE            |    500003 | NULL            |          NULL | NULL     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+---------------+------------+----------+------------+----------------+-------------------+------------+---------------+-----------+-------+-------+--------------+----------+--------+--------------+-----------------+-----------+-----------------+---------------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 rows in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In a user tenant, you can query the partition locations of all tables under the current tenant from the <code>oceanbase.dba_ob_table_locations</code> view.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> database_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> table_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> table_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> table_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> svr_ip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> role </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> oceanbase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dba_ob_table_locations </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;t1&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+------------+----------+------------+-------+--------------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| database_name | table_name | table_id | table_type | zone  | svr_ip       | role   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+------------+----------+------------+-------+--------------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| test          | t1         |   500087 | USER TABLE | zone1 | xx.xxx.xx.20 | LEADER |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+------------+----------+------------+-------+--------------+--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="view-and-modify-ldc-settings">View and modify LDC settings<a href="#view-and-modify-ldc-settings" class="hash-link" aria-label="Direct link to View and modify LDC settings" title="Direct link to View and modify LDC settings">​</a></h4>
<p>LDC-based routing can resolve the issue of latency caused by remote routing when multiple IDCs are deployed across multiple regions in a distributed relational database.</p>
<p>As a typical high-availability distributed relational database system, OceanBase Database uses the Paxos protocol for log synchronization. OceanBase Database natively supports multi-region and multi-IDC deployment to ensure high disaster tolerance and reliability. However, every database deployed across multiple regions and IDCs has a latency issue caused by routing. OceanBase Database provides the LDC routing feature to address this issue. If the region and IDC attributes are specified for each zone in an OceanBase cluster and the IDC name attribute is specified for ODP, when a data request is sent to ODP, ODP will select an OBServer node in the following sequence: an OBServer node in the same IDC, an OBServer node in the same region, and a remote OBServer node. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177670" target="_blank" rel="noopener noreferrer">Strategy-based routing</a>.</p>
<p><img decoding="async" loading="lazy" alt="LDC" src="/assets/images/006-21f42ec4f48e22e631d8dabd0a2fb5d9.png" width="921" height="493" class="img_ev3q"></p>
<p>OceanBase Database allows you to modify the system variables to change the default routing strategies. For more information, see <a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001377970" target="_blank" rel="noopener noreferrer">SQL routing</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-availability-based-on-odp-routing">High Availability Based on ODP Routing<a href="#high-availability-based-on-odp-routing" class="hash-link" aria-label="Direct link to High Availability Based on ODP Routing" title="Direct link to High Availability Based on ODP Routing">​</a></h2>
<p>High availability means that OceanBase Database is tolerant of server faults, which makes the faults transparent and imperceptible to applications. When ODP finds that an OBServer node is faulty, it excludes the faulty node and selects a healthy node during routing. ODP also allows failed SQL statements to be retried. High availability is implemented by using fault detection, the blocklist mechanism, and the retry logic. As shown in the following figure, ODP adds the faulty OBServer node 1 to the blocklist and selects a healthy node during routing.</p>
<p><img decoding="async" loading="lazy" alt="High availability" src="/assets/images/007-17c271360e629c7e57cfe9638f72424b.png" width="621" height="465" class="img_ev3q"></p>
<p>You can design routing strategies based on the factors affecting data routing and the principles of data routing. In principle, the status and data distribution of OBServer nodes must be monitored in real time. However, this is almost impossible in practice. Therefore, the routing strategies must achieve a balance between functionality, performance, and high availability to make OceanBase Database easier to use.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="routing-features-and-strategies-of-odp">Routing Features and Strategies of ODP<a href="#routing-features-and-strategies-of-odp" class="hash-link" aria-label="Direct link to Routing Features and Strategies of ODP" title="Direct link to Routing Features and Strategies of ODP">​</a></h2>
<p>ODP allows you to access different servers of different tenants in different clusters through cluster routing, tenant routing, and intra-tenant routing. This section describes the routing features of ODP in terms of these three aspects.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-routing">Cluster routing<a href="#cluster-routing" class="hash-link" aria-label="Direct link to Cluster routing" title="Direct link to Cluster routing">​</a></h3>
<p>Cluster routing allows you to access different clusters. The key to cluster routing is to obtain the mapping between a cluster name and a RootService list.</p>
<ul>
<li>
<p>In the startup method in which the RootService list is specified by using a startup parameter, the mapping between a cluster name and the RootService list is also specified by using a startup parameter.</p>
</li>
<li>
<p>In the startup method in which the <code>config_server_url</code> parameter is specified, the mapping between a cluster name and a RootService list is obtained from the access URL.</p>
</li>
</ul>
<p>Note that the RootService list does not need to contain all the cluster servers. ODP obtains the list of servers in a cluster from a view. Generally, the RootService list contains servers where RootService is located.</p>
<p><img decoding="async" loading="lazy" alt="Cluster routing procedure" src="/assets/images/008-52f2040c33d045a59543bce2aaad4169.png" width="778" height="701" class="img_ev3q"></p>
<p>As can be seen from the preceding figure, OceanBase Cloud Platform (OCP) is a key module in cluster routing. If cluster routing issues occur in your production environment, check whether OCP operates properly.</p>
<p>ODP obtains the RootService list when you log in to access a cluster for the first time. ODP then saves the RootService list to the memory. In subsequent access to the cluster, ODP can obtain the RootService list from the memory.</p>
<p>Cluster routing allows you to access different clusters. Therefore, when you use ODP to connect to a cluster, you must specify <code>user_name</code>, <code>tenant_name</code>, as well as <code>cluster_name</code> in the command. If OceanBase Developer Center (ODC) is deployed, you must use ODP to connect to clusters. When you configure a connection string in ODC, you must also add <code>cluster_name</code> to the connection string. Here is an example (assuming that the IP address and port number of ODP are <code>127.0.0.1</code> and <code>2883</code>, respectively):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -h 127.0.0.1 -u user_name@tenant_name#cluster_name -P2883 -Ddatabase_name -pPASSWORD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you directly connect to an OBServer node without using ODP, you can specify <code>user_name</code> and <code>tenant_name</code> in the statement, without specifying <code>cluster_name</code>. Here is an example (assuming that the IP address and port number of OBServer node are <code>1.2.3.4</code> and <code>12345</code>):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -h 1.2.3.4 -u user_name@tenant_name -P12345 -Ddatabase_name -pPASSWORD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tenant-routing">Tenant routing<a href="#tenant-routing" class="hash-link" aria-label="Direct link to Tenant routing" title="Direct link to Tenant routing">​</a></h3>
<p>In OceanBase Database, a cluster has multiple tenants. The tenant routing feature of ODP allows you to access different tenants. Different from other tenants, the <code>sys</code> tenant is similar to an administrator tenant, and is related to cluster management. This section separately describes routing for the <code>sys</code> tenant and routing for a user tenant.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="routing-for-the-sys-tenant">Routing for the <code>sys</code> tenant<a href="#routing-for-the-sys-tenant" class="hash-link" aria-label="Direct link to routing-for-the-sys-tenant" title="Direct link to routing-for-the-sys-tenant">​</a></h4>
<p>After completing cluster routing, ODP obtains the RootService list of the cluster. In this case, ODP logs in to a server in the RootService list with the <code>proxyro@sys</code> account and obtains all the servers in the cluster from the <code>DBA_OB_SERVERS</code> view.</p>
<p>In the implementation of OceanBase Database, the <code>sys</code> tenant is distributed on each node. Therefore, the result retrieved from the <code>DBA_OB_SERVERS</code> view is the routing information of the <code>sys</code> tenant.</p>
<p>ODP accesses the <code>DBA_OB_SERVERS</code> view every 15 seconds to maintain the latest routing information and to perceive node changes in the cluster. In addition to the cluster server list, ODP also obtains information such as the partition distribution information, zone information, and tenant information from the <code>sys</code> tenant.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="routing-for-a-user-tenant">Routing for a user tenant<a href="#routing-for-a-user-tenant" class="hash-link" aria-label="Direct link to Routing for a user tenant" title="Direct link to Routing for a user tenant">​</a></h4>
<p>Unlike the routing information of the <code>sys</code> tenant, the routing information of a user tenant is about the servers where the tenant resources are located.</p>
<p>ODP does not obtain routing information of a user tenant from a unit-related table, but by using the special table name <code>__all_dummy</code>, which indicates a query for the tenant information. ODP obtains the server list of the tenant from the internal table <code>__all_virtual_proxy_schema</code>. For ODP to access the <code>__all_virtual_proxy_schema</code> table, you must specify the table name <code>__all_dummy</code> and the tenant name to obtain the node information of the tenant.</p>
<p><img decoding="async" loading="lazy" alt="Routing for a user tenant" src="/assets/images/009-d7532c147a4f56d5db952e6ce2bc0c25.png" width="974" height="802" class="img_ev3q"></p>
<p>ODP stores the obtained tenant information in the local memory and updates the cache information according to certain strategies. For the <code>sys</code> tenant, ODP initiates a pull task every 15 seconds to obtain the latest information. For user tenants, ODP refreshes the routing cache in accordance with the following strategies:</p>
<ul>
<li>
<p>Creation: When you access a user tenant for the first time, ODP accesses the <code>__all_virtual_proxy_schema</code> table to obtain the routing information of the tenant and creates the routing cache.</p>
</li>
<li>
<p>Eviction: ODP disables the cache when the OBServer node returns the <code>OB_TENANT_NOT_IN_SERVER</code> error code.</p>
</li>
<li>
<p>Update: ODP accesses the <code>__all_virtual_proxy_schema</code> table again to obtain the routing information of the user tenant when the cache is disabled.</p>
</li>
</ul>
<p>In summary, in the multi-tenant architecture, ODP obtains metadata information from the <code>sys</code> tenant. The routing information of the <code>sys</code> tenant is a list of servers in the cluster. Then, ODP obtains the routing information of tenants from the metadata information. With the tenant routing feature, ODP supports the multi-tenant architecture of OceanBase Database.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="intra-tenant-routing">Intra-tenant routing<a href="#intra-tenant-routing" class="hash-link" aria-label="Direct link to Intra-tenant routing" title="Direct link to Intra-tenant routing">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sql-routing-strategy-for-strong-consistency-reads">SQL routing strategy for strong-consistency reads<a href="#sql-routing-strategy-for-strong-consistency-reads" class="hash-link" aria-label="Direct link to SQL routing strategy for strong-consistency reads" title="Direct link to SQL routing strategy for strong-consistency reads">​</a></h5>
<p>ODP supports many routing strategies. This section describes a part of them from simple ones to complex ones.</p>
<ul>
<li>
<p>In the strong-consistency read strategy, ODP routes SQL statements to the node that hosts the leader replica of the accessed table partition. This strategy is easy to understand, but the routing of SQL statements can be complicated.</p>
</li>
<li>
<p>If an SQL statement accesses two tables, ODP will identify the node that hosts the leader replica of the accessed partition in the first table based on the first accessed table and its partitioning conditions. If the identification fails, ODP routes the SQL statement to a random node. Therefore, in an SQL statement that joins multiple tables, the order of tables can affect the routing strategy, which in turn affects the database performance.</p>
</li>
<li>
<p>When ODP needs to identify the node that hosts the leader of the accessed partition in a partitioned table, ODP checks whether the partitioning key is specified as an equivalence condition in the SQL statement. If not, ODP cannot identify the partition to be accessed. In this case, ODP routes the SQL statement to a random node that hosts a partition of the table.</p>
</li>
<li>
<p>When a transaction starts, the node to which the first SQL statement in the transaction is routed serves as the destination node of subsequent SQL statements in the transaction until the transaction is committed or rolled back.</p>
</li>
<li>
<p>After ODP routes an SQL statement to a node, the execution of the SQL statement is divided into the following three cases:</p>
<ul>
<li>
<p>Local execution: If the leader of the partition to be accessed exists on that node, the SQL statement is executed on that node based on a local execution plan. The value of the <code>plan_type</code> parameter is <code>1</code>.</p>
</li>
<li>
<p>Remote execution: If the leader of the partition to be accessed does not exist on that node, the SQL statement is forwarded by the OBServer node, and is executed on another node based on a remote execution plan. The value of the <code>plan_type</code> parameter is <code>2</code>.</p>
</li>
<li>
<p>Distributed execution: If replicas of the partition to be accessed are distributed on multiple nodes, the SQL statement is executed based on a distributed execution plan. The value of the <code>plan_type</code> parameter is <code>3</code>.</p>
</li>
</ul>
</li>
<li>
<p>If a transaction contains an SQL statement that reads a replicated table, and the SQL statement is routed to a node where a follower of the replicated table exists, the SQL statement can read the local follower. This is because all followers of the replicated table are strongly consistent with the leader. The SQL statement is executed based on a local execution plan.</p>
</li>
</ul>
<p>In real-world scenarios, complex SQL statements are often used. As a result, ODP uses complex routing strategies. Therefore, the routing result may be inaccurate. If the routing does not meet the design requirements, bugs will occur. However, the bugs may also be triggered by design. After all, the current version of ODP can parse only simple SQL statements, while OceanBase Database can parse complete execution plans.</p>
<p>When many complex business SQL statements are involved, remote and distributed SQL executions are unavoidable. In this case, you must note the proportions of remote and distributed SQL executions. If the proportions are large, the overall execution performance of business SQL statements will not be good. To improve the execution performance, you need to minimize remote and distributed SQL executions by using methods such as creating table groups, using replicated tables, and setting the <code>PRIMARY_ZONE</code> parameter.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sql-routing-strategy-for-weak-consistency-reads">SQL routing strategy for weak-consistency reads<a href="#sql-routing-strategy-for-weak-consistency-reads" class="hash-link" aria-label="Direct link to SQL routing strategy for weak-consistency reads" title="Direct link to SQL routing strategy for weak-consistency reads">​</a></h5>
<p>By default, OceanBase Database uses the strong-consistency read mode, which is also known as read-after-write consistency. This mode allows you to view changes right after you make the changes. In the strong-consistency read strategy, ODP routes SQL statements first to the node that hosts the leader replica of the accessed table partition.</p>
<p>Weak-consistency read is the opposite of strong-consistency read, which means that you cannot view the data right after you write the data. In the weak-consistency read strategy, ODP routes an SQL statement that accesses a table partition to a node that hosts the leader or follower replicas of the partition. Generally, ODP routes the SQL statement to a node that hosts three or more replicas.</p>
<p>However, if the LDC feature is enabled for both OceanBase Database and ODP, the SQL routing strategy for weak-consistency reads may change and an SQL statement is routed to a node in the following order:</p>
<ul>
<li>
<p>A node in the same IDC or region and not in the In Major Compaction state</p>
</li>
<li>
<p>A node in the same region and in the In Major Compaction state</p>
</li>
<li>
<p>A node in another region</p>
</li>
</ul>
<p>ODP prefers nodes that are not in the In Major Compaction state. However, if you disable rotating major compaction for an OceanBase cluster by setting the <code>enable_merge_by_turn</code> parameter to <code>false</code>, ODP cannot avoid nodes in the In Major Compaction state because all nodes are involved in major compaction.</p>
<p>In addition to SQL statements that are used for data access, some SQL statements are used for viewing or setting variable values. Here is an example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> @</span><span class="token variable" style="color:#36acaa">@autocommit</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">off</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;autocommit&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These SQL statements are routed to a random node. In the random routing strategy, if the LDC feature is enabled for OceanBase Database and ODP, SQL statements are also routed in the preceding order.</p>
<p>Generally, weak-consistency reads are used in scenarios where data reads and writes are separated. However, if the <code>PRIMARY_ZONE</code> parameter of a tenant is set to <code>RANDOM</code>, the leaders of all partitions of the tenant are distributed across all zones. In this case, the weak-consistency read strategy does not make much difference.</p>
<p>However, if you use read-only replicas and deploy the node that hosts read-only replicas in a separate IDC, you can deploy ODP in the same IDC to route SQL statements to the node that hosts the read-only replicas.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="other-routing-strategies">Other routing strategies<a href="#other-routing-strategies" class="hash-link" aria-label="Direct link to Other routing strategies" title="Direct link to Other routing strategies">​</a></h5>
<p>ODP supports many routing strategies. This section briefly describes a part of them. You can focus on the ODP routing strategies for strong-consistency reads and weak-consistency reads.</p>
<p>ODP supports the following intra-tenant routing strategies:</p>
<ul>
<li>
<p>IP address-based routing</p>
<p>In this mode, an OBServer node is specified by using the <code>target_db_server</code> parameter of ODP or by using a hint in the statement. ODP routes the statement to the specified OBServer node. This routing mode has the highest priority. If an IP address is specified, ODP will ignore other routing modes. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177666" target="_blank" rel="noopener noreferrer">IP address-based routing</a>.</p>
</li>
<li>
<p>Partitioned table-based routing for strong-consistency reads</p>
<p>In this mode, the partitioning key, partitioning key expression, or partition name is provided in a strong-consistency read statement on a partitioned table. ODP accurately routes the statement to the OBServer node that hosts the leader of the partition where the data resides. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177668" target="_blank" rel="noopener noreferrer">Partitioned table-based routing for strong-consistency reads</a>.</p>
</li>
<li>
<p>Global index table-based routing for strong-consistency reads</p>
<p>In this mode, the column value, value expression, or index partition name of the global index table is provided in a strong-consistency read statement on the primary table. ODP accurately routes the statement to the OBServer node that hosts the leader of the index partition where the data resides. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177667" target="_blank" rel="noopener noreferrer">Global index table-based routing for strong-consistency reads</a>.</p>
</li>
<li>
<p>Replicated table-based routing for strong-consistency reads</p>
<p>For a strong-consistency read statement on a replicated table, ODP routes the statement to the OBServer node nearest to ODP. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177669" target="_blank" rel="noopener noreferrer">Replication table-based routing for strong-consistency reads</a>.</p>
</li>
<li>
<p>Primary zone-based routing for strong-consistency reads</p>
<p>In this mode, the primary zone is configured by using an ODP parameter. ODP routes a strong-consistency read statement for which routing calculation cannot be performed to an OBServer node in the primary zone. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177672" target="_blank" rel="noopener noreferrer">Primary zone-based routing for strong-consistency reads</a>.</p>
</li>
<li>
<p>Strategy-based routing</p>
<p>ODP routes statements based on rules of the configured routing strategy. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177670" target="_blank" rel="noopener noreferrer">Strategy-based routing</a>.</p>
</li>
<li>
<p>Distributed transaction routing</p>
<p>After distributed transaction routing is enabled by using the ODP parameter <code>enable_transaction_internal_routing</code>, statements in a transaction do not need to be force routed to the OBServer node that starts the transaction. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177671" target="_blank" rel="noopener noreferrer">Distributed transaction routing</a>.</p>
</li>
<li>
<p>Rerouting</p>
<p>Rerouting is enabled by using an ODP parameter. After a statement is routed to an OBServer node, if no partition is hit or the distributed transaction cannot be executed on this OBServer node, ODP can accurately reroute the statement. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177675" target="_blank" rel="noopener noreferrer">Rerouting</a>.</p>
</li>
<li>
<p>Forcible routing</p>
<p>ODP decides whether to perform forcible routing. Forcible routing is performed in the following cases. For more information, see <a href="https://en.oceanbase.com/docs/common-odp-doc-en-10000000001177673" target="_blank" rel="noopener noreferrer">Forcible routing</a>.</p>
<ul>
<li>
<p>For non-distributed transaction routing, statements in a transaction are force routed to the OBServer node that starts the transaction.</p>
</li>
<li>
<p>For session-level temporary table-based routing, a query is force routed to the OBServer node where the temporary table is queried for the first time.</p>
</li>
<li>
<p>Session reuse-based routing: If routing calculation fails and the <code>enable_cached_server</code> parameter is set to <code>True</code>, ODP force routes a query to the OBServer node where the session resides the last time.</p>
</li>
<li>
<p>Cursor/Piece-based routing: When the client uses cursors/pieces to obtain/upload data, all requests are force routed to the same OBServer node.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li>Blog in the OceanBase community forum: <a href="https://open.oceanbase.com/blog/topics/3983484160" target="_blank" rel="noopener noreferrer">ODP: High-Performance Data Access Middleware</a>。</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/01_introduction.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/oms_troubleshooting_guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OMS Community Edition Troubleshooting Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/odp_troubleshooting_guide/show_trace"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Check Whether ODP Causes a Performance Bottleneck</div></a></nav><div>Loading...</div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#troubleshooting-mind-map-for-odp" class="table-of-contents__link toc-highlight">Troubleshooting Mind Map for ODP</a></li><li><a href="#what-is-odp" class="table-of-contents__link toc-highlight">What is ODP</a></li><li><a href="#benefits-of-odp" class="table-of-contents__link toc-highlight">Benefits of ODP</a></li><li><a href="#high-performance-based-on-odp-routing" class="table-of-contents__link toc-highlight">High Performance Based on ODP Routing</a><ul><li><a href="#implementation-logic-of-odp-routing" class="table-of-contents__link toc-highlight">Implementation logic of ODP routing</a></li><li><a href="#types-of-sql-execution-plans" class="table-of-contents__link toc-highlight">Types of SQL execution plans</a></li><li><a href="#resource-distribution-information" class="table-of-contents__link toc-highlight">Resource distribution information</a></li></ul></li><li><a href="#high-availability-based-on-odp-routing" class="table-of-contents__link toc-highlight">High Availability Based on ODP Routing</a></li><li><a href="#routing-features-and-strategies-of-odp" class="table-of-contents__link toc-highlight">Routing Features and Strategies of ODP</a><ul><li><a href="#cluster-routing" class="table-of-contents__link toc-highlight">Cluster routing</a></li><li><a href="#tenant-routing" class="table-of-contents__link toc-highlight">Tenant routing</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://github.com/oceanbase/oceanbase/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussion<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/oceanbase/shared_invite/zt-1e25oz3ol-lJ6YNqPHaKwY_mhhioyEuw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ask.oceanbase.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum (in Chinese)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">SIG</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/sig/AI/sig_intro">AI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/cloud-native/sig_intro">cloud-native</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/compilation/sig_intro">compilation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/develop-tools/sig_intro">develop-tools</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/miniob/sig_intro">MiniOB</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/obdiag/sig_intro">obdiag</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sig/operation/sig_intro">operation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://en.oceanbase.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About OceanBase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blogs/arch/all-in-one">Blogs</a></li><li class="footer__item"><a href="https://github.com/oceanbase/oceanbase" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OceanBase, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>