"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[839],{97156:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>h,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var s=r(74848),t=r(28453);const a={},o="\u4e3a\u73b0\u6709\u96c6\u7fa4\u589e\u52a0\u767d\u5c4f\u76d1\u63a7",i={id:"obd/user-guide/add-white-screen-monitoring",title:"\u4e3a\u73b0\u6709\u96c6\u7fa4\u589e\u52a0\u767d\u5c4f\u76d1\u63a7",description:"OBD \u81ea V1.6.0 \u5f00\u59cb\u652f\u6301 prometheus \u548c grafana \u7ec4\u4ef6\u7684\u90e8\u7f72\uff0c\u82e5\u60a8\u60f3\u4e3a\u4e4b\u524d\u90e8\u7f72\u7684\u96c6\u7fa4\u65b0\u589e\u767d\u5c4f\u76d1\u63a7\uff0c\u53ef\u53c2\u8003\u672c\u6587\u8fdb\u884c\u64cd\u4f5c\u3002",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/obd/300.user-guide/500.add-white-screen-monitoring.md",sourceDirName:"obd/300.user-guide",slug:"/obd/user-guide/add-white-screen-monitoring",permalink:"/zh-Hans/docs/obd/user-guide/add-white-screen-monitoring",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/obd/300.user-guide/500.add-white-screen-monitoring.md",tags:[],version:"current",sidebarPosition:500,frontMatter:{}},h={},c=[{value:"\u573a\u666f\u4e00\uff1a\u73b0\u6709\u96c6\u7fa4\u672a\u90e8\u7f72 OBAgent",id:"\u573a\u666f\u4e00\u73b0\u6709\u96c6\u7fa4\u672a\u90e8\u7f72-obagent",level:2},{value:"\u573a\u666f\u4e8c\uff1a\u73b0\u6709\u96c6\u7fa4\u5df2\u90e8\u7f72 OBAgent",id:"\u573a\u666f\u4e8c\u73b0\u6709\u96c6\u7fa4\u5df2\u90e8\u7f72-obagent",level:2},{value:"\u573a\u666f\u4e09\uff1a\u76d1\u63a7\u591a\u4e2a\u96c6\u7fa4\u5e76\u52a8\u6001\u540c\u6b65 OBAgent \u53d8\u5316",id:"\u573a\u666f\u4e09\u76d1\u63a7\u591a\u4e2a\u96c6\u7fa4\u5e76\u52a8\u6001\u540c\u6b65-obagent-\u53d8\u5316",level:2},{value:"\u4fee\u6539\u88ab\u76d1\u63a7\u96c6\u7fa4\u914d\u7f6e",id:"\u4fee\u6539\u88ab\u76d1\u63a7\u96c6\u7fa4\u914d\u7f6e",level:3}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"\u4e3a\u73b0\u6709\u96c6\u7fa4\u589e\u52a0\u767d\u5c4f\u76d1\u63a7",children:"\u4e3a\u73b0\u6709\u96c6\u7fa4\u589e\u52a0\u767d\u5c4f\u76d1\u63a7"}),"\n",(0,s.jsx)(n.p,{children:"OBD \u81ea V1.6.0 \u5f00\u59cb\u652f\u6301 prometheus \u548c grafana \u7ec4\u4ef6\u7684\u90e8\u7f72\uff0c\u82e5\u60a8\u60f3\u4e3a\u4e4b\u524d\u90e8\u7f72\u7684\u96c6\u7fa4\u65b0\u589e\u767d\u5c4f\u76d1\u63a7\uff0c\u53ef\u53c2\u8003\u672c\u6587\u8fdb\u884c\u64cd\u4f5c\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u6587\u5206\u4e3a\u4e09\u4e2a\u573a\u666f\u8fdb\u884c\u4ecb\u7ecd\uff0c\u60a8\u53ef\u6839\u636e\u6839\u636e\u81ea\u8eab\u96c6\u7fa4\u60c5\u51b5\u9009\u62e9\u5408\u9002\u7684\u573a\u666f\u53c2\u8003\u3002"}),"\n",(0,s.jsxs)("main",{id:"notice",type:"explain",children:[(0,s.jsx)("h4",{children:"\u8bf4\u660e"}),(0,s.jsxs)("p",{children:["\u672c\u6587\u6240\u63d0\u4f9b\u7684\u914d\u7f6e\u793a\u4f8b\u4ec5\u4f9b\u53c2\u8003\uff0c\u8be6\u7ec6\u914d\u7f6e\u53ca\u914d\u7f6e\u8bf4\u660e\u8bf7\u5207\u6362\u5230 ",(0,s.jsx)("code",{children:"/usr/obd/example"})," \u76ee\u5f55\u4e0b\u67e5\u770b\u5bf9\u5e94\u7ec4\u4ef6\u7684\u793a\u4f8b\u3002"]})]}),"\n",(0,s.jsx)(n.h2,{id:"\u573a\u666f\u4e00\u73b0\u6709\u96c6\u7fa4\u672a\u90e8\u7f72-obagent",children:"\u573a\u666f\u4e00\uff1a\u73b0\u6709\u96c6\u7fa4\u672a\u90e8\u7f72 OBAgent"}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u60a8\u73b0\u6709\u96c6\u7fa4\u672a\u90e8\u7f72 OBAgent \u65f6\uff0c\u82e5\u8981\u589e\u52a0\u767d\u5c4f\u76d1\u63a7\uff0c\u9700\u65b0\u5efa\u4e00\u4e2a\u5305\u542b obagent\u3001prometheus \u548c grafana \u7ec4\u4ef6\u7684\u96c6\u7fa4\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5176\u4e2d\uff0cOBAgent \u901a\u8fc7\u5355\u72ec\u7684\u914d\u7f6e\u6307\u5b9a\u7528\u4e8e\u91c7\u96c6 OceanBase \u6570\u636e\u5e93\u7684\u76d1\u63a7\u4fe1\u606f\uff1b\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u58f0\u660e Prometheus \u4f9d\u8d56\u4e8e obagent \u7ec4\u4ef6\uff0cGrafana \u4f9d\u8d56\u4e8e prometheus \u7ec4\u4ef6\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5177\u4f53\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# user:\r\n#   username: your username\r\n#   password: your password if need\r\n#   key_file: your ssh-key file path if need\r\n#   port: your ssh port, default 22\r\n#   timeout: ssh connection timeout (second), default 30\r\nobagent:\r\n  servers:\r\n    # Please don't use hostname, only IP can be supported\r\n    - 192.168.1.2\r\n    - 192.168.1.3\r\n    - 192.168.1.4\r\n  global:\r\n    # The working directory for obagent. obagent is started under this directory. This is a required field.\r\n    home_path: /root/obagent\r\n    # The port that pulls and manages the metrics. The default port number is 8088.\r\n    server_port: 8088\r\n    # Debug port for pprof. The default port number is 8089.\r\n    pprof_port: 8089\r\n    # Log level. The default value is INFO.\r\n    log_level: INFO\r\n    # Log path. The default value is log/monagent.log.\r\n    log_path: log/monagent.log\r\n    # Encryption method. OBD supports aes and plain. The default value is plain.\r\n    crypto_method: plain\r\n    # Path to store the crypto key. The default value is conf/.config_secret.key.\r\n    # crypto_path: conf/.config_secret.key\r\n    # Size for a single log file. Log size is measured in Megabytes. The default value is 30M.\r\n    log_size: 30\r\n    # Expiration time for logs. The default value is 7 days.\r\n    log_expire_day: 7\r\n    # The maximum number for log files. The default value is 10.\r\n    log_file_count: 10\r\n    # Whether to use local time for log files. The default value is true.\r\n    # log_use_localtime: true\r\n    # Whether to enable log compression. The default value is true.\r\n    # log_compress: true\r\n    # Username for HTTP authentication. The default value is admin.\r\n    http_basic_auth_user: ******\r\n    # Password for HTTP authentication. The default value is root.\r\n    http_basic_auth_password: ******\r\n    # Username for debug service. The default value is admin.\r\n    pprof_basic_auth_user: ******\r\n    # Password for debug service. The default value is root.\r\n    pprof_basic_auth_password: ******\r\n    # Monitor username for OceanBase Database. The user must have read access to OceanBase Database as a system tenant. The default value is root.\r\n    monitor_user: root\r\n    # Monitor password for OceanBase Database. The default value is empty. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the root_password in oceanbase-ce.\r\n    monitor_password: \r\n    # The SQL port for observer. The default value is 2881. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the mysql_port in oceanbase-ce.\r\n    sql_port: 2881\r\n    # The RPC port for observer. The default value is 2882. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the rpc_port in oceanbase-ce.\r\n    rpc_port: 2882\r\n    # Cluster name for OceanBase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the appname in oceanbase-ce.\r\n    cluster_name: obcluster\r\n    # Cluster ID for OceanBase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the cluster_id in oceanbase-ce.\r\n    cluster_id: 1\r\n    # Monitor status for OceanBase Database.  Active is to enable. Inactive is to disable. The default value is active. When you deploy an cluster automatically, OBD decides whether to enable this parameter based on depends.\r\n    ob_monitor_status: active\r\n    # Monitor status for your host. Active is to enable. Inactive is to disable. The default value is active.\r\n    host_monitor_status: active\r\n    # Whether to disable the basic authentication for HTTP service. True is to disable. False is to enable. The default value is false.\r\n    disable_http_basic_auth: false\r\n    # Whether to disable the basic authentication for the debug interface. True is to disable. False is to enable. The default value is false.\r\n    disable_pprof_basic_auth: false\r\n    # Synchronize the obagent-related information to the specified path of the remote host, as the targets specified by `file_sd_config` in the Prometheus configuration.\r\n    # For prometheus that depends on obagent, it can be specified to $home_path/targets of prometheus.\r\n    # For independently deployed prometheus, specify the files to be collected by setting `config` -> `scrape_configs` -> `file_sd_configs` -> `files`.For details, please refer to prometheus-only-example.yaml.\r\n    # target_sync_configs:\r\n    #   - host: 192.168.1.1\r\n    #     target_dir: /root/prometheus/targets\r\n    #     username: your username\r\n    #     password: your password if need\r\n    #     key_file: your ssh-key file path if need\r\n    #     port: your ssh port, default 22\r\n    #     timeout: ssh connection timeout (second), default 30\r\n  192.168.1.2:\r\n    # Zone name for your observer. The default value is zone1. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the zone name in oceanbase-ce.\r\n    zone_name: zone1\r\n  192.168.1.3:\r\n    # Zone name for your observer. The default value is zone1. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the zone name in oceanbase-ce.\r\n    zone_name: zone2\r\n  192.168.1.4:\r\n    # Zone name for your observer. The default value is zone1. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the zone name in oceanbase-ce.\r\n    zone_name: zone3\r\nprometheus:\r\n  depends:\r\n    - obagent\r\n  servers:\r\n    - 192.168.1.5\r\n  global:\r\n    home_path: /root/prometheus\r\ngrafana:\r\n  depends:\r\n    - prometheus\r\n  servers:\r\n    - 192.168.1.5\r\n  global:\r\n    home_path: /root/grafana\r\n    login_password: oceanbase\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u90e8\u7f72\u5e76\u542f\u52a8\u65b0\u96c6\u7fa4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"obd cluster deploy <new deploy name> -c new_config.yaml\r\nobd cluster start <new deploy name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u96c6\u7fa4\u542f\u52a8\u540e\uff0c\u6839\u636e\u5c55\u793a\u4fe1\u606f\u8bbf\u95ee Grafana \u9875\u9762\uff0c\u5373\u53ef\u67e5\u770b\u73b0\u6709\u96c6\u7fa4\u7684\u76d1\u63a7\u4fe1\u606f\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u573a\u666f\u4e8c\u73b0\u6709\u96c6\u7fa4\u5df2\u90e8\u7f72-obagent",children:"\u573a\u666f\u4e8c\uff1a\u73b0\u6709\u96c6\u7fa4\u5df2\u90e8\u7f72 OBAgent"}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u60a8\u73b0\u6709\u96c6\u7fa4\u5df2\u90e8\u7f72 OBAgent \u65f6\uff0c\u82e5\u8981\u589e\u52a0\u767d\u5c4f\u76d1\u63a7\uff0c\u9700\u65b0\u5efa\u4e00\u4e2a\u5305\u542b prometheus \u548c grafana \u7ec4\u4ef6\u7684\u96c6\u7fa4\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u6b64\u65f6\uff0c\u7531\u4e8e\u65e0\u6cd5\u58f0\u660e depends obagent\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u8fdb\u884c\u5173\u8054\u3002\u67e5\u770b\u539f\u6709\u96c6\u7fa4\u4e2d OBAgent \u5b89\u88c5\u76ee\u5f55\u4e0b ",(0,s.jsx)(n.code,{children:"conf/prometheus_config/prometheus.yaml"})," \u6587\u4ef6\uff0c\u5c06\u5bf9\u5e94\u7684\u914d\u7f6e\u590d\u5236\u5230\u65b0\u96c6\u7fa4\u914d\u7f6e\u4e2d prometheus \u7ec4\u4ef6\u7684 ",(0,s.jsx)(n.code,{children:"global"})," -> ",(0,s.jsx)(n.code,{children:"conifg"})," \u4e0b\u3002\u5177\u4f53\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# user:\r\n#   username: your username\r\n#   password: your password if need\r\n#   key_file: your ssh-key file path if need\r\n#   port: your ssh port, default 22\r\n#   timeout: ssh connection timeout (second), default 30\r\nprometheus:\r\n  servers:\r\n    - 192.168.1.5\r\n  global:\r\n    # The working directory for prometheus. prometheus is started under this directory. This is a required field.\r\n    home_path: /root/prometheus\r\n    config: # Configuration of the Prometheus service. The format is consistent with the Prometheus config file. Corresponds to the `config.file` parameter.\r\n      global:\r\n        scrape_interval: 1s\r\n        evaluation_interval: 10s\r\n\r\n      rule_files:\r\n        - \"rules/*rules.yaml\"\r\n\r\n      scrape_configs:\r\n        - job_name: prometheus\r\n          metrics_path: /metrics\r\n          scheme: http\r\n          static_configs:\r\n            - targets:\r\n                - 'localhost:9090'\r\n        - job_name: node\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/node/host\r\n          scheme: http\r\n          static_configs:\r\n            - targets:\r\n                - 192.168.1.2:8088\r\n        - job_name: ob_basic\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/ob/basic\r\n          scheme: http\r\n          static_configs:\r\n            - targets:\r\n                - 192.168.1.2:8088\r\n        - job_name: ob_extra\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/ob/extra\r\n          scheme: http\r\n          static_configs:\r\n            - targets:\r\n                - 192.168.1.2:8088\r\n        - job_name: agent\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/stat\r\n          scheme: http\r\n          static_configs:\r\n            - targets:\r\n                - 192.168.1.2:8088\r\ngrafana:\r\n  servers:\r\n    - 192.168.1.5\r\n  depends:\r\n    - prometheus\r\n  global:\r\n    home_path: /root/grafana\r\n    login_password: oceanbase # Grafana login password. The default value is 'oceanbase'.\n"})}),"\n",(0,s.jsxs)("main",{id:"notice",type:"explain",children:[(0,s.jsx)("h4",{children:"\u8bf4\u660e"}),(0,s.jsxs)("p",{children:["\u4e0a\u6587\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u4e2d ",(0,s.jsx)("code",{children:"basic_auth"})," \u914d\u7f6e\u9879\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u9700\u548c OBAgent \u914d\u7f6e\u6587\u4ef6\u4e2d http_basic_auth_xxx \u914d\u7f6e\u9879\u76f8\u5bf9\u5e94\u3002"]})]}),"\n",(0,s.jsx)(n.p,{children:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u90e8\u7f72\u65b0\u96c6\u7fa4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"obd cluster deploy <new deploy name> -c new_config.yaml\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u5c06 OBAgent \u5b89\u88c5\u76ee\u5f55\u4e0b ",(0,s.jsx)(n.code,{children:"conf/prometheus_config/rules"})," \u76ee\u5f55\u590d\u5236\u5230 Prometheus \u7684\u5b89\u88c5\u76ee\u5f55\u4e0b\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u542f\u52a8\u65b0\u96c6\u7fa4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"obd cluster start <new deploy name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u96c6\u7fa4\u542f\u52a8\u540e\uff0c\u6839\u636e\u5c55\u793a\u4fe1\u606f\u8bbf\u95ee Grafana \u9875\u9762\uff0c\u5373\u53ef\u67e5\u770b\u73b0\u6709\u96c6\u7fa4\u7684\u76d1\u63a7\u4fe1\u606f\u3002"}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)("h4",{children:"\u6ce8\u610f"}),(0,s.jsxs)("ol",{children:[(0,s.jsx)("li",{children:(0,s.jsxs)("p",{children:[(0,s.jsx)("code",{children:"scrape_configs"})," \u4e2d\u7684 Prometheus \u76d1\u63a7\u9879\u4e2d ",(0,s.jsx)("code",{children:"'localhost:9090'"})," \u9700\u8981\u6839\u636e\u5f53\u524d Prometheus \u7684\u76d1\u542c\u5730\u5740\u8fdb\u884c\u4fee\u6539\uff0c\u5982\u679c\u5f53\u524d Prometheus \u5f00\u542f\u4e86\u8ba4\u8bc1\uff0c\u4e5f\u9700\u8981\u5bf9\u5e94\u7684\u914d\u7f6e ",(0,s.jsx)("code",{children:"basic_auth"}),"\u3002\u8fd9\u91cc\u63d0\u5230\u7684\u76d1\u542c\u5730\u5740\u4e3a\u90e8\u7f72 Prometheus \u7684\u5730\u5740\uff0c\u5373 Prometheus \u914d\u7f6e\u4e2d\u7684 address \u548c port \u914d\u7f6e\u9879\u3002"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)("p",{children:["\u5982\u679c\u539f\u6709\u96c6\u7fa4\u7684 obagent \u8282\u70b9\u6709\u6240\u53d8\u5316\uff0c\u9700\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"obd cluster edit-config <new deploy name>"})," \u540c\u6b65 OBAgent \u5b89\u88c5\u76ee\u5f55\u4e0b ",(0,s.jsx)("code",{children:"conf/prometheus_config/prometheus.yaml"})," \u7684\u5185\u5bb9\u3002"]})})]})]}),"\n",(0,s.jsx)(n.h2,{id:"\u573a\u666f\u4e09\u76d1\u63a7\u591a\u4e2a\u96c6\u7fa4\u5e76\u52a8\u6001\u540c\u6b65-obagent-\u53d8\u5316",children:"\u573a\u666f\u4e09\uff1a\u76d1\u63a7\u591a\u4e2a\u96c6\u7fa4\u5e76\u52a8\u6001\u540c\u6b65 OBAgent \u53d8\u5316"}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u82e5\u5e0c\u671b Prometheus \u53ef\u4ee5\u91c7\u96c6\u591a\u4e2a\u96c6\u7fa4\u7684\u76d1\u63a7\u4fe1\u606f\uff0c\u6216\u8005\u52a8\u6001\u540c\u6b65 OBAgent \u7684\u53d8\u5316\uff0c\u53ef\u5728\u573a\u666f\u4e8c\u7684\u57fa\u7840\u4e0a\u505a\u5c11\u8bb8\u6539\u52a8\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5c06 Prometheus \u914d\u7f6e\u4e2d\u7684 ",(0,s.jsx)(n.code,{children:"static_configs"})," \u66ff\u6362\u4e3a ",(0,s.jsx)(n.code,{children:"file_sd_config"})," \u6765\u83b7\u53d6\u548c\u540c\u6b65 OBAgent \u7684\u8282\u70b9\u4fe1\u606f\u3002\u5982\u4e0b\u793a\u4f8b\u4e2d\u8868\u793a\u6536\u96c6 Prometheus \u5b89\u88c5\u76ee\u5f55\uff08",(0,s.jsx)(n.code,{children:"home_path"}),"\uff09\u4e0b targets \u76ee\u5f55\u4e0b\u7684\u6240\u6709 yaml \u6587\u4ef6\u3002"]}),"\n",(0,s.jsxs)("main",{id:"notice",type:"explain",children:[(0,s.jsx)("h4",{children:"\u8bf4\u660e"}),(0,s.jsxs)("p",{children:["Prometheus \u5b89\u88c5\u76ee\u5f55\u4e0b\u7684 targets \u76ee\u5f55\u9700\u5728\u539f\u6709\u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6\u4e2d obagent \u7ec4\u4ef6\u4e0b\u8fdb\u884c\u76f8\u5173\u914d\u7f6e\u624d\u4f1a\u88ab\u521b\u5efa\u3002\u5177\u4f53\u914d\u7f6e\u53c2\u89c1 ",(0,s.jsx)("a",{href:"#\u4fee\u6539\u88ab\u76d1\u63a7\u96c6\u7fa4\u914d\u7f6e",children:"\u4fee\u6539\u88ab\u76d1\u63a7\u96c6\u7fa4\u914d\u7f6e"}),"\u3002"]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# user:\r\n#   username: your username\r\n#   password: your password if need\r\n#   key_file: your ssh-key file path if need\r\n#   port: your ssh port, default 22\r\n#   timeout: ssh connection timeout (second), default 30\r\nprometheus:\r\n  servers:\r\n    - 192.168.1.5\r\n  global:\r\n    # The working directory for prometheus. prometheus is started under this directory. This is a required field.\r\n    home_path: /root/prometheus\r\n    config: # Configuration of the Prometheus service. The format is consistent with the Prometheus config file. Corresponds to the `config.file` parameter.\r\n      global:\r\n        scrape_interval: 1s\r\n        evaluation_interval: 10s\r\n\r\n      rule_files:\r\n        - \"rules/*rules.yaml\"\r\n\r\n      scrape_configs:\r\n        - job_name: prometheus\r\n          metrics_path: /metrics\r\n          scheme: http\r\n          static_configs:\r\n            - targets:\r\n                - 'localhost:9090'\r\n        - job_name: node\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/node/host\r\n          scheme: http\r\n          file_sd_configs:\r\n            - files:\r\n              - targets/*.yaml\r\n        - job_name: ob_basic\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/ob/basic\r\n          scheme: http\r\n          file_sd_configs:\r\n            - files:\r\n              - targets/*.yaml\r\n        - job_name: ob_extra\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/ob/extra\r\n          scheme: http\r\n          file_sd_configs:\r\n            - files:\r\n              - targets/*.yaml\r\n        - job_name: agent\r\n          basic_auth:\r\n            username: ******\r\n            password: ******\r\n          metrics_path: /metrics/stat\r\n          scheme: http\r\n          file_sd_configs:\r\n            - files:\r\n              - targets/*.yaml\r\ngrafana:\r\n  servers:\r\n    - 192.168.1.5\r\n  depends:\r\n    - prometheus\r\n  global:\r\n    home_path: /root/grafana\r\n    login_password: oceanbase # Grafana login password. The default value is 'oceanbase'.\n"})}),"\n",(0,s.jsxs)("main",{id:"notice",type:"explain",children:[(0,s.jsx)("h4",{children:"\u8bf4\u660e"}),(0,s.jsxs)("p",{children:["\u4e0a\u6587\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u4e2d ",(0,s.jsx)("code",{children:"basic_auth"})," \u914d\u7f6e\u9879\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u9700\u548c OBAgent \u914d\u7f6e\u6587\u4ef6\u4e2d http_basic_auth_xxx \u914d\u7f6e\u9879\u76f8\u5bf9\u5e94\u3002"]})]}),"\n",(0,s.jsx)(n.p,{children:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u90e8\u7f72\u65b0\u96c6\u7fa4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"obd cluster deploy <new deploy name> -c new_config.yaml\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u5c06 OBAgent \u5b89\u88c5\u76ee\u5f55\u4e0b\u7684 ",(0,s.jsx)(n.code,{children:"conf/prometheus_config/rules"})," \u76ee\u5f55\u590d\u5236\u5230 Prometheus \u7684\u5b89\u88c5\u76ee\u5f55\u4e0b\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u542f\u52a8\u65b0\u96c6\u7fa4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"obd cluster start <new deploy name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u90e8\u7f72\u597d\u65b0\u96c6\u7fa4\u540e\uff0c\u6839\u636e\u5c55\u793a\u4fe1\u606f\u8bbf\u95ee Grafana \u9875\u9762\uff0c\u6b64\u65f6\u65e0\u6cd5\u67e5\u770b\u88ab\u76d1\u63a7\u96c6\u7fa4\u7684\u76d1\u63a7\u4fe1\u606f\uff0c\u8fd8\u9700\u4fee\u6539\u88ab\u76d1\u63a7\u96c6\u7fa4\u7684 obagent \u914d\u7f6e\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"\u4fee\u6539\u88ab\u76d1\u63a7\u96c6\u7fa4\u914d\u7f6e",children:"\u4fee\u6539\u88ab\u76d1\u63a7\u96c6\u7fa4\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.p,{children:["\u82e5\u8981\u5728 Prometheus \u5b89\u88c5\u76ee\u5f55\u4e0b\u521b\u5efa targets \u76ee\u5f55\uff0c\u9700\u6267\u884c ",(0,s.jsx)(n.code,{children:"obd cluster edit-config <deploy name>"})," \u547d\u4ee4\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u589e\u52a0\u914d\u7f6e\u9879 ",(0,s.jsx)(n.code,{children:"target_sync_configs"})," \u6307\u5411 Prometheus \u5b89\u88c5\u76ee\u5f55\u4e0b\u7684 targets \u76ee\u5f55\uff08\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u5f53\u524d\u96c6\u7fa4\u7684 user \u914d\u7f6e\uff0c\u5982\u679c\u6709\u5dee\u522b\u53ef\u4ee5\u6309\u7167\u793a\u4f8b\u8fdb\u884c\u8bbe\u7f6e\uff09\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"obagent:\r\n  servers:\r\n    # Please don't use hostname, only IP can be supported\r\n    - 192.168.1.2\r\n    - 192.168.1.3\r\n    - 192.168.1.4\r\n  global:\r\n    ....\r\n    target_sync_configs:\r\n      - host: 192.168.1.5\r\n        target_dir: /root/prometheus/targets\r\n    #    username: your username\r\n    #    password: your password if need\r\n    #    key_file: your ssh-key file path if need\r\n    #    port: your ssh port, default 22\r\n    #    timeout: ssh connection timeout (second), default 30\r\n    ...\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\u9700\u6839\u636e\u63d0\u793a\u91cd\u542f\u96c6\u7fa4\uff0c\u91cd\u542f\u540e\u8bbf\u95ee Grafana \u9875\u9762\uff0c\u5373\u53ef\u67e5\u770b\u73b0\u6709\u96c6\u7fa4\u7684\u76d1\u63a7\u4fe1\u606f\u3002"}),"\n",(0,s.jsxs)("main",{id:"notice",type:"notice",children:[(0,s.jsx)("h4",{children:"\u6ce8\u610f"}),(0,s.jsxs)("ol",{children:[(0,s.jsx)("li",{children:(0,s.jsxs)("p",{children:[(0,s.jsx)("code",{children:"scrape_configs"})," \u4e2d\u7684 Prometheus \u76d1\u63a7\u9879\u4e2d ",(0,s.jsx)("code",{children:"'localhost:9090'"})," \u9700\u8981\u6839\u636e\u5f53\u524d Prometheus \u7684\u76d1\u542c\u5730\u5740\u8fdb\u884c\u4fee\u6539\uff0c\u5982\u679c\u5f53\u524d Prometheus \u5f00\u542f\u4e86\u8ba4\u8bc1\uff0c\u4e5f\u9700\u8981\u5bf9\u5e94\u7684\u914d\u7f6e ",(0,s.jsx)("code",{children:"basic_auth"}),"\u3002\u8fd9\u91cc\u63d0\u5230\u7684\u76d1\u542c\u5730\u5740\u4e3a\u90e8\u7f72 Prometheus \u7684\u5730\u5740\uff0c\u5373 Prometheus \u914d\u7f6e\u4e2d\u7684 address \u548c port \u914d\u7f6e\u9879\u3002"]})}),(0,s.jsx)("li",{children:(0,s.jsx)("p",{children:"\u88ab Prometheus \u91c7\u96c6\u7684 OBAgent \u7684 http \u7528\u6237\u540d\u5bc6\u7801\u9700\u8981\u4fdd\u6301\u4e00\u81f4\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\uff0c\u8bf7\u62c6\u5206\u91c7\u96c6\u9879\u3002"})})]})]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var s=r(96540);const t={},a=s.createContext(t);function o(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);