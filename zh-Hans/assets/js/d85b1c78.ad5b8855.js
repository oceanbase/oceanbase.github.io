"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[5283],{71923:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var s=r(74848),c=r(28453);const o={title:"OBServer \u8282\u70b9 core \u6389\u540e\u5982\u4f55\u6536\u96c6\u5806\u6808",weight:2},l="OBServer \u8282\u70b9 core \u6389\u540e\u5982\u4f55\u6536\u96c6\u5806\u6808",i={id:"trouble_shooting/collection_stack",title:"OBServer \u8282\u70b9 core \u6389\u540e\u5982\u4f55\u6536\u96c6\u5806\u6808",description:"\u672c\u6587\u4ecb\u7ecd OBServer \u8282\u70b9 core \u6389\u540e\u5982\u4f55\u6392\u67e5\u786e\u8ba4\uff0c\u5e76\u6536\u96c6\u5806\u6808\u3002",source:"@site/docs/trouble_shooting/collection_stack.md",sourceDirName:"trouble_shooting",slug:"/trouble_shooting/collection_stack",permalink:"/zh-Hans/docs/trouble_shooting/collection_stack",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/trouble_shooting/collection_stack.md",tags:[],version:"current",frontMatter:{title:"OBServer \u8282\u70b9 core \u6389\u540e\u5982\u4f55\u6536\u96c6\u5806\u6808",weight:2},sidebar:"legacySidebar",previous:{title:"SQL \u5ba1\u8ba1\u89c6\u56fe",permalink:"/zh-Hans/docs/performance_tuning/sql_audit"},next:{title:"OBServer \u5185\u5b58\u5360\u7528\u9ad8",permalink:"/zh-Hans/docs/trouble_shooting/observer_high_memory"}},t={},d=[{value:"<strong>\u95ee\u9898\u73b0\u8c61</strong>",id:"\u95ee\u9898\u73b0\u8c61",level:2},{value:"<strong>\u95ee\u9898\u6392\u67e5</strong>",id:"\u95ee\u9898\u6392\u67e5",level:2},{value:"<strong>\u6536\u96c6\u5806\u6808</strong>",id:"\u6536\u96c6\u5806\u6808",level:2},{value:"<strong>\u5b89\u88c5 debuginfo</strong>",id:"\u5b89\u88c5-debuginfo",level:3},{value:"<strong>\u6536\u96c6\u5806\u6808</strong>",id:"\u6536\u96c6\u5806\u6808-1",level:3},{value:"<strong>\u5806\u6808\u5206\u6790</strong>",id:"\u5806\u6808\u5206\u6790",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"observer-\u8282\u70b9-core-\u6389\u540e\u5982\u4f55\u6536\u96c6\u5806\u6808",children:(0,s.jsx)(n.strong,{children:"OBServer \u8282\u70b9 core \u6389\u540e\u5982\u4f55\u6536\u96c6\u5806\u6808"})}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u6587\u4ecb\u7ecd OBServer \u8282\u70b9 core \u6389\u540e\u5982\u4f55\u6392\u67e5\u786e\u8ba4\uff0c\u5e76\u6536\u96c6\u5806\u6808\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u95ee\u9898\u73b0\u8c61",children:(0,s.jsx)(n.strong,{children:"\u95ee\u9898\u73b0\u8c61"})}),"\n",(0,s.jsx)(n.p,{children:"\u6b63\u5e38\u8fd0\u884c\u7684 OBServer \u7a81\u7136\u5f02\u5e38\u9000\u51fa\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u95ee\u9898\u6392\u67e5",children:(0,s.jsx)(n.strong,{children:"\u95ee\u9898\u6392\u67e5"})}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u51e0\u79cd\u65b9\u6cd5\u6392\u67e5 OBServer \u662f\u5426 core \u6389\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u770b OBServer \u8fdb\u7a0b\u662f\u5426\u5b58\u5728\uff0c\u82e5\u8f93\u51fa\u4e3a 0 \u8868\u793a\u8fdb\u7a0b\u4e0d\u5b58\u5728\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@x.x.x.x ~]$ ps -ef | grep 3.1.5 | grep -v grep | wc -l\n0\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u67e5\u770b\u5bf9\u5e94\u7684 OBServer \u65e5\u5fd7\u91cc\u662f\u5426\u8f93\u51fa ",(0,s.jsx)(n.code,{children:"CRASH ERROR"})," \u5173\u952e\u5b57\uff0c\u5982\u4e0b\u6240\u793a\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'[root@x.x.x.x ~]$ grep "CRASH ERROR" /home/admin/ob3.1.5/log/observer.log\nCRASH ERROR!!! sig=11, sig_code=0, sig_addr=59ef, timestamp=1683513011732829, tid=27670, tname=observer, trace_id=0-0, extra_info=((null)), lbt=0x9bac9c8 0x9b9d248 0x2ac7a28ac62f 0x2ac7a2f8a9fd 0x2ac7a2f8a893 0x9461d97 0x22ed172 0x2ac7a2ee7554 0x22ebe28\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u67e5\u770b\u5bf9\u5e94\u7684 OBServer \u673a\u5668 ",(0,s.jsx)(n.code,{children:"/etc/sysctl.conf"})," \u6587\u4ef6\u4e2d\u6307\u5b9a\u7684 kernel.core_pattern \u4f4d\u7f6e\u662f\u5426\u751f\u6210\u5bf9\u5e94\u7684 core \u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'[root@x.x.x.x ~]$ grep "kernel.core_pattern" /etc/sysctl.conf\nkernel.core_pattern = /home/admin/core_test/core-%e-%p-%t\n\n[root@x.x.x.x ~]$ ls -l /home/admin/core_test/core-observer-27670-1683513011\n-rw------- 1 admin admin 8723914752 5\u6708   8 10:30 /home/admin/core_test/core-observer-27670-1683513011\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u8bf4\u660e"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u6ca1\u6709\u6307\u5b9a kernel.core_pattern\uff0c\u9ed8\u8ba4\u4f1a\u5728 OceanBase \u6570\u636e\u5e93\u7684 ",(0,s.jsx)(n.code,{children:"home_path"})," \u8def\u5f84\u4e0b\u751f\u6210 ",(0,s.jsx)(n.code,{children:"core.${ob_pid}"})," \u7684\u6587\u4ef6\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7 ulimit -a \u6216\u8005 ulimit -c \u67e5\u770b\u5f53\u524d\u8d44\u6e90\u7684\u9650\u5236\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a 0 \u6216\u8005\u5f88\u5c0f\u5219\u4f1a\u5728\u53d1\u751f\u8282\u70b9 core \u65f6\u65e0\u6cd5\u751f\u4ea7 core \u6587\u4ef6\u7684\u60c5\u51b5\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6536\u96c6\u5806\u6808",children:(0,s.jsx)(n.strong,{children:"\u6536\u96c6\u5806\u6808"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b89\u88c5-debuginfo",children:(0,s.jsx)(n.strong,{children:"\u5b89\u88c5 debuginfo"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u6536\u96c6\u5806\u6808\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b89\u88c5\u4e00\u4e0b oceanbase-ce-debuginfo \u5305\u3002"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u6ce8\u610f"})}),"\n",(0,s.jsxs)(n.p,{children:["\u9700\u5b89\u88c5\u5bf9\u5e94 OceanBase \u6570\u636e\u5e93\u7248\u672c\u7684 oceanbase-ce-debuginfo \u5305\uff0c\u6bd4\u5982\u5f53\u524d\u4f7f\u7528\u7684 OceanBase \u6570\u636e\u5e93\u7248\u672c\u4e3a\uff1a",(0,s.jsx)(n.code,{children:"Server version: 5.7.25 OceanBase 3.1.5 (r100000252023041721-6d73a6764190f46bbc0805dc27eea5ab08e1920c) (Built Apr 17 2023 21:10:15)"}),"\uff0c\u5219\u4e0b\u8f7d\u5bf9\u5e94\u7684 V3.1.5 \u7248\u672c oceanbase-ce-debuginfo \u5305\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u4e0b\u8f7d\u7684 oceanbase-ce-debuginfo \u5305"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"wget https://mirrors.aliyun.com/oceanbase/community/stable/el/7/x86_64/oceanbase-ce-debuginfo-3.1.5-100000252023041721.el7.x86_64.rpm\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5b89\u88c5 debuginfo"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"yum install oceanbase-ce-debuginfo-3.1.5-100000252023041721.el7.x86_64.rpm -y\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u6267\u884c\u5b89\u88c5\u547d\u4ee4\u65f6\u63d0\u793a\u5982\u4e0b\u5185\u5bb9\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 rpm --force \u65b9\u5f0f\u5b89\u88c5\uff0c\u793a\u4f8b\u5165\u4e0b\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u63d0\u793a\u4fe1\u606f\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"file /usr/lib/debug from install of oceanbase-ce-debuginfo-3.1.5-100000252023041721.el7.x86_64 conflicts with file from package filesystem-3.2-25.el7.x86_64\n"})}),"\n",(0,s.jsx)(n.p,{children:"rpm \u547d\u4ee4\u5b89\u88c5\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"rpm -ivh --force oceanbase-ce-debuginfo-3.1.5-100000252023041721.el7.x86_64.rpm\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5c06\u5b89\u88c5\u540e\u7684 observer.debug \u6587\u4ef6\u62f7\u8d1d\u5230\u8ddf OBServer \u53ef\u6267\u884c\u6587\u4ef6\u540c\u4e00\u7ea7\u76ee\u5f55\u4e0b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[root@x.x.x.x opt]$ rpm -ql oceanbase-ce-debuginfo | grep observer.debug\n/usr/lib/debug/home/admin/oceanbase/bin/observer.debug\n[root@x.x.x.x opt]$ cp /usr/lib/debug/home/admin/oceanbase/bin/observer.debug /home/admin/ob3.1.5/bin/\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u6536\u96c6\u5806\u6808-1",children:(0,s.jsx)(n.strong,{children:"\u6536\u96c6\u5806\u6808"})}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u9700\u8981\u501f\u52a9 addr2line \u6216\u8005 gdb \u6765\u6536\u96c6\u53d1\u751f core \u65f6\u523b\u7684\u5806\u6808\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528 addr2line \u6536\u96c6\u5806\u6808"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u5982\u679c\u6ca1\u6709 addr2line \u547d\u4ee4\uff0c\u9700\u8981\u5148\u5b89\u88c5 \nyum install -y binutils\n\naddr2line -pCfe /home/admin/ob3.1.5/bin/observer 0x9bac9c8 0x9b9d248 0x2b910122b62f 0x2b91019098ed 0x2b9101909783 0x946be28 0x22ed172 0x2b9101866554    0x22e\nsafe_backtrace at ??:?\noceanbase::common::coredump_cb(int, siginfo_t*) at ??:?\n?? ??:0\n?? ??:0\n?? ??:0\noceanbase::observer::ObServer::wait() at ??:?\nmain at ??:?\n?? ??:0\n_start at ??:?\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528 gdb \u547d\u4ee4\u6536\u96c6"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u5806\u6808\u5206\u6790",children:(0,s.jsx)(n.strong,{children:"\u5806\u6808\u5206\u6790"})}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u5c06\u5806\u6808\u4fe1\u606f\u53d1\u9001\u5230\u793e\u533a\u95ee\u7b54\u6216\u8005\u7ed9\u5230\u5bf9\u5e94\u7684\u793e\u533a\u652f\u6301\u4eba\u5458\uff0c\u793e\u533a\u540c\u5b66\u4f1a\u5e2e\u5fd9\u5206\u6790\u5904\u7406\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>i});var s=r(96540);const c={},o=s.createContext(c);function l(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);