"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[8283],{36406:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>_,toc:()=>m});var a=t(74848),i=t(28453);const s={title:"\u5408\u5e76\u7ba1\u7406",weight:6},o=void 0,_={id:"user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql/merge_management",title:"\u5408\u5e76\u7ba1\u7406",description:"root@sys \u767b\u9646\u67e5\u8be2\uff0c",source:"@site/docs/user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql/06_merge_management.md",sourceDirName:"user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql",slug:"/user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql/merge_management",permalink:"/docs/user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql/merge_management",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql/06_merge_management.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"\u5408\u5e76\u7ba1\u7406",weight:6},sidebar:"operation_and_maintenanceSidebar",previous:{title:"\u5907\u4efd\u6062\u590d",permalink:"/docs/user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql/backup_and_restore"},next:{title:"\u76d1\u63a7\u6307\u6807",permalink:"/docs/user_manual/operation_and_maintenance/operations_and_maintenance/commonly_used_sql/monitoring_metrics"}},r={},m=[{value:"\u7cfb\u7edf\u79df\u6237\u4e0b\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001",id:"\u7cfb\u7edf\u79df\u6237\u4e0b\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001",level:2},{value:"\u666e\u901a\u79df\u6237\u4e0b\u67e5\u8be2\u5f53\u524d\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001",id:"\u666e\u901a\u79df\u6237\u4e0b\u67e5\u8be2\u5f53\u524d\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001",level:2},{value:"\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684 tablet \u8f6c\u50a8\u5386\u53f2\u4fe1\u606f",id:"\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684-tablet-\u8f6c\u50a8\u5386\u53f2\u4fe1\u606f",level:2},{value:"memstore \u4fe1\u606f",id:"memstore-\u4fe1\u606f",level:2},{value:"\u79df\u6237 memstore \u4fe1\u606f",id:"\u79df\u6237-memstore-\u4fe1\u606f",level:2},{value:"\u67e5\u770b\u8f6c\u50a8\u4fe1\u606f",id:"\u67e5\u770b\u8f6c\u50a8\u4fe1\u606f",level:2},{value:"\u67e5\u770b\u6bcf\u65e5\u5408\u5e76\u8017\u65f6",id:"\u67e5\u770b\u6bcf\u65e5\u5408\u5e76\u8017\u65f6",level:2}];function d(n){const e={code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"root@sys"})," \u767b\u9646\u67e5\u8be2\uff0c"]}),"\n",(0,a.jsx)(e.h2,{id:"\u7cfb\u7edf\u79df\u6237\u4e0b\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001",children:"\u7cfb\u7edf\u79df\u6237\u4e0b\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  tenant_id,\n  global_broadcast_scn AS broadcast_scn,\n  is_error AS error,\n  status,\n  frozen_scn,\n  last_scn,\n  is_suspended AS suspend,\n  info,\n  start_time,\n  last_finish_time,\n  timestampdiff(second, start_time, last_finish_time) merge_time_second\nFROM\n  cdb_ob_major_compaction\nORDER BY\n  start_time DESC\nLIMIT\n  50;\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  *\nFROM\n  cdb_ob_zone_major_compaction;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u666e\u901a\u79df\u6237\u4e0b\u67e5\u8be2\u5f53\u524d\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001",children:"\u666e\u901a\u79df\u6237\u4e0b\u67e5\u8be2\u5f53\u524d\u79df\u6237\u7684\u5408\u5e76\u72b6\u6001"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  global_broadcast_scn AS broadcast_scn,\n  is_error AS error,\n  status,\n  frozen_scn,\n  last_scn,\n  is_suspended AS suspend,\n  info,\n  start_time,\n  last_finish_time,\n  timestampdiff(second, start_time, last_finish_time) merge_time_second\nFROM\n  dba_ob_major_compaction\nORDER BY\n  start_time DESC\nLIMIT\n  50;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684-tablet-\u8f6c\u50a8\u5386\u53f2\u4fe1\u606f",children:"\u67e5\u8be2\u6240\u6709\u79df\u6237\u7684 tablet \u8f6c\u50a8\u5386\u53f2\u4fe1\u606f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  *\nFROM\n  gv$ob_tablet_compaction_history\nWHERE\n  type = 'MINI_MERGE'\n  AND finish_time >= date_sub(now(), INTERVAL 2 HOUR)\nORDER BY\n  start_time DESC\nLIMIT\n  50;\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  tenant_id,\n  MIN(start_time) AS min_start_time,\n  MAX(finish_time) AS max_finish_time,\n  SUM(occupy_size) AS occupy_size,\n  SUM(total_row_count) AS total_row_count,\n  COUNT(1) AS tablet_count\nFROM\n  gv$ob_tablet_compaction_history\nWHERE\n  type = 'MINI_MERGE'\n--   AND finish_time >= date_sub(now(), INTERVAL 600 SECOND)\n--   AND finish_time >= date_sub(now(), INTERVAL 3 HOUR)\n  AND finish_time >= date_sub(now(), INTERVAL 1 DAY)\nGROUP BY\n  tenant_id\nLIMIT\n  50;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"memstore-\u4fe1\u606f",children:"memstore \u4fe1\u606f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  /*+ MONITOR_AGENT READ_CONSISTENCY(WEAK) */\n  tenant_id,\n  svr_ip,\n  svr_port,\n  round(active_span / 1024 / 1024) active_mb,\n  round(memstore_used / 1024 / 1024) memstore_used_mb,\n  round(freeze_trigger / 1024 / 1024) freeze_trigger_mb,\n  round(memstore_limit / 1024 / 1024) mem_limit_mb,\n  freeze_cnt,\n  round(memstore_used / memstore_limit, 2) mem_usage\nFROM\n  gv$ob_memstore\nORDER BY\n  tenant_id,\n  svr_ip,\n  svr_port;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u79df\u6237-memstore-\u4fe1\u606f",children:"\u79df\u6237 memstore \u4fe1\u606f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  /*+ READ_CONSISTENCY(WEAK),query_timeout(100000000) */\n  t.tenant_id,\n  t.tenant_name,\n  MAX(m.freeze_cnt) AS freeze_cnt,\n  s.value AS minor_freeze_times,\n  round(100 * MAX(m.freeze_cnt) / s.value, 2) AS compact_trigger_ratio\nFROM\n  gv$ob_memstore m\n  JOIN dba_ob_tenants t ON m.tenant_id = t.tenant_id\n  JOIN gv$ob_parameters s ON s.name = 'major_compact_trigger'\n  AND s.tenant_id = t.tenant_id\nWHERE\n  t.tenant_id > 1000\n  AND t.tenant_type <> 'meta'\nGROUP BY\n  m.tenant_id;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u67e5\u770b\u8f6c\u50a8\u4fe1\u606f",children:"\u67e5\u770b\u8f6c\u50a8\u4fe1\u606f"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"root@sys"})," \u767b\u9646\u67e5\u8be2\uff0c"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  *\nFROM\n  dba_ob_rootservice_event_history\nWHERE\n  event = 'root_minor_freeze'\nORDER BY\n  timestamp DESC\nLIMIT\n  30;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u67e5\u770b\u6bcf\u65e5\u5408\u5e76\u8017\u65f6",children:"\u67e5\u770b\u6bcf\u65e5\u5408\u5e76\u8017\u65f6"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"root@sys"})," \u767b\u9646\u67e5\u8be2\uff0c"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  t.tenant_id,\n  t.global_boradcast_scn,\n  t.merge_begin_time,\n  u.merge_end_time,\n  timestampdiff(second, t.merge_begin_time, u.merge_end_time) merge_time_second\nFROM\n  (\n    SELECT\n      value1 tenant_id,\n      value2 global_boradcast_scn,\n      timestamp merge_begin_time\n    FROM\n      dba_ob_rootservice_event_history\n    WHERE\n      module = 'daily_merge'\n      AND event = 'merging'\n  ) t,\n  (\n    SELECT\n      value1 tenant_id,\n      value2 global_boradcast_scn,\n      timestamp merge_end_time\n    FROM\n      dba_ob_rootservice_event_history\n    WHERE\n      module = 'daily_merge'\n      AND event = 'global_merged'\n  ) u\nWHERE\n  t.tenant_id = u.tenant_id\n  AND t.global_boradcast_scn = u.global_boradcast_scn\nORDER BY\n  3 DESC\nLIMIT\n  10;\n"})})]})}function c(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>o,x:()=>_});var a=t(96540);const i={},s=a.createContext(i);function o(n){const e=a.useContext(s);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function _(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),a.createElement(s.Provider,{value:e},n.children)}}}]);