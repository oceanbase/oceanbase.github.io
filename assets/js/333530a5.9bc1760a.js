"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[2898],{18679:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>c,default:()=>_,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var r=i(74848),t=i(28453);const a={title:"\u8d1f\u8f7d\u5747\u8861\u89e3\u51b3\u65b9\u6848",weight:4},c=void 0,s={id:"user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/load_balancing",title:"\u8d1f\u8f7d\u5747\u8861\u89e3\u51b3\u65b9\u6848",description:"\u672c\u6587\u4f5c\u8005\uff1a\u97e6\u5f6a\uff08OceanBase \u793e\u533a\u8bba\u575b\u8d26\u53f7\uff1a@\u752f\u7a7a\uff09",source:"@site/docs/user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/04_load_balancing.md",sourceDirName:"user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction",slug:"/user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/load_balancing",permalink:"/docs/user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/load_balancing",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/04_load_balancing.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"\u8d1f\u8f7d\u5747\u8861\u89e3\u51b3\u65b9\u6848",weight:4},sidebar:"operation_and_maintenanceSidebar",previous:{title:"\u8bef\u64cd\u4f5c\u6062\u590d\u6307\u5357",permalink:"/docs/user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/misoperation_recovery"},next:{title:"OceanBase \u7a7a\u95f4\u7f29\u5bb9\u5b9e\u8df5",permalink:"/docs/user_manual/operation_and_maintenance/zh-CN/user_practice_co-construction/resource_reduction"}},o={},l=[{value:"\u4e00\u3001\u80cc\u666f\u4ecb\u7ecd",id:"\u4e00\u80cc\u666f\u4ecb\u7ecd",level:2},{value:"\u4e8c\u3001\u62d3\u6251\u4ecb\u7ecd",id:"\u4e8c\u62d3\u6251\u4ecb\u7ecd",level:2},{value:"\u4e09\u3001\u914d\u7f6e\u8be6\u60c5",id:"\u4e09\u914d\u7f6e\u8be6\u60c5",level:2},{value:"\u56db\u3001\u603b\u7ed3",id:"\u56db\u603b\u7ed3",level:2}];function p(n){const e={blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u4f5c\u8005\uff1a\u97e6\u5f6a\uff08OceanBase \u793e\u533a\u8bba\u575b\u8d26\u53f7\uff1a@\u752f\u7a7a\uff09"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u4e00\u80cc\u666f\u4ecb\u7ecd",children:"\u4e00\u3001\u80cc\u666f\u4ecb\u7ecd"}),"\n",(0,r.jsx)(e.p,{children:"\u4e4b\u524d\u7684\u516c\u53f8\u7b97\u662f\u7b2c\u4e00\u6279\u4f7f\u7528 Oceanbase \u7684\u4e92\u8054\u7f51\u516c\u53f8\u4e86, \u7531\u4e8e\u4e4b\u524d\u505a\u8fc7 LINUX \u8fd0\u7ef4, \u6df1\u5165\u601d\u8003\u8fc7\u4f01\u4e1a\u5165\u53e3\u7684\u8d1f\u8f7d\u5747\u8861\u95ee\u9898\u3002\u901a\u8fc7 Nginx\u3001Keepalived\u3001\u57df\u540d\u5b9e\u73b0\u53cc\u6d3b\u3001\u591a\u6d3b\uff0c\u80fd\u5f7b\u5e95\u89e3\u51b3\u5355\u70b9\u6545\u969c\u3001\u8d1f\u8f7d\u4e0d\u5747\u8861\u3001\u6269\u5c55\u6027\u5dee\u7b49\u95ee\u9898\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u4e4b\u524d\u56e0\u4e3a\u75ab\u60c5\u539f\u56e0\uff0c\u4e1a\u52a1\u6709 10 \u500d\u589e\u957f\uff0c\u5bf9\u5927\u5e76\u53d1\u3001\u6a2a\u5411\u6269\u5c55\u4f1a\u6bd4\u8f83\u5173\u6ce8\u3002\u901a\u8fc7\u4f7f\u7528\u73b0\u6709\u5f00\u6e90\u7ec4\u4ef6\u7ec4\u5408\uff0c\u53ef\u4ee5\u5ab2\u7f8e\u5546\u4e1a\u8d1f\u8f7d\u5747\u8861\uff0c\u6700\u7ec8\u80fd\u591f\u505a\u5230\u514d\u7ef4\u62a4\u3001\u751a\u81f3\u9057\u5fd8\u8d1f\u8f7d\u5747\u8861\u548c\u9ad8\u53ef\u7528\u7684\u5b58\u5728\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u5f00\u6e90\u7ec4\u4ef6:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"obproxy\uff08TCP\u3001UDP\u3001HTTP \u8d1f\u8f7d\u5747\u8861\u6362\u6210 nginx\u3001haproxy\uff09"}),"\n",(0,r.jsx)(e.li,{children:"keepalived"}),"\n",(0,r.jsx)(e.li,{children:"DNS \u57df\u540d\u89e3\u6790"}),"\n",(0,r.jsx)(e.li,{children:"\u4e09\u4e2a VIP \u5730\u5740"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u4e8c\u62d3\u6251\u4ecb\u7ecd",children:"\u4e8c\u3001\u62d3\u6251\u4ecb\u7ecd"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"\u793a\u4f8b\u56fe\u7247",src:i(86887).A+"",width:"7174",height:"4626"})}),"\n",(0,r.jsx)(e.h2,{id:"\u4e09\u914d\u7f6e\u8be6\u60c5",children:"\u4e09\u3001\u914d\u7f6e\u8be6\u60c5"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5b89\u88c5 oceanbase\u3001obproxy \u7684\u6b65\u9aa4\u7565\u53bb\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5b89\u88c5 keepalived\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"yum install keepalived   # centos\napt install keepalived   # ubuntu\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsx)(e.li,{children:"\u4e3b\u673a 10.1.1.1 \u914d\u7f6e\u6587\u4ef6"}),"\n"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"/etc/keepalived/checkobproxy.sh"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"#!/bin/bash\nif [ `ps -C obproxy --no-header |wc -l` -eq 0 ]; then\n   sleep 1\n   if [ $(ps -C obproxy --no-header | wc -l) -eq 0 ]; then\n       exit 1\n   fi\nfi\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"/etc/keepalived/keepalived.conf"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'# Configuration File for keepalived\n\nglobal_defs {\n   notification_email {\n     willian@xx.com\n   }\n   router_id LVS_DEVEL\n   vrrp_skip_check_adv_addr\n   vrrp_garp_interval 0\n   vrrp_gna_interval 0\n   script_user root\n   enable_script_security\n}\n\n\nvrrp_script check_obproxy {\n    script "/etc/keepalived/checkobproxy.sh"\n    interval 2\n    weight -50\n}\n\nvrrp_instance VI_1 {\n    # nopreempt\n    state BACKUP\n    interface bond1\n    virtual_router_id 1\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.1\n    unicast_peer {\n        10.1.1.2\n        10.1.1.3\n    }\n    virtual_ipaddress {\n        10.1.1.241/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\n\nvrrp_instance VI_2 {\n    state BACKUP\n    interface bond1\n    virtual_router_id 2\n    priority 60\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.1\n    unicast_peer {\n        10.1.1.2\n        10.1.1.3\n    }\n    virtual_ipaddress {\n        10.1.1.242/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\nvrrp_instance VI_3 {\n    state BACKUP\n    interface bond1\n    virtual_router_id 3\n    priority 80\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.1\n    unicast_peer {\n        10.1.1.2\n        10.1.1.3\n    }\n    virtual_ipaddress {\n        10.1.1.243/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"4",children:["\n",(0,r.jsx)(e.li,{children:"\u4e3b\u673a 10.1.1.2 \u914d\u7f6e\u6587\u4ef6"}),"\n"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"/etc/keepalived/checkobproxy.sh"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"#!/bin/bash\nif [ `ps -C obproxy --no-header |wc -l` -eq 0 ]; then\n   sleep 1\n   if [ $(ps -C obproxy --no-header | wc -l) -eq 0 ]; then\n       exit 1\n   fi\nfi\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"/etc/keepalived/keepalived.conf"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'# Configuration File for keepalived\n\nglobal_defs {\n   notification_email {\n     willian@xx.com\n   }\n   router_id LVS_DEVEL\n   vrrp_skip_check_adv_addr\n   vrrp_garp_interval 0\n   vrrp_gna_interval 0\n   script_user root\n   enable_script_security\n}\n\n\nvrrp_script check_obproxy {\n    script "/etc/keepalived/checkobproxy.sh"\n    interval 2\n    weight -50\n}\n\nvrrp_instance VI_1 {\n    state BACKUP\n    interface bond1\n    virtual_router_id 1\n    priority 80\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.2\n    unicast_peer {\n        10.1.1.1\n        10.1.1.3\n    }\n    virtual_ipaddress {\n        10.1.1.241/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\n\nvrrp_instance VI_2 {\n    # nopreempt\n    state BACKUP\n    interface bond1\n    virtual_router_id 2\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.2\n    unicast_peer {\n        10.1.1.1\n        10.1.1.3\n    }\n    virtual_ipaddress {\n        10.1.1.242/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\nvrrp_instance VI_3 {\n    state BACKUP\n    interface bond1\n    virtual_router_id 3\n    priority 60\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.2\n    unicast_peer {\n        10.1.1.1\n        10.1.1.3\n    }\n    virtual_ipaddress {\n        10.1.1.243/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"5",children:["\n",(0,r.jsx)(e.li,{children:"\u4e3b\u673a 10.1.1.3 \u914d\u7f6e\u6587\u4ef6"}),"\n"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"/etc/keepalived/checkobproxy.sh"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"#!/bin/bash\nif [ `ps -C obproxy --no-header |wc -l` -eq 0 ]; then\n   sleep 1\n   if [ $(ps -C obproxy --no-header | wc -l) -eq 0 ]; then\n       exit 1\n   fi\nfi\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"/etc/keepalived/keepalived.conf"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'# Configuration File for keepalived\n\nglobal_defs {\n   notification_email {\n     willian@xx.com\n   }\n   router_id LVS_DEVEL\n   vrrp_skip_check_adv_addr\n   vrrp_garp_interval 0\n   vrrp_gna_interval 0\n   script_user root\n   enable_script_security\n}\n\n\nvrrp_script check_obproxy {\n    script "/etc/keepalived/checkobproxy.sh"\n    interval 2\n    weight -50\n}\n\nvrrp_instance VI_1 {\n    state BACKUP\n    interface bond1\n    virtual_router_id 1\n    priority 60\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.3\n    unicast_peer {\n        10.1.1.1\n        10.1.1.2\n    }\n    virtual_ipaddress {\n        10.1.1.241/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\n\nvrrp_instance VI_2 {\n    state BACKUP\n    interface bond1\n    virtual_router_id 2\n    priority 80\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.3\n    unicast_peer {\n        10.1.1.1\n        10.1.1.2\n    }\n    virtual_ipaddress {\n        10.1.1.242/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\nvrrp_instance VI_3 {\n    # nopreempt\n    state BACKUP\n    interface bond1\n    virtual_router_id 3\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass wukong\n    }\n    unicast_src_ip 10.1.1.3\n    unicast_peer {\n        10.1.1.1\n        10.1.1.2\n    }\n    virtual_ipaddress {\n        10.1.1.243/24\n    }\n    track_script {\n        check_obproxy\n    }\n}\n\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u56db\u603b\u7ed3",children:"\u56db\u3001\u603b\u7ed3"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u57df\u540d\u89e3\u6790\u4e09\u4e2a VIP A \u8bb0\u5f55\uff0c\u5229\u7528 DNS RR \u8f6e\u8be2\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u901a\u8fc7 VIP \u5730\u5740\u8df3\u8f6c\uff0c\u89c4\u907f\u67d0\u4e2a OBProxy \u670d\u52a1\u4e0d\u53ef\u7528\u3002"}),"\n",(0,r.jsx)(e.li,{children:"OBProxy \u6062\u590d\u540e VIP \u62a2\u5360\u56de\u6765\uff0c\u4eba\u5de5\u65e0\u9700\u5e72\u9884\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u4f7f\u7528 keepalived \u65b0\u589e\u5355\u64ad\u529f\u80fd\uff0c\u6765\u4fdd\u6d3b\u901a\u4fe1\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u4e0d\u4f7f\u7528 haproxy\uff0c\u51cf\u5c11\u53cd\u5411\u4ee3\u7406\u5c42\u7ea7\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u4e09\u6d3b\u8282\u70b9\uff0c\u8db3\u591f\u5065\u58ee\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u6a2a\u5411\u6269\u5bb9\u4e0d\u53d7\u9650\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u8fd0\u7ef4\u7b80\u5355\uff0c\u4e14\u5f00\u6e90\u514d\u8d39\u3002"}),"\n"]})]})}function _(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(p,{...n})}):p(n)}},86887:(n,e,i)=>{i.d(e,{A:()=>r});const r=i.p+"assets/images/001-c1782446a39f12d3527171fbd08c5b69.png"},28453:(n,e,i)=>{i.d(e,{R:()=>c,x:()=>s});var r=i(96540);const t={},a=r.createContext(t);function c(n){const e=r.useContext(a);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:c(n.components),r.createElement(a.Provider,{value:e},n.children)}}}]);