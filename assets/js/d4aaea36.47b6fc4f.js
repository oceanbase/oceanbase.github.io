"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[2068],{39279:(e,a,i)=>{i.r(a),i.d(a,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>n,metadata:()=>o,toc:()=>c});var t=i(74848),s=i(28453);const n={title:"Multi-replica High Availability Solution",weight:2},r=void 0,o={id:"user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/multi_replica_solution",title:"Multi-replica High Availability Solution",description:"Multi-replica High Availability Solution Based on Paxos",source:"@site/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/02_multi_replica_solution.md",sourceDirName:"user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design",slug:"/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/multi_replica_solution",permalink:"/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/multi_replica_solution",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/02_multi_replica_solution.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Multi-replica High Availability Solution",weight:2},sidebar:"operation_and_maintenanceEnglishSidebar",previous:{title:"Disaster Recovery Architecture Overview",permalink:"/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/high_availability_architecture_overview"},next:{title:"Physical Standby Database Solution Based on Asynchronous Log Replication",permalink:"/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/primary_standby_database_solution"}},l={},c=[{value:"Multi-replica High Availability Solution Based on Paxos",id:"multi-replica-high-availability-solution-based-on-paxos",level:2},{value:"Single-server disaster recovery",id:"single-server-disaster-recovery",level:3},{value:"IDC-level disaster recovery",id:"idc-level-disaster-recovery",level:3},{value:"City-level disaster recovery",id:"city-level-disaster-recovery",level:3}];function d(e){const a={a:"a",blockquote:"blockquote",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h2,{id:"multi-replica-high-availability-solution-based-on-paxos",children:"Multi-replica High Availability Solution Based on Paxos"}),"\n",(0,t.jsx)(a.p,{children:"This solution is implemented based on the Paxos protocol. Generally, multiple replicas, such as three or five replicas, constitute a cluster and provide disaster recovery capabilities."}),"\n",(0,t.jsx)(a.p,{children:"If a minority of replicas, such as one out of three or two out of five, are unavailable, the database can automatically execute a failover and recover services with a recovery point objective (RPO) of 0 and a recovery time objective (RTO) of less than 8 seconds."}),"\n",(0,t.jsx)(a.p,{children:"You can flexibly adjust the distribution of Internet data centers (IDCs) in different zones and regions of a cluster, as well as the distribution of replicas for tenants in the zones, to adjust the deployment mode of tenants and achieve different levels of disaster recovery."}),"\n",(0,t.jsx)(a.p,{children:"The following table describes the disaster recovery levels supported in OceanBase Database."}),"\n",(0,t.jsxs)(a.table,{children:[(0,t.jsx)(a.thead,{children:(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.th,{children:"Deployment mode"}),(0,t.jsx)(a.th,{children:"Optimal number of replicas"}),(0,t.jsx)(a.th,{children:"Disaster recovery scenario"}),(0,t.jsx)(a.th,{children:"Disaster recovery capability"})]})}),(0,t.jsxs)(a.tbody,{children:[(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:"Single IDC"}),(0,t.jsx)(a.td,{children:"3"}),(0,t.jsx)(a.td,{children:"This deployment mode is applicable to scenarios with only a single IDC. Three replicas in the same IDC form a cluster. We recommend that you deploy the replicas of the same copy of data on a group of servers with the same disaster recovery capability, such as the same rack or the same power supply."}),(0,t.jsx)(a.td,{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Able to cope with failures of a minority of nodes."})," ",(0,t.jsx)("li",{children:"Unable to cope with IDC-level failures or city-wide failures. IDC-level failures include network disconnection and power outage of the IDC. City-wide failures include natural disasters such as earthquakes, tsunamis, and hurricanes."})]})})]}),(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:"Three IDCs in the same region"}),(0,t.jsx)(a.td,{children:"3"}),(0,t.jsx)(a.td,{children:"This deployment mode is applicable to scenarios with three IDCs in a city. Three IDCs in the same city form a cluster. Each IDC is a zone. The network latency between the IDCs generally ranges from 0.5 ms to 2 ms."}),(0,t.jsx)(a.td,{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Able to cope with failures of a minority of nodes."})," ",(0,t.jsx)("li",{children:"Able to cope with single-IDC failures."})," ",(0,t.jsx)("li",{children:"Unable to cope with city-wide failures."})]})})]}),(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:"Three IDCs across two regions"}),(0,t.jsx)(a.td,{children:"5"}),(0,t.jsx)(a.td,{children:"This deployment mode is applicable to scenarios with two IDCs in a city. The primary city and the standby city form a cluster with five replicas. The primary city has four replicas distributed in two IDCs and the standby city has one replica. When an IDC fails, at most two replicas are lost, and the remaining three replicas are still available."}),(0,t.jsx)(a.td,{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Able to cope with failures of a minority of nodes."})," ",(0,t.jsx)("li",{children:"Able to cope with single-IDC failures."})," ",(0,t.jsx)("li",{children:"Unable to cope with failures in the primary city."})]})})]}),(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:"Five IDCs across three regions"}),(0,t.jsx)(a.td,{children:"5"}),(0,t.jsx)(a.td,{children:"This deployment mode is applicable to scenarios where city-level disaster recovery is required. Five replicas in three cities form a cluster. Two cities each have two replicas, and a third city has one replica. In the case of an IDC-level or city-wide failure, the remaining replicas are still available and can guarantee an RPO of 0."}),(0,t.jsx)(a.td,{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Able to cope with failures of a minority of nodes."})," ",(0,t.jsx)("li",{children:"Able to cope with failures of a minority of IDCs."})," ",(0,t.jsx)("li",{children:"Able to cope with failures of a minority of cities."})]})})]})]})]}),"\n",(0,t.jsx)(a.p,{children:"The following figures show the three deployment modes."}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Three IDCs in the same region"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.1/manage/three-IDCs-in-the-same-city.jpg",alt:"Three IDCs in the same region"})}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Three IDCs across two regions"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.1/manage/three-IDCs-across-two-regions1.jpg",alt:"Three IDCs across two regions"})}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"Five IDCs across three regions"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:"https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.1/manage/five-IDCs-across-three-regions1.jpg",alt:"Five IDCs across three regions"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(a.p,{children:['The deployment mode of OceanBase Database is described by the locality of tenants. For more information about the locality settings in the three deployment modes, see "Manage replicas." You can adjust the locality of tenants to flexibly adjust the deployment mode and achieve different levels of disaster recovery. For more information, see ',(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001714976",children:"Locality"}),"."]}),"\n",(0,t.jsx)(a.p,{children:"The core logic of multi-replica disaster recovery is to ensure that transaction logs are committed in the majority of replicas based on the Paxos protocol. If a minority of replicas fail, the election protocol guarantees automatic recovery with an RPO of 0. If a majority of replicas fail, manual intervention is required. You can pull up the service based on a single replica. The minority of replicas may not contain the latest data. Therefore, the last part of data may be lost."}),"\n",(0,t.jsxs)(a.blockquote,{children:["\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.strong,{children:"Notice"})}),"\n",(0,t.jsx)(a.p,{children:"Pulling up the service based on a single replica is not a regular O&M operation, but the last resort taken when a cluster cannot be recovered. It may cause data loss and dual leaders. If you want to perform this operation, contact OceanBase Technical Support for instructions. This topic does not provide operation details."}),"\n"]}),"\n",(0,t.jsx)(a.p,{children:"In the financial industry, a conventional relational database is usually deployed in the architecture of three IDCs across two regions. Two IDCs in the same city are deployed in primary/standby mode, and one IDC in the other city is deployed in cold standby mode. The native semi-synchronization mechanism of the database ensures that business updates are also synchronized to the standby database. However, it is not a strong consistency mechanism. When the primary database fails, the latest updates may have not been synchronized to the standby database, and forcibly switching the standby database to a primary database may cause data loss. Therefore, for conventional relational databases in the architecture of three IDCs across two regions, only one of the high availability and strong consistency features can be implemented, and the consistency, availability, partition tolerance (CAP) theorem applies. However, Paxos-based multi-replica disaster recovery of OceanBase Database achieves lossless city-level disaster recovery and geo-disaster recovery, with an RPO of 0 and an RTO of less than 8 seconds."}),"\n",(0,t.jsx)(a.p,{children:"In the multi-replica disaster recovery architecture of OceanBase Database, applications are aware of only one data source and are unaware of details of internal replication in the database. In addition, this architecture provides lossless single-server, IDC-level, and even city-level disaster recovery with an RTO of less than 8 seconds."}),"\n",(0,t.jsx)(a.h3,{id:"single-server-disaster-recovery",children:"Single-server disaster recovery"}),"\n",(0,t.jsxs)(a.p,{children:["The heartbeat mechanism of OceanBase Database can automatically monitor OBServer node failures. OceanBase Database Proxy (ODP) can also detect OBServer node failures to avoid impact on applications. If an OBServer node is connected but abnormal, you must immediately isolate the OBServer node to avoid transient impact on applications due to the ping-pong effect. For more information, see ",(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001714999",children:"Isolate a node"}),". If the leader automatically elected after you isolate the OBServer node is not the optimal choice, you can manually switch the primary zone to a specific zone. For more information, see ",(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715084",children:"Database-level high availability"}),"."]}),"\n",(0,t.jsx)(a.p,{children:"Follow-up operations vary based on the following scenarios:"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"If the failed OBServer node can be restarted:"}),"\n",(0,t.jsxs)(a.p,{children:["After you restart the OBServer node, it can resume services when the heartbeat connection to RootService is restored, regardless of the previous heartbeat status of the OBServer node. For more information, see ",(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001714995",children:"Restart a node"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsx)(a.p,{children:"If the failed OBServer node is damaged and cannot be restarted:"}),"\n",(0,t.jsxs)(a.p,{children:["Remove the failed OBServer node and put a new OBServer node online. For more information, see ",(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715006",children:"Replace a node"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(a.h3,{id:"idc-level-disaster-recovery",children:"IDC-level disaster recovery"}),"\n",(0,t.jsxs)(a.p,{children:["IDC-level disaster recovery requires that the cluster be deployed in multiple IDCs, such as three IDCs in the same region or three IDCs across two regions. In this deployment mode, if a minority of replicas are unavailable due to IDC failures, the remaining majority of replicas can still provide services, ensuring zero data loss. If an IDC failure affects only a single zone, you can run the STOP ZONE command to isolate the failed replica. For more information, see ",(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001714999",children:"Isolate a zone"}),". If an IDC failure affects multiple zones, you can manually switch the leader to a specific zone. For more information, see ",(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715084",children:"Database-level high availability"}),"."]}),"\n",(0,t.jsx)(a.h3,{id:"city-level-disaster-recovery",children:"City-level disaster recovery"}),"\n",(0,t.jsxs)(a.p,{children:["City-level disaster recovery requires that the cluster be deployed in multiple cities, such as five IDCs across three regions. In this deployment mode, at most two replicas are lost in the case of a city-wide failure, and the remaining majority of replicas can still provide services, ensuring zero data loss. If the leader automatically elected is not the optimal choice or if you want to avoid the intermittent impact of city-wide failures, you can manually switch the leader to the optimal zone. For more information, see ",(0,t.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715084",children:"Database-level high availability"}),"."]})]})}function h(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,a,i)=>{i.d(a,{R:()=>r,x:()=>o});var t=i(96540);const s={},n=t.createContext(s);function r(e){const a=t.useContext(n);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(n.Provider,{value:a},e.children)}}}]);