"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[8010],{29523:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var o=s(74848),t=s(28453);const a={title:"Perform O&M by using OBD",weight:3},r="5.2 Perform O&M by using OBD",i={id:"user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/o_m_by_obd",title:"Perform O&M by using OBD",description:"OceanBase Deployer (OBD) is a tool for installing and deploying open source ecosystem components of OceanBase. It can also be used to manage deployed components. For example, you can use OBD to restart, upgrade, scale out, and diagnose these components. This topic describes how to use OBD for O&M.",source:"@site/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/02_o_m_by_obd.md",sourceDirName:"user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance",slug:"/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/o_m_by_obd",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/o_m_by_obd",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/02_o_m_by_obd.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Perform O&M by using OBD",weight:3},sidebar:"quick_starts_and_hands_on_practices_in_englishSidebar",previous:{title:"Perform O&M by using OCP",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/o_m_by_ocp"},next:{title:"Perform O&M by using ob-operator",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_05_operation_and_maintenance/o_m_by_ob-operator"}},c={},d=[{value:"Modify parameters of an OceanBase cluster",id:"modify-parameters-of-an-oceanbase-cluster",level:2},{value:"Restart managed service components",id:"restart-managed-service-components",level:2},{value:"Restart the entire cluster",id:"restart-the-entire-cluster",level:3},{value:"Restart specified service components in the deployment configuration file",id:"restart-specified-service-components-in-the-deployment-configuration-file",level:3},{value:"Restart specified service components on specified nodes in the deployment configuration file",id:"restart-specified-service-components-on-specified-nodes-in-the-deployment-configuration-file",level:3},{value:"Upgrade managed service components",id:"upgrade-managed-service-components",level:2},{value:"Upgrade OBD",id:"upgrade-obd",level:3},{value:"Online upgrade",id:"online-upgrade",level:4},{value:"Offline upgrade",id:"offline-upgrade",level:4},{value:"Upgrade OceanBase Database",id:"upgrade-oceanbase-database",level:3},{value:"Upgrade ODP",id:"upgrade-odp",level:3},{value:"Online upgrade",id:"online-upgrade-1",level:4},{value:"Offline upgrade",id:"offline-upgrade-1",level:4},{value:"Upgrade OCP Express",id:"upgrade-ocp-express",level:3},{value:"Scale out managed service components",id:"scale-out-managed-service-components",level:2},{value:"Considerations",id:"considerations",level:3},{value:"Procedure",id:"procedure",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"52-perform-om-by-using-obd",children:"5.2 Perform O&M by using OBD"})}),"\n",(0,o.jsx)(n.p,{children:"OceanBase Deployer (OBD) is a tool for installing and deploying open source ecosystem components of OceanBase. It can also be used to manage deployed components. For example, you can use OBD to restart, upgrade, scale out, and diagnose these components. This topic describes how to use OBD for O&M."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Note"})}),"\n",(0,o.jsx)(n.p,{children:"The official documents referenced in this tutorial are of the latest version available at the time of writing or the Long-Term Support (LTS) version. You can switch to another version as needed in the upper-left corner of the document page."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You can run the following command to view the basic information of level-1 directories of OBD. Based on this information, you can learn about the management and O&M methods of OBD, as well as the considerations."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 ~]$ tree -L 1 ~/.obd\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"\n/home/admin/.obd\n\u251c\u2500\u2500 cluster         # Stores the configuration file of the deployed cluster. We recommend that you do not directly edit this configuration file. You can run the obd cluster edit-config command to modify the cluster configurations. This directory contains a hidden file named .data, which records the name of the deployed cluster, information about components, and deployment status. We recommend that you do not directly edit this configuration file.\n\u251c\u2500\u2500 config_parser\n\u251c\u2500\u2500 lock\n\u251c\u2500\u2500 log             # Stores the operation logs of OBD commands.\n\u251c\u2500\u2500 mirror          # Stores the installation package in the local repository and the .repo file in the remote repository.\n\u251c\u2500\u2500 optimize\n\u251c\u2500\u2500 plugins         # Stores plug-ins of components.\n\u251c\u2500\u2500 repository     \n\u2514\u2500\u2500 version         # Records the OBD version. \n"})}),"\n",(0,o.jsx)(n.h2,{id:"modify-parameters-of-an-oceanbase-cluster",children:"Modify parameters of an OceanBase cluster"}),"\n",(0,o.jsxs)(n.p,{children:["To modify the system parameters of an OceanBase cluster, you can run the ",(0,o.jsx)(n.code,{children:"obd cluster edit-config"})," command in OBD to modify the deployment configuration file. Run the following command to view the ",(0,o.jsx)(n.code,{children:"parameter.yaml"})," file to obtain the OceanBase cluster parameters that can be modified in OBD:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'find ~/.obd/plugin/${component} "parameter.yaml"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You must replace ",(0,o.jsx)(n.code,{children:"${component}"})," in the command with the name of the target component. In this example, it is replaced with ",(0,o.jsx)(n.code,{children:"oceanbase-ce"})," to view the parameters of OceanBase Database."]}),"\n",(0,o.jsxs)(n.p,{children:["Modifications to parameters in the ",(0,o.jsx)(n.code,{children:"parameter.yaml"})," file may take effect in one of the following ways. The specific method by which the modifications take effect is also displayed in the output of the ",(0,o.jsx)(n.code,{children:"obd cluster edit-config"})," command."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"need_redeploy"})," is set to ",(0,o.jsx)(n.code,{children:"true"})," for a parameter, you must run the ",(0,o.jsx)(n.code,{children:"obd cluster redeploy"})," command for the modifications to take effect. This command will uninstall the service, clear data, and deploy a new cluster. Proceed with caution."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"need_restart"})," is set to ",(0,o.jsx)(n.code,{children:"true"})," for a parameter, you must run the ",(0,o.jsx)(n.code,{children:"obd cluster restart"})," command for the modifications to take effect. This command will restart the service. Pay attention to the impact of service interruptions in a production environment."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"need_reload"})," is set to ",(0,o.jsx)(n.code,{children:"true"})," for a parameter, you must run the ",(0,o.jsx)(n.code,{children:"obd cluster reload"})," command for the modifications to take effect."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The following describes the general O&M procedure in OBD through an example of modifying the resource parameters of an OceanBase cluster and scaling out the resources of a user tenant."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"View the cluster list."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 ~]$ obd cluster list\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"+--------------------------------------------------------+\n|                      Cluster List                      |\n+------+-------------------------------+-----------------+\n| Name | Configuration Path            | Status (Cached) |\n+------+-------------------------------+-----------------+\n| test | /home/admin/.obd/cluster/test | running         |\n+------+-------------------------------+-----------------+\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Modify the configuration file."}),"\n",(0,o.jsxs)(n.p,{children:["For parameters included in the deployment configuration file, run the ",(0,o.jsx)(n.code,{children:"obd cluster edit-config"})," command to modify them. For parameters not included in the file, you can log on to the database and execute the ",(0,o.jsx)(n.code,{children:"alter system set Parameter name='Parameter value';"})," statement to modify them."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 ~]$ obd cluster edit-config test\n"})}),"\n",(0,o.jsx)(n.p,{children:"After you run the command, find the oceanbase-ce module in the configuration file that is opened. Here is an example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"oceanbase-ce:\n  servers:\n    - 10.10.10.1\n  global:\n    home_path: /home/admin/oceanbase\n    data_dir: /obdata/data\n    redo_dir: /obdata/log\n    devname: eth0\n    mysql_port: 2881 \n    rpc_port: 2882 \n    zone: zone1\n    cluster_id: 1\n    memory_limit: 32G \n    system_memory: 5G \n    datafile_size: 100G \n    datafile_next: 0G\n    datafile_maxsize: 0G\n    log_disk_size: 100G \n    cpu_count: 16\n    production_mode: false\n    enable_syslog_wf: false \n    enable_syslog_recycle: true \n    max_syslog_file_count: 10\n    root_password ******\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Change the value of the ",(0,o.jsx)(n.code,{children:"memory_limit"})," parameter to ",(0,o.jsx)(n.code,{children:"50G"}),", ",(0,o.jsx)(n.code,{children:"system_memory"})," to ",(0,o.jsx)(n.code,{children:"10G"}),", and ",(0,o.jsx)(n.code,{children:"log_disk_size"})," to ",(0,o.jsx)(n.code,{children:"150G"})," in the configuration file. Then, run the ",(0,o.jsx)(n.code,{children:":x"})," command to save the configuration file and exit."]}),"\n",(0,o.jsxs)(n.p,{children:["When you increase resource parameter values, make sure that the new values do not exceed the range of the remaining resources on servers. When you decrease resource parameter values, make sure that the new values are not smaller than the sizes of resources that have been allocated to or occupied by tenants. For more information about the relationships among resource parameters, see the ",(0,o.jsx)(n.strong,{children:"Common resource parameters of OceanBase Database and their calculation methods"})," section in ",(0,o.jsx)(n.strong,{children:"2.1 Deploy OceanBase database - Preparations before deployment"}),"."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Notice"})}),"\n",(0,o.jsxs)(n.p,{children:["You cannot decrease the value of the ",(0,o.jsx)(n.code,{children:"datafile_size"})," parameter."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Reload the configurations."}),"\n",(0,o.jsx)(n.p,{children:"After you modify and save the configuration file, OBD will output the reload command. Here is an example of the output:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'Search param plugin and load ok\nSearch param plugin and load ok\nParameter check ok\nSave deploy "test" configuration\nUse `obd cluster reload test` to make changes take effect.\nTrace ID: 12ece7da-f32d-11ee-ae7a-00163e046d79\nIf you want to view detailed obd logs, please run: obd display-trace 12ece7da-f32d-11ee-ae7a-00163e046d79\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You can run the ",(0,o.jsx)(n.code,{children:"obd cluster reload test"})," command provided in the preceding output for the modifications to take effect."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 ~]$ obd cluster reload test \n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Get local repositories and plugins ok\nLoad cluster param plugin ok\nOpen ssh connection ok\nCluster status check ok\nConnect to observer 10.10.10.1:2881 ok\ntest reload\nTrace ID: 70529604-f32d-11ee-a216-00163e046d79\nIf you want to view detailed obd logs, please run: obd display-trace 70529604-f32d-11ee-a216-00163e046d79\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the modifications."}),"\n",(0,o.jsxs)(n.p,{children:["Log on to the ",(0,o.jsx)(n.code,{children:"sys"})," tenant of OceanBase Database as the ",(0,o.jsx)(n.code,{children:"root"})," user, and run the following command to verify whether a parameter is modified. The ",(0,o.jsx)(n.code,{children:"memory_limit"})," parameter is used as an example here."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"obclient [oceanbase]> show parameters like 'memory_limit';\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"+-------+----------+----------------+----------+--------------+-----------+-------+---------------------------------------------------------------------------------------------------------------------------------+----------+---------+---------+-------------------+\n| zone  | svr_type | svr_ip         | svr_port | name         | data_type | value | info                                                                                                                            | section  | scope   | source  | edit_level        |\n+-------+----------+----------------+----------+--------------+-----------+-------+---------------------------------------------------------------------------------------------------------------------------------+----------+---------+---------+-------------------+\n| zone1 | observer | 10.10.10.1     |     2882 | memory_limit | NULL      | 50G   | the size of the memory reserved for internal use(for testing purpose), 0 means follow memory_limit_percentage. Range: 0, [1G,). | OBSERVER | CLUSTER | DEFAULT | DYNAMIC_EFFECTIVE |\n+-------+----------+----------------+----------+--------------+-----------+-------+---------------------------------------------------------------------------------------------------------------------------------+----------+---------+---------+-------------------+\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"View the available resources of the OceanBase cluster."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"obclient [oceanbase]> select zone,svr_ip,svr_port,cpu_capacity,cpu_assigned_max,cpu_capacity-cpu_assigned_max as cpu_free,round(memory_limit/1024/1024/1024,2) as memory_total_gb,round((memory_limit-mem_capacity)/1024/1024/1024,2) as system_memory_gb,round(mem_assigned/1024/1024/1024,2) as mem_assigned_gb,round((mem_capacity-mem_assigned)/1024/1024/1024,2) as memory_free_gb,round(log_disk_capacity/1024/1024/1024,2) as log_disk_capacity_gb,round(log_disk_assigned/1024/1024/1024,2) as log_disk_assigned_gb,round((log_disk_capacity-log_disk_assigned)/1024/1024/1024,2) as log_disk_free_gb,round((data_disk_capacity/1024/1024/1024),2) as data_disk_gb,round((data_disk_in_use/1024/1024/1024),2) as data_disk_used_gb,round((data_disk_capacity-data_disk_in_use)/1024/1024/1024,2) as data_disk_free_gb from gv$ob_servers;\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"+-------+----------------+----------+--------------+------------------+----------+-----------------+------------------+-----------------+----------------+----------------------+----------------------+------------------+--------------+-------------------+-------------------+\n| zone  | svr_ip         | svr_port | cpu_capacity | cpu_assigned_max | cpu_free | memory_total_gb | system_memory_gb | mem_assigned_gb | memory_free_gb | log_disk_capacity_gb | log_disk_assigned_gb | log_disk_free_gb | data_disk_gb | data_disk_used_gb | data_disk_free_gb |\n+-------+----------------+----------+--------------+------------------+----------+-----------------+------------------+-----------------+----------------+----------------------+----------------------+------------------+--------------+-------------------+-------------------+\n| zone1 | 10.10.10.1     |     2882 |           16 |               16 |        0 |           50.00 |            10.00 |           27.00 |          13.00 |               150.00 |               100.00 |            50.00 |       100.00 |              0.04 |             99.96 |\n+-------+----------------+----------+--------------+------------------+----------+-----------------+------------------+-----------------+----------------+----------------------+----------------------+------------------+--------------+-------------------+-------------------+\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"View the resource allocation information of tenants in the OceanBase cluster."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"select t4.tenant_id,t4.tenant_name,t1.name resource_pool_name, t1.unit_count, t2.`name` unit_config_name, t2.max_cpu, t2.min_cpu, round(t2.memory_size/1024/1024/1024,2) mem_size_gb, round(t2.log_disk_size/1024/1024/1024,2) log_disk_size_gb, t2.max_iops, t2.min_iops, t3.unit_id, t3.zone, concat(t3.svr_ip,':' ,t3.`svr_port`) observer from dba_ob_resource_pools t1 join dba_ob_unit_configs t2 on (t1.unit_config_id=t2.unit_config_id) join dba_ob_units t3 on (t1.`resource_pool_id` = t3.`resource_pool_id`) left join dba_ob_tenants t4 on (t1.tenant_id=t4.tenant_id) order by t4.tenant_name,t3.zone;\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"+-----------+-------------+--------------------+------------+------------------+---------+---------+-------------+------------------+---------------------+---------------------+---------+-------+---------------------+\n| tenant_id | tenant_name | resource_pool_name | unit_count | unit_config_name | max_cpu | min_cpu | mem_size_gb | log_disk_size_gb | max_iops            | min_iops            | unit_id | zone  | observer            |\n+-----------+-------------+--------------------+------------+------------------+---------+---------+-------------+------------------+---------------------+---------------------+---------+-------+---------------------+\n|         1 | sys         | sys_pool           |          1 | sys_unit_config  |       3 |       3 |        2.00 |             4.00 | 9223372036854775807 | 9223372036854775807 |       1 | zone1 | 10.10.10.1:2882     |\n|      1002 | test_tenant | test_tenant_pool   |          1 | test_tenant_unit |      13 |      13 |       25.00 |            96.00 | 9223372036854775807 | 9223372036854775807 |    1001 | zone1 | 10.10.10.1:2882     |\n+-----------+-------------+--------------------+------------+------------------+---------+---------+-------------+------------------+---------------------+---------------------+---------+-------+---------------------+\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Upgrade the unit config of the ",(0,o.jsx)(n.code,{children:"test_tenant"})," tenant."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Note"})}),"\n",(0,o.jsxs)(n.p,{children:["If you add significant cluster resources, we recommend that you also add resources (except ",(0,o.jsx)(n.code,{children:"system_memory"}),") for the ",(0,o.jsx)(n.code,{children:"sys"})," tenant. Since the ",(0,o.jsx)(n.code,{children:"sys"})," tenant hosts RootService and other key system processes, its performance issues can impair the response speed and processing capability of the entire cluster."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The following command increases the memory size from ",(0,o.jsx)(n.code,{children:"25G"})," to ",(0,o.jsx)(n.code,{children:"35G"})," and the transaction log disk size from ",(0,o.jsx)(n.code,{children:"96G"})," to ",(0,o.jsx)(n.code,{children:"105G"})," for the tenant."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"obclient [oceanbase]> alter resource unit test_tenant_unit MEMORY_SIZE '35G',LOG_DISK_SIZE '105G';\n"})}),"\n",(0,o.jsx)(n.p,{children:"Take note of the following rules when you adjust the resource parameters of a tenant:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"When you increase resource parameter values, make sure that the new values do not exceed the range of the remaining resources of the OceanBase cluster."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["When you decrease resource parameter values, make sure that the memory size is not smaller than the value of ",(0,o.jsx)(n.code,{children:"__min_full_resource_pool_memory"}),". You can log on to the ",(0,o.jsx)(n.code,{children:"sys"})," tenant of the OceanBase cluster as the ",(0,o.jsx)(n.code,{children:"root"})," user and execute the following statement to query the value of the ",(0,o.jsx)(n.code,{children:"__min_full_resource_pool_memory"})," parameter:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"select * from oceanbase.GV$OB_PARAMETERS where name ='__min_full_resource_pool_memory';\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["When you decrease resource parameter values, make sure that the number of CPU cores is not smaller than 1, and that the value of ",(0,o.jsx)(n.code,{children:"MAX_CPU"})," is not smaller than the value of ",(0,o.jsx)(n.code,{children:"MIN_CPU"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["When you decrease resource parameter values, we recommend that you set ",(0,o.jsx)(n.code,{children:"LOG_DISK_SIZE"})," to a value that is three to four times the memory size."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"View available resources of the OceanBase cluster again."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"obclient [oceanbase]> select zone,svr_ip,svr_port,cpu_capacity,cpu_assigned_max,cpu_capacity-cpu_assigned_max as cpu_free,round(memory_limit/1024/1024/1024,2) as memory_total_gb,round((memory_limit-mem_capacity)/1024/1024/1024,2) as system_memory_gb,round(mem_assigned/1024/1024/1024,2) as mem_assigned_gb,round((mem_capacity-mem_assigned)/1024/1024/1024,2) as memory_free_gb,round(log_disk_capacity/1024/1024/1024,2) as log_disk_capacity_gb,round(log_disk_assigned/1024/1024/1024,2) as log_disk_assigned_gb,round((log_disk_capacity-log_disk_assigned)/1024/1024/1024,2) as log_disk_free_gb,round((data_disk_capacity/1024/1024/1024),2) as data_disk_gb,round((data_disk_in_use/1024/1024/1024),2) as data_disk_used_gb,round((data_disk_capacity-data_disk_in_use)/1024/1024/1024,2) as data_disk_free_gb from gv$ob_servers;\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"+-------+----------------+----------+--------------+------------------+----------+-----------------+------------------+-----------------+----------------+----------------------+----------------------+------------------+--------------+-------------------+-------------------+\n| zone  | svr_ip         | svr_port | cpu_capacity | cpu_assigned_max | cpu_free | memory_total_gb | system_memory_gb | mem_assigned_gb | memory_free_gb | log_disk_capacity_gb | log_disk_assigned_gb | log_disk_free_gb | data_disk_gb | data_disk_used_gb | data_disk_free_gb |\n+-------+----------------+----------+--------------+------------------+----------+-----------------+------------------+-----------------+----------------+----------------------+----------------------+------------------+--------------+-------------------+-------------------+\n| zone1 | 10.10.10.1     |     2882 |           16 |               16 |        0 |           50.00 |            10.00 |           37.00 |           3.00 |               150.00 |               109.00 |            41.00 |       100.00 |              0.10 |             99.90 |\n+-------+----------------+----------+--------------+------------------+----------+-----------------+------------------+-----------------+----------------+----------------------+----------------------+------------------+--------------+-------------------+-------------------+\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"restart-managed-service-components",children:"Restart managed service components"}),"\n",(0,o.jsxs)(n.p,{children:["You can run the ",(0,o.jsx)(n.code,{children:"obd cluster stop"})," and ",(0,o.jsx)(n.code,{children:"obd cluster start"})," commands, or the ",(0,o.jsx)(n.code,{children:"obd cluster restart"})," command alone to restart the deployed service components. You can also choose to restart a specific component or a specific component on a specific node. For more information about the commands, see ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/community-obd-en-10000000001181575",children:"Cluster commands"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"This section uses a three-node cluster, where ODP and OceanBase Database are co-deployed, as an example to describe how to use OBD for restart."}),"\n",(0,o.jsx)(n.h3,{id:"restart-the-entire-cluster",children:"Restart the entire cluster"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@@test001 /home/admin]$ obd cluster restart test2\n"})}),"\n",(0,o.jsx)(n.p,{children:"Take note of the following considerations:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Before you restart components, make sure that SSH connections have been established among all nodes where the components reside. Otherwise, you cannot restart the components even if you specify the node IP addresses."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["The status of a deployed cluster is ",(0,o.jsx)(n.code,{children:"running"})," in the ",(0,o.jsx)(n.code,{children:"obd cluster list"})," command output only if all components in the cluster have been restarted. If any component fails to be restarted, subsequent components will not be restarted."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Notice"})}),"\n",(0,o.jsxs)(n.p,{children:["The status of the deployed cluster returned in the ",(0,o.jsx)(n.code,{children:"obd cluster list"})," command output is not updated in real time. When a server restarts, the service component on the server may become abnormal while the status of the cluster is still displayed as ",(0,o.jsx)(n.code,{children:"running"}),". Therefore, we recommend that after a server restarts, you run the ",(0,o.jsx)(n.code,{children:"obd cluster display"})," command to verify whether all components are normal."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If the status of the deployed cluster is not ",(0,o.jsx)(n.code,{children:"running"}),", subsequent management operations, such as upgrade and scale-out, will be affected."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The output of the restart command is as follows, where the status of all components in the cluster is displayed:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Get local repositories and plugins ok\nLoad cluster param plugin ok\nOpen ssh connection ok\nCluster status check ok\nCheck before restart observer ok\nConnect to observer ok\nServer check ok\nObserver restart ok\nWait for observer init ok\n+--------------------------------------------------+\n|                     observer                     |\n+----------------+---------+------+-------+--------+\n| ip             | version | port | zone  | status |\n+----------------+---------+------+-------+--------+\n| 10.10.10.1     | 4.2.1.2 | 2881 | zone1 | ACTIVE |\n| 10.10.10.2     | 4.2.1.2 | 2881 | zone3 | ACTIVE |\n| 10.10.10.3     | 4.2.1.2 | 2881 | zone2 | ACTIVE |\n+----------------+---------+------+-------+--------+\nobclient -h10.10.10.1 -P2881 -uroot -p'******' -Doceanbase -A\n\nCheck before start obproxy ok\nStop obproxy ok\nStart obproxy ok\nobproxy program health check ok\nConnect to obproxy ok\n+--------------------------------------------------+\n|                     obproxy                      |\n+----------------+------+-----------------+--------+\n| ip             | port | prometheus_port | status |\n+----------------+------+-----------------+--------+\n| 10.10.10.1     | 2883 | 2884            | active |\n| 10.10.10.2     | 2883 | 2884            | active |\n| 10.10.10.3     | 2883 | 2884            | active |\n+----------------+------+-----------------+--------+\nobclient -h10.10.10.1 -P2883 -uroot@proxysys -p'******' -Doceanbase -A \n\ntest2 restart\nTrace ID: 471fd8d0-f33e-11ee-88aa-00163e046d79\nIf you want to view detailed obd logs, please run: obd display-trace 471fd8d0-f33e-11ee-88aa-00163e046d79\n"})}),"\n",(0,o.jsx)(n.h3,{id:"restart-specified-service-components-in-the-deployment-configuration-file",children:"Restart specified service components in the deployment configuration file"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd cluster restart test2 -c obproxy-ce\n"})}),"\n",(0,o.jsx)(n.p,{children:"Take note of the following considerations:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["The component name specified by ",(0,o.jsx)(n.code,{children:"-c"})," is the component module name in the deployment configuration file, not the name displayed in the output of the ",(0,o.jsx)(n.code,{children:"obd cluster display"})," command."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["To specify multiple component names, separate them with commas (",(0,o.jsx)(n.code,{children:","}),")."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If you choose to restart a service component separately, the status of the deployed cluster does not change. For example, if you restart a service component separately or restart service components sequentially for a cluster in the ",(0,o.jsx)(n.code,{children:"stopped"})," state, the cluster will remain in the ",(0,o.jsx)(n.code,{children:"stopped"})," state even after the restart is complete."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The output of the restart command is as follows, where the status of only specified components in the cluster is displayed:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Get local repositories and plugins ok\nLoad cluster param plugin ok\nOpen ssh connection ok\nCluster status check ok\nCheck before start obproxy ok\nStop obproxy ok\nStart obproxy ok\nobproxy program health check ok\nConnect to obproxy ok\n+--------------------------------------------------+\n|                     obproxy                      |\n+----------------+------+-----------------+--------+\n| ip             | port | prometheus_port | status |\n+----------------+------+-----------------+--------+\n| 10.10.10.1     | 2883 | 2884            | active |\n| 10.10.10.2     | 2883 | 2884            | active |\n| 10.10.10.3     | 2883 | 2884            | active |\n+----------------+------+-----------------+--------+\nobclient -h10.10.10.1 -P2883 -uroot -p'******' -Doceanbase -A\nsucceed\nTrace ID: 669dc098-f3dc-11ee-bafb-00163e046d79\nIf you want to view detailed obd logs, please run: obd display-trace 669dc098-f3dc-11ee-bafb-00163e046d79\n"})}),"\n",(0,o.jsx)(n.h3,{id:"restart-specified-service-components-on-specified-nodes-in-the-deployment-configuration-file",children:"Restart specified service components on specified nodes in the deployment configuration file"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd cluster start test2 -c oceanbase-ce  -s xx.xx.xx.2\n"})}),"\n",(0,o.jsx)(n.p,{children:"Take note of the following considerations:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["To specify multiple component names or node IP addresses, separate them with commas (",(0,o.jsx)(n.code,{children:","}),")."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"If an incorrect IP address is specified, OBD will skip this IP address and restart components on nodes with correct IP addresses."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"If an incorrect component name is specified, OBD will abort the restart process."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The output of the restart command is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Get local repositories ok\nSearch plugins ok\nOpen ssh connection ok\nLoad cluster param plugin ok\nCluster status check ok\nCheck before start observer ok\nStart observer ok\nobserver program health check ok\nConnect to observer 10.10.10.2:2881 ok\nsucceed\nTrace ID: bb2082a0-f3db-11ee-8a93-00163e046d79\nIf you want to view detailed obd logs, please run: obd display-trace bb2082a0-f3db-11ee-8a93-00163e046d79\n"})}),"\n",(0,o.jsx)(n.h2,{id:"upgrade-managed-service-components",children:"Upgrade managed service components"}),"\n",(0,o.jsx)(n.p,{children:"You can upgrade service components in a cluster deployed by using OBD, such as OceanBase Database, ODP, and OceanBase Cloud Platform (OCP) Express. OBD does not support batch upgrade. This section describes how to upgrade OBD, OceanBase Database, ODP, and OCP Express in sequence."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Note"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"To use OBD to upgrade cluster components, make sure that the cluster is managed by OBD. Otherwise, OBD cannot obtain the cluster information. By default, a cluster deployed by using OBD is managed by OBD. For a cluster not deployed with OBD, you first need to take over the cluster to OBD."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["This section does not describe how to upgrade OCP. For information about how to upgrade OCP by using OBD, see ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-ocp-10000000001483962",children:"Upgrade OCP on the GUI"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"upgrade-obd",children:"Upgrade OBD"}),"\n",(0,o.jsx)(n.p,{children:"You can upgrade OBD in online or offline mode, depending on whether Internet access is available in the current environment."}),"\n",(0,o.jsx)(n.h4,{id:"online-upgrade",children:"Online upgrade"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Enable remote repositories."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror enable remote\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Run the upgrade command."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd update\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"offline-upgrade",children:"Offline upgrade"}),"\n",(0,o.jsx)(n.p,{children:"In an offline environment, you first need to obtain the installation package of the target OBD version and upload the installation package to any directory in the current environment."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Disable remote repositories."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror disable remote\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Clone the installation package to the local repository of OBD."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror clone ob-deploy-*.rpm\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Run the upgrade command."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd update \n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"upgrade-oceanbase-database",children:"Upgrade OceanBase Database"}),"\n",(0,o.jsx)(n.p,{children:"Take note of the following considerations:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Before the upgrade, you need to verify whether OBD needs to be upgraded. We recommend that you use the latest OBD version."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If a tenant in the cluster to be upgraded has a standby tenant, you must first upgrade the cluster where the standby tenant resides or run the ",(0,o.jsx)(n.code,{children:"obd cluster tenant switchover"})," command to switch the primary tenant in the current cluster to a standby tenant. We recommend that you upgrade the primary and standby clusters to the same version. For more information about the ",(0,o.jsx)(n.code,{children:"obd cluster tenant switchover"})," command, see the ",(0,o.jsx)(n.strong,{children:"obd cluster tenant switchover"})," section in ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/community-obd-en-10000000001181575",children:"Cluster commands"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Before the upgrade, you need to verify whether the current version can be upgraded to the target version. For more information, see the upgrade notes section in the release notes of the target version. For the release notes of OceanBase Database, visit the ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001376050",children:"link"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Before the upgrade, make sure that the deployed cluster is in the ",(0,o.jsx)(n.code,{children:"running"})," state and the OceanBase cluster is normal."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["If the upgrade fails, you can run the upgrade command again. However, it is prohibited to modify system parameters of the cluster before the upgrade failure cause is confirmed. For example, it is prohibited to modify the ",(0,o.jsx)(n.code,{children:"enable_ddl"})," and ",(0,o.jsx)(n.code,{children:"enable_upgrade_mode"})," parameters. When the upgrade fails, you can run the ",(0,o.jsx)(n.code,{children:"obd display-trace xxxx"})," command displayed in the output to view logs, or directly check the upgrade log file ",(0,o.jsx)(n.code,{children:"upgrade_post.log"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"The default upgrade mode is rolling upgrade and cannot be modified. During the upgrade, a node being upgraded will stop providing database services. If the cluster contains less than three zones or is a standalone cluster, you need to pay attention to the impact of the upgrade on business."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"If the target version is V4.0.x, V4.1.x, or V4.2.0 BETA, you need to restore the primary zone priorities of user tenants after the upgrade. Otherwise, the business performance may be compromised."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"After the upgrade, we recommend you upgrade other components to matching versions."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["For more information, see ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/community-obd-en-10000000001181608",children:"Upgrade OceanBase Database"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"upgrade-odp",children:"Upgrade ODP"}),"\n",(0,o.jsx)(n.p,{children:"You can upgrade ODP in online or offline mode, depending on whether Internet access is available in the current environment."}),"\n",(0,o.jsx)(n.h4,{id:"online-upgrade-1",children:"Online upgrade"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Enable remote repositories."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror enable remote\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"View the versions of ODP in the corresponding remote repository."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror list oceanbase.community.stable | grep obproxy-ce\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows, where the hash values of the corresponding versions of ODP (obproxy-ce) are displayed in the last column:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror list oceanbase.community.stable | grep obproxy-ce\n| obproxy-ce                   | 4.1.0.0 | 7.el8                  | x86_64 | 9f64a13645980e5c767fdbfc6aa0ff3fca7c2fe468d40aeb6c45ea2cccd863ba |\n| obproxy-ce                   | 4.2.0.0 | 7.el8                  | x86_64 | bac143e7cdedd98fd4458a66291b403b42d1f8effffb896452105020331b7053 |\n| obproxy-ce                   | 4.2.1.0 | 11.el8                 | x86_64 | eff4c01cef815c1323b70ae5105cc09d5711852baf3638b6cd12c5f9d09ffe7c |\n| obproxy-ce                   | 4.2.3.0 | 3.el8                  | x86_64 | 14958440fa70d669cf08671b3e5a2c3bdbec235fbe72960a9bc51e61b4ed6f8d |\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Run the upgrade command."}),"\n",(0,o.jsx)(n.p,{children:"The following command upgrades ODP from an earlier version to V4.2.3. You need to replace the version number and hash value based on the actual situation."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd cluster upgrade test2 -c obproxy-ce -V 4.2.3.0 --usable=14958440fa70d669cf08671b3e5a2c3bdbec235fbe72960a9bc51e61b4ed6f8d\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"offline-upgrade-1",children:"Offline upgrade"}),"\n",(0,o.jsx)(n.p,{children:"In an offline environment, you first need to obtain the installation package of the target ODP version and upload the installation package to any directory in the current environment."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Disable remote repositories."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror disable remote\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Clone the installation package to the local repository of OBD."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror clone obproxy-ce-*.rpm\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"View the list of installation packages in the local repository."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd mirror list local |grep obproxy-ce\n| obproxy-ce                | 4.2.3.0   | 3.el7                  | x86_64  | 0490ebc04220def8d25cb9cac9ac61a4efa6d639 |\n| obproxy-ce                | 4.2.1.0   | 11.el7                 | x86_64  | 0aed4b782120e4248b749f67be3d2cc82cdcb70d |\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Run the upgrade command."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd cluster upgrade test2 -c obproxy-ce -V 4.2.3.0 --usable=0490ebc04220def8d25cb9cac9ac61a4efa6d639\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the ODP version."}),"\n",(0,o.jsxs)(n.p,{children:["After the upgrade, log on to the ",(0,o.jsx)(n.code,{children:"sys"})," tenant of OceanBase Database as the ",(0,o.jsx)(n.code,{children:"root"})," user, and run the following command to query the ODP version:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"show proxyinfo binary\\G\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"upgrade-ocp-express",children:"Upgrade OCP Express"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Note"})}),"\n",(0,o.jsx)(n.p,{children:"At present, you can upgrade OCP Express only by running OBD commands on the CLI."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Take note of the following considerations:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Before the upgrade, you need to verify whether OBD needs to be upgraded. We recommend that you use the latest OBD version."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"In an offline environment, you need to clone the installation packages of both OCP Express and OBAgent of a matching version to the local repository."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Before the upgrade, you first need to verify the current and target versions of OCP Express. The methods for intra-version upgrade and inter-version upgrade are different. For example, the ",(0,o.jsx)(n.code,{children:"obd cluster reinstall"})," command is used for intra-version upgrade, and the ",(0,o.jsx)(n.code,{children:"obd cluster upgrade"})," command is used for inter-version upgrade."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["An upgrade failure does not affect the business database. You can run the ",(0,o.jsx)(n.code,{children:"obd display-trace xxxx"})," command for troubleshooting."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["After the upgrade, the logon password of OCP Express will not be reset. You can log on and choose ",(0,o.jsx)(n.strong,{children:"Help"})," > ",(0,o.jsx)(n.strong,{children:"About OCP Express"})," to check the version number and release date to verify whether OCP Express is upgraded to the target version."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["For more information, see ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/community-obd-en-10000000001181610",children:"Upgrade OCP Express"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"scale-out-managed-service-components",children:"Scale out managed service components"}),"\n",(0,o.jsxs)(n.p,{children:["OBD V2.5.0 and later support scale-out for all components except OCP-Server and oblogproxy in a cluster. For more information, see ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/community-obd-en-10000000001181616",children:"Scale out a cluster and change cluster components"}),". This section describes the considerations and procedure for scaling out an OceanBase cluster by using OBD."]}),"\n",(0,o.jsx)(n.h3,{id:"considerations",children:"Considerations"}),"\n",(0,o.jsx)(n.p,{children:"Take note of the following considerations:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Before the scale-out, you need to verify whether OBD needs to be upgraded. We recommend that you use the latest OBD version."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Before the scale-out, we recommend that you first perform server initialization for the nodes to be added. The deployment user and SSH connection information must be consistent with those of existing nodes in the cluster. For more information, see '",(0,o.jsx)(n.strong,{children:"2.1 Deploy OceanBase database - Preparations before deployment"}),"'."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Before the scale-out, make sure that the OceanBase cluster is normal."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Before the scale-out, make sure that OBClient is installed."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["You cannot modify the original cluster configurations in the ",(0,o.jsx)(n.code,{children:"depends"}),", ",(0,o.jsx)(n.code,{children:"global"}),", and ",(0,o.jsx)(n.code,{children:"server"})," sections of the configuration file for a new node. You only need to configure the basic information for the new node. Make sure that the resource configurations and mounted directories of the new node are consistent with those of existing nodes in the cluster."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["During the scale-out, the ",(0,o.jsx)(n.code,{children:"obd cluster scale_out"})," command will update the configuration information of the new node to the cluster deployment configuration file and perform a environment pre-check for the new node. If the new node passes the check, the command will install and start the OceanBase Database service on the new node, and then add the new node to the cluster."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["After the scale-out, you can run the ",(0,o.jsx)(n.code,{children:"obd cluster display"})," command to check the cluster status."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["After the scale-out, you need to add a replica for the tenant. Otherwise, the tenant still has only one replica. For more information, see ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001105989",children:"Add replicas"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"After the scale-out, we recommend that you adjust the primary zone priorities of the tenant as needed."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"At present, OBD does not support scaling in a cluster."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["After the scale-out, you can add more OBServer nodes to each of the existing zones. You only need to specify the name of zones for which you want to add OBServer nodes in the scaling configuration file. Then, you can horizontally add resources for the tenant. For more information, see ",(0,o.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001106670",children:"Horizontal scaling of tenant resources"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"procedure",children:"Procedure"}),"\n",(0,o.jsx)(n.p,{children:"The following example describes how to use OBD to scale out a standalone cluster into a three-zone cluster."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"View information about the standalone cluster."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$obd cluster display Expansion\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the deployed cluster is named ",(0,o.jsx)(n.code,{children:"Expansion"}),". You must replace the cluster name with the actual one. The output is as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Get local repositories and plugins ok\nOpen ssh connection ok\nCluster status check ok\nConnect to observer xx.xx.xx.1:2881 ok\nWait for observer init ok\n+--------------------------------------------------+\n|                     observer                     |\n+----------------+---------+------+-------+--------+\n| ip             | version | port | zone  | status |\n+----------------+---------+------+-------+--------+\n| 10.10.10.1     | 4.2.1.2 | 2881 | zone1 | ACTIVE |\n+----------------+---------+------+-------+--------+\nobclient -hxx.xx.xx.1 -P2881 -uroot -p'******' -Doceanbase -A\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Edit the scale-out configuration file."}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the scale-out configuration file is named ",(0,o.jsx)(n.code,{children:"Expansion1_3.yaml"}),". You can change the file name."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ vim Expansion1_3.yaml\n"})}),"\n",(0,o.jsx)(n.p,{children:"The file content is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"oceanbase-ce:\n  servers:\n    - name: server2\n      ip: 10.10.10.2\n    - name: server3\n      ip: 10.10.10.3\n  server2:\n    mysql_port: 2881\n    rpc_port: 2882 \n    home_path: /home/admin/oceanbase\n    zone: zone2\n  server3:\n    mysql_port: 2881\n    rpc_port: 2882 \n    home_path: /home/admin/oceanbase\n    zone: zone3\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Run the scale-out command."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$obd cluster scale_out Expansion  -c Expansion1_3.yaml\n"})}),"\n",(0,o.jsx)(n.p,{children:"The following output indicates that the scale-out is successful:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"succeed\nConnect to observer 10.10.10.1:2881 ok\nscaling out ok\nWaiting for observers ready ok\nExecute ` obd cluster display Expansion ` to view the cluster status\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify the scale-out result."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[admin@test001 /home/admin]$ obd cluster display Expansion\n"})}),"\n",(0,o.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"Get local repositories and plugins ok\nOpen ssh connection ok\nCluster status check ok\nConnect to observer 10.10.10.1:2881 ok\nWait for observer init ok\n+--------------------------------------------------+\n|                     observer                     |\n+----------------+---------+------+-------+--------+\n| ip             | version | port | zone  | status |\n+----------------+---------+------+-------+--------+\n| 10.10.10.1     | 4.2.1.2 | 2881 | zone1 | ACTIVE |\n| 10.10.10.2     | 4.2.1.2 | 2881 | zone2 | ACTIVE |\n| 10.10.10.3     | 4.2.1.2 | 2881 | zone3 | ACTIVE |\n+----------------+---------+------+-------+--------+\nobclient -h10.10.10.1 -P2881 -uroot -p'******' -Doceanbase -A\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>i});var o=s(96540);const t={},a=o.createContext(t);function r(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);