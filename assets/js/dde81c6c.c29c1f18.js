"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[1025],{74458:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var s=r(74848),n=r(28453);const t={slug:"Materialized-Views",title:"Explore Data Warehouses with Columnar Storage and Materialized Views of OceanBase Database"},i=void 0,o={id:"blogs/tech/Materialized-Views",title:"Explore Data Warehouses with Columnar Storage and Materialized Views of OceanBase Database",description:'"Making Technology Visible | The OceanBase Preacher Program" is a yearly technical writing contest hosted by OceanBase, and co-sponsored by Modb\\.pro, ITPUB, and CSDN, three major tech media platforms. Four rounds are organized to assess articles quarterly. Each year, we award the best writer, or preacher. This article, by Zhang Xiao, is among the most outstanding pieces of round 1.',source:"@site/docs/blogs/tech/Materialized-Views.md",sourceDirName:"blogs/tech",slug:"/blogs/tech/Materialized-Views",permalink:"/docs/blogs/tech/Materialized-Views",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/blogs/tech/Materialized-Views.md",tags:[],version:"current",frontMatter:{slug:"Materialized-Views",title:"Explore Data Warehouses with Columnar Storage and Materialized Views of OceanBase Database"},sidebar:"blogsSidebar",previous:{title:"Insights into OceanBase Database 4.0: How to Make DDL Execution Efficient and Transparent in a Distributed Database",permalink:"/docs/blogs/tech/DDL-Execution-Efficient"},next:{title:"Simplistic Yet Not Simple: The Upgrade to a Modern HBase Architecture with OceanBase Database",permalink:"/docs/blogs/tech/Modern-HBase-Arch"}},d={},c=[{value:"1 Feature Comparison",id:"1-feature-comparison",level:2},{value:"1.1 Row-based storage versus columnar storage",id:"11-row-based-storage-versus-columnar-storage",level:3},{value:"1.2 Materialized view versus table",id:"12-materialized-view-versus-table",level:3},{value:"2 Build a Real-time Data Warehouse by Using OceanBase Database",id:"2-build-a-real-time-data-warehouse-by-using-oceanbase-database",level:2},{value:"2.1 Technical requirements for building a real-time data warehouse",id:"21-technical-requirements-for-building-a-real-time-data-warehouse",level:3},{value:"2.2 Capabilities of OceanBase Database",id:"22-capabilities-of-oceanbase-database",level:3},{value:"2.3 Demo for building a real-time data warehouse",id:"23-demo-for-building-a-real-time-data-warehouse",level:3},{value:"2.4 Summary",id:"24-summary",level:3},{value:"3 Build a Batch Processing Data Warehouse by Using OceanBase Database",id:"3-build-a-batch-processing-data-warehouse-by-using-oceanbase-database",level:2},{value:"3.1 Technical requirements for building a batch processing data warehouse",id:"31-technical-requirements-for-building-a-batch-processing-data-warehouse",level:3},{value:"3.2 Capabilities of OceanBase Database",id:"32-capabilities-of-oceanbase-database",level:3},{value:"3.3 Demo for building a batch processing data warehouse based on materialized views",id:"33-demo-for-building-a-batch-processing-data-warehouse-based-on-materialized-views",level:3},{value:"3.4 Summary",id:"34-summary",level:3},{value:"4 Afterword",id:"4-afterword",level:2}];function l(e){const a={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:'"Making Technology Visible | The OceanBase Preacher Program" is a yearly technical writing contest hosted by OceanBase, and co-sponsored by Modb.pro, ITPUB, and CSDN, three major tech media platforms. Four rounds are organized to assess articles quarterly. Each year, we award the best writer, or preacher. This article, by Zhang Xiao, is among the most outstanding pieces of round 1.'}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"Starting from V4.3, OceanBase Database supports row-based storage, columnar storage, and refreshable materialized views. These features extend the versatility and potential of OceanBase Database. After a year of working with data warehouses, I have recently tested and explored these features. With these features, you can build data warehouses based on OceanBase Database in both stream processing and batch processing scenarios."}),"\n",(0,s.jsx)(a.h2,{id:"1-feature-comparison",children:"1 Feature Comparison"}),"\n",(0,s.jsx)(a.h3,{id:"11-row-based-storage-versus-columnar-storage",children:"1.1 Row-based storage versus columnar storage"}),"\n",(0,s.jsx)(a.p,{children:"The classic databases that we are familiar with, such as InnoDB of MySQL and the native storage engine of Oracle, all adopt row-based storage. When I first started in the field, I never imagined that databases with columnstore engines would become necessary. As data volumes grew and large-scale report queries became more complex, the query performance of a database without hardware upgrades began to decline."}),"\n",(0,s.jsx)(a.p,{children:"Columnar storage is the solution. While row-based storage is designed for transactions, columnar storage is ideal for scenarios where only some columns are read, especially for queries that require just a few columns. Columnar storage also offers a higher compression ratio, incurring less costs when processing larger amounts of business data. Unlike row-based storage, which relies on high-performance storage, columnar storage can work with regular storage, making it an ideal fit for data warehouses."}),"\n",(0,s.jsx)(a.p,{children:"Instead of simply supporting columnar storage, OceanBase Database V4.3 combines both row-based storage and columnar storage into an integrated architecture, balancing query performance for transaction processing (TP) and analytical processing (AP). This feature caught my attention at the launch event and had me thinking for months about how to apply it to my current work and testing efforts."}),"\n",(0,s.jsx)(a.h3,{id:"12-materialized-view-versus-table",children:"1.2 Materialized view versus table"}),"\n",(0,s.jsx)(a.p,{children:"Oracle was the first mainstream database to use materialized views. Unlike regular views, materialized views store a physical copy of the query results. This enables fast access to the results of complex queries. Materialized views have continued to evolve, all the way to Oracle Database 23ai."}),"\n",(0,s.jsx)(a.p,{children:"OceanBase Database V4.3.3 has also made significant progress in its materialized view feature. Some may ask, with columnar storage available, is there still a need for materialized views? Or rather, what are the advantages of materialized views and columnstore tables, and how do their applicable scenarios differ?"}),"\n",(0,s.jsx)(a.p,{children:"I've had the same question, and the answer lies in the storage engine: log-structured merge-tree (LSM-tree)."}),"\n",(0,s.jsx)(a.p,{children:"With the LSM-tree-based storage engine, columnstore tables in OceanBase Database support transactions. This enables streaming writes while ensuring atomicity, consistency, isolation, and durability (ACID), making OceanBase Database an ideal choice for serving as a real-time data warehouse. OceanBase Database also delivers high execution efficiency by supporting parallel queries and multiple replicas. Data warehouses process more reads than writes. In such scenarios, especially when data of only a few columns in wide tables is read, columnar storage provides obvious benefits."}),"\n",(0,s.jsx)(a.p,{children:"Materialized views, with their refresh mechanism, are ideal for tasks such as aggregation, distribution, and multi-table joins to store the results of common queries on disks. Compared to columnar storage, materialized views, due to their periodic refresh mechanism, are more suited for batch processing. Batch processing is less time-sensitive than stream processing but requires efficient handling of large datasets. Sometimes, batch processing also involves extract, transform, load (ETL) tasks."}),"\n",(0,s.jsx)(a.h2,{id:"2-build-a-real-time-data-warehouse-by-using-oceanbase-database",children:"2 Build a Real-time Data Warehouse by Using OceanBase Database"}),"\n",(0,s.jsx)(a.h3,{id:"21-technical-requirements-for-building-a-real-time-data-warehouse",children:"2.1 Technical requirements for building a real-time data warehouse"}),"\n",(0,s.jsx)(a.p,{children:"As its name suggests, a real-time data warehouse differs from a conventional offline data warehouse in timeliness. In the past, data warehouses usually had a one-day delay in data timeliness (T+1). This is inflexible for metrics requiring real-time computation and immediate results. If a logic issue with the data warehouse occurs, it might not be discovered until the next day, leading to untimely adjustments and reruns of tasks. However, a company has many business metrics that need real-time computation and fast feedback to relevant departments."}),"\n",(0,s.jsx)(a.p,{children:"To build a real-time data warehouse, the following technical requirements must be met:"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(1) High performance"}),": The prerequisite to timeliness is high performance. A product suitable for serving as a real-time data warehouse must have extremely low latency, typically ranging from milliseconds to seconds, to ensure timely data processing."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(2) Data integration"}),": The upstream of a data warehouse may include databases from various production systems or even offline data files. A product suitable for serving as a real-time data warehouse must offer rich data integration interfaces to meet diverse needs."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(3) Scalability"}),": In addition to processing data in real time, a real-time data warehouse must also support instant scaling. An offline data warehouse does not require high scalability because batch jobs are run at night. In contrast, a real-time data warehouse needs high scalability to handle resource bottlenecks and, therefore, ensure timeliness."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(4) Security"}),": Timeliness brings higher security requirements, because real-time computation often involves crucial data. This imposes greater security and privacy demands, requiring measures such as data encryption and access control to ensure data security and reliability."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(5) Flexible querying and analysis"}),": A real-time data warehouse is used in diverse scenarios, requiring the database to offer rich query and analysis tools that support complex query statements and data analysis models."]}),"\n",(0,s.jsx)(a.h3,{id:"22-capabilities-of-oceanbase-database",children:"2.2 Capabilities of OceanBase Database"}),"\n",(0,s.jsx)(a.p,{children:"Timeliness: OceanBase Database V4.3 supports real-time (T+0) writes, allowing data to be imported quickly for real-time analysis."}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(1) High performance"}),": As mentioned earlier, the columnstore and vectorized engines in OceanBase Database V4.3 significantly boost query performance, especially in wide table scenarios. In my test, OceanBase Database V4.3 is comparable with mainstream columnstore databases in the industry in wide table queries, enabling real-time analysis in seconds. Despite additional overheads incurred by support for transactions, OceanBase Database delivers sufficient performance in columnar storage."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(2) Data integration"}),": OceanBase Database V4.3 and later support integration with MySQL and Oracle, as well as integration with other mainstream open source databases such as PostgreSQL and ClickHouse through tools in the Flink ecosystem. Additionally, the direct load feature of OceanBase Database has been enhanced, providing the integration capabilities required for serving as a real-time data warehouse."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(3) Scalability"}),": The cloud-native distributed architecture of OceanBase Database supports high-concurrency reads and writes and horizontal scaling based on business needs to handle increasing data volumes and user requests. In my test, replicas and OBServer nodes can be scaled out in minutes. However, the time increases as data and business grow."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(4) Security"}),": OceanBase Database V4.3.3 offers enhanced security features such as resource and permission isolation between tenants, database security auditing, data encryption for storage and transmission, network-based access control, and password complexity restrictions, meeting the Level 3 requirements of Multi-Level Protection Scheme (MLPS)."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(5) Flexible querying and analysis"}),": OceanBase Database V4.3.3 supports most common data types, including ",(0,s.jsx)(a.code,{children:"ARRAY"}),". The database also supports both the rule-based optimizer (RBO) and the cost-based optimizer (CBO). With additional features such as full-text index, vector retrieval, columnar storage, and materialized views, OceanBase Database is well-suited for flexible querying and analysis."]}),"\n",(0,s.jsx)(a.h3,{id:"23-demo-for-building-a-real-time-data-warehouse",children:"2.3 Demo for building a real-time data warehouse"}),"\n",(0,s.jsx)(a.p,{children:"Here is a demo for building a real-time data warehouse by using OceanBase Database based on its columnar storage."}),"\n",(0,s.jsxs)(a.p,{children:["Data source 1: MySQL 8",(0,s.jsx)(a.br,{}),"\n","Data source 2: PostgreSQL 14",(0,s.jsx)(a.br,{}),"\n","Real-time data warehouse: OceanBase Database Community Edition V4.3.3",(0,s.jsx)(a.br,{}),"\n","Data synchronization tool: Flink CDC"]}),"\n",(0,s.jsx)(a.p,{children:"a. Create a MySQL table and insert data into it."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE TABLE orders (\r\n        order_id INT AUTO_INCREMENT,\r\n        order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n        customer_name VARCHAR(100),\r\n        price DECIMAL(10, 2),\r\n        product_id INT,\r\n        order_status BOOLEAN,\r\n        PRIMARY KEY (order_id)\r\n    );\r\n    \r\n    INSERT INTO orders (customer_name, price, product_id, order_status) VALUES\r\n    ('Alice', 19.99, 101, TRUE),\r\n    ('Bob', 29.99, 102, FALSE),\r\n    ('Charlie', 39.99, 103, TRUE),\r\n    ('David', 49.99, 104, TRUE);\n"})}),"\n",(0,s.jsx)(a.p,{children:"b. Create a table in Flink CDC for synchronizing data from the MySQL table."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE TABLE mysql_source (\r\n        order_id INT,\r\n        order_date TIMESTAMP(0),\r\n        customer_name STRING,\r\n        price DECIMAL(10, 5),\r\n        product_id INT,\r\n        order_status BOOLEAN,\r\n        PRIMARY KEY (order_id) NOT ENFORCED\r\n    ) WITH (\r\n        'connector' = 'mysql-cdc', \r\n        'hostname' = '192.16.1.10', \r\n        'port' = '3306',\r\n        'username' = 'test', \r\n        'password' = 'password', \r\n        'database-name' = 'test', \r\n        'table-name' = 'orders' \r\n    );\n"})}),"\n",(0,s.jsx)(a.p,{children:"c. Create a PostgreSQL table and insert data into it."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE TABLE products (\r\n        product_id INT PRIMARY KEY,\r\n        product_name VARCHAR(100),\r\n        product_description TEXT\r\n    );\r\n    \r\n    INSERT INTO products (product_id, product_name, product_description) VALUES\r\n    (101, 'Laptop', 'High performance laptop'),\r\n    (102, 'Smartphone', 'Latest model smartphone'),\r\n    (103, 'Tablet', 'Portable and lightweight tablet'),\r\n    (104, 'Headphones', 'Noise-cancelling headphones');\n"})}),"\n",(0,s.jsx)(a.p,{children:"d. Create a table in Flink CDC for synchronizing data from the PostgreSQL table."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE TABLE postgres_source (\r\n        product_id INT,\r\n        product_name STRING,\r\n        product_description STRING,\r\n        PRIMARY KEY (product_id) NOT ENFORCED\r\n    ) WITH (\r\n        'connector' = 'postgres-cdc', \r\n        'hostname' = '192.168.10.11', \r\n        'port' = '5432', \r\n        'username' = 'test', \r\n        'password' = 'password', \r\n        'database-name' = 'test', \r\n        'schema-name' = 'public', \r\n        'table-name' = 'products'\r\n    );\n"})}),"\n",(0,s.jsx)(a.p,{children:"e. Create a target columnstore table in OceanBase Database."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE TABLE joined_orders (\r\n        order_id INT,\r\n        order_date TIMESTAMP,\r\n        customer_name VARCHAR(100),\r\n        price DECIMAL(10, 2),\r\n        product_name VARCHAR(100),\r\n        product_description TEXT,\r\n        order_status BOOLEAN,\r\n        PRIMARY KEY (order_id)\r\n    ) WITH COLUMN GROUP (each column);\n"})}),"\n",(0,s.jsx)(a.p,{children:"f. Create a join view in Flink based on the fields of the target table in OceanBase Database."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE VIEW joined_orders AS\r\n    SELECT\r\n        o.order_id,\r\n        o.order_date,\r\n        o.customer_name,\r\n        o.price,\r\n        p.product_name,\r\n        p.product_description,\r\n        o.order_status\r\n    FROM mysql_source AS o\r\n    JOIN postgres_source AS p ON o.product_id = p.product_id;\n"})}),"\n",(0,s.jsxs)(a.p,{children:["g. Configure a write task for Flink CDC.",(0,s.jsx)(a.br,{}),"\n",(0,s.jsx)(a.em,{children:"The steps are not described here."})]}),"\n",(0,s.jsxs)(a.p,{children:["f. Verify the result.",(0,s.jsx)(a.br,{}),"\n","If all previous steps are successful, you can find the following query result:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    SELECT * FROM joined_orders;\r\n    +----------+---------------------+---------------+-------+--------------+---------------------------------+--------------+\r\n    | order_id | order_date          | customer_name | price | product_name | product_description             | order_status |\r\n    +----------+---------------------+---------------+-------+--------------+---------------------------------+--------------+\r\n    |        1 | 2024-11-19 00:00:00 | Alice         | 19.99 | Laptop       | High performance laptop         |            1 |\r\n    |        2 | 2024-11-19 00:00:01 | Bob           | 29.99 | Smartphone   | Latest model smartphone         |            0 |\r\n    |        3 | 2024-11-19 00:00:02 | Charlie       | 39.99 | Tablet       | Portable and lightweight tablet |            1 |\r\n    |        4 | 2024-11-19 00:00:03 | David         | 49.99 | Headphones   | Noise-cancelling headphones     |            1 |\r\n    +----------+---------------------+---------------+-------+--------------+---------------------------------+--------------+\n"})}),"\n",(0,s.jsx)(a.p,{children:"Insert data into the source tables."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    INSERT INTO orders (customer_name, price, product_id, order_status) VALUES ('Eve', 59.99, 105, TRUE);\r\n    ---- the MySQL table\r\n    \r\n    INSERT INTO products (product_id, product_name, product_description) VALUES (105, 'Smartwatch', 'Advanced smartwatch with health tracking features'); ---- the PostgreSQL table\n"})}),"\n",(0,s.jsx)(a.p,{children:"After committing data, you can query the latest result from the target table in OceanBase Database in real time."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    SELECT * FROM joined_orders;\r\n    +----------+---------------------+---------------+-------+--------------+---------------------------------------------------+--------------+\r\n    | order_id | order_date          | customer_name | price | product_name | product_description                               | order_status |\r\n    +----------+---------------------+---------------+-------+--------------+---------------------------------------------------+--------------+\r\n    |        1 | 2024-11-19 00:00:00 | Alice         | 19.99 | Laptop       | High performance laptop                           |            1 |\r\n    |        2 | 2024-11-19 00:00:01 | Bob           | 29.99 | Smartphone   | Latest model smartphone                           |            0 |\r\n    |        3 | 2024-11-19 00:00:02 | Charlie       | 39.99 | Tablet       | Portable and lightweight tablet                   |            1 |\r\n    |        4 | 2024-11-19 00:00:03 | David         | 49.99 | Headphones   | Noise-cancelling headphones                       |            1 |\r\n    |        5 | 2024-11-19 00:00:05 | Eve           | 59.99 | Smartwatch   | Advanced smartwatch with health tracking features |            1 |\r\n    +----------+---------------------+---------------+-------+--------------+---------------------------------------------------+--------------+\n"})}),"\n",(0,s.jsx)(a.h3,{id:"24-summary",children:"2.4 Summary"}),"\n",(0,s.jsx)(a.p,{children:"The preceding demo, where two tables are joined to output results, is simple and mainly aims to verify timeliness. In essence, OceanBase Database, with its high performance in columnar storage and its read/write splitting feature based on multiple replicas, works as a simplified real-time data warehouse. In this demo, OceanBase Database works with Flink CDC to serve as a real-time data warehouse, ensuring latency within seconds."}),"\n",(0,s.jsx)(a.p,{children:"Due to limited resources and time, this demo does not cover larger data volumes or more complex calculations and is intended only as a reference. Given the opportunity, I'll provide a more detailed version in the future."}),"\n",(0,s.jsx)(a.h2,{id:"3-build-a-batch-processing-data-warehouse-by-using-oceanbase-database",children:"3 Build a Batch Processing Data Warehouse by Using OceanBase Database"}),"\n",(0,s.jsx)(a.h3,{id:"31-technical-requirements-for-building-a-batch-processing-data-warehouse",children:"3.1 Technical requirements for building a batch processing data warehouse"}),"\n",(0,s.jsx)(a.p,{children:"A batch processing data warehouse is a conventional data warehouse that relies on batch processing technologies. Typically, ETL tasks are run at scheduled times to extract data from the source system, transform and cleanse it, and then load it into the data warehouse. A batch processing data warehouse has low timeliness demands but imposes other requirements on the database:"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(1) Storage capability"}),": A batch processing data warehouse processes and stores far more data than a real-time data warehouse and thus requires higher throughput and more efficient data compression."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(2) Data processing capability"}),": A batch processing data warehouse has broader data processing requirements than a real-time data warehouse. In addition to support for common object types and SQL, large-scale parallel computing is required to process hundreds of gigabytes of data every day. For complex reports, techniques such as index acceleration are needed to maximize performance."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(3) Data consistency"}),": Transaction support is often required during the execution of multiple complex ETL tasks to load, transform, compute, and persist data. In addition, constraints such as primary keys, unique keys, and non-null keys are needed to ensure data consistency and quality."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(4) Security and data integration"}),": The requirements are similar to those of a real-time data warehouse."]}),"\n",(0,s.jsx)(a.h3,{id:"32-capabilities-of-oceanbase-database",children:"3.2 Capabilities of OceanBase Database"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(1) Storage capability"}),": In various customer cases and my test with hundreds of gigabytes of data imported, OceanBase Database meets the requirements of a batch processing data warehouse for high throughput and storage capabilities. Additionally, columnar storage optimizes performance, minimizes storage space usage, and supports efficient data compression for large data volumes."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(2) Data processing capability"}),": OceanBase Database V4.3 has introduced column-based vectorized engine 2.0, which significantly boosts query performance in AP scenarios. This equips OceanBase Database with large-scale parallel computing capabilities, enabling it to process hundreds of gigabytes of data every day as long as enough resources are allocated. The materialized view feature pre-calculates and stores query results in materialized views to improve real-time query performance, which is especially useful for querying complex reports."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(3) Data consistency"}),": As mentioned earlier, OceanBase Database supports transactions during the execution of multiple complex ETL tasks. This ensures data consistency during data loading, transformation, computation, and persistence. Constraints such as primary keys, unique keys, and not-null keys are supported in both row-based storage and columnar storage, which alleviates my concerns about data consistency."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"(4) Security and data integration"}),": The capabilities are similar to those provided for building a real-time data warehouse."]}),"\n",(0,s.jsx)(a.h3,{id:"33-demo-for-building-a-batch-processing-data-warehouse-based-on-materialized-views",children:"3.3 Demo for building a batch processing data warehouse based on materialized views"}),"\n",(0,s.jsx)(a.p,{children:"My exploration of batch processing data warehouses is primarily based on the materialized views of OceanBase Database. Here, I simulate a batch processing data warehouse scenario to verify how materialized views speed up data queries."}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:"Test data: TPC-H 10 GB/20 GB"}),"\n",(0,s.jsx)(a.p,{children:"Test statements: Multi-table queries and direct materialized view queries"}),"\n",(0,s.jsx)(a.p,{children:"Test version: OceanBase Database Community Edition V4.3.3"}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"a. Create TPC-H tables."}),"\n",(0,s.jsxs)(a.p,{children:["Create eight ",(0,s.jsx)(a.strong,{children:"columnstore"})," tables based on TPC-H requirements."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE TABLE NATION  ( N_NATIONKEY  INTEGER NOT NULL,\r\n                            N_NAME       VARCHAR(25) NOT NULL,\r\n                            N_REGIONKEY  INTEGER NOT NULL,\r\n                            N_COMMENT    VARCHAR(152),\r\n                            PRIMARY KEY (N_NATIONKEY)\r\n                        )WITH COLUMN GROUP (each column);\r\n    \r\n    CREATE TABLE REGION  ( R_REGIONKEY  INTEGER NOT NULL,\r\n                            R_NAME       VARCHAR(25) NOT NULL,\r\n                            R_COMMENT    VARCHAR(152),\r\n                            PRIMARY KEY (R_REGIONKEY)\r\n                        )WITH COLUMN GROUP (each column);\r\n    \r\n    CREATE TABLE PART  ( P_PARTKEY     INTEGER NOT NULL,\r\n                              P_NAME        VARCHAR(55) NOT NULL,\r\n                              P_MFGR        VARCHAR(25)  NOT NULL,\r\n                              P_BRAND       VARCHAR(10)  NOT NULL,\r\n                              P_TYPE        VARCHAR(25) NOT NULL,\r\n                              P_SIZE        INTEGER NOT NULL,\r\n                              P_CONTAINER   VARCHAR(10) /*CHAR(10)*/ NOT NULL,\r\n                              P_RETAILPRICE DECIMAL(15,2) NOT NULL,\r\n                              P_COMMENT     VARCHAR(23) NOT NULL,\r\n                            PRIMARY KEY (P_PARTKEY)\r\n                        )WITH COLUMN GROUP (each column);\r\n    \r\n    CREATE TABLE SUPPLIER ( S_SUPPKEY     INTEGER NOT NULL,\r\n                                 S_NAME        VARCHAR(25) NOT NULL,\r\n                                 S_ADDRESS     VARCHAR(40) NOT NULL,\r\n                                 S_NATIONKEY   INTEGER NOT NULL,\r\n                                 S_PHONE       VARCHAR(15) NOT NULL,\r\n                                 S_ACCTBAL     DECIMAL(15,2) NOT NULL,\r\n                                 S_COMMENT     VARCHAR(101) NOT NULL,\r\n                            PRIMARY KEY (S_SUPPKEY)\r\n                            )WITH COLUMN GROUP (each column);\r\n    \r\n    CREATE TABLE PARTSUPP ( PS_PARTKEY     INTEGER NOT NULL,\r\n                                 PS_SUPPKEY     INTEGER NOT NULL,\r\n                                 PS_AVAILQTY    INTEGER NOT NULL,\r\n                                 PS_SUPPLYCOST  DECIMAL(15,2)  NOT NULL,\r\n                                 PS_COMMENT     VARCHAR(199) NOT NULL,\r\n                             PRIMARY KEY (PS_PARTKEY, PS_SUPPKEY)\r\n                            )WITH COLUMN GROUP (each column);\r\n    \r\n    CREATE TABLE CUSTOMER ( C_CUSTKEY     INTEGER NOT NULL,\r\n                                 C_NAME        VARCHAR(25) NOT NULL,\r\n                                 C_ADDRESS     VARCHAR(40) NOT NULL,\r\n                                 C_NATIONKEY   INTEGER NOT NULL,\r\n                                 C_PHONE       VARCHAR(15)  NOT NULL,\r\n                                 C_ACCTBAL     DECIMAL(15,2)   NOT NULL,\r\n                                 C_MKTSEGMENT  VARCHAR(10)  NOT NULL,\r\n                                 C_COMMENT     VARCHAR(117) NOT NULL,\r\n                            PRIMARY KEY (C_CUSTKEY)\r\n                            )WITH COLUMN GROUP (each column);\r\n    \r\n    CREATE TABLE ORDERS  ( O_ORDERKEY       BIGINT NOT NULL,\r\n                               O_CUSTKEY        INTEGER NOT NULL,\r\n                               O_ORDERSTATUS    VARCHAR(1) NOT NULL,\r\n                               O_TOTALPRICE     DECIMAL(15,2) NOT NULL,\r\n                               O_ORDERDATE      DATE NOT NULL,\r\n                               O_ORDERPRIORITY  VARCHAR(15)  NOT NULL,  \r\n                               O_CLERK          VARCHAR(15)  NOT NULL, \r\n                               O_SHIPPRIORITY   INTEGER NOT NULL,\r\n                               O_COMMENT        VARCHAR(79) NOT NULL,\r\n                            PRIMARY KEY (O_ORDERKEY)\r\n                            )WITH COLUMN GROUP (each column);\r\n    \r\n    CREATE TABLE LINEITEM ( L_ORDERKEY    BIGINT NOT NULL,\r\n                                 L_PARTKEY     INTEGER NOT NULL,\r\n                                 L_SUPPKEY     INTEGER NOT NULL,\r\n                                 L_LINENUMBER  INTEGER NOT NULL,\r\n                                 L_QUANTITY    INTEGER  NOT NULL,\r\n                                 L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,\r\n                                 L_DISCOUNT    DECIMAL(15,2) NOT NULL,\r\n                                 L_TAX         DECIMAL(15,2) NOT NULL,\r\n                                 L_RETURNFLAG  VARCHAR(1) NOT NULL,\r\n                                 L_LINESTATUS  VARCHAR(1) NOT NULL,\r\n                                 L_SHIPDATE    DATE NOT NULL,\r\n                                 L_COMMITDATE  DATE NOT NULL,\r\n                                 L_RECEIPTDATE DATE NOT NULL,\r\n                                 L_SHIPINSTRUCT VARCHAR(25)  NOT NULL,\r\n                                 L_SHIPMODE     VARCHAR(10) NOT NULL,\r\n                                 L_COMMENT      VARCHAR(44) NOT NULL,\r\n                             PRIMARY KEY (L_ORDERKEY, L_LINENUMBER)\r\n                            )WITH COLUMN GROUP (each column);\n"})}),"\n",(0,s.jsx)(a.p,{children:"b. Use the data generation tool to generate a 10 GB dataset."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    ./dbgen -s 10\n"})}),"\n",(0,s.jsxs)(a.p,{children:["c. Import the 10 GB dataset after configuring ",(0,s.jsx)(a.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715689",children:"secure_file_priv"}),"."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    SET SESSION ob_query_timeout = 1000000000000\n"})}),"\n",(0,s.jsx)(a.p,{children:"d. Execute a TPC-H query and record the execution time. Here, I execute Q11 and record an execution time of 3.33 seconds."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    select\r\n        ps_partkey,\r\n        sum(ps_supplycost * ps_availqty) as value\r\n    from\r\n        partsupp,\r\n        supplier,\r\n        nation\r\n    where\r\n        ps_suppkey = s_suppkey\r\n        and s_nationkey = n_nationkey\r\n        and n_name = 'GERMANY'\r\n    group by\r\n        ps_partkey having\r\n        sum(ps_supplycost * ps_availqty) > (\r\n            select\r\n            sum(ps_supplycost * ps_availqty) * 0.000002\r\n            from\r\n                partsupp,\r\n                supplier,\r\n                nation\r\n            where\r\n                ps_suppkey = s_suppkey\r\n                and s_nationkey = n_nationkey\r\n                and n_name = 'GERMANY'\r\n        )\r\n    order by\r\n        value desc;\n"})}),"\n",(0,s.jsx)(a.p,{children:"e. Create a materialized view based on Q11."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE MATERIALIZED VIEW mv_q11\r\n    REFRESH COMPLETE ON DEMAND\r\n    AS\r\n    select\r\n        ps_partkey,\r\n        sum(ps_supplycost * ps_availqty) as value\r\n    from\r\n        partsupp,\r\n        supplier,\r\n        nation\r\n    where\r\n        ps_suppkey = s_suppkey\r\n        and s_nationkey = n_nationkey\r\n        and n_name = 'GERMANY'\r\n    group by\r\n        ps_partkey having\r\n        sum(ps_supplycost * ps_availqty) > (\r\n            select\r\n            sum(ps_supplycost * ps_availqty) * 0.000002\r\n            from\r\n                partsupp,\r\n                supplier,\r\n                nation\r\n            where\r\n                ps_suppkey = s_suppkey\r\n                and s_nationkey = n_nationkey\r\n                and n_name = 'GERMANY'\r\n        )\r\n    order by\r\n        value desc;\n"})}),"\n",(0,s.jsx)(a.p,{children:"f. Clear the cache, query the materialized view, and record the execution time. Here, the execution time is 0.46 seconds, achieving a 7 times performance boost."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    select * from mv_q11;\n"})}),"\n",(0,s.jsx)(a.p,{children:"As the data volume grows, the performance gains from the materialized view become more evident. For example, in a production environment where tens of gigabytes of data are generated daily, incremental refreshes, such as those at a 6-hour interval, of the materialized views in OceanBase Database deliver better performance."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{children:"    CREATE MATERIALIZED VIEW mv_q11\r\n    REFRESH FORCE\r\n    START WITH SYSDATE\r\n    NEXT SYSDATE + 6/24  \r\n    AS\r\n    select\r\n        ps_partkey,\r\n        sum(ps_supplycost * ps_availqty) as value\r\n    from\r\n        partsupp,\r\n        supplier,\r\n        nation\r\n    where\r\n        ps_suppkey = s_suppkey\r\n        and s_nationkey = n_nationkey\r\n        and n_name = 'GERMANY'\r\n    group by\r\n        ps_partkey having\r\n        sum(ps_supplycost * ps_availqty) > (\r\n            select\r\n            sum(ps_supplycost * ps_availqty) * 0.000002\r\n            from\r\n                partsupp,\r\n                supplier,\r\n                nation\r\n            where\r\n                ps_suppkey = s_suppkey\r\n                and s_nationkey = n_nationkey\r\n                and n_name = 'GERMANY'\r\n        )\r\n    order by\r\n        value desc;\n"})}),"\n",(0,s.jsx)(a.h3,{id:"34-summary",children:"3.4 Summary"}),"\n",(0,s.jsx)(a.p,{children:"It is evident that the query efficiency of columnstore tables still lags significantly behind that of materialized views stored on disks. In data warehouses with fixed queries or common reports involving a large amount of data, materialized views that are periodically refreshed can greatly reduce the system overhead."}),"\n",(0,s.jsx)(a.p,{children:"In fact, materialized views are at the top layer of a data warehouse, which is often referred to as the data mart or report layer. Below the top layer are the summary, foundation, and operational data store (ODS) layers, which can be transformed into columnstore tables in OceanBase Database through batch ETL tasks to deliver higher performance than rowstore tables."}),"\n",(0,s.jsx)(a.h2,{id:"4-afterword",children:"4 Afterword"}),"\n",(0,s.jsx)(a.p,{children:"OceanBase Database, known for its row-based storage and transaction processing (TP) capabilities, surprised me with its excellence in columnar storage, especially after I verified the performance disparity between row-based and columnar storage. The columnar storage technology is well suited for data warehouses. In columnar storage mode, the data of each column is stored as an independent SSTable, and the SSTables of all columns are combined into a virtual SSTable as baseline data in columnar storage. This design allows you to perform transactional operations on columnstore tables as on rowstore tables, improving both performance and the compression ratio. In the future, OceanBase Database may offer more new features for enhancement."}),"\n",(0,s.jsx)(a.p,{children:"In batch processing data warehouses, the materialized view feature of OceanBase Database pre-processes complex queries and stores the results, which speeds up queries while reducing reliance on external ETL tools. What I haven't covered in this article is that the materialized views of OceanBase Database support flexible refresh strategies, including full refresh and on-demand refresh, allowing you to choose the one that best suits your needs. From my personal experience, I have observed that materialized views in OceanBase Database outperform those in other Chinese databases."}),"\n",(0,s.jsx)(a.p,{children:"To keep the article concise, I haven't covered how to build the ODS, data warehouse detail (DWD), data warehouse service (DWS), and application layers. The new columnstore engine can significantly improve the efficiency of these layers. I've moved the test data at these layers to columnstore tables in OceanBase Database and conducted numerous tests. The test result shows that ETL tasks that used to take hours are now at least twice as fast due to the acceleration based on columnar storage. If the computation logic is adapted to columnar storage, the speed will improve even further."}),"\n",(0,s.jsx)(a.p,{children:"Thanks to Modb.pro for reminding me to finish this article before the deadline."})]})}function h(e={}){const{wrapper:a}={...(0,n.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,a,r)=>{r.d(a,{R:()=>i,x:()=>o});var s=r(96540);const n={},t=s.createContext(n);function i(e){const a=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),s.createElement(t.Provider,{value:a},e.children)}}}]);