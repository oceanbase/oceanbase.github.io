"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[4577],{7862:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var n=t(74848),a=t(28453);const r={title:"Other common test items",weight:8},i="3.7 Other common test items",o={id:"user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/common_testing_points",title:"Other common test items",description:"Parallel import",source:"@site/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/07_common_testing_points.md",sourceDirName:"user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database",slug:"/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/common_testing_points",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/common_testing_points",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/07_common_testing_points.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"Other common test items",weight:8},sidebar:"quick_starts_and_hands_on_practices_in_englishSidebar",previous:{title:"Use JMeter to test OceanBase Database in simulated business scenarios",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/jmeter_test"},next:{title:"Introduction",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_04_migration_and_synchronization_oceanbase/introduction"}},c={},l=[{value:"Parallel import",id:"parallel-import",level:2},{value:"Data compression",id:"data-compression",level:2},{value:"High availability",id:"high-availability",level:2}];function d(e){const s={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"37-other-common-test-items",children:"3.7 Other common test items"})}),"\n",(0,n.jsx)(s.h2,{id:"parallel-import",children:"Parallel import"}),"\n",(0,n.jsxs)(s.p,{children:["Create an empty table named ",(0,n.jsx)(s.code,{children:"customer2"})," with the same schema as the ",(0,n.jsx)(s.code,{children:"customer"})," table in the TPC-H benchmark test. Then, execute the ",(0,n.jsx)(s.code,{children:"INSERT INTO ...SELECT"})," statement to insert all the 15 million rows of the ",(0,n.jsx)(s.code,{children:"customer"})," table into the ",(0,n.jsx)(s.code,{children:"customer2"})," table. Insert the data when parallel DML (PDML) is enabled and disabled respectively to observe the effects and differences."]}),"\n",(0,n.jsxs)(s.p,{children:["Copy the schema of the ",(0,n.jsx)(s.code,{children:"customer"})," table and create an empty table named ",(0,n.jsx)(s.code,{children:"customer2"})," based on the copied schema."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE customer2 LIKE customer;\n"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"Insert data without enabling PDML"}),"\n",(0,n.jsxs)(s.p,{children:["After you create the ",(0,n.jsx)(s.code,{children:"customer2"})," table, insert data into the table without enabling PDML. This is a large transaction that involves 15 million rows. Therefore, you need to set the maximum execution time of SQL statements in OceanBase Database to a larger value, in \u03bcs."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"SET ob_query_timeout = 21600000000;\n"})}),"\n",(0,n.jsx)(s.p,{children:"Execute the following statement to insert data:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"obclient [test]> INSERT INTO customer2 SELECT * FROM customer;\n"})}),"\n",(0,n.jsx)(s.p,{children:"According to the following output, when PDML is disabled, it takes 110 seconds for a single transaction to insert 15 million rows in OceanBase Database."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"Query OK, 15000000 rows affected (1 min 50.043 sec)\nRecords: 15000000  Duplicates: 0  Warnings: 0\n"})}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"Insert data with PDML enabled"}),"\n",(0,n.jsx)(s.p,{children:"Add a hint to the statement to enable PDML. Before you insert data again, you need to execute the following statement to truncate the data inserted earlier:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"obclient [test]> TRUNCATE TABLE customer2;\n"})}),"\n",(0,n.jsx)(s.p,{children:"Generally, if you do not need to execute multiple SQL statements in parallel, you can set the degree of parallelism (DOP) of a single SQL statement to the number of CPU cores of the tenant. Here is an example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"obclient [test]> INSERT /*+ parallel(22) enable_parallel_dml */ INTO customer2 SELECT * FROM customer;\n"})}),"\n",(0,n.jsx)(s.p,{children:"According to the following output, after PDML is enabled, the time taken to insert 15 million rows is reduced to about 17.3 seconds."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"Query OK, 15000000 rows affected (17.319 sec)\nRecords: 15000000  Duplicates: 0  Warnings: 0\n"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"To sum up, PDML can help improve the performance by about 6.3 times. You can enable PDML in scenarios that involve batch data processing."}),"\n",(0,n.jsx)(s.h2,{id:"data-compression",children:"Data compression"}),"\n",(0,n.jsx)(s.p,{children:"OceanBase Database has its own storage engine based on the log-structured merge-tree (LSM-tree) structure. Data is roughly classified into baseline data and incremental data. Baseline data is stored in SSTables on the disk, and incremental data is stored in MemTables in the memory. In this way, data can be stored on the disk in a more compact manner. Baseline data on the disk is not frequently updated, and OceanBase Database re-compresses the baseline data based on a general compression algorithm. Therefore, data stored in OceanBase Database has a high compression ratio without compromising the query or write performance."}),"\n",(0,n.jsx)(s.p,{children:"You can import a large amount of data to OceanBase Database and check the data compression ratio. You can use the test data for the TPC-H benchmark in the '3.5 Run the TPC-H benchmark' section. After you import the data, initiate a major compaction to compact and compress the incremental data with the baseline data."}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"Initiate a major compaction."}),"\n",(0,n.jsx)(s.p,{children:"Log on as the root user to the sys tenant and execute the following statement:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"obclient [oceanbase]> ALTER SYSTEM major freeze tenant=mysql_tenant;\n"})}),"\n",(0,n.jsxs)(s.p,{children:["In the statement, ",(0,n.jsx)(s.code,{children:"mysql_tenant"})," is the tenant on which a data compression test is to be performed. You need to replace it with the actual tenant name."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"Check whether the major compaction is completed."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_MAJOR_COMPACTION;\n"})}),"\n",(0,n.jsxs)(s.p,{children:["If the value of the ",(0,n.jsx)(s.code,{children:"STATUS"})," column in the returned information is ",(0,n.jsx)(s.code,{children:"IDLE"}),", the major compaction is completed."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"+-----------+---------------------+----------------------------+----------------------+---------------------+----------------------------+----------------------------+--------+----------+--------------+------+\n| TENANT_ID | FROZEN_SCN          | FROZEN_TIME                | GLOBAL_BROADCAST_SCN | LAST_SCN            | LAST_FINISH_TIME           | START_TIME                 | STATUS | IS_ERROR | IS_SUSPENDED | INFO |\n+-----------+---------------------+----------------------------+----------------------+---------------------+----------------------------+----------------------------+--------+----------+--------------+------+\n|         1 | 1709661601360541623 | 2024-03-06 02:00:01.360542 |  1709661601360541623 | 1709661601360541623 | 2024-03-06 02:06:25.027267 | 2024-03-06 02:00:01.382794 | IDLE   | NO       | NO           |      |\n|      1001 | 1709661602742784187 | 2024-03-06 02:00:02.742784 |  1709661602742784187 | 1709661602742784187 | 2024-03-06 02:05:36.148110 | 2024-03-06 02:00:02.780978 | IDLE   | NO       | NO           |      |\n|      1002 | 1709661600590790760 | 2024-03-06 02:00:00.590791 |  1709661600590790760 | 1709661600590790760 | 2024-03-06 02:05:43.819029 | 2024-03-06 02:00:00.641044 | IDLE   | NO       | NO           |      |\n+-----------+---------------------+----------------------------+----------------------+---------------------+----------------------------+----------------------------+--------+----------+--------------+------+\n"})}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"View the occupied storage space."}),"\n",(0,n.jsxs)(s.p,{children:["Execute the following statement in the sys tenant to view the storage space occupied after data is imported. Here, the storage space occupied by the leaders of the ",(0,n.jsx)(s.code,{children:"lineitem"})," table is queried."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"obclient [oceanbase]> select t1.table_name,\n    round(sum(t2.data_size)/1024/1024/1024,2) as data_size_gb,\n    round(sum(t2.required_size)/1024/1024/1024,2) as required_size_gb\n    from dba_ob_tenants t,cdb_ob_table_locations t1,cdb_ob_tablet_replicas t2\n    where t.tenant_id=t1.tenant_id\n    and t1.svr_ip=t2.svr_ip\n    and t1.tenant_id=t2.tenant_id\n    and t1.ls_id=t2.ls_id\n    and t1.tablet_id=t2.tablet_id\n    and t1.role='leader'\n    and t.tenant_name='perf'\n    and t1.database_name='test'\n    and t1.table_name='lineitem'\n    group by t1.table_name\n    order by 3 desc;\n"})}),"\n",(0,n.jsxs)(s.p,{children:["According to the following output, the total size of data before it is imported to the ",(0,n.jsx)(s.code,{children:"lineitem"})," table is 75 GB, the data size after compression is 22.15 GB, and the required disk space is 23.11 GB, achieving a compression ratio of 3.2, which is calculated by dividing 75 by 23.11."]}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Note"})}),"\n",(0,n.jsxs)(s.p,{children:["In the output, the value of ",(0,n.jsx)(s.code,{children:"required_size_gb"})," is greater than that of ",(0,n.jsx)(s.code,{children:"data_size_gb"})," because the minimum unit for data storage is macroblock, which is 2 MB in size."]}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"+------------+--------------+------------------+\n| table_name | data_size_gb | required_size_gb |\n+------------+--------------+------------------+\n| lineitem   |        22.15 |            23.11 |\n+------------+--------------+------------------+\n"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"high-availability",children:"High availability"}),"\n",(0,n.jsx)(s.p,{children:"High-availability disaster recovery at the cluster level is one of the highlights of a distributed database and is measured based on the recovery time objective (RTO). OceanBase Database V4.x has achieved an RTO of less than 8s."}),"\n",(0,n.jsxs)(s.p,{children:["You can use the oltp_read_write.lua test case of Sysbench to simulate continuous business requests. During stress testing, you can run ",(0,n.jsx)(s.code,{children:"kill -9"})," to make a leader faulty and then observe the period during which the queries per second (QPS) or transactions per second (TPS) value decreases to and remains 0."]}),"\n",(0,n.jsxs)(s.p,{children:["Here, you need to specify the ",(0,n.jsx)(s.code,{children:"--mysql-ignore-errors"})," parameter to ignore the 1062, 2013, 4265, 5066, 6002, 6213, 6224, 6222, 4746, 4012, 4009, 4250, 4009, and 4038 error codes, so that the client is not disconnected due to an error code. Here is an example:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"sysbench oltp_read_write.lua --mysql-host=xxx --mysql-port=xxx --mysql-user=root@mysql --mysql-db=sysbench --mysql-password=test --threads=400 --report-interval=1 --tables=10 --table_size=500000 --mysql-ignore-errors=1062,2013,4265,5066,6002,6213,6224,6222,4746,4012,4009,4250,4009,4038 --time=600 --db-ps-mode=disable run\n"})}),"\n",(0,n.jsx)(s.p,{children:"According to the following output, the TPS value remains at about 500 and decreases within the period from 21s to 27s, which means that services resume within 8s. In other words, the RTO is less than 8s."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-shell",children:"[ 13s ] thds: 400 tps: 190.00 qps: 3431.03 (r/w/o: 2700.03/380.00/351.00) lat (ms,99%): 1938.16 err/s: 0.00 reconn/s: 0.00\n[ 14s ] thds: 400 tps: 452.00 qps: 8034.99 (r/w/o: 6234.99/885.00/915.00) lat (ms,99%): 2045.74 err/s: 0.00 reconn/s: 0.00\n[ 15s ] thds: 400 tps: 464.00 qps: 8466.98 (r/w/o: 6591.98/945.00/930.00) lat (ms,99%): 1304.21 err/s: 0.00 reconn/s: 0.00\n[ 16s ] thds: 400 tps: 404.00 qps: 7723.98 (r/w/o: 6036.98/865.00/822.00) lat (ms,99%): 1280.93 err/s: 0.00 reconn/s: 0.00\n[ 17s ] thds: 400 tps: 515.99 qps: 8798.78 (r/w/o: 6818.83/971.98/1007.97) lat (ms,99%): 1479.41 err/s: 0.00 reconn/s: 0.00\n[ 18s ] thds: 400 tps: 546.01 qps: 9694.12 (r/w/o: 7528.10/1071.01/1095.01) lat (ms,99%): 1149.76 err/s: 0.00 reconn/s: 0.00\n[ 19s ] thds: 400 tps: 555.99 qps: 9973.84 (r/w/o: 7746.88/1109.98/1116.98) lat (ms,99%): 861.95 err/s: 0.00 reconn/s: 0.00\n[ 20s ] thds: 400 tps: 551.02 qps: 10089.34 (r/w/o: 7873.26/1121.04/1095.04) lat (ms,99%): 846.57 err/s: 0.00 reconn/s: 0.00\n[ 21s ] thds: 400 tps: 267.00 qps: 4857.99 (r/w/o: 3763.99/534.00/560.00) lat (ms,99%): 831.46 err/s: 0.00 reconn/s: 0.00\n[ 22s ] thds: 400 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,99%): 0.00 err/s: 0.00 reconn/s: 0.00\n[ 23s ] thds: 400 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,99%): 0.00 err/s: 0.00 reconn/s: 0.00\n[ 24s ] thds: 400 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,99%): 0.00 err/s: 0.00 reconn/s: 0.00\n[ 25s ] thds: 400 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,99%): 0.00 err/s: 0.00 reconn/s: 0.00\n[ 26s ] thds: 400 tps: 0.00 qps: 211.00 (r/w/o: 90.00/0.00/121.00) lat (ms,99%): 0.00 err/s: 0.00 reconn/s: 178.00\n[ 27s ] thds: 400 tps: 3.00 qps: 1765.86 (r/w/o: 1531.88/10.00/223.98) lat (ms,99%): 6594.16 err/s: 0.00 reconn/s: 174.99\n[ 28s ] thds: 400 tps: 449.03 qps: 10079.67 (r/w/o: 8246.55/935.06/898.06) lat (ms,99%): 7895.16 err/s: 0.00 reconn/s: 2.00\n[ 29s ] thds: 400 tps: 612.00 qps: 10188.00 (r/w/o: 7714.00/1268.00/1206.00) lat (ms,99%): 816.63 err/s: 0.00 reconn/s: 0.00\n[ 30s ] thds: 400 tps: 550.03 qps: 10166.58 (r/w/o: 7971.46/1084.06/1111.06) lat (ms,99%): 831.46 err/s: 0.00 reconn/s: 0.00\n[ 31s ] thds: 400 tps: 571.96 qps: 10246.31 (r/w/o: 7956.46/1139.92/1149.92) lat (ms,99%): 831.46 err/s: 0.00 reconn/s: 0.00\n"})})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,s,t)=>{t.d(s,{R:()=>i,x:()=>o});var n=t(96540);const a={},r=n.createContext(a);function i(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);