"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[3052],{74569:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>_,toc:()=>r});var a=t(74848),o=t(28453);const i={title:"Backup and Restore",weight:5},s=void 0,_={id:"user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql/backup_and_restore",title:"Backup and Restore",description:"Query the Status of Log Backup",source:"@site/docs/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql/05_backup_and_restore.md",sourceDirName:"user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql",slug:"/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql/backup_and_restore",permalink:"/docs/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql/backup_and_restore",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql/05_backup_and_restore.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Backup and Restore",weight:5},sidebar:"operation_and_maintenanceEnglishSidebar",previous:{title:"User and Privilege Management",permalink:"/docs/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql/user_and_privilege_management"},next:{title:"Compaction Management",permalink:"/docs/user_manual/operation_and_maintenance/en-US/operations_and_maintenance/commonly_used_sql/merge_management"}},c={},r=[{value:"Query the Status of Log Backup",id:"query-the-status-of-log-backup",level:2},{value:"Query the Status of Full Backup",id:"query-the-status-of-full-backup",level:2}];function d(n){const e={code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h2,{id:"query-the-status-of-log-backup",children:"Query the Status of Log Backup"}),"\n",(0,a.jsxs)(e.p,{children:["Execute the following SQL statement to query the information as the ",(0,a.jsx)(e.code,{children:"root@sys"})," user:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  *\nFROM\n  (\n    SELECT\n      incarnation,\n      round_id AS log_archive_round,\n      tenant_id,\n      path AS backup_dest,\n      if(start_scn_display != '', start_scn_display, NULL) AS min_first_time,\n      if(\n        checkpoint_scn_display != '',\n        checkpoint_scn_display,\n        NULL\n      ) AS max_next_time,\n      status,\n      if(\n        checkpoint_scn != '',\n        truncate(\n          (time_to_usec(now()) - checkpoint_scn / 1000) / 1000000,\n          4\n        ),\n        NULL\n      ) AS delay,\n      now(6) AS check_time\n    FROM\n      cdb_ob_archivelog_summary\n      right JOIN (\n        SELECT\n          tenant_id AS _tenant_id,\n          MAX(round_id) AS _round_id\n        FROM\n          cdb_ob_archivelog_summary\n        GROUP BY\n          _tenant_id\n      ) AS t ON tenant_id = t._tenant_id\n      AND round_id = t._round_id\n  )\nlimit\n  0, 100;\n"})}),"\n",(0,a.jsx)(e.h2,{id:"query-the-status-of-full-backup",children:"Query the Status of Full Backup"}),"\n",(0,a.jsxs)(e.p,{children:["Execute the following SQL statement to query the information as the ",(0,a.jsx)(e.code,{children:"root@sys"})," user:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"SELECT\n  *\nFROM\n  (\n    SELECT\n      job_id,\n      incarnation,\n      tenant_id,\n      backup_set_id,\n      backup_type,\n      path AS backup_dest,\n      start_timestamp AS start_time,\n      end_timestamp AS end_time,\n      now(6) AS check_time,\n      status,\n      comment,\n      description,\n      'TENANT' AS backup_level\n    FROM\n      (\n        SELECT\n          job_id,\n          incarnation,\n          tenant_id,\n          backup_set_id,\n          backup_type,\n          path,\n          start_timestamp,\n          NULL AS end_timestamp,\n          status,\n          comment,\n          description\n        FROM\n          cdb_ob_backup_jobs\n        UNION\n        SELECT\n          job_id,\n          incarnation,\n          tenant_id,\n          backup_set_id,\n          backup_type,\n          path,\n          start_timestamp,\n          end_timestamp,\n          status,\n          comment,\n          description\n        FROM\n          cdb_ob_backup_job_history\n      )\n    WHERE\n      tenant_id != 1\n    ORDER BY\n      start_time DESC\n  );\n"})})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>_});var a=t(96540);const o={},i=a.createContext(o);function s(n){const e=a.useContext(i);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function _(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),a.createElement(i.Provider,{value:e},n.children)}}}]);