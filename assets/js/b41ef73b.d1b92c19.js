"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[4573],{25785:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var r=t(74848),o=t(28453);const s={title:"Unexpected Errors",weight:6},a=void 0,i={id:"user_manual/operation_and_maintenance/en-US/emergency_handbook/how_to_ask",title:"Unexpected Errors",description:"Background Information",source:"@site/docs/user_manual/operation_and_maintenance/en-US/emergency_handbook/08_how_to_ask.md",sourceDirName:"user_manual/operation_and_maintenance/en-US/emergency_handbook",slug:"/user_manual/operation_and_maintenance/en-US/emergency_handbook/how_to_ask",permalink:"/docs/user_manual/operation_and_maintenance/en-US/emergency_handbook/how_to_ask",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/en-US/emergency_handbook/08_how_to_ask.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Unexpected Errors",weight:6},sidebar:"operation_and_maintenanceEnglishSidebar",previous:{title:"Full Log/Data Disk",permalink:"/docs/user_manual/operation_and_maintenance/en-US/emergency_handbook/disk_capacity_problem"},next:{title:"OMS Community Edition Troubleshooting Guide",permalink:"/docs/user_manual/operation_and_maintenance/en-US/tool_emergency_handbook/oms_troubleshooting_guide"}},d={},c=[{value:"Background Information",id:"background-information",level:2},{value:"Required Information",id:"required-information",level:2},{value:"Retrieve Logs",id:"retrieve-logs",level:2},{value:"Method 1: select last_trace_id()",id:"method-1-select-last_trace_id",level:3},{value:"Method 2: grep &quot;ret=-errno&quot;",id:"method-2-grep-ret-errno",level:3},{value:"Method 3: logs from OCP",id:"method-3-logs-from-ocp",level:3},{value:"What to Do Next",id:"what-to-do-next",level:2}];function l(e){const n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"background-information",children:"Background Information"}),"\n",(0,r.jsx)(n.p,{children:"Many of you may submit questions to the OceanBase community forum when you encounter unexpected errors."}),"\n",(0,r.jsx)(n.p,{children:"However, it is often observed that only the error code is included in the questions, which is insufficient. You need to include more relevant information, such as the OceanBase Database version, the SQL statement involved, and logs. This helps engineers on duty reproduce the error and identify its cause."}),"\n",(0,r.jsx)(n.p,{children:"In the following example, only an error code that indicates an internal error is provided, which does not help identify the error cause. The user must also provide relevant logs."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image",src:t(70485).A+"",width:"1520",height:"930"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)("font",{color:"red",children:"This topic describes the information that you need to provide to the engineers on duty in the community forum when you encounter unexpected errors, as well as how to retrieve logs. "})})}),"\n",(0,r.jsx)(n.h2,{id:"required-information",children:"Required Information"}),"\n",(0,r.jsx)(n.p,{children:"The information that you provide will be used by OceanBase Technical Support engineers to reproduce the error and identify its cause. In most cases, the following information is required:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The table schema involved in the error"}),"\n",(0,r.jsx)(n.li,{children:"The SQL statement that triggered the error"}),"\n",(0,r.jsx)(n.li,{children:"The logs that correspond to the error"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"retrieve-logs",children:"Retrieve Logs"}),"\n",(0,r.jsxs)(n.p,{children:["For example, an error is reported when I create a database named ",(0,r.jsx)(n.code,{children:"zlatan_db"})," in a special version of OceanBase Database."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"obclient> create database zlatan_db;\nERROR 4016 (HY000): Internal error\n"})}),"\n",(0,r.jsx)(n.p,{children:"I can use one of the following methods to retrieve corresponding logs."}),"\n",(0,r.jsx)(n.h3,{id:"method-1-select-last_trace_id",children:"Method 1: select last_trace_id()"}),"\n",(0,r.jsxs)(n.p,{children:["In the same session, execute the ",(0,r.jsx)(n.code,{children:"select last_trace_id()"})," statement after the SQL statement that triggered the error."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"obclient> create database zlatan_db;\nERROR 4016 (HY000): Internal error\n\nobclient> select last_trace_id();\n+------------------------------------+\n| last_trace_id()                    |\n+------------------------------------+\n| Y584A0B9E1F14-0006299CA6E2263B-0-0 |\n+------------------------------------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then, run a ",(0,r.jsx)(n.code,{children:"grep"})," command in a log directory similar to ",(0,r.jsx)(n.code,{children:"/home/user_name/oceanbase/log"})," to search for the occurrences of the trace ID in log files."]}),"\n",(0,r.jsxs)(n.p,{children:["If the directory contains a small number of log files, run the ",(0,r.jsx)(n.code,{children:"grep trace_id *"})," command in the directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"grep Y584A0B9E1F14-0006299CA6E2263B-0-0 * > zlatan.log\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Otherwise, run a ",(0,r.jsx)(n.code,{children:"grep"})," command to search for the occurrences of the trace ID in log files generated within a specific period of time."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"grep Y584A0B9E1F14-0006299CA6E2263B-0-0 observer.log.2024121918* rootservice.log.2024121918* > zlatan.log\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Upload the ",(0,r.jsx)(n.code,{children:"zlatan.log"})," file as an attachment to the question and then post the question in the forum."]}),"\n",(0,r.jsxs)(n.p,{children:["You can also highlight ",(0,r.jsx)(n.code,{children:"ret=-4016"})," in the ",(0,r.jsx)(n.code,{children:"zlatan.log"})," file, as the reported error code is 4016. The direct cause of the error is found next to the first occurrence of ",(0,r.jsx)(n.code,{children:"ret=-4016"})," in the logs."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image",src:t(84734).A+"",width:"2150",height:"352"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'rootservice.log.20241219182047574:[2024-12-19 18:12:51.807165] WDIAG [RS] \ncreate_database (ob_root_service.cpp:3039) [44788][DDLQueueTh0][T0]\n[Y584A0B9E1F14-0006299CA6E2263B-0-0] [lt=18][errcode=-4016]\ncreate database failed, because db_name is forbidden by zlatan. just for test.(ret=-4016)\n\nrootservice.log.20241219182047574:[2024-12-19 18:12:51.807177] WDIAG [RS] process_ \n(ob_rs_rpc_processor.h:206) [44788][DDLQueueTh0][T0]\n[Y584A0B9E1F14-0006299CA6E2263B-0-0] [lt=10][errcode=-4016] process failed(ret=-4016)\n\nrootservice.log.20241219182047574:[2024-12-19 18:12:51.807187] INFO  [RS] \nprocess_ (ob_rs_rpc_processor.h:226) [44788][DDLQueueTh0][T0]\n[Y584A0B9E1F14-0006299CA6E2263B-0-0] [lt=8] [DDL] \nexecute ddl like stmt(\n    ret=-4016, cost=117618, ddl_arg=ddl_stmt_str:"create database zlatan_db", \n    exec_tenant_id:1002, ddl_id_str:"", sync_from_primary:false, \n    based_schema_object_infos:[], parallelism:0, task_id:0, consumer_group_id:0)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The preceding results show that the direct cause of error 4016 is ",(0,r.jsx)(n.code,{children:"create database failed, because db_name is forbidden by zlatan. just for test."})]}),"\n",(0,r.jsxs)(n.p,{children:["This is because I modified the code in this special version of OceanBase Database to prevent users from naming a database ",(0,r.jsx)(n.code,{children:"zlatan_db"}),". You will never encounter the error. Don't worry."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'int ObRootService::create_database(\n    const ObCreateDatabaseArg &arg,\n    UInt64 &db_id)\n{\n  int ret = OB_SUCCESS;\n  \n  // other codes, we ignore\n  // ...\n  \n  // add by zlatan, just for debug\n  ObString forbidden_db_name = "zlatan_db";\n  if (arg.database_schema_.get_database_name_str() == forbidden_db_name) {\n    ret = OB_ERR_UNEXPECTED;\n    LOG_WARN("create database failed, because db_name is forbidden by zlatan. just for test.", K(ret));\n  }\n\n  return ret;\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"method-2-grep-ret-errno",children:'Method 2: grep "ret=-errno"'}),"\n",(0,r.jsxs)(n.p,{children:["Method 1 is limited, as ",(0,r.jsxs)(n.strong,{children:["you must execute the ",(0,r.jsx)(n.code,{children:"select last_trace_id()"})," statement immediately after the SQL statement that triggered the error, within the same session."]})]}),"\n",(0,r.jsxs)(n.p,{children:["If another SQL statement has been executed after the SQL statement that triggered the error or the session is exited, you can run the ",(0,r.jsx)(n.code,{children:'grep "ret=-errno"'})," command to obtain the trace ID."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'$grep "ret=-4016" *\nobserver.log.20241219181453955:[2024-12-19 18:12:51.807313]\nWDIAG [RPC] send (ob_poc_rpc_proxy.h:176) [46486][T1002_L0_G0][T1002]\n[Y584A0B9E1F14-0006299CA6E2263B-0-0] [lt=10][errcode=-4016]\nexecute rpc fail(addr="11.158.31.20:22602", pcode=520, ret=-4016, timeout=999999400)\n...\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then, retrieve complete logs by running a ",(0,r.jsx)(n.code,{children:"grep"})," command with the trace ID, which is ",(0,r.jsx)(n.code,{children:"Y584A0B9E1F14-0006299CA6E2263B-0-0"})," in this example."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"grep Y584A0B9E1F14-0006299CA6E2263B-0-0 * > zlatan.log\n"})}),"\n",(0,r.jsx)(n.h3,{id:"method-3-logs-from-ocp",children:"Method 3: logs from OCP"}),"\n",(0,r.jsxs)(n.p,{children:["If you do not want to run a ",(0,r.jsx)(n.code,{children:"grep"})," command to retrieve logs, you can perform GUI-based operations to obtain logs from OCP. You can use the keyword ",(0,r.jsx)(n.code,{children:"ret=-errno"})," to obtain the logs within the specified time range."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image",src:t(25519).A+"",width:"3802",height:"1942"})}),"\n",(0,r.jsx)(n.h2,{id:"what-to-do-next",children:"What to Do Next"}),"\n",(0,r.jsx)(n.p,{children:"Submit your question in the community forum, with the logs attached."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},70485:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/001-183a14a138d3613e7af9e8f58a49cf4f.png"},84734:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/002-946efb0bbd8cc7c318fd3e9c8e4da8de.png"},25519:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/3-ebeb1d82cf701e4124811117d321c294.png"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(96540);const o={},s=r.createContext(o);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);