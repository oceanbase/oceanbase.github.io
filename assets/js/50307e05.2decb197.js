"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[7276],{45087:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(74848),s=n(28453);const i={slug:"parallel-execution-VII",title:"Mastering Parallel Execution in OceanBase Database: Part 7 - Get Started with a PoC Test"},l=void 0,o={id:"blogs/tech/parallel-execution-VII",title:"Mastering Parallel Execution in OceanBase Database: Part 7 - Get Started with a PoC Test",description:"Parallel execution is a complex subject. You need to have a proper understanding of parallel execution to make full use of its capabilities. This article aims to help you get started with parallel execution and applies to OceanBase Database V3.1 and later. Parameters in this article are not optimal but can help avoid most bad cases.",source:"@site/docs/blogs/tech/parallel-execution-VII.md",sourceDirName:"blogs/tech",slug:"/blogs/tech/parallel-execution-VII",permalink:"/docs/blogs/tech/parallel-execution-VII",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/blogs/tech/parallel-execution-VII.md",tags:[],version:"current",frontMatter:{slug:"parallel-execution-VII",title:"Mastering Parallel Execution in OceanBase Database: Part 7 - Get Started with a PoC Test"},sidebar:"blogsSidebar",previous:{title:"Mastering Parallel Execution in OceanBase Database: Part 6 - Troubleshooting and Tuning Tips",permalink:"/docs/blogs/tech/parallel-execution-VI"},next:{title:"A Brief Analysis of Frequently Asked Questions about Partition Creation",permalink:"/docs/blogs/tech/partition-create"}},r={},c=[{value:"Initialize the Environment",id:"initialize-the-environment",level:2},{value:"Collect Statistics",id:"collect-statistics",level:2},{value:"Set a Hint",id:"set-a-hint",level:2},{value:"Tune the Performance",id:"tune-the-performance",level:2},{value:"FAQ",id:"faq",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",br:"br",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["Parallel execution is a complex subject. You need to have a proper understanding of parallel execution to make full use of its capabilities. This article aims to help you get started with parallel execution and applies to OceanBase Database ",(0,a.jsx)(t.strong,{children:"V3.1 and later"}),". Parameters in this article are ",(0,a.jsx)(t.strong,{children:"not optimal"})," but can help ",(0,a.jsx)(t.strong,{children:"avoid most bad cases"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"This is the last article of a seven-part series on parallel execution."}),"\n",(0,a.jsx)(t.p,{children:"Part 1"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/blogs/tech/parallel-execution-I",children:"Introduction"})}),"\n",(0,a.jsx)(t.p,{children:"Part 2"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/blogs/tech/parallel-execution-II",children:"Set the DOP"})}),"\n",(0,a.jsx)(t.p,{children:"Part 3"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/blogs/tech/parallel-execution-III",children:"Concurrency Control and Queuing"})}),"\n",(0,a.jsx)(t.p,{children:"Part 4"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/blogs/tech/parallel-execution-IV",children:"Parallel Execution Types"})}),"\n",(0,a.jsx)(t.p,{children:"Part 5"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/blogs/tech/parallel-execution-V",children:"Parallel Execution Parameters"})}),"\n",(0,a.jsx)(t.p,{children:"Part 6"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/blogs/tech/parallel-execution-VI",children:"Troubleshooting and Tuning Tips"})}),"\n",(0,a.jsx)(t.p,{children:"Part 7"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/blogs/tech/parallel-execution-VII",children:"Get Started with a PoC Test"})}),"\n",(0,a.jsx)(t.h2,{id:"initialize-the-environment",children:"Initialize the Environment"}),"\n",(0,a.jsx)(t.p,{children:"Execute the following command in an analytical processing (AP) tenant:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"    /* MySQL */\n    set global parallel_servers_target = MIN_CPU * 20;\n    \n    /* Oracle */\n    alter system set parallel_servers_target = MIN_CPU * 20;\n"})}),"\n",(0,a.jsx)(t.h2,{id:"collect-statistics",children:"Collect Statistics"}),"\n",(0,a.jsx)(t.p,{children:"In OceanBase Database V3.x, statistics collection is bound with major compactions. Therefore, after you import data, you must initiate a major compaction before you collect statistics."}),"\n",(0,a.jsxs)(t.p,{children:["In OceanBase Database V4.x, after you import data, you can directly call the ",(0,a.jsx)(t.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001134124",children:"DBMS_STAT package"})," to collect statistics."]}),"\n",(0,a.jsx)(t.h2,{id:"set-a-hint",children:"Set a Hint"}),"\n",(0,a.jsxs)(t.p,{children:["Make sure that the ",(0,a.jsx)(t.strong,{children:"maximum"})," degree of parallelism (DOP) of an SQL statement does not exceed 1.5 times the number of physical CPU cores."]}),"\n",(0,a.jsxs)(t.p,{children:["Generally, if you do not need to execute multiple SQL statements in parallel, you can set the DOP of a single SQL statement to ",(0,a.jsx)(t.strong,{children:"the number of CPU cores"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["For example, if the system has 32 physical CPU cores, you can set the hint as ",(0,a.jsx)(t.code,{children:"/*+ PARALLEL(32) */"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"tune-the-performance",children:"Tune the Performance"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Run the ",(0,a.jsx)(t.code,{children:"top -H"})," command to view the CPU utilization of the current tenant."]}),"\n",(0,a.jsxs)(t.li,{children:["If the performance of a single SQL statement is not as expected, contact OceanBase Technical Support to query the ",(0,a.jsx)(t.code,{children:"sql_plan_monitor"})," view for the performance report and contact R&D engineers for further analysis."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"faq",children:"FAQ"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"What do I do if the query performance is not as expected while the CPU resources are not fully used?"}),"\n"]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["Execute the ",(0,a.jsx)(t.code,{children:"show variables like 'parallel_servers_target"})," statement and check whether the value of ",(0,a.jsx)(t.code,{children:"parallel_servers_target"})," is not less than MIN_CPU \xd7 20."]}),"\n"]}),"\n",(0,a.jsxs)(t.ol,{start:"2",children:["\n",(0,a.jsx)(t.li,{children:"What do I do if the PDML performance is not as expected?"}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Execute the ",(0,a.jsx)(t.code,{children:"EXPLAIN EXTENDED"})," statement to verify whether parallel DML (PDML) is used. If PDML is not used, the ",(0,a.jsx)(t.code,{children:"Note"})," field at the bottom of the plan describes the reason. Generally, if the target table contains triggers, foreign keys, or local unique indexes, PDML will not be used."]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["Keywords such as ",(0,a.jsx)(t.code,{children:"DISTRIBUTED INSERT"}),", ",(0,a.jsx)(t.code,{children:"DISTRIBUTED UPDATE"}),", and ",(0,a.jsx)(t.code,{children:"DISTRIBUTED DELETE"})," indicate that PDML is not used."]}),"\n"]}),"\n",(0,a.jsxs)(t.ol,{start:"3",children:["\n",(0,a.jsxs)(t.li,{children:["What do I do when the error ",(0,a.jsx)(t.code,{children:"-4138 OB_SNAPSHOT_DISCARDED"})," is returned upon a PDML timeout?"]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Set the ",(0,a.jsx)(t.code,{children:"undo_retention"})," parameter to a value that is not less than the maximum execution time of a PDML statement. The default value of ",(0,a.jsx)(t.code,{children:"undo_retention"})," is 30 minutes. If the execution time of a PDML statement exceeds 30 minutes, this error may be returned and the statement will be aborted and retried until it times out."]}),"\n",(0,a.jsxs)(t.ol,{start:"4",children:["\n",(0,a.jsx)(t.li,{children:"How do I enable parallel execution for business SQL statements without making any modifications to the business?"}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["OceanBase Database Proxy (ODP) provides a web UI for you to modify connection configurations to enable parallel execution. For example, you can set the DOP of all SQL statements in a read/write splitting connection to 2.",(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.img,{alt:"1705633920",src:n(4120).A+"",width:"952",height:"602"})]}),"\n",(0,a.jsx)(t.p,{children:"The web UI was iterated in April 2023 and released in early May 2023. Make sure that the version of ODP is V3211bp1 or later."})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},4120:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/1705633920006-75730035586291ccc1db57bec9116b3f.png"},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var a=n(96540);const s={},i=a.createContext(s);function l(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);