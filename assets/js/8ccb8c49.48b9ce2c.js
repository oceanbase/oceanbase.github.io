"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[209],{29849:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var s=t(74848),i=t(28453);const a={title:"SQL Development Specifications",weight:3},o=void 0,c={id:"user_manual/operation_and_maintenance/en-US/development_specification/sql_specification",title:"SQL Development Specifications",description:"Note:",source:"@site/docs/user_manual/operation_and_maintenance/en-US/development_specification/03_sql_specification.md",sourceDirName:"user_manual/operation_and_maintenance/en-US/development_specification",slug:"/user_manual/operation_and_maintenance/en-US/development_specification/sql_specification",permalink:"/docs/user_manual/operation_and_maintenance/en-US/development_specification/sql_specification",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/en-US/development_specification/03_sql_specification.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"SQL Development Specifications",weight:3},sidebar:"operation_and_maintenanceEnglishSidebar",previous:{title:"Character Set Usage Specifications",permalink:"/docs/user_manual/operation_and_maintenance/en-US/development_specification/charset_specification"},next:{title:"Limitations",permalink:"/docs/user_manual/operation_and_maintenance/en-US/development_specification/some_limits"}},r={},d=[{value:"Specifications for the SELECT Statement",id:"specifications-for-the-select-statement",level:2},{value:"Specifications for DML Statements",id:"specifications-for-dml-statements",level:2},{value:"Specifications for DDL statements",id:"specifications-for-ddl-statements",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note:"}),"\n",(0,s.jsx)(n.p,{children:"The specifications in this topic are only recommended. You can determine whether to follow these specifications based on your business requirements."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"specifications-for-the-select-statement",children:"Specifications for the SELECT Statement"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"For an SQL statement that uses a partitioned table, we recommend that you include the partitioning key in the predicate to avoid unnecessary full table scans."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We recommend that the columns specified in the ",(0,s.jsx)(n.code,{children:"ORDER BY"})," clause be unique or unique in combination."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Unlike a standalone database, a distributed database may produce unstable sorting results when sorting data by a non-unique column, as it implements sorting in a fundamentally different way. For example, the result of ",(0,s.jsx)(n.code,{children:"ORDER BY c1"})," may be as follows in a distributed database:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"c1"}),(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"c2"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u2003\u2003\u2003 1 \u2003\u2003\u2003"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u2003\u2003\u2003 a \u2003\u2003\u2003"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"1"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"b"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"2"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"2"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"d"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The result may also be as follows:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"c1"}),(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"c2"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u2003\u2003\u2003 1 \u2003\u2003\u2003"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"\u2003\u2003\u2003 b \u2003\u2003\u2003"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"1"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"a"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"2"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"d"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"2"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"c"})]})]})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We recommend that you do not use an ",(0,s.jsx)(n.code,{children:"IN"})," operator. Instead, try to rewrite a subquery with an ",(0,s.jsx)(n.code,{children:"IN"})," operator by using a ",(0,s.jsx)(n.code,{children:"JOIN"})," operator. If an ",(0,s.jsx)(n.code,{children:"IN"})," operator is required, do not specify more than 100 collection elements after the operator."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If data deduplication is not required, we recommend that you use the ",(0,s.jsx)(n.code,{children:"UNION ALL"})," operator instead of the ",(0,s.jsx)(n.code,{children:"UNION"})," operator. The ",(0,s.jsx)(n.code,{children:"UNION ALL"})," operator can reduce unnecessary resource consumption for sorting."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)("code",{children:"COUNT(*)"})," counts the rows with a NULL value, whereas ",(0,s.jsx)("code",{children:"COUNT(column name)"})," does not count rows with a NULL value. Select a proper aggregation method based on your business requirements."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We recommend that you do not compare or join columns of different data types. Otherwise, implicit data type conversions may be performed and indexes cannot be used. If you must compare or join columns of different data types, you can use the ",(0,s.jsx)(n.code,{children:"CAST"})," or ",(0,s.jsx)(n.code,{children:"CONVERT"})," function to implement explicit data type conversions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We do not recommend the ",(0,s.jsx)(n.code,{children:"WHERE (c1, c2) = ('abc', 'def')"})," syntax. First, it is not standard SQL syntax and is applicable only to specific databases, which can cause compatibility issues. Second, although the syntax is supported by specific databases, it cannot utilize indexes or be optimized, compromising query performance. We recommend that you rewrite the preceding filter condition as ",(0,s.jsx)(n.code,{children:"WHERE c1 = 'abc' AND c2 = 'def'"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"When you set the degree of parallelism (DOP) for a query, the query shows the best performance if the DOP equals the number of table shards, and shows the second-best performance if the DOP generated by the auto DOP feature is used."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We recommend that you do not add a read lock by using ",(0,s.jsx)(n.code,{children:"SELECT ... FOR UPDATE (WITH CS)"}),". Otherwise, it can cause a lock wait and impact the business in the case of highly concurrent large transactions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We recommend that you specify column names in the ",(0,s.jsx)(n.code,{children:"SELECT"})," statement as needed. Try to avoid using the ",(0,s.jsx)(n.code,{children:"SELECT * "})," syntax, as it may lead to the following issues:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The parsing cost of the query analyzer is increased and additional I/O costs are generated."}),"\n",(0,s.jsx)(n.li,{children:"Table access by index primary key may occur and compromise query performance."}),"\n",(0,s.jsxs)(n.li,{children:["Adding or removing columns may cause inconsistencies with the upstream and downstream ",(0,s.jsx)(n.code,{children:"resultMap"})," configurations."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"specifications-for-dml-statements",children:"Specifications for DML Statements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["We recommend that you specify column names in an ",(0,s.jsx)(n.code,{children:"INSERT"})," statement instead of using the ",(0,s.jsx)(n.code,{children:"INSERT INTO TBL VALUES(......)"})," syntax. Otherwise, unexpected issues may occur when you add or remove columns in a table."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["A change made by a DML statement is persisted only when the transaction is committed. A single DML statement can be a transaction. You can configure the ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715675",children:"autocommit"})," system variable to specify whether to enable automatic commit of transactions. The default value of the system variable is ",(0,s.jsx)(n.code,{children:"1"}),", indicating that a DML statement is taken as a transaction and automatically committed."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["When you execute an ",(0,s.jsx)(n.code,{children:"UPDATE"})," statement that involves a large number of data records without using the ",(0,s.jsx)(n.code,{children:"WHERE"})," clause, a large transaction is generated. If the transaction times out, the ",(0,s.jsx)(n.code,{children:"UPDATE"})," statement may fail to be executed."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["We recommend that you use a ",(0,s.jsx)(n.code,{children:"WHERE"})," clause to control the number of rows to be updated in an ",(0,s.jsx)(n.code,{children:"UPDATE"})," statement. This ensures that the transaction is in a proper size."]}),"\n",(0,s.jsxs)(n.li,{children:["We recommend that you specify a ",(0,s.jsx)(n.code,{children:"WHERE"})," clause in a ",(0,s.jsx)(n.code,{children:"DELETE"})," statement to delete data in batches. Alternatively, you can use the ",(0,s.jsx)(n.code,{children:"TRUNCATE TABLE"})," statement to delete all data from the table. This can improve data deletion performance. However, the ",(0,s.jsx)(n.code,{children:"TRUNCATE"})," statement is a DDL statement and cannot be executed in another transaction."]}),"\n",(0,s.jsxs)(n.li,{children:["You can set greater values for the ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715719",children:"ob_query_timeout"})," and ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001715749",children:"ob_trx_timeout"})," variables to ensure that large transactions can be executed."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsxs)("font",{color:"red",children:["If you frequently insert, delete, or update data in a table, the buffer table issue may occur. You can enable the adaptive major compaction feature or set the ",(0,s.jsx)(n.code,{children:"table_mode"})," parameter to troubleshoot the issue. For more information, see ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001719947",children:"Adaptive major compactions"}),". "]})})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"specifications-for-ddl-statements",children:"Specifications for DDL statements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsxs)("font",{color:"red",children:["For more information about the online and offline DDL operations supported by OceanBase Database, see ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001784252",children:"Online and offline DDL operations"}),". When offline DDL operations are performed on a table, the table is locked and you cannot perform DML operations on the table. "]})})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"We recommend that you perform DDL operations during off-peak hours to reduce the impact on the system."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(96540);const i={},a=s.createContext(i);function o(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);