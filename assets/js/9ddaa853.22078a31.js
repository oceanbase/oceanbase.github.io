"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[3426],{46242:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=t(74848),s=t(28453);const o={slug:"ob-openai",title:"Build Your Own Document Q&A App with OceanBase and OpenAI in 30 mins"},r=void 0,i={id:"blogs/tech/ob-openai",title:"Build Your Own Document Q&A App with OceanBase and OpenAI in 30 mins",description:"\u2728 Intro: Vector Search Is the Core of AI Applications",source:"@site/docs/blogs/tech/ob-openai.md",sourceDirName:"blogs/tech",slug:"/blogs/tech/ob-openai",permalink:"/docs/blogs/tech/ob-openai",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/blogs/tech/ob-openai.md",tags:[],version:"current",frontMatter:{slug:"ob-openai",title:"Build Your Own Document Q&A App with OceanBase and OpenAI in 30 mins"},sidebar:"blogsSidebar",previous:{title:"OceanBase Helps Enterprises Cope with the Challenges of Database Transformation in the Deep Waters",permalink:"/docs/blogs/tech/ob-db-transform"},next:{title:"What Is a Schema in OceanBase Database?",permalink:"/docs/blogs/tech/ob-schema"}},c={},l=[{value:"\u2728 Intro: Vector Search Is the Core of AI Applications",id:"-intro-vector-search-is-the-core-of-ai-applications",level:2},{value:"\ud83d\udd0d Why Use OceanBase for Vector Search?",id:"-why-use-oceanbase-for-vector-search",level:2},{value:"\u2699\ufe0f Step-by-Step: Document Q&amp;A with OceanBase and OpenAI",id:"\ufe0f-step-by-step-document-qa-with-oceanbase-and-openai",level:2},{value:"1. Set Up OceanBase",id:"1-set-up-oceanbase",level:3},{value:"2. Create MySQL tenant and database",id:"2-create-mysql-tenant-and-database",level:3},{value:"2.1 Create a unit config",id:"21-create-a-unit-config",level:4},{value:"2.2 Create a resource pool",id:"22-create-a-resource-pool",level:4},{value:"2.3 Create a tenant",id:"23-create-a-tenant",level:4},{value:"3. Register an account on the LLM platform",id:"3-register-an-account-on-the-llm-platform",level:3},{value:"4. Store vector data to OceanBase Database",id:"4-store-vector-data-to-oceanbase-database",level:3},{value:"4.1 Store vector data in OceanBase Database",id:"41-store-vector-data-in-oceanbase-database",level:4},{value:"4.2 Query OceanBase data",id:"42-query-oceanbase-data",level:4},{value:"5. Summary",id:"5-summary",level:3},{value:"6. References",id:"6-references",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"-intro-vector-search-is-the-core-of-ai-applications",children:"\u2728 Intro: Vector Search Is the Core of AI Applications"}),"\n",(0,a.jsx)(n.p,{children:"AI-powered applications are evolving fast, and one of the most exciting capabilities is the RAG (Retrieval-Augmented Generation) pattern \u2014 combining language models like OpenAI\u2019s GPT with your own data for accurate, contextual answers."}),"\n",(0,a.jsx)(n.p,{children:"At the heart of any RAG system is a vector database \u2014 storing and searching embeddings for documents, questions, images, and more. Most developers turn to purpose-built vector DBs, but what if you could use a general-purpose distributed SQL database with native vector capabilities?"}),"\n",(0,a.jsx)(n.p,{children:"That\u2019s where OceanBase comes in."}),"\n",(0,a.jsx)(n.p,{children:"In this post, we\u2019ll show you how to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Turn your documents into embeddings using OpenAI"}),"\n",(0,a.jsx)(n.li,{children:"Store and index them in OceanBase"}),"\n",(0,a.jsx)(n.li,{children:"Run fast vector similarity search using SQL"}),"\n",(0,a.jsx)(n.li,{children:"Generate answers using GPT based on retrieved content"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Let\u2019s build a simple but powerful document Q&A system \u2014 using only OceanBase, OpenAI, and Python."}),"\n",(0,a.jsx)(n.p,{children:"Prerequisites"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Install Python 3.9 or above and corresponding pip."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Install poetry, pyobvector, and OpenAI SDK."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"python3 -m pip install poetry\npython3 -m pip install pyobvector\npython3 -m pip install openai\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Prepare your ",(0,a.jsx)(n.a,{href:"https://platform.openai.com/api-keys",children:"OpenAI API key"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Make sure you have set the ob_vector_memory_limit_percentage configuration item in your instance to enable vector retrieval. The recommended setting is 30"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-why-use-oceanbase-for-vector-search",children:"\ud83d\udd0d Why Use OceanBase for Vector Search?"}),"\n",(0,a.jsx)(n.p,{children:"OceanBase is a distributed relational database, originally developed by Ant Group, and now available as a fully open source, MySQL-compatible database."}),"\n",(0,a.jsx)(n.p,{children:"In its latest release, OceanBase added native support for vector indexing and search \u2014 including:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Vector data type and distance functions (L2, IP)"}),"\n",(0,a.jsx)(n.li,{children:"Index-based nearest neighbor search"}),"\n",(0,a.jsx)(n.li,{children:"Seamless SQL integration for hybrid queries"}),"\n",(0,a.jsx)(n.li,{children:"Cost-effective storage and horizontal scalability"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This means you can store structured data + vector embeddings in one system, run fast retrieval with SQL, and build AI features without extra infrastructure."}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-step-by-step-document-qa-with-oceanbase-and-openai",children:"\u2699\ufe0f Step-by-Step: Document Q&A with OceanBase and OpenAI"}),"\n",(0,a.jsx)(n.p,{children:"If you have deployed OceanBase database V4.3.3 or above, created MySQL mode tenants, databases, and accounts, and granted read and write permissions to the database accounts, you can skip steps 1 and 2 below."}),"\n",(0,a.jsx)(n.h3,{id:"1-set-up-oceanbase",children:"1. Set Up OceanBase"}),"\n",(0,a.jsxs)(n.p,{children:["You can install OceanBase locally using OceanBase Community Edition by following the ",(0,a.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001976348",children:"official doc - Deploy OceanBase Database in a Docker container"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"2-create-mysql-tenant-and-database",children:"2. Create MySQL tenant and database"}),"\n",(0,a.jsx)(n.h4,{id:"21-create-a-unit-config",children:"2.1 Create a unit config"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 1:"})}),"\n",(0,a.jsx)(n.p,{children:"Log in to the sys tenant of the cluster as the root user."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"obclient -h172.30.xx.xx -P2883 -uroot@sys#cluster -p**** -A\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 2:"})}),"\n",(0,a.jsx)(n.p,{children:"Access the database named oceanbase."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"USE oceanbase;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 3:"})}),"\n",(0,a.jsx)(n.p,{children:"Query the DBA_OB_UNIT_CONFIGS view for information about existing unit configs."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_UNIT_CONFIGS;\n+----------------+-------------------------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+\n| UNIT_CONFIG_ID | NAME                          | CREATE_TIME                | MODIFY_TIME                | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |\n+----------------+-------------------------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+\n|              1 | sys_unit_config               | 2022-12-20 17:50:17.035504 | 2022-12-20 17:50:17.035504 |       1 |       1 | 14495514624 |   14495514624 |    10000 |    10000 |           1 |\n|           1001 | config_mysql001_zone1_S1_okz  | 2022-12-20 18:04:31.547715 | 2022-12-20 18:04:31.547715 |     1.5 |     1.5 |  6442450944 |   19327352832 |    15000 |    15000 |           1 |\n|           1002 | config_mysql001_zone2_S1_pme  | 2022-12-20 18:04:31.561335 | 2022-12-20 18:04:31.561335 |     1.5 |     1.5 |  6442450944 |   19327352832 |    15000 |    15000 |           1 |\n|           1003 | config_mysql001_zone3_S1_jsu  | 2022-12-20 18:04:31.564510 | 2022-12-20 18:04:31.564510 |     1.5 |     1.5 |  6442450944 |   19327352832 |    15000 |    15000 |           1 |\n|           1013 | config_oracle001_zone3_S1_exu | 2022-12-26 18:28:37.969047 | 2022-12-26 18:28:37.969047 |     1.5 |     1.5 |  6442450944 |   19327352832 |    15000 |    15000 |           1 |\n|           1014 | config_oracle001_zone2_S1_hli | 2022-12-26 18:28:37.972194 | 2022-12-26 18:28:37.972194 |     1.5 |     1.5 |  6442450944 |   19327352832 |    15000 |    15000 |           1 |\n|           1015 | config_oracle001_zone1_S1_owy | 2022-12-26 18:28:37.976446 | 2022-12-26 18:28:37.976446 |     1.5 |     1.5 |  6442450944 |   19327352832 |    15000 |    15000 |           1 |\n+----------------+-------------------------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+\n7 rows in set\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 4:"})}),"\n",(0,a.jsx)(n.p,{children:"Execute the CREATE RESOURCE UNIT statement to create a unit config."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE RESOURCE UNIT unit_name \n    MEMORY_SIZE [=] 'size_value',\n    MAX_CPU [=] cpu_num,  \n    [MAX_IOPS [=] iops_num,]\n    [MIN_CPU [=] cpu_num,]\n    [MIN_IOPS [=] iops_num,]\n    [IOPS_WEIGHT [=]iopsweight,]\n    [LOG_DISK_SIZE [=] 'size_value'];\n"})}),"\n",(0,a.jsx)(n.p,{children:"Here is an example:\nCreate a unit config named S1_unit_config that contains one CPU core, 5 GB of memory, and 6 GB of log disk space."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> CREATE RESOURCE UNIT S1_unit_config\n                MEMORY_SIZE = '5G',\n                MAX_CPU = 1, MIN_CPU = 1,\n                LOG_DISK_SIZE = '6G',\n                MAX_IOPS = 10000, MIN_IOPS = 10000, IOPS_WEIGHT=1;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 5:"})}),"\n",(0,a.jsx)(n.p,{children:"Query the DBA_OB_UNIT_CONFIGS view to verify whether the unit config is successfully created."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_UNIT_CONFIGS WHERE NAME = 'S1_unit_config';\n+----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+\n| UNIT_CONFIG_ID | NAME           | CREATE_TIME                | MODIFY_TIME                | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |\n+----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+\n|           1020 | S1_unit_config | 2023-01-10 22:31:38.805862 | 2023-01-10 22:31:38.805862 |       1 |       1 |  5368709120 |    6442450944 |    10000 |    10000 |           1 |\n+----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+\n1 row in set\n"})}),"\n",(0,a.jsx)(n.h4,{id:"22-create-a-resource-pool",children:"2.2 Create a resource pool"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 1:"})}),"\n",(0,a.jsx)(n.p,{children:"Log in to the sys tenant of the cluster as the root user."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient -h172.30.xx.xx -P2883 -uroot@sys#cluster -p**** -A\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 2:"})}),"\n",(0,a.jsx)(n.p,{children:"Access the database named oceanbase."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [(none)]> USE oceanbase;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 3:"})}),"\n",(0,a.jsx)(n.p,{children:"Query the DBA_OB_RESOURCE_POOLS view for the configuration information about resource pools."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_RESOURCE_POOLS;\n+------------------+--------------------------+-----------+----------------------------+----------------------------+------------+----------------+-------------------+--------------+\n| RESOURCE_POOL_ID | NAME                     | TENANT_ID | CREATE_TIME                | MODIFY_TIME                | UNIT_COUNT | UNIT_CONFIG_ID | ZONE_LIST         | REPLICA_TYPE |\n+------------------+--------------------------+-----------+----------------------------+----------------------------+------------+----------------+-------------------+--------------+\n|                1 | sys_pool                 |         1 | 2022-12-20 17:50:17.038641 | 2022-12-20 17:50:17.045453 |          1 |              1 | zone1;zone2;zone3 | FULL         |\n|             1001 | pool_mysql001_zone3_jsu  |      1002 | 2022-12-20 18:04:31.607227 | 2022-12-20 18:04:31.692836 |          1 |           1003 | zone3             | FULL         |\n|             1002 | pool_mysql001_zone1_okz  |      1002 | 2022-12-20 18:04:31.617087 | 2022-12-20 18:04:31.691827 |          1 |           1001 | zone1             | FULL         |\n|             1003 | pool_mysql001_zone2_pme  |      1002 | 2022-12-20 18:04:31.621327 | 2022-12-20 18:04:31.692836 |          1 |           1002 | zone2             | FULL         |\n|             1013 | pool_oracle001_zone3_exu |      1010 | 2022-12-26 18:28:37.979539 | 2022-12-26 18:28:38.059505 |          1 |           1013 | zone3             | FULL         |\n|             1014 | pool_oracle001_zone1_owy |      1010 | 2022-12-26 18:28:37.988964 | 2022-12-26 18:28:38.058440 |          1 |           1015 | zone1             | FULL         |\n|             1015 | pool_oracle001_zone2_hli |      1010 | 2022-12-26 18:28:37.994241 | 2022-12-26 18:28:38.059505 |          1 |           1014 | zone2             | FULL         |\n+------------------+--------------------------+-----------+----------------------------+----------------------------+------------+----------------+-------------------+--------------+\n7 rows in set\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 4:"})}),"\n",(0,a.jsx)(n.p,{children:"Execute the CREATE RESOURCE POOL statement to create a resource pool."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE RESOURCE POOL poolname \n    UNIT [=] unitname, \n    UNIT_NUM [=] unitnum, \n    ZONE_LIST [=] ('zone' [, 'zone' ...]);\n"})}),"\n",(0,a.jsx)(n.p,{children:"Here is an example:"}),"\n",(0,a.jsx)(n.p,{children:"Create a resource pool named mq_pool_01, a resource unit for each of zone1 and zone2, and a unit config named S1_unit_config for the resource units."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> CREATE RESOURCE POOL mq_pool_01 \n                UNIT='S1_unit_config', \n                UNIT_NUM=1, \n                ZONE_LIST=('zone1','zone2'); \n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 5:"})}),"\n",(0,a.jsx)(n.p,{children:"Query the DBA_OB_RESOURCE_POOLS view to verify whether the resource pool is successfully created."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> SELECT * FROM DBA_OB_RESOURCE_POOLS WHERE NAME = 'mq_pool_01';\n+------------------+------------+-----------+----------------------------+----------------------------+------------+----------------+-------------+--------------+\n| RESOURCE_POOL_ID | NAME       | TENANT_ID | CREATE_TIME                | MODIFY_TIME                | UNIT_COUNT | UNIT_CONFIG_ID | ZONE_LIST   | REPLICA_TYPE |\n+------------------+------------+-----------+----------------------------+----------------------------+------------+----------------+-------------+--------------+\n|             1024 | mq_pool_01 |      NULL | 2023-01-10 22:37:08.212366 | 2023-01-10 22:37:08.212366 |          1 |           1020 | zone1;zone2 | FULL         |\n+------------------+------------+-----------+----------------------------+----------------------------+------------+----------------+-------------+--------------+\n1 row in set\n"})}),"\n",(0,a.jsx)(n.h4,{id:"23-create-a-tenant",children:"2.3 Create a tenant"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 1:"})}),"\n",(0,a.jsx)(n.p,{children:"Log in to the sys tenant of the cluster as the root user."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"obclient -h172.30.xx.xx -P2883 -uroot@sys#cluster -p**** -A\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 2:"})}),"\n",(0,a.jsx)(n.p,{children:"Access the database named oceanbase."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"USE oceanbase;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 3:"})}),"\n",(0,a.jsx)(n.p,{children:"Query the DBA_OB_TENANTS view for information about all tenants."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_TENANTS;\n+-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+\n| TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE | LOCALITY      | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED | TENANT_ROLE | SWITCHOVER_STATUS | SWITCHOVER_EPOCH | SYNC_SCN            | REPLAYABLE_SCN      | READABLE_SCN        | RECOVERY_UNTIL_SCN  | LOG_MODE     | ARBITRATION_SERVICE_STATUS |\n+-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+\n|         1 | sys         | SYS         | 2023-05-17 18:10:19.940353 | 2023-05-17 18:10:19.940353 | RANDOM       | FULL{1}@zone1 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 |                NULL |                NULL |                NULL |                NULL | NOARCHIVELOG | DISABLED                   |\n|      1001 | META$1002   | META        | 2023-05-17 18:15:21.455549 | 2023-05-17 18:15:36.639479 | zone1        | FULL{1}@zone1 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 |                NULL |                NULL |                NULL |                NULL | NOARCHIVELOG | DISABLED                   |\n|      1002 | mysql001    | USER        | 2023-05-17 18:15:21.461276 | 2023-05-17 18:15:36.669988 | zone1        | FULL{1}@zone1 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1684395321137516636 | 1684395321137516636 | 1684395321052204807 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |\n|      1003 | META$1004   | META        | 2023-05-17 18:18:19.927859 | 2023-05-17 18:18:36.443233 | zone1        | FULL{1}@zone1 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 |                NULL |                NULL |                NULL |                NULL | NOARCHIVELOG | DISABLED                   |\n|      1004 | oracle001   | USER        | 2023-05-17 18:18:19.928914 | 2023-05-17 18:18:36.471606 | zone1        | FULL{1}@zone1 | NULL              | ORACLE             | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1684395321137558760 | 1684395321137558760 | 1684395320951813345 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |\n+-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+\n5 rows in set\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 4:"})}),"\n",(0,a.jsx)(n.p,{children:"Execute the CREATE TENANT statement to create a tenant."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TENANT [IF NOT EXISTS] tenant_name  \n    PRIMARY_ZONE [=] zone,\n    RESOURCE_POOL_LIST [=](poolname [, poolname...])\n    [ENABLE_ARBITRATION_SERVICE = {true | false}]\n    {SET | SET VARIABLES | VARIABLES} system_var_name = expr [,system_var_name = expr] ...\n"})}),"\n",(0,a.jsx)(n.p,{children:"Here is an example:"}),"\n",(0,a.jsx)(n.p,{children:"Create a tenant named mq_t1, which is a MySQL tenant by default. Set the number of replicas to 2, resource pool to mq_pool_01, and primary zone to zone1, and allow all IP addresses to connect to the tenant."}),"\n",(0,a.jsx)(n.p,{children:"The list of zones where the tenant is distributed is inherited from the ZONE_LIST attribute of the resource pool specified by RESOURCE_POOL_LIST. The number of replicas of the tenant is the same as the number of zones specified by the ZONE_LIST attribute of the resource pool specified by RESOURCE_POOL_LIST. The number of resource units in each zone is equal to the value of the UNIT_NUM attribute of the resource pool specified by RESOURCE_POOL_LIST. The unit config for the resource units of the tenant is determined by the UNIT attribute of the resource pool specified by RESOURCE_POOL_LIST."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> CREATE TENANT IF NOT EXISTS mq_t1 \n                PRIMARY_ZONE='zone1', \n                RESOURCE_POOL_LIST=('mq_pool_01')\n                set OB_TCP_INVITED_NODES='%';\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 5:"})}),"\n",(0,a.jsx)(n.p,{children:"Query the DBA_OB_TENANTS view to verify whether the tenant is successfully created."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [oceanbase]> SELECT * FROM DBA_OB_TENANTS WHERE TENANT_NAME = 'mq_t1';\n+-----------+-------------+-------------+----------------------------+----------------------------+--------------+------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+\n| TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE | LOCALITY                     | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED | TENANT_ROLE | SWITCHOVER_STATUS | SWITCHOVER_EPOCH | SYNC_SCN            | REPLAYABLE_SCN      | READABLE_SCN        | RECOVERY_UNTIL_SCN  | LOG_MODE     | ARBITRATION_SERVICE_STATUS |\n+-----------+-------------+-------------+----------------------------+----------------------------+--------------+------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+\n|      1006 | mq_t1       | USER        | 2023-05-18 15:48:57.447657 | 2023-05-18 15:49:12.857944 | zone1;zone2  | FULL{1}@zone1, FULL{1}@zone2 | NULL              | MYSQL              | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1684396167132057328 | 1684396167132057328 | 1684396167051160964 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |\n+-----------+-------------+-------------+----------------------------+----------------------------+--------------+------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+\n1 row in set\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 6:"})}),"\n",(0,a.jsx)(n.p,{children:"After the tenant is created, try to log in to the tenant.\nBy default, the password of the administrator user is empty. The administrator user is named root in MySQL mode. You must change its password as soon as possible."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Log in to the mq_t1 tenant as the root user."}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient -h172.30.xx.xx -P2883 -uroot@mq_t1#cluster  -A\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Execute the following statement to change the password of the root user:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient [(none)]> ALTER USER root IDENTIFIED BY '****';\nQuery OK, 0 rows affected\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Step 7:"})}),"\n",(0,a.jsx)(n.p,{children:"After the password is changed, log in to the tenant again."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"obclient -h172.30.xx.xx -P2883 -uroot@mq_t1#cluster -p**** -A\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-register-an-account-on-the-llm-platform",children:"3. Register an account on the LLM platform"}),"\n",(0,a.jsx)(n.p,{children:"Obtain an OpenAI API key:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Log in to the ",(0,a.jsx)(n.a,{href:"https://platform.openai.com/",children:"OpenAI"})," console."]}),"\n",(0,a.jsx)(n.li,{children:"In the upper-right corner, click API Keys."}),"\n",(0,a.jsx)(n.li,{children:"Click Create API Key."}),"\n",(0,a.jsx)(n.li,{children:"Fill in the required information and click Create API Key."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Configure the OpenAI API key as an environment variable:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"For a Unix-based system (such as Ubuntu or MacOS), run the following command in the terminal:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"export OPENAI_API_KEY='your-api-key'\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"For a Windows system, run the following command in the command prompt:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"set OPENAI_API_KEY=your-api-key\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Make sure to replace your-api-key with your actual OpenAI API key."})}),"\n",(0,a.jsx)(n.h3,{id:"4-store-vector-data-to-oceanbase-database",children:"4. Store vector data to OceanBase Database"}),"\n",(0,a.jsx)(n.p,{children:"After you have completed the preceding steps, you can store vector data to OceanBase Database."}),"\n",(0,a.jsx)(n.h4,{id:"41-store-vector-data-in-oceanbase-database",children:"4.1 Store vector data in OceanBase Database"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Step 1:"}),"\nPrepare test data.\nDownload the ",(0,a.jsx)(n.a,{href:"https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20240827/srxyhu/fine_food_reviews.csv",children:"CSV"})," file that contains pre-computed vectorized data. The CSV file contains 1,000 reviews of food and the last column contains the vectorized values. Therefore, you do not need to compute the vectors again. You can also use the following code to recalculate the embedding column (i.e., the vector column) and generate a new CSV file."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from openai import OpenAI\nimport pandas as pd\ninput_datapath = "./fine_food_reviews.csv"\nclient = OpenAI()\n# You can change the text-embedding-ada-002 model to another one as needed.\ndef embedding_text(text, model="text-embedding-ada-002"):\n    # For more information about how to generate embedding vectors, see: https://community.openai.com/t/embeddings-api-documentation-needs-to-updated/475663\n    res = client.embeddings.create(input=text, model=model)\n    return res.data[0].embedding\ndf = pd.read_csv(input_datapath, index_col=0)\n# It takes a few minutes to generate vectors. The OpenAI Embedding API is called for each row.\ndf["embedding"] = df.combined.apply(embedding_text)\noutput_datapath = \'./fine_food_reviews_self_embeddings.csv\'\ndf.to_csv(output_datapath)\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Step 2:"}),"\nRun the following script to insert the test data into OceanBase Database. The directory where the script is located must be the same as the directory where the test data is located."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"    import os\n    import sys\n    import csv\n    import json\n    from pyobvector import *\n    from sqlalchemy import Column, Integer, String\n    # Connect to OceanBase Database by using pyobvector. Replace @ in the username and password with %40.\n    client = ObVecClient(uri=\"host:port\", user=\"username\",password=\"****\",db_name=\"test\")\n    # The prepared test dataset has been vectorized. By default, the dataset is stored in the same directory as the Python script. If you have vectorized the dataset yourself, replace the file name with the name of the corresponding file.\n    file_name = \"fine_food_reviews.csv\"\n    file_path = os.path.join(\"./\", file_name)\n    # Define columns. The vectorized column is the last field.\n    cols = [\n        Column('id', Integer, primary_key=True, autoincrement=False),\n        Column('product_id', String(256), nullable=True),\n        Column('user_id', String(256), nullable=True),\n        Column('score', Integer, nullable=True),\n        Column('summary', String(2048), nullable=True),\n        Column('text', String(8192), nullable=True),\n        Column('combined', String(8192), nullable=True),\n        Column('n_tokens', Integer, nullable=True),\n        Column('embedding', VECTOR(1536))\n    ]\n    # Specify the table name.\n    table_name = 'fine_food_reviews'\n    # Create the table if it does not exist.\n    if not client.check_table_exists(table_name):\n        client.create_table(table_name,columns=cols)\n        # Create an index for the vector column.\n        client.create_index(\n            table_name=table_name,\n            is_vec_index=True,\n            index_name='vidx',\n            column_names=['embedding'],\n            vidx_params='distance=l2, type=hnsw, lib=vsag',\n        )\n    # Open and read the CSV file.\n    with open(file_name, mode='r', newline='', encoding='utf-8') as csvfile:\n        csvreader = csv.reader(csvfile)\n        # Read the header row.\n        headers = next(csvreader)\n        print(\"Headers:\", headers)\n        batch = [] # Store data. Insert the data into the database in batches of 10 rows.\n        for i, row in enumerate(csvreader):\n            # The CSV file has nine fields: id, product_id, user_id, score, summary, text, combined, n_tokens, and embedding.\n            if not row:\n                break\n            food_review_line= {'id':row[0],'product_id':row[1],'user_id':row[2],'score':row[3],'summary':row[4],'text':row[5],\\\n            'combined':row[6],'n_tokens':row[7],'embedding':json.loads(row[8])}\n            batch.append(food_review_line)\n            # Insert data in batches of 10 rows.\n            if (i + 1) % 10 == 0:\n                client.insert(table_name,batch)\n                batch = []  # Clear the cache.\n        # Insert the remaining rows (if any).\n        if batch:\n            client.insert(table_name,batch)\n    # Check the data in the table to make sure that all data has been inserted.\n    count_sql = f\"select count(*) from {table_name};\"\n    cursor = client.perform_raw_text_sql(count_sql)\n    result = cursor.fetchone()\n    print(f\"Total number of imported rows:{result[0]}\")\n"})}),"\n",(0,a.jsx)(n.h4,{id:"42-query-oceanbase-data",children:"4.2 Query OceanBase data"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Step 1:"}),"\nSave the following Python script as openAIQuery.py"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'    import os\n    import sys\n    import csv\n    import json\n    from pyobvector import *\n    from sqlalchemy import func\n    from openai import OpenAI\n    # Get the command-line arguments.\n    if len(sys.argv) != 2:\n        print("Please enter a query statement.")\n        sys.exit()\n    queryStatement = sys.argv[1]\n    # Connect to OceanBase Database by using pyobvector. Replace @ in the username or password with %40.\n    client = ObVecClient(uri="host:port", user="usename",password="****",db_name="test")\n    openAIclient = OpenAI()\n    # Define a function to generate text vectors.\n    def generate_embeddings(text, model="text-embedding-ada-002"):\n        # For more information about how to create embedding vectors, see: https://community.openai.com/t/embeddings-api-documentation-needs-to-updated/475663\n        res = openAIclient.embeddings.create(input=text, model=model)\n        return res.data[0].embedding\n\n    def query_ob(query, tableName, vector_name="embedding", top_k=1):\n        embedding = generate_embeddings(query)\n        # Perform approximate nearest neighbor search.\n        res = client.ann_search(\n            table_name=tableName,\n            vec_data=embedding,\n            vec_column_name=vector_name,\n            distance_func=func.l2_distance,\n            topk=top_k,\n            output_column_names=[\'combined\']\n        )\n        for row in res:\n            print(str(row[0]).replace("Title: ", "").replace("; Content: ", ": "))\n    # Specify the table name.\n    table_name = \'fine_food_reviews\'\n    query_ob(queryStatement,table_name,\'embedding\',1)\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Step 2:"}),"\nEnter a question and obtain the relevant answer."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"python3 openAIQuery.py 'pet food'\n"})}),"\n",(0,a.jsx)(n.p,{children:"The expected result is as follows:"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Crack for dogs. These thing are like crack for dogs. I am not sure of the make-up but the doggies sure love them."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"5-summary",children:"5. Summary"}),"\n",(0,a.jsx)(n.p,{children:"\u2705 Result: A Lightweight, End-to-End Q&A App"}),"\n",(0,a.jsx)(n.p,{children:"You now have a working document-based Q&A system that:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Uses OpenAI to generate vector embeddings"}),"\n",(0,a.jsx)(n.li,{children:"Stores and indexes them in OceanBase"}),"\n",(0,a.jsx)(n.li,{children:"Runs fast retrieval with pure SQL"}),"\n",(0,a.jsx)(n.li,{children:"Uses GPT to answer based on real content"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"No need for extra vector DBs or complex infrastructure \u2014 just one OceanBase instance and a few lines of Python."}),"\n",(0,a.jsx)(n.p,{children:"\ud83e\udded What\u2019s Next?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\ud83d\udcc4 Add metadata (source, tags) to build a smarter retrieval system"}),"\n",(0,a.jsx)(n.li,{children:"\ud83d\ude80 Scale to millions of documents \u2014 OceanBase supports large-scale deployments with strong consistency"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"6-references",children:"6. References"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001976365",children:"ob + openAI"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971591",children:"create a tenant"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001976348",children:"Deploy OceanBase Database in a container"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var a=t(96540);const s={},o=a.createContext(s);function r(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);