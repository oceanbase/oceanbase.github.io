"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[8833],{81815:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var a=n(74848),r=n(28453);const s={title:"Read/Write Splitting Strategy and Architecture",weight:3},i=void 0,o={id:"user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap/read_write_separation_best_practices",title:"Read/Write Splitting Strategy and Architecture",description:"Note: At present, OceanBase Advanced Tutorial for DBAs applies only to OceanBase Database Community Edition. Therefore, the arbitration replica feature of OceanBase Database Enterprise Edition is not included in the tutorial outline provided in this topic. For more information about the differences between the two editions, see Differences between Enterprise Edition and Community Edition.",source:"@site/docs/user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap/03_read_write_separation_best_practices.md",sourceDirName:"user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap",slug:"/user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap/read_write_separation_best_practices",permalink:"/docs/user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap/read_write_separation_best_practices",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap/03_read_write_separation_best_practices.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Read/Write Splitting Strategy and Architecture",weight:3},sidebar:"operation_and_maintenanceEnglishSidebar",previous:{title:"Background Knowledge of the SQL Engine",permalink:"/docs/user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap/background_knowledge"},next:{title:"HTAP System Architecture Design",permalink:"/docs/user_manual/operation_and_maintenance/en-US/scenario_best_practices/chapter_03_htap/htap_best_practices"}},l={},c=[{value:"Overview",id:"overview",level:2},{value:"Follower-first Read (Weak-consistency Read) Strategy",id:"follower-first-read-weak-consistency-read-strategy",level:2},{value:"Read-only Zone Strategy",id:"read-only-zone-strategy",level:2},{value:"Read-only Replica Strategy",id:"read-only-replica-strategy",level:2},{value:"Read-only Standby Cluster (Standby Tenant) Strategy",id:"read-only-standby-cluster-standby-tenant-strategy",level:2},{value:"Summary",id:"summary",level:2},{value:"References",id:"references",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["Note: At present, ",(0,a.jsx)(t.em,{children:"OceanBase Advanced Tutorial for DBAs"})," applies only to OceanBase Database Community Edition. Therefore, the arbitration replica feature of OceanBase Database Enterprise Edition is not included in the tutorial outline provided in this topic. For more information about the differences between the two editions, see ",(0,a.jsx)(t.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001714481",children:"Differences between Enterprise Edition and Community Edition"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(t.p,{children:"The read/write splitting strategy separates query operations from write operations in a database, preventing mutual impact and improving resource utilization. In a hybrid transaction and analytical processing (HTAP) database, read/write splitting scenarios are common, and read-only scenarios include business intelligence (BI) queries, extract, transform, and load (ETL) in big data, and data pulling from caches."}),"\n",(0,a.jsx)(t.p,{children:"Hosting both transaction processing (TP) business and analytical processing (AP) business in the same database cluster raises high requirements for database configurations. The read/write splitting strategy is generally used to route some read requests to followers to reduce the resource usage by complex online analytical processing (OLAP) requests and shorten the response time of online business."}),"\n",(0,a.jsxs)(t.p,{children:["OceanBase Database natively supports read/write splitting by using ",(0,a.jsx)(t.a,{href:"https://open.oceanbase.com/blog/10900290",children:"OceanBase Database Proxy (ODP)"})," and modifying the configurations of OBServer nodes."]}),"\n",(0,a.jsxs)(t.p,{children:["OceanBase Database provides two read consistency levels: strong consistency and weak consistency. Strong-consistency read requests are routed to the leader to read the latest data. ",(0,a.jsx)(t.a,{href:"https://en.oceanbase.com/docs/common-oceanbase-database-10000000001029729",children:"Weak-consistency read requests"})," are preferentially routed to followers and may not read the latest data."]}),"\n",(0,a.jsx)(t.p,{children:"OceanBase Database allows you to add an SQL hint to an SQL statement to be executed at the application side to explicitly enable weak-consistency reads, thereby implementing comment-based read-write splitting. OceanBase Database supports the following three common read/write splitting strategies and allows you to flexibly configure a read/write splitting strategy as needed."}),"\n",(0,a.jsx)(t.h2,{id:"follower-first-read-weak-consistency-read-strategy",children:"Follower-first Read (Weak-consistency Read) Strategy"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"Single-table SQL queries are generally routed to the node where the leader of the table resides, regardless of the ODP that you use to connect to the OceanBase cluster. This default routing strategy is called strong-consistency read."}),"\n",(0,a.jsx)(t.li,{children:"You can change the routing strategy of ODP to follower-first so that business read traffic is assigned to the ODP and read requests are preferentially routed to followers. By default, ODP routes a read request to the local follower. If the local replica is the leader, ODP preferentially routes the read request to the follower in another IDC in the same region. In one word, the follower-first read strategy means to read a nearby follower."}),"\n",(0,a.jsxs)(t.li,{children:["For the configuration method, see ",(0,a.jsx)(t.a,{href:"https://en.oceanbase.com/docs/common-best-practices-10000000001714402",children:"Best practices for read/write splitting"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"The following figure shows the routing strategy."})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"image.png",src:n(4983).A+"",width:"817",height:"783"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Advantages"}),": The configuration procedure is simple. You need to modify only ODP settings but no OBServer node settings. Read traffic is evenly distributed to all followers."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Disadvantages"}),": If the local replica is the leader, read requests need to be routed across IDCs (zones). If leaders are not changed, the leader and followers of different replicas may coexist in the same zone or server. In other words, zone- or server-level read/write splitting cannot be fully implemented."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:(0,a.jsx)("font",{color:"red",children:"Scenarios: Generally, the follower-first read (weak-consistency read) strategy applies to scenarios without high requirements for read/write splitting and with a few read requests. For a scenario with many read requests, the read-only zone or read-only replica strategy is recommended to avoid affecting read and write operations of the leader. "})})}),"\n",(0,a.jsx)(t.h2,{id:"read-only-zone-strategy",children:"Read-only Zone Strategy"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Set ",(0,a.jsx)(t.code,{children:"PRIMARY_ZONE"})," to ",(0,a.jsx)(t.code,{children:"zone1,zone2;zone3"}),". Note that a comma (,) is used between ",(0,a.jsx)(t.code,{children:"zone1"})," and ",(0,a.jsx)(t.code,{children:"zone2"}),", while a semicolon (;) is used between ",(0,a.jsx)(t.code,{children:"zone2"})," and ",(0,a.jsx)(t.code,{children:"zone3"}),", which indicates that both ",(0,a.jsx)(t.code,{children:"zone1"})," and ",(0,a.jsx)(t.code,{children:"zone2"})," are set to primary zones. Therefore, all leaders will be migrated to ",(0,a.jsx)(t.code,{children:"zone1"})," and ",(0,a.jsx)(t.code,{children:"zone2"}),". By default, followers are routed to ",(0,a.jsx)(t.code,{children:"zone3"})," and are configured to process only OLAP SQL statements for which the weak-consistency read strategy is specified."]}),"\n",(0,a.jsx)(t.li,{children:"SQL statements that require weak-consistency read are routed to the ODP with weak-consistency read enabled. Other SQL statements are routed to a normal ODP."}),"\n",(0,a.jsx)(t.li,{children:"All SQL statements bound for the ODP with weak-consistency read enabled are automatically routed to the local follower based on the logical data center (LDC)-based strategy and follower-first read strategy."}),"\n",(0,a.jsxs)(t.li,{children:["For the configuration method, see ",(0,a.jsx)(t.a,{href:"https://en.oceanbase.com/docs/common-best-practices-10000000001714402",children:"Best practices for read/write splitting"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"The following figure shows the routing strategy."})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"image.png",src:n(16252).A+"",width:"677",height:"569"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Advantages"}),": Read/Write splitting is implemented at the zone level by setting a read-only zone. The isolation performance is higher than that of the follower-first read strategy."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Disadvantages"}),": The primary zones must be manually specified. The write traffic will be distributed to ",(0,a.jsx)(t.code,{children:"zone1"})," and ",(0,a.jsx)(t.code,{children:"zone2"}),"."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:(0,a.jsx)("font",{color:"red",children:"Scenarios: The read-only zone strategy applies to scenarios with balanced read and write requests. "})})}),"\n",(0,a.jsx)(t.h2,{id:"read-only-replica-strategy",children:"Read-only Replica Strategy"}),"\n",(0,a.jsx)(t.p,{children:"Apart from full-featured replicas, OceanBase Database also supports read-only replicas. The name of read-only replicas is READONLY or R for short. Read-only replicas support read operations and do not support write operations. A read-only replica can serve only as a follower of a log stream, and cannot participate in election or voting. In other words, a read-only replica cannot be elected as the leader of the log stream."}),"\n",(0,a.jsx)(t.p,{children:"You can configure a dedicated zone to host a read-only replica for processing OLAP requests. When the read-only replica fails, services of the primary cluster are not affected."}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"The primary cluster provides services normally."}),"\n",(0,a.jsx)(t.li,{children:"AP requests are routed by using an independent ODP to a read-only replica."}),"\n",(0,a.jsxs)(t.li,{children:["Select the read-only replica type for the corresponding zone during tenant creation. ",(0,a.jsx)(t.strong,{children:"Note that a full-featured replica can be dynamically switched to a read-only replica."})]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"image.png",src:n(33765).A+"",width:"3438",height:"1932"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"The following figure shows the routing strategy."})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"image.png",src:n(49098).A+"",width:"937",height:"614"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Advantages"}),": OLAP requests can be fully isolated from online transaction processing (OLTP) requests without affecting each other."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Disadvantages"}),": More resources are required for the read-only replica."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:(0,a.jsx)("font",{color:"red",children:"Scenarios: The read-only replica strategy applies to scenarios with far more read requests than write requests, most of which do not require high real-time performance, or scenarios with a large number of AP requests. "})})}),"\n",(0,a.jsx)(t.h2,{id:"read-only-standby-cluster-standby-tenant-strategy",children:"Read-only Standby Cluster (Standby Tenant) Strategy"}),"\n",(0,a.jsxs)(t.p,{children:["The preceding read/write splitting strategies apply to the three-replica or five-replica architecture. ",(0,a.jsx)(t.strong,{children:(0,a.jsx)("font",{color:"red",children:"For scenarios that demand cost effectiveness but not require high availability"})}),", you can build a single-replica or three-replica standby cluster for the OceanBase cluster and route read-only requests only to the standby cluster."]}),"\n",(0,a.jsx)(t.p,{children:"Notice: A standby cluster supports only reads and the reads must have weak consistency."}),"\n",(0,a.jsxs)(t.p,{children:["For information about the Physical Standby Database solution, see ",(0,a.jsx)(t.a,{href:"https://oceanbase.github.io/docs/user_manual/operation_and_maintenance/en-US/disaster_recovery_architecture_design/primary_standby_database_solution",children:"Physical standby database solution based on asynchronous log replication"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"You can create a standby tenant in OceanBase Cloud Platform (OCP) by setting the tenant type to STANDBY and specifying the primary tenant for it."}),"\n",(0,a.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(t.p,{children:"To sum up, OceanBase Database supports the following read/write splitting strategies:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Follower-first read/Read-only zone: In the three-replica or five-replica architecture, you can specify a weak-consistency read hint or configure session settings to enable certain SQL statements to access a nearby read-only replica."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Read-only replica: In the three-replica or five-replica architecture, you can specify one or more additional read-only replicas and configure a dedicated ODP to route read-only requests to the read-only replicas."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Read-only standby cluster: You can build a standby cluster with one or three replicas. In this case, read-only requests are routed only to this standby cluster."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Advantages of the read/write splitting feature:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"A follower or read-only replica, which does not support write operations, will not be mistakenly written. All write operations will be routed to the leader."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"When a follower or read-only replica fails, ODP will route the requests to a nearby follower."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Finally, let me end this topic about read/write splitting with a user's fair comment: \"If you are used to Oracle's ADG or MySQL's master/slave read/write splitting, you may find OceanBase Database's read/write splitting solution a little complicated. Strictly speaking, a read/write splitting solution needs to consider various abnormal situations. That's exactly what OceanBase Database has done. What's more, OceanBase Database simplifies the configuration procedure and makes O&M easier.\""}),"\n",(0,a.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://open.oceanbase.com/blog/5581452032",children:"Read/Write Splitting"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://open.oceanbase.com/blog/1100238",children:"Architecture Design for AP Scenarios: Read/Write Splitting"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},4983:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/001-9f9e95c8d6a54d7b684f20e6e47f7dfb.png"},16252:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/002-bfe47ddee0771d40fe917aadec19d791.png"},33765:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/003-7852b8450343ef882ba41bb84920337e.png"},49098:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/004-c6ec46fa1e2bac1f4fed44b08c22dd88.png"},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var a=n(96540);const r={},s=a.createContext(r);function i(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);