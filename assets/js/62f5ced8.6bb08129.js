"use strict";(self.webpackChunkmy_docs_website=self.webpackChunkmy_docs_website||[]).push([[5912],{30044:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var s=t(74848),a=t(28453);const r={title:"Run the TPC-H benchmark",weight:6},i="3.5 Run the TPC-H benchmark",l={id:"user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/tpch_test",title:"Run the TPC-H benchmark",description:"This topic describes two methods to run the Transaction Processing Performance Council Benchmark H (TPC-H) benchmark on OceanBase Database in a CentOS Linux 7.9 environment based on the x86 architecture.",source:"@site/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/05_tpch_test.md",sourceDirName:"user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database",slug:"/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/tpch_test",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/tpch_test",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/oceanbase.github.io/tree/main/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/05_tpch_test.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Run the TPC-H benchmark",weight:6},sidebar:"quick_starts_and_hands_on_practices_in_englishSidebar",previous:{title:"Run the TPC-C benchmark",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/tpcc_test"},next:{title:"Use JMeter to test OceanBase Database in simulated business scenarios",permalink:"/docs/user_manual/quick_starts_and_hands_on_practices_in_english/chapter_03_test_oceanbase_database/jmeter_test"}},c={},d=[{value:"TPC-H overview",id:"tpc-h-overview",level:2},{value:"Database model",id:"database-model",level:3},{value:"SQL type",id:"sql-type",level:3},{value:"Metrics",id:"metrics",level:3},{value:"Use obdiag to inspect the cluster before running the benchmark",id:"use-obdiag-to-inspect-the-cluster-before-running-the-benchmark",level:2},{value:"Prepare the environment",id:"prepare-the-environment",level:2},{value:"Test plan",id:"test-plan",level:2},{value:"Test environment (Alibaba Cloud ECS)",id:"test-environment-alibaba-cloud-ecs",level:3},{value:"Software versions",id:"software-versions",level:3},{value:"Tenant specifications",id:"tenant-specifications",level:3},{value:"Use OBD to run the benchmark",id:"use-obd-to-run-the-benchmark",level:2},{value:"Manually run the TPC-H benchmark",id:"manually-run-the-tpc-h-benchmark",level:2},{value:"Step 1: Tune parameters",id:"step-1-tune-parameters",level:3},{value:"Step 2: Install the TPC-H tool",id:"step-2-install-the-tpc-h-tool",level:3},{value:"Step 3: Generate data",id:"step-3-generate-data",level:3},{value:"Step 5: Generate SQL query statements",id:"step-5-generate-sql-query-statements",level:3},{value:"Step 6: Create a table",id:"step-6-create-a-table",level:3},{value:"Step 7: Load data",id:"step-7-load-data",level:3},{value:"Step 8: Run the benchmark",id:"step-8-run-the-benchmark",level:3},{value:"Test results",id:"test-results",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"35-run-the-tpc-h-benchmark",children:"3.5 Run the TPC-H benchmark"})}),"\n",(0,s.jsx)(n.p,{children:"This topic describes two methods to run the Transaction Processing Performance Council Benchmark H (TPC-H) benchmark on OceanBase Database in a CentOS Linux 7.9 environment based on the x86 architecture."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Use OceanBase Deployer (OBD) to run the benchmark."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Manually run the benchmark step by step."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tpc-h-overview",children:"TPC-H overview"}),"\n",(0,s.jsx)(n.p,{children:"TPC-H is a business intelligence test set developed by the Transaction Processing Performance Council (TPC) of the United States to simulate the decision-making process of applications. It is commonly used in academia and industry for evaluating the performance of decision support applications."}),"\n",(0,s.jsx)(n.h3,{id:"database-model",children:"Database model"}),"\n",(0,s.jsxs)(n.p,{children:["The TPC-H model is a typical snowflake schema, which comprises eight tables. The ",(0,s.jsx)(n.code,{children:"nation"})," and ",(0,s.jsx)(n.code,{children:"region"})," tables have fixed amounts of data. The data amounts of the other six tables are correlated with the scale factor (SF). You can set the SF to 1, 100, or 1000, which respectively represents 1 GB, 100 GB, or 1000 GB. The amount of data in each table is determined based on the specified SF."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"part"}),": records parts information. The primary key is ",(0,s.jsx)(n.code,{children:"p_partkey"}),", whose value range is 1 to SF \xd7 200,000. This table is associated with the ",(0,s.jsx)(n.code,{children:"partsupp"})," table."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"supplier"}),": records supplier information. The primary key is ",(0,s.jsx)(n.code,{children:"s_suppkey"}),", whose value range is 1 to SF \xd7 10,000. This table is associated with the ",(0,s.jsx)(n.code,{children:"partsupp"}),", ",(0,s.jsx)(n.code,{children:"customer"}),", and ",(0,s.jsx)(n.code,{children:"nation"})," tables."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"partsupp"}),": records parts supply information. The primary keys are ",(0,s.jsx)(n.code,{children:"ps_partkey"})," and ",(0,s.jsx)(n.code,{children:"ps_suppkey"}),". This table is associated with the ",(0,s.jsx)(n.code,{children:"part"}),", ",(0,s.jsx)(n.code,{children:"supplier"}),", and ",(0,s.jsx)(n.code,{children:"lineitem"})," tables."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"customer"}),": records consumer information. The primary key is ",(0,s.jsx)(n.code,{children:"c_custkey"}),", whose value range is 1 to SF \xd7 150,000. This table is associated with the ",(0,s.jsx)(n.code,{children:"orders"})," table."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"orders"}),": records order information. The primary key is ",(0,s.jsx)(n.code,{children:"o_orderkey"}),", whose value range is 1 to SF \xd7 1,500,000. This table is associated with the ",(0,s.jsx)(n.code,{children:"lineitem"})," table."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"lineitem"}),": records information about commodities on sale. The primary keys are ",(0,s.jsx)(n.code,{children:"l_orderkey"})," and ",(0,s.jsx)(n.code,{children:"l_linenumber"}),". This table contains the largest amount of data."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"nation"}),": records country information. The primary key is ",(0,s.jsx)(n.code,{children:"n_nationkey"}),". This table contains information about 25 fixed countries."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"region"}),": records region information. The primary key is ",(0,s.jsx)(n.code,{children:"r_regionkey"}),". This table contains information about five fixed regions."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"sql-type",children:"SQL type"}),"\n",(0,s.jsx)(n.p,{children:"The TPC-H standard comprises 22 SQL statements, which are all query operations that aim to assess the following data analysis capabilities of databases:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Aggregation"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Join"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Expression calculation"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Subqueries"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Parallelism and concurrency"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"metrics",children:"Metrics"}),"\n",(0,s.jsxs)(n.p,{children:["TPC-H implements a data warehouse in the Third Normal Form (3NF) that contains eight basic relationships. The main evaluation metric is the response time of each query from its submission to the return of results. The TPC-H benchmark measures the number of queries executed per hour (QphH@size) in a database. ",(0,s.jsx)(n.code,{children:"H"})," indicates the average number of complex queries executed per hour and ",(0,s.jsx)(n.code,{children:"size"})," indicates the scale of the database. This metric reflects the query processing capacity of a database system."]}),"\n",(0,s.jsx)(n.h2,{id:"use-obdiag-to-inspect-the-cluster-before-running-the-benchmark",children:"Use obdiag to inspect the cluster before running the benchmark"}),"\n",(0,s.jsxs)(n.p,{children:["OceanBase Database is a native distributed database system. Root cause analysis for faults is complex because a variety of factors need to be considered, such as the server environment, parameters, and runtime load. Experts must collect and analyze extensive information during troubleshooting. Therefore, OceanBase Diagnostic Tool (obdiag) is introduced to help efficiently collect information scattered on various nodes. Before you run the TPC-H benchmark, you can use obdiag to perform a health check on OceanBase Database. For the check procedure, see the ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/obdiag-en",children:"obdiag Documentation"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"prepare-the-environment",children:"Prepare the environment"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Java Development Kit (JDK): Use V1.8u131 or later."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["CMake: Run the ",(0,s.jsx)(n.code,{children:"sudo yum install make"})," command to install CMake."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["GNU Compiler Collection (GCC): Run the ",(0,s.jsx)(n.code,{children:"sudo yum install gcc"})," command to install GCC."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["MySQL-devel: Run the ",(0,s.jsx)(n.code,{children:"sudo yum install mysql-devel"})," command to install MySQL-devel."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Python driver: Run the ",(0,s.jsx)(n.code,{children:"sudo yum install MySQL-python"})," command to install the Python driver."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["PrettyTable: Run the ",(0,s.jsx)(n.code,{children:"pip install prettytable"})," command to install PrettyTable."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["OceanBase Client (OBClient): For information about OBClient, see the ",(0,s.jsx)(n.a,{href:"https://github.com/oceanbase/obclient",children:"GitHub repository"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"test-plan",children:"Test plan"}),"\n",(0,s.jsx)(n.p,{children:"The TPC-H benchmark requires four servers, one for deploying the TPC-H tool, ODP, and OBD, and three for deploying an OceanBase cluster that has three zones, with each containing one OBServer node."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Notice"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"We recommend that you set input/output operations per second (IOPS) to a value greater than 10000, and configure three disks for system logs, transaction logs, and data files respectively."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If you use OBD to deploy the cluster, we recommend that you do not use the ",(0,s.jsx)(n.code,{children:"obd cluster autodeploy"})," command. This is because for consideration of system stability, the command will not maximize the resource utilization. We recommend that you customize the OBD configuration file to maximize the resource utilization."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"test-environment-alibaba-cloud-ecs",children:"Test environment (Alibaba Cloud ECS)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Service type"}),(0,s.jsx)(n.th,{children:"ECS type"}),(0,s.jsx)(n.th,{children:"Number of instances"}),(0,s.jsx)(n.th,{children:"Number of CPU cores"}),(0,s.jsx)(n.th,{children:"Memory"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"OceanBase Database"}),(0,s.jsx)(n.td,{children:"ecs.g7.8xlarge"}),(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"32"}),(0,s.jsx)(n.td,{children:"128 GB. The system disk of each server is sized 300 GB. Two 400 GB cloud disks are mounted as the clog disk and data disk, respectively. The performance level is PL1."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ODP and TPC-H tool"}),(0,s.jsx)(n.td,{children:"ecs.c7.16xlarge"}),(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"32"}),(0,s.jsx)(n.td,{children:"128 GB"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"software-versions",children:"Software versions"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Service type"}),(0,s.jsx)(n.th,{children:"Software version"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"OceanBase Database"}),(0,s.jsx)(n.td,{children:"OceanBase_CE 4.2.1.0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ODP"}),(0,s.jsx)(n.td,{children:"OBProxy_CE 4.2.1.0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TPC-H"}),(0,s.jsx)(n.td,{children:"V3.0.0"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"tenant-specifications",children:"Tenant specifications"}),"\n",(0,s.jsxs)(n.p,{children:["After deployment, you need to create a tenant and a user for the TPC-H benchmark. The sys tenant is a built-in tenant for cluster management and cannot be used for testing. Set the ",(0,s.jsx)(n.code,{children:"primary_zone"})," parameter to ",(0,s.jsx)(n.code,{children:"RANDOM"}),", which means that the leader of a new partition is randomly distributed to any OBServer node."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE RESOURCE UNIT tpch_unit max_cpu 26, memory_size '100g';\nCREATE RESOURCE POOL tpch_pool unit = 'tpch_unit', unit_num = 1, zone_list=('zone1','zone2','zone3');\nCREATE TENANT tpch_mysql resource_pool_list=('tpch_pool'),  zone_list('zone1', 'zone2', 'zone3'), primary_zone=RANDOM, locality='F@zone1,F@zone2,F@zone3' set variables ob_compatibility_mode='mysql', ob_tcp_invited_nodes='%', secure_file_priv = '/';\n"})}),"\n",(0,s.jsx)(n.h2,{id:"use-obd-to-run-the-benchmark",children:"Use OBD to run the benchmark"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Note"})}),"\n",(0,s.jsxs)(n.p,{children:["If you use OBD to run the test, the test cluster must be a cluster managed by OBD. By default, a cluster deployed by using OBD is managed by OBD. To use a cluster deployed by using another method as the test cluster, you need to take over the cluster to OBD. For more information, see ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/obd-en",children:"User Guide of OBD"})," in OceanBase Deployer Documentation."]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install obtpch"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"sudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo\nsudo yum install obtpch\nsudo ln -s /usr/tpc-h-tools/tpc-h-tools/ /usr/local/\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Run the benchmark."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"obd test tpch <deploy_name>  --tenant=<tenant_name> -s 100 --remote-tbl-dir=/tmp/tpch100\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the command, ",(0,s.jsx)(n.code,{children:"deploy_name"})," specifies the cluster name and ",(0,s.jsx)(n.code,{children:"tenant_name"})," specifies the tenant name, which is ",(0,s.jsx)(n.code,{children:"tpch_mysql"})," in the ",(0,s.jsx)(n.a,{href:"#Tenant_specifications",children:"Tenant specifications"})," section. You need to modify the cluster name and tenant name based on the actual situation."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The remote directory specified by ",(0,s.jsx)(n.code,{children:"remote-tbl-dir"})," must have sufficient capacity to store TPC-H data. We recommend that you specify an independent disk to store loaded test data."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"obd test tpch"})," command automatically completes all operations, including generating test data, tuning performance parameters, importing data, and running the benchmark. For more information about the command, see ",(0,s.jsx)(n.strong,{children:"obd test tpch"})," in ",(0,s.jsx)(n.a,{href:"https://en.oceanbase.com/docs/community-obd-en-10000000001181574",children:"OBD Command > Testing commands"})," in OceanBase Deployer Documentation."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"manually-run-the-tpc-h-benchmark",children:"Manually run the TPC-H benchmark"}),"\n",(0,s.jsx)(n.h3,{id:"step-1-tune-parameters",children:"Step 1: Tune parameters"}),"\n",(0,s.jsx)(n.p,{children:"Before you run the TPC-H benchmark, you need to tune related parameters."}),"\n",(0,s.jsxs)(n.p,{children:["Run the ",(0,s.jsx)(n.code,{children:"obclient -h<host_ip> -P<host_port> -uroot@sys -A -p"})," command to connect to the sys tenant. Then, execute the following statements:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"ALTER SYSTEM flush plan cache GLOBAL;\nALTER system SET enable_sql_audit=false;\nALTER system SET enable_perf_event=false;\nALTER system SET syslog_level='PERF';\nalter system set enable_record_trace_log=false;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Run the ",(0,s.jsx)(n.code,{children:"obclient -h<host_ip> -P<host_port> -u<user_name>@<tenant_name> -A -p"})," command to connect to the test tenant. Then, execute the following statements:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"# Set the percentage of the SQL workspace memory to the total memory of the tenant\nSET GLOBAL ob_sql_work_area_percentage = 80;\n# Set the maximum execution time of an SQL statement\nSET GLOBAL ob_query_timeout = 36000000000;\n# Set the timeout period of transactions\nSET GLOBAL ob_trx_timeout = 36000000000;\n# Set the maximum size of network packets\nSET GLOBAL max_allowed_packet = 67108864;\n# Set the number of PX threads that can be requested by the tenant on each node\nSET GLOBAL parallel_servers_target = 624;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-install-the-tpc-h-tool",children:"Step 2: Install the TPC-H tool"}),"\n",(0,s.jsx)(n.p,{children:"Perform the following steps to install the TPC-H tool:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Download the TPC-H tool."}),"\n",(0,s.jsxs)(n.p,{children:["Download the TPC-H tool from ",(0,s.jsx)(n.a,{href:"https://www.tpc.org/tpc_documents_current_versions/download_programs/tools-download-request5.asp?bm_type=TPC-H&bm_vers=3.0.0&mode=CURRENT-ONLY",children:"TPC-H Tools Download"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Decompress the TPC-H tool package."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@test ~]$ unzip *-tpc-h-tool.zip\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Modify the ",(0,s.jsx)(n.code,{children:"Makefile"})," file."]}),"\n",(0,s.jsxs)(n.p,{children:["In the ",(0,s.jsx)(n.code,{children:"TPC-H_Tools_v3.0.0/dbgen"})," directory, run the following command to copy the ",(0,s.jsx)(n.code,{children:"makefile.suite"})," file and rename it as ",(0,s.jsx)(n.code,{children:"Makefile"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@test dbgen]$ cp makefile.suite Makefile\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Redefine the ",(0,s.jsx)(n.code,{children:"CC"}),", ",(0,s.jsx)(n.code,{children:"DATABASE"}),", ",(0,s.jsx)(n.code,{children:"MACHINE"}),", and ",(0,s.jsx)(n.code,{children:"WORKLOAD"})," parameters in the ",(0,s.jsx)(n.code,{children:"Makefile"})," file. The content after the modification is as follows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"CC      = gcc\n# Current values for DATABASE are: INFORMIX, DB2, TDAT (Teradata)\n#                                  SQLSERVER, SYBASE, ORACLE, VECTORWISE\n# Current values for MACHINE are: ATT, DOS, HP, IBM, ICL, MVS,\n#                                  SGI, SUN, U2200, VMS, LINUX, WIN32\n# Current values for WORKLOAD are: TPCH\nDATABASE= MYSQL\nMACHINE = LINUX\nWORKLOAD = TPCH\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Modify the ",(0,s.jsx)(n.code,{children:"tpcd.h"})," file."]}),"\n",(0,s.jsxs)(n.p,{children:["Modify the ",(0,s.jsx)(n.code,{children:"tpcd.h"})," file in the ",(0,s.jsx)(n.code,{children:"dbgen"})," directory and add new macro definitions."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@test dbgen]$ vim tpcd.h\n"})}),"\n",(0,s.jsx)(n.p,{children:"Add the following content to the file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'#ifdef MYSQL\n#define GEN_QUERY_PLAN ""\n#define START_TRAN "START TRANSACTION"\n#define END_TRAN "COMMIT"\n#define SET_OUTPUT ""\n#define SET_ROWCOUNT "limit %d;\\n"\n#define SET_DBASE "use %s;\\n"\n#endif\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Compile the file."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@test dbgen]$ make\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"step-3-generate-data",children:"Step 3: Generate data"}),"\n",(0,s.jsxs)(n.p,{children:["Generate 10 GB, 100 GB, or 1 TB of data for the TPC-H benchmark based on the actual environment. Run the following command in the ",(0,s.jsx)(n.code,{children:"dbgen"})," directory to generate 100 GB of data:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@test dbgen]$ ./dbgen -s 100\n[admin@test dbgen]$ mkdir tpch100\n[admin@test dbgen]$ mv *.tbl tpch100\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-5-generate-sql-query-statements",children:"Step 5: Generate SQL query statements"}),"\n",(0,s.jsxs)(n.p,{children:["You can perform the following steps to generate and modify the SQL query statements, or directly use the SQL query statements provided on ",(0,s.jsx)(n.a,{href:"https://github.com/oceanbase/obdeploy/tree/master/plugins/tpch/4.0.0.0/queries",children:"GitHub"}),". If you use the SQL statements provided on GitHub, you need to change the value of the ",(0,s.jsx)(n.code,{children:"cpu_num"})," parameter in the SQL statements to the actual concurrency."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Copy the ",(0,s.jsx)(n.code,{children:"qgen"})," and ",(0,s.jsx)(n.code,{children:"dists.dss"})," files to the ",(0,s.jsx)(n.code,{children:"queries"})," directory."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@test dbgen]$ cp qgen queries\n[admin@test dbgen]$ cp dists.dss queries\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Create a script named ",(0,s.jsx)(n.code,{children:"gen.sh"})," in the ",(0,s.jsx)(n.code,{children:"queries"})," directory to generate SQL query statements."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost queries]$ vim gen.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"The script content is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'#!/usr/bin/bash\nfor i in {1..22}\ndo  \n./qgen -d $i -s 100 > db"$i".sql\ndone\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Run the ",(0,s.jsx)(n.code,{children:"gen.sh"})," script."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost queries]$ chmod +x  gen.sh\n[admin@localhost queries]$ ./gen.sh\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Adjust the SQL query statements."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost queries]$ dos2unix *\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For more information about the modified SQL query statements, see ",(0,s.jsx)(n.a,{href:"https://github.com/oceanbase/obdeploy/tree/master/plugins/tpch/3.1.0/queries",children:"GitHub"}),". You need to change the value of the ",(0,s.jsx)(n.code,{children:"cpu_num"})," parameter in the SQL statements provided on GitHub to the actual concurrency. We recommend that the concurrency value be the same as the total number of available CPU cores to achieve the optimal performance. You can run the following command in the sys tenant to query the total number of available CPU cores of a tenant:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT sum(cpu_capacity_max) FROM __all_virtual_server;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Here is a sample SQL query statement ",(0,s.jsx)(n.code,{children:"q1"})," after modification:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT /*+    parallel(96) */   ---Specify the execution concurrency.\n  l_returnflag,\n  l_linestatus,\n  sum(l_quantity) as sum_qty,\n  sum(l_extendedprice) as sum_base_price,\n  sum(l_extendedprice * (1 - l_discount)) as sum_disc_price,\n  sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge,\n  avg(l_quantity) as avg_qty,\n  avg(l_extendedprice) as avg_price,\n  avg(l_discount) as avg_disc,\n  count(*) as count_order\nFROM\n  lineitem\nWHERE\n  l_shipdate <= date '1998-12-01' - interval '90' day\nGROUP BY\n  l_returnflag,\n  l_linestatus\nORDER BY\n  l_returnflag,\n  l_linestatus;\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"step-6-create-a-table",children:"Step 6: Create a table"}),"\n",(0,s.jsxs)(n.p,{children:["Create a folder named ",(0,s.jsx)(n.code,{children:"load"})," in the ",(0,s.jsx)(n.code,{children:"dbgen"})," directory, and then create a table schema file named ",(0,s.jsx)(n.code,{children:"create_tpch_mysql_table_part.ddl"})," in the ",(0,s.jsx)(n.code,{children:"load"})," folder."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost dbgen]$ mkdir load\n[admin@localhost dbgen]$ cd load\n[admin@localhost load]$ vim create_tpch_mysql_table_part.ddl\n"})}),"\n",(0,s.jsx)(n.p,{children:"The file content is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"DROP TABLE IF EXISTS lineitem;\nDROP TABLE IF EXISTS orders;\nDROP TABLE IF EXISTS partsupp;\nDROP TABLE IF EXISTS part;\nDROP TABLE IF EXISTS customer;\nDROP TABLE IF EXISTS supplier;\nDROP TABLE IF EXISTS nation;\nDROP TABLE IF EXISTS region;\nDROP TABLEGROUP IF EXISTS tpch_tg_lineitem_order_group;\nDROP TABLEGROUP IF EXISTS tpch_tg_partsupp_part;\n\nCREATE TABLEGROUP IF NOT EXISTS tpch_tg_lineitem_order_group binding true partition by key 1 partitions cpu_num;\nCREATE TABLEGROUP IF NOT EXISTS tpch_tg_partsupp_part binding true partition by key 1 partitions cpu_num;\n\nDROP TABLE IF EXISTS lineitem;\nCREATE TABLE lineitem (\n  l_orderkey BIGINT NOT NULL,\n  l_partkey BIGINT NOT NULL,\n  l_suppkey INTEGER NOT NULL,\n  l_linenumber INTEGER NOT NULL,\n  l_quantity DECIMAL(15,2) NOT NULL,\n  l_extendedprice DECIMAL(15,2) NOT NULL,\n  l_discount DECIMAL(15,2) NOT NULL,\n  l_tax DECIMAL(15,2) NOT NULL,\n  l_returnflag char(1) DEFAULT NULL,\n  l_linestatus char(1) DEFAULT NULL,\n  l_shipdate date NOT NULL,\n  l_commitdate date DEFAULT NULL,\n  l_receiptdate date DEFAULT NULL,\n  l_shipinstruct char(25) DEFAULT NULL,\n  l_shipmode char(10) DEFAULT NULL,\n  l_comment varchar(44) DEFAULT NULL,\n  PRIMARY KEY(l_orderkey, l_linenumber))row_format = condensed\n  tablegroup = tpch_tg_lineitem_order_group\n  partition by key (l_orderkey) partitions cpu_num;\n\nDROP TABLE IF EXISTS orders;\nCREATE TABLE orders (\n  o_orderkey bigint not null,\n  o_custkey bigint not null,\n  o_orderstatus char(1) default null,\n  o_totalprice bigint default null,\n  o_orderdate date not null,\n  o_orderpriority char(15) default null,\n  o_clerk char(15) default null,\n  o_shippriority bigint default null,\n  o_comment varchar(79) default null,\n  PRIMARY KEY (o_orderkey))row_format = condensed\n  tablegroup = tpch_tg_lineitem_order_group\n  partition by key(o_orderkey) partitions cpu_num;\n\nDROP TABLE IF EXISTS partsupp;\nCREATE TABLE partsupp (\n  ps_partkey bigint not null,\n  ps_suppkey bigint not null,\n  ps_availqty bigint default null,\n  ps_supplycost bigint default null,\n  ps_comment varchar(199) default null,\n  PRIMARY KEY (ps_partkey, ps_suppkey))row_format = condensed\n  tablegroup tpch_tg_partsupp_part\n  partition by key(ps_partkey) partitions cpu_num;\n\nDROP TABLE IF EXISTS part;\nCREATE TABLE part (\n  p_partkey bigint not null,\n  p_name varchar(55) default null,\n  p_mfgr char(25) default null,\n  p_brand char(10) default null,\n  p_type varchar(25) default null,\n  p_size bigint default null,\n  p_container char(10) default null,\n  p_retailprice bigint default null,\n  p_comment varchar(23) default null,\n  PRIMARY KEY (p_partkey))row_format = condensed\n  tablegroup tpch_tg_partsupp_part\n  partition by key(p_partkey) partitions cpu_num;\n\nDROP TABLE IF EXISTS customer;\nCREATE TABLE customer (\n  c_custkey bigint not null,\n  c_name varchar(25) default null,\n  c_address varchar(40) default null,\n  c_nationkey bigint default null,\n  c_phone char(15) default null,\n  c_acctbal bigint default null,\n  c_mktsegment char(10) default null,\n  c_comment varchar(117) default null,\n  PRIMARY KEY (c_custkey))row_format = condensed\n  partition by key(c_custkey) partitions cpu_num;\n\nDROP TABLE IF EXISTS supplier;\nCREATE TABLE supplier (\n  s_suppkey bigint not null,\n  s_name char(25) default null,\n  s_address varchar(40) default null,\n  s_nationkey bigint default null,\n  s_phone char(15) default null,\n  s_acctbal bigint default null,\n  s_comment varchar(101) default null,\n  PRIMARY KEY (s_suppkey))row_format = condensed\n  partition by key(s_suppkey) partitions cpu_num;\n\nDROP TABLE IF EXISTS nation;\nCREATE TABLE nation (\n  n_nationkey bigint not null,\n  n_name char(25) default null,\n  n_regionkey bigint default null,\n  n_comment varchar(152) default null,\n  PRIMARY KEY (n_nationkey))row_format = condensed;\n\nDROP TABLE IF EXISTS region;\nCREATE TABLE region (\n  r_regionkey bigint not null,\n  r_name char(25) default null,\n  r_comment varchar(152) default null,\n  PRIMARY KEY (r_regionkey))row_format = condensed;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-7-load-data",children:"Step 7: Load data"}),"\n",(0,s.jsx)(n.p,{children:"Write a script based on the data and SQL query statements generated in the preceding steps. Perform the following steps to load data:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Create a script named ",(0,s.jsx)(n.code,{children:"load.py"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost load]$ vim load.py\n"})}),"\n",(0,s.jsx)(n.p,{children:"The script content is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python\n#-*- encoding:utf-8 -*-\nimport os\nimport sys\nimport time\nimport commands\nhostname=\'$host_ip\'  # Notice! ! Enter the host name of an OBServer node, for example, the IP address of the server where OBServer node A resides.\nport=\'$host_port\'               # The port number of OBServer node A.\ntenant=\'$tenant_name\'              # The tenant name.\nuser=\'$user\'               # The username.\npassword=\'$password\'           # The password.\ndata_path=\'$path\'         # Notice! ! Enter the directory of the table on the server where OBServer node A resides.\ndb_name=\'$db_name\'             # The database name.\n# Create a table.\ncmd_str=\'obclient -h%s -P%s -u%s@%s -p%s -D%s < create_tpch_mysql_table_part.ddl\'%(hostname,port,user,tenant,password,db_name)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=\'obclient -h%s -P%s -u%s@%s -p%s  -D%s -e "show tables;" \'%(hostname,port,user,tenant,password,db_name)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s -c  -D%s -e "load data /*+ parallel(80) */ infile \'%s/customer.tbl\' into table customer fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s -c  -D%s -e "load data /*+ parallel(80) */ infile \'%s/lineitem.tbl\' into table lineitem fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s -c -D%s -e "load data /*+ parallel(80) */ infile \'%s/nation.tbl\' into table nation fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s -c  -D%s -e "load data /*+ parallel(80) */ infile \'%s/orders.tbl\' into table orders fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s   -D%s -e "load data /*+ parallel(80) */ infile \'%s/partsupp.tbl\' into table partsupp fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s -c  -D%s -e "load data /*+ parallel(80) */ infile \'%s/part.tbl\' into table part fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s -c  -D%s -e "load data /*+ parallel(80) */ infile \'%s/region.tbl\' into table region fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\ncmd_str=""" obclient -h%s -P%s -u%s@%s -p%s -c  -D%s -e "load data /*+ parallel(80) */ infile \'%s/supplier.tbl\' into table supplier fields terminated by \'|\';" """ %(hostname,port,user,tenant,password,db_name,data_path)\nresult = commands.getstatusoutput(cmd_str)\nprint result\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Load data."}),"\n",(0,s.jsx)(n.p,{children:"To load data, you need to install the OBClient."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost load]$ python load.py\n"})}),"\n",(0,s.jsx)(n.p,{children:"The output is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"(0,'')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.   \\nTABLE_NAME\\nT1\\nLINEITEM\\nORDERS\\nPARTSUPP\\nPART\\nCUSTOMER\\nSUPPLIER\\nNATION\\nREGION')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.')\n(0, 'obclient: [Warning] Using a password on the command line interface can be insecure.')\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Perform a major compaction."}),"\n",(0,s.jsx)(n.p,{children:"Log on as the root user to the sys tenant of the OceanBase cluster. Run the following command to compact SSTables and MEMTables of the current major version with the full static data of an earlier version, to ensure that the storage-layer statistics are more accurate and the generated execution plan is more stable."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"<your tenant name>"})," indicates the name of the test tenant, which is ",(0,s.jsx)(n.code,{children:"tpch_mysql"})," in the ",(0,s.jsx)(n.a,{href:"#Tenant_specifications",children:"Tenant specifications"})," section. You need to replace it with the actual test tenant name."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"obclient [oceanbase]> ALTER SYSTEM major freeze tenant=<your tenant name>;\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Check whether the major compaction is completed."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_MAJOR_COMPACTION;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If the value of the ",(0,s.jsx)(n.code,{children:"STATUS"})," column in the returned information is ",(0,s.jsx)(n.code,{children:"IDLE"}),", the major compaction is completed."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"+-----------+---------------------+----------------------------+----------------------+---------------------+----------------------------+----------------------------+--------+----------+--------------+------+\n| TENANT_ID | FROZEN_SCN          | FROZEN_TIME                | GLOBAL_BROADCAST_SCN | LAST_SCN            | LAST_FINISH_TIME           | START_TIME                 | STATUS | IS_ERROR | IS_SUSPENDED | INFO |\n+-----------+---------------------+----------------------------+----------------------+---------------------+----------------------------+----------------------------+--------+----------+--------------+------+\n|         1 | 1709661601360541623 | 2024-03-06 02:00:01.360542 |  1709661601360541623 | 1709661601360541623 | 2024-03-06 02:06:25.027267 | 2024-03-06 02:00:01.382794 | IDLE   | NO       | NO           |      |\n|      1001 | 1709661602742784187 | 2024-03-06 02:00:02.742784 |  1709661602742784187 | 1709661602742784187 | 2024-03-06 02:05:36.148110 | 2024-03-06 02:00:02.780978 | IDLE   | NO       | NO           |      |\n|      1002 | 1709661600590790760 | 2024-03-06 02:00:00.590791 |  1709661600590790760 | 1709661600590790760 | 2024-03-06 02:05:43.819029 | 2024-03-06 02:00:00.641044 | IDLE   | NO       | NO           |      |\n+-----------+---------------------+----------------------------+----------------------+---------------------+----------------------------+----------------------------+--------+----------+--------------+------+\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Collect statistics."}),"\n",(0,s.jsxs)(n.p,{children:["Run the ",(0,s.jsx)(n.code,{children:"obclient -h<host_ip> -P<host_port> -u<user_name>@<tenant_name> -p -A -D<db_name>"})," command to connect to the test tenant. Then, run the following command, where ",(0,s.jsx)(n.code,{children:"$db_name"})," needs to be replaced with the ",(0,s.jsx)(n.code,{children:"db_name"})," value configured in the ",(0,s.jsx)(n.code,{children:"load.py"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"obclient [oceanbase]> call dbms_stats.gather_schema_stats('$db_name',degree=>96);\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"step-8-run-the-benchmark",children:"Step 8: Run the benchmark"}),"\n",(0,s.jsx)(n.p,{children:"You can write a script based on the data and SQL query statements generated in the preceding steps. Perform the following steps to run the benchmark:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Write the ",(0,s.jsx)(n.code,{children:"tpch.sh"})," test script in the ",(0,s.jsx)(n.code,{children:"queries"})," directory."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost queries]$ vim tpch.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"The script content is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'#!/bin/bash\nTPCH_TEST="obclient -h ${host_ip} -P ${host_port} -uroot@tpch_mysql  -D ${db_name}  -p${password} -c"\n# Run a warmup.\nfor i in {1..22}\ndo\n    sql1="source db${i}.sql"\n    echo $sql1| $TPCH_TEST >db${i}.log  || ret=1\ndone\n# Run the formal test.\nfor i in {1..22}\ndo\n    starttime=`date +%s%N`\n    echo `date  \'+[%Y-%m-%d %H:%M:%S]\'` "BEGIN Q${i}"\n    sql1="source db${i}.sql"\n    echo $sql1| $TPCH_TEST >db${i}.log  || ret=1\n    stoptime=`date +%s%N`\n    costtime=`echo $stoptime $starttime | awk \'{printf "%0.2f\\n", ($1 - $2) / 1000000000}\'`\n    echo `date  \'+[%Y-%m-%d %H:%M:%S]\'` "END,COST ${costtime}s"\ndone\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Execute the test script."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"[admin@localhost queries]$ sh tpch.sh\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"test-results",children:"Test results"}),"\n",(0,s.jsx)(n.p,{children:"The performance test data is affected by various factors, such as hardware configurations, database installation and deployment modes, and resources allocated to the business tenant for testing. Therefore, the test results are for reference only and the actual performance data can vary depending on the environment."}),"\n",(0,s.jsx)(n.p,{children:"The size of the test dataset is 100 GB."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Query ID"}),(0,s.jsx)(n.th,{children:"Response time of the three-node OceanBase Database V4.2.1 cluster (seconds)"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q1"}),(0,s.jsx)(n.td,{children:"2.24"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q2"}),(0,s.jsx)(n.td,{children:"0.48"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q3"}),(0,s.jsx)(n.td,{children:"1.49"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q4"}),(0,s.jsx)(n.td,{children:"0.66"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q5"}),(0,s.jsx)(n.td,{children:"0.95"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q6"}),(0,s.jsx)(n.td,{children:"0.14"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q7"}),(0,s.jsx)(n.td,{children:"1.35"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q8"}),(0,s.jsx)(n.td,{children:"1.09"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q9"}),(0,s.jsx)(n.td,{children:"4.46"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q10"}),(0,s.jsx)(n.td,{children:"0.95"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q11"}),(0,s.jsx)(n.td,{children:"0.19"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q12"}),(0,s.jsx)(n.td,{children:"1.34"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q13"}),(0,s.jsx)(n.td,{children:"1.86"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q14"}),(0,s.jsx)(n.td,{children:"0.41"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q15"}),(0,s.jsx)(n.td,{children:"0.88"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q16"}),(0,s.jsx)(n.td,{children:"0.67"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q17"}),(0,s.jsx)(n.td,{children:"1.57"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q18"}),(0,s.jsx)(n.td,{children:"0.91"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q19"}),(0,s.jsx)(n.td,{children:"0.64"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q20"}),(0,s.jsx)(n.td,{children:"1.12"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q21"}),(0,s.jsx)(n.td,{children:"2.52"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Q22"}),(0,s.jsx)(n.td,{children:"1.11"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Total"}),(0,s.jsx)(n.td,{children:"27.03"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var s=t(96540);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);